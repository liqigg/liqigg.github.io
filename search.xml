<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>我们都不善表达心里都藏着真话</title>
      <link href="/2023/12/21/%E6%96%87%E6%A1%A3/%E7%BD%97%E7%BF%94%E8%AF%AD%E5%BD%951/"/>
      <url>/2023/12/21/%E6%96%87%E6%A1%A3/%E7%BD%97%E7%BF%94%E8%AF%AD%E5%BD%951/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img1.baidu.com/it/u=3708199491,2218027625&fm=253&fmt=auto&app=120&f=JPEG?w=500&h=500" alt="世界的美好与你环环相扣"></p><h2 id="真正的勇敢是一种坚持"><a href="#真正的勇敢是一种坚持" class="headerlink" title="真正的勇敢是一种坚持"></a>真正的勇敢是一种坚持</h2><p>就比如说我看上谁我就喜欢上谁</p><p>我爱谁我就想跟谁在一起</p><p>这个不叫做勇敢，也不叫做勇气</p><p>真正的勇敢是你能够拒绝诱惑</p><p>始终如一的爱一个人</p><p>这个才能叫做勇敢<br><img src="https://img2.baidu.com/it/u=2366470892,3397085334&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=666" alt="世界的美好与你环环相扣"></p><p><strong>如果爱只是一种感觉，那么当他遇到挑战，这种感觉很快就会消失，因为我们很容易在不同的人身上获得这种感觉，所以移情别恋最经常的说辞就是我没有感觉，但真正的爱并非一种感觉，他更多的是一种责任，是一种彼此的牺牲和彼此的长久，真正的爱一定不是瞬间的感到，而必然是很久的一种委身，彼此牺牲，彼此成就，彼此尊重。</strong></p><h2 id="爱情是没有技巧的，有的只有真心，忍耐和缘分"><a href="#爱情是没有技巧的，有的只有真心，忍耐和缘分" class="headerlink" title="爱情是没有技巧的，有的只有真心，忍耐和缘分"></a>爱情是没有技巧的，有的只有真心，忍耐和缘分</h2><p><strong>其实谁对你的评价是最重要的，只有你最在乎的人，他们对你的评价才是最重要的</strong></p><p><strong>你最在乎的人，他们的爱可能胜过一切的赞誉，也足以弥补别人对你的一切的批评</strong></p><p><img src="https://img2.baidu.com/it/u=4108974965,4144496583&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="世界的美好与你环环相扣"></p><h2 id="看东西只有用心才能看的清楚，而重要的东西，用眼睛是看不见的"><a href="#看东西只有用心才能看的清楚，而重要的东西，用眼睛是看不见的" class="headerlink" title="看东西只有用心才能看的清楚，而重要的东西，用眼睛是看不见的"></a>看东西只有用心才能看的清楚，而重要的东西，用眼睛是看不见的</h2><p>权利，金钱，名望，这些看得见的东西，他不可能给我们带来真正的满足</p><p>我们只有为那看不见的东西，而活着</p><p><strong>爱，是看不见的</strong></p><p><strong>爱，是要用心去感受的</strong></p><p><strong>互相迁就才能长久，双向奔赴才有意义。</strong><br><img src="https://img0.baidu.com/it/u=2995761493,3584690677&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="世界的美好与你环环相扣"></p>]]></content>
      
      
      <categories>
          
          <category> 男孩文案 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 我们都不善表达心里都藏着真话 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于认知--罗翔</title>
      <link href="/2023/12/20/%E6%96%87%E6%A1%A3/%E7%BD%97%E7%BF%942/"/>
      <url>/2023/12/20/%E6%96%87%E6%A1%A3/%E7%BD%97%E7%BF%942/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img0.baidu.com/it/u=674388584,4098422968&fm=253&fmt=auto&app=138&f=JPEG?w=501&h=500" alt="世界的美好与你环环相扣"></p><h1 id="关于认知"><a href="#关于认知" class="headerlink" title="关于认知"></a>关于认知</h1><ol><li><p>人最大的痛苦，就在于你知道什么是好的，但永远做出错误的选择。</p></li><li><p>在自由的状态下，人绝大多数是选择崇高还是选择堕落？</p></li></ol><p>大家自己可以问自己一个问题，如果完全不受限制，你是向往崇高还是向往堕落？</p><p>自由意味着责任，正因为如此，多数人都惧怕自由。</p><ol start="3"><li>如果我的手机不关的话，我看柏拉图的《理想国》，看5分钟就会开始玩手机。</li></ol><p>玩两个小时然后把手机一摔，说：“我怎么是这种人呢！”然后又接着看10分钟柏拉图，然后又看手机。</p><p>所以需要受到限制，我现在看书一般把手机关了，我直接把网络给砸了。</p><ol start="4"><li>真正的自由是自律的自由，不是放纵的自由。</li></ol><p><img src="https://img1.baidu.com/it/u=801651472,2538739595&fm=253&fmt=auto&app=138&f=JPEG?w=526&h=500" alt="世界的美好与你环环相扣"><br>005.<br>我们终将毁灭于我们热爱的东西，而且所有那些看起来很爽的东西，都是瞬间的感觉，而人类所有真实的快乐，一定是恒久的努力。</p><p>快乐是不能走捷径的，所有的快乐都意味着艰辛的努力。</p><p>快乐只是责任的副产品，脱离责任去追求快乐，最后得到的一定是痛苦。</p><ol start="6"><li><p>低级的快乐来自放纵，高级的快乐来自克制。</p></li><li><p>越能体现人性尊严的快乐，越是一种最高级的快乐。</p></li></ol><p>我们之所以读书、行路，其实就是希望我们能够不断地享受什么快乐呢？高级快乐。</p><p>当你享受高级快乐并不会失去低级快乐，对吧。我读莎士比亚并不妨碍我读郭德纲的相声。但是如果你的眼目永远只关注地下，你永远不知道向上看有多么的快乐。</p><ol start="8"><li>做你该做的事，并接受它的事与愿违。</li></ol><p>我们太有限了，我们只能做我们觉得是对的事情。</p><p>因为人生所有东西都是有“负斜率”的，你在向上奔跑的时候，可能就慢慢地偏离了最初的目标，所以这就是为什么不要对自己所投入、所看重的事情，抱有不加边际的幻想和热情。</p><p><img src="https://img0.baidu.com/it/u=3138718657,3160891789&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="世界的美好与你环环相扣"><br>009.<br>人类最大的弱点之一就是自命不凡的幻想。</p><ol start="10"><li>有的时候偏见比无知更为可怕，因为无知的人承认自己的无知，所以不会轻易地进行论断。</li></ol><p>但是偏见的人自以为是、自以为知，所以很容易做出断言。</p><ol start="11"><li>一个知识越贫乏的人，越是拥有一种莫名奇怪的勇气和一种莫名奇怪的自豪感。</li></ol><p>因为知识越贫乏，你所相信的东西就越绝对。因为你根本没有听过与此相对立的观点。</p><p>夜郎自大是无知者、好辩事者的天性。</p><ol start="12"><li>一个农夫来到城市，他不是蠢，他只是不太理解，什么叫交通规则。一个城里人来到农村，也不能说他蠢，他只是分不清稻子和麦子。</li></ol><p>所以，如果遇到和自己观点不同的人，希望能够本着求同存异的心，而不是带有知识的优越感。</p><ol start="13"><li>过于崇尚知识，又何尝不是一种同样愚蠢的偏见。</li></ol><p><img src="https://img1.baidu.com/it/u=546883209,4030279815&fm=253&fmt=auto&app=120&f=JPEG?w=500&h=500" alt="世界的美好与你环环相扣"><br>014.<br>苏格拉底说，人心中的欲念是一个筛子，筛子装不满水，无论多少东西都填满不了人心。</p><p>所以人的欲望一定要限定在一个具体的事情上，这样你才会有真实的满足感，否则你不可能有满足感。</p><ol start="15"><li>当生命中缺少一个终极的敬仰对象，人就不可避免地会把自己置于生命中最重要的地位，形成无法抑制的自恋。</li></ol><p>什么是自恋？自恋就是缺乏对自己正确的认识。</p><p>一个自恋的人，因为他认清不了自己，他不仅会毁了他自己，也会毁了他身边的人。</p><ol start="16"><li>人性中充满矛盾，我们远比自己想象的更加自恋和道貌岸然。</li></ol><p><img src="https://img1.baidu.com/it/u=1715280521,29009551&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="世界的美好与你环环相扣"><br>017.<br>当我们越多地理解世界，我们也就越多地理解自己。</p><ol start="18"><li>一个人成熟的重要标志，就是在脑海中，能够同时存在两种看似对立的观点。</li></ol><p>而一个不成熟的标志，脑海中总是非此即彼、非黑即白。</p><ol start="19"><li>若不接受自己的卑微与渺小，我们很难发自内心地去尊重他人。</li></ol><p>人心隐藏着整个世界的败坏，我们每个人心中都藏着个张三。</p><p><img src="https://img0.baidu.com/it/u=3937108006,1804082063&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="世界的美好与你环环相扣"></p>]]></content>
      
      
      <categories>
          
          <category> 男孩文案 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 关于认知--罗翔 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于爱--罗翔</title>
      <link href="/2023/12/19/%E6%96%87%E6%A1%A3/%E7%BD%97%E7%BF%943/"/>
      <url>/2023/12/19/%E6%96%87%E6%A1%A3/%E7%BD%97%E7%BF%943/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img2.baidu.com/it/u=2837967446,3117221733&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="有你的地方就有暖阳"></p><h1 id="关于爱"><a href="#关于爱" class="headerlink" title="关于爱"></a>关于爱</h1><ol><li></li></ol><p>任何美好的情感都需要节制，否则美好就会成为邪恶却不自知。</p><ol start="2"><li></li></ol><p>远藤周作在《沉默》一书中有一句话很扎心：</p><p>“罪，并不是一般人所想象的，如盗窃、说谎。所谓罪，是指一个人通过另一个人的人生，却忘了留在那里的雪泥鸿爪。”</p><ol start="3"><li></li></ol><p>人和人的相处像刺猬一样，合在一起扎得疼，离开了又觉得孤独。</p><ol start="4"><li></li></ol><p>我们为什么害怕独处？</p><p>因为人在独处的时候，总是会听到心灵深处的声音。</p><ol start="5"><li></li></ol><p>人跟人的关系，就像存钱。你必须先存钱才能取钱。</p><p>如果只取钱不存钱，这叫恶意透支，你的账户就破产了呀，所以如果你想从他人的身上支取感情。你首先要存入足够多的感情。<br><img src="https://img0.baidu.com/it/u=674388584,4098422968&fm=253&fmt=auto&app=138&f=JPEG?w=501&h=500" alt="有你的地方就有暖阳"><br>06.</p><p>如果人的一生只是为了追求自我的利益，那么人生难免像陀螺一般，要靠着功名利禄不断鞭策，才能在虚荣和虚空中不断转动。但总有一天你的人生会停摆。</p><ol start="7"><li></li></ol><p>我们以为贫穷就是饥饿、衣不蔽体和没有房屋，然而最大的贫穷，却是不被需要、没有爱和不被关心。</p><ol start="8"><li></li></ol><p>真正的朋友，并不会嘲笑你的软弱，你也无需假装强大。</p><p>你不需要开着豪车，在朋友面前通过炫耀来掩饰你内心的贫穷；也不需要用各种高深莫测的哲学大词，在朋友面前夸夸其谈来掩盖你的无知。</p><p>在真正的朋友面前，我们是不需要戴上面具的，我们只需要有天赐的真诚与天赐的真心。</p><ol start="9"><li></li></ol><p>罗素称自己活着有3个动力：1. 对爱情的渴望；2. 对知识的追求；3. 对人类苦难不可遏制的同情心。</p><p>但罗素只爱概念上的人类，不爱具体的人。他热爱民众，并为他们的苦难而痛苦，但他依旧远离他们；他主张人人平等，却从未放弃自己的伯爵头衔；他主张男女平等，却是为了有更大的性自由去拈花惹草。<br><img src="https://img1.baidu.com/it/u=590774462,1489265337&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="有你的地方就有暖阳"><br>10.</p><p>真正的爱从来不是一种表演，它常常体现在每天的接人待物中，对某个个体发自内心的尊重。</p><p>只不过在我们这个时代，人的物化几乎成为了主流，对人的尊重很多时候被认为是一种弱者的行径。</p><ol start="11"><li></li></ol><p>无须付出代价的爱不是为了欺骗自己，就是为了欺骗他人。</p><ol start="12"><li></li></ol><p>很多人为了寻找爱情，在不同的情人中周旋探索，最终觉得自己越来越孤独。</p><p>原因就在于，自恋的爱，永远不能长久，任何一个人都无法达到你对他的全部预设。</p><p>一个可爱的人，人人都会去爱他&#x2F;她，但当他&#x2F;她不再像以前那么可爱，你还去爱他&#x2F;她，而且愿意去发掘他&#x2F;她的可爱之处，那这可能就是真正的爱了。</p><ol start="13"><li></li></ol><p>自恋让人缺乏安全感。</p><p>人知道自己的有限，无法主宰未来，但自恋让人靠不断的自我提升来对抗对未来的焦虑。</p><p>只不过不断的自我成功带来的却是更大的不安全感，以及对同类更深的敌意。人们总是在贪图虚名，互相嫉妒。</p><p>在人的眼中，每个人都是潜在的竞争对象，没有朋友，只有敌人。<br><img src="https://img2.baidu.com/it/u=4013613449,90904937&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="有你的地方就有暖阳"><br>14.</p><p>责任和幸福谁更重要，责任显然更重要，只是我们这个时代的人更喜欢追求幸福。</p><ol start="15"><li></li></ol><p>要爱具体的人，不要爱抽象的人；</p><p>要爱生活，不要爱生活的意义。</p><p>因为人越是喜欢探讨抽象概念，越是觉得自己崇高。因为你越觉得抽象的人可爱，你就会越觉得身边的人不可爱。因为忙着爱人类，以至于没有时间爱具体的人。</p><ol start="16"><li></li></ol><p>人生真正要在意的，不就是少数几个人，你的亲人、三五个知己，这是每天跟你有交流的一些人，他们才是你最应该在乎的。</p><p>那些你没有见过面，可能一辈子也不会见的人，在某种意义上，无论是批评也罢、赞赏也罢，可能并没有我们想象中那么重要。</p><p>你最要在乎的，应该是你身边的人、你所爱的人，他们的意见。<br><img src="https://img1.baidu.com/it/u=2803455130,2119915553&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="有你的地方就有暖阳"><br>17.</p><p>在我的词汇中，勇敢是一个最高级的词汇。因为我自己不够勇敢，所以我认为，在人类所有的美德中，勇敢是最稀缺的。</p><p>当你愤恨自己不勇敢的时候，怎么办呢？</p><p>愤恨没有用，就当命运之神把你推向那勇敢的时刻，希望你能够像你想象中那么勇敢。</p><ol start="18"><li></li></ol><p>“昨天的已经成为过去，明天的还没有到来，所以今天是一个礼物。”</p><p>大家要把今天当作一个礼物，去珍惜、享受你现在拥有的平凡的幸福。</p><p>因为这种幸福你现在觉得平凡，但等到你失去它的那一天，你会觉得它是如此的珍贵。</p><ol start="19"><li></li></ol><p>这个世界上最伟大的东西、最宝贵的东西，其实都是免费的，空气、阳光和父母的爱，它们都是免费的。<br><img src="https://img0.baidu.com/it/u=880099421,318230831&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="有你的地方就有暖阳"></p>]]></content>
      
      
      <categories>
          
          <category> 男孩文案 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 关于爱--罗翔 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>闻神emo文案</title>
      <link href="/2023/12/17/%E6%96%87%E6%A1%A3/%E7%94%B7%E5%AD%A9%E6%96%87%E6%A1%884/"/>
      <url>/2023/12/17/%E6%96%87%E6%A1%A3/%E7%94%B7%E5%AD%A9%E6%96%87%E6%A1%884/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img1.baidu.com/it/u=2921360444,2657529019&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="世界的美好与你环环相扣"></p><h1 id="我们都不善表达心里都藏着真话"><a href="#我们都不善表达心里都藏着真话" class="headerlink" title="我们都不善表达心里都藏着真话"></a>我们都不善表达心里都藏着真话</h1><p>1.言语是把杀人不见血的刀</p><p>2.海的那边是什么已经不重要了</p><p>3.你失约的海我替你看了</p><p><img src="https://img1.baidu.com/it/u=584225703,1973838137&fm=253&fmt=auto?w=800&h=500" alt="世界的美好与你环环相扣"><br>4.走散的人或许从一开始就不顺路</p><p>5.她是我青春岁月里勇敢而又失败的一章</p><p>6.人总要和握不住的东西说再见</p><p><img src="https://img1.baidu.com/it/u=3365206613,3013473660&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" alt="世界的美好与你环环相扣"><br>7.天气越来越冷我的心也是</p><p>8.我们总以为机会无限所以不珍惜眼前人</p><p>9.岁月总是亏欠那些记忆力好却又偏偏念旧的人10.不循环的缘 断不了的念</p><p>11.时间不会回头感情岂会有如果</p><p><img src="https://img0.baidu.com/it/u=3372684447,3821477664&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="世界的美好与你环环相扣"><br>12.我们总觉得截图就能留住一些东西</p><p>13.情绪很多语言又有限</p><p>14.人与人的羁绊本就薄如蝉翼</p><p>15.念的不是旧是付出的真心<br><img src="https://img0.baidu.com/it/u=3874713340,2045829156&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" alt="世界的美好与你环环相扣"><br>16.人可以被代替但记忆不行</p><p>17.释怀太难只能等着烂在回忆里</p><p>18.也许人生要有遗憾才算圆满</p><p><img src="https://img0.baidu.com/it/u=3805806369,735024149&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" alt="世界的美好与你环环相扣"><br>19.我们都不善表达心里都藏着真话</p><p>20.再听一遍须车敬我们的初相识</p>]]></content>
      
      
      <categories>
          
          <category> 男孩文案 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 闻神emo文案 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于生活--罗翔</title>
      <link href="/2023/12/17/%E6%96%87%E6%A1%A3/%E7%BD%97%E7%BF%944/"/>
      <url>/2023/12/17/%E6%96%87%E6%A1%A3/%E7%BD%97%E7%BF%944/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img2.baidu.com/it/u=1434013347,2019413718&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="有你的地方就有暖阳"></p><h1 id="关于生活"><a href="#关于生活" class="headerlink" title="关于生活"></a>关于生活</h1><ol><li></li></ol><p>这世间，本就是各人下雪，各人有各人的隐晦与皎洁。</p><ol start="2"><li></li></ol><p>整个一生说白了，就是北大保安说的3句话：</p><p>你是谁？你去哪？你干嘛？</p><ol start="3"><li></li></ol><p>生活远比戏剧更荒诞与沉重。但荒诞不是让我们绝望，而是让我们重新滋生勇气与信心。</p><ol start="4"><li></li></ol><p>人生值得关注的事少之又少，我们就才区区3万多天，每天睡觉耗去了三分之一，每天做些无聊的事情，又耗去了一些时间，你还天天关注这、关注那，那其实真的很没有意义。<br><img src="https://img0.baidu.com/it/u=722331485,1234888975&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="有你的地方就有暖阳"><br>05.</p><p>误解是人生的常态。</p><p>理解是稀缺的例外。</p><ol start="6"><li></li></ol><p>人承认自己是有限性的，于是承认你的逻辑是有限的、承认你的理性是有限的、承认你的阅读是有限的、承认你整个人就是在偏见之中，你这一生就是在走出偏见。</p><p>我们求学问道，读万卷书、行万里路，就是为了走出我们基于地域、血统、民族所形成的偏见。</p><ol start="7"><li></li></ol><p>从逻辑上来说，光明跟黑暗其实不是二元对立的，因为所有的黑暗不过是光明的缺乏，所有的邪恶也都只是对良善的背离。因此，只有追求良善，在逻辑上才是自洽的。</p><p>所以真正的勇敢，其实是对良善的坚持。这种坚持本身就是一种幸福，只是也许大多数人并不期待这种幸福。</p><p>低垂的麦穗跟高傲的稗草其实长得很相似，很多人可能区分不出来，但是一个硕果累累，而另外一个是具有破坏性的杂草。所以是虚心地承认自己的有限，还是虚荣地认为自己无所不能，这是我们一生要去思考的话题。</p><ol start="8"><li></li></ol><p>要用行动、而不是空想，来对抗人生的痛苦和焦虑。<br><img src="https://img1.baidu.com/it/u=1335372199,879485646&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="有你的地方就有暖阳"><br>09.</p><p>我觉得，人生最大的痛苦就是无法跨越“知道”和“做到”的鸿沟。</p><p>笛卡尔所说的“我思故我在”，这个很对。</p><p>但是“我思故我在”经常让我们沉浸于一种幻想之中，就是我只要思考到了我就能做到，但其实不是这样，你思想过深刻的东西、你说过深刻的东西、你感动过深刻的东西，你为你自己所说的感动了，你就真的觉得自己做到了。</p><p>很多时候，这是一种自欺。</p><ol start="10"><li></li></ol><p>人，认清自己是最难的，所以每天我们需要学习如何去认清自己，因为它太难了。</p><ol start="11"><li></li></ol><p>真正的自由是做正确事情的自由。</p><p>随意吸毒不叫自由，可以控制自己不去沾染毒品才是自由；任意更换性伴侣、始乱终弃不是自由，可以约束自己的欲望才叫自由。</p><p>百花争妍，但仍能忠于命定的那朵玫瑰，才是真正的自由。<br><img src="https://img2.baidu.com/it/u=3718052930,929470444&fm=253&fmt=auto&app=138&f=JPEG?w=508&h=500" alt="有你的地方就有暖阳"><br>12.</p><p>我个人其实不太相信天道酬勤，因为如果你相信天道酬勤，很容易导致走向骄傲，或者走向虚无。</p><p>当你成功的时候，你觉得是靠你努力拼搏得来的，你配拥有这一切，所以你就瞧不起那些失败的人。但是当你努力了，最后依然失败、依然一事无成，你又会陷入一种极大的抱怨，你会觉得天道不公。</p><p>所以我个人，其实是更倾向于一种悖论式的命定论。人生中大部分的事情是你决定不了的，但是你自己一定要尽力而为。</p><p>我们一生中95%的事情可能是自己决定不了的，但是我们依然要用5%的努力去撬动那95%你无法决定的事情。</p><p>凡事尽力而为，但同时要接受命运一切的安排。</p><ol start="13"><li></li></ol><p>我们只需要活好今天，因为永恒由每个今天构成，每个今天都可以触摸永恒。</p><p>不要活在一切事情都能安排好的幻想中，我们每天都会创造一个新的故事，这个故事不是喜剧也不是悲剧，是悲喜剧。活好当下，做好每天该做的事。<br><img src="https://img1.baidu.com/it/u=3877935431,280298828&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="有你的地方就有暖阳"><br>14.</p><p>一个真正有韧性的人，他的姿态一定是谦卑，因为人的本性就是骄傲和傲慢，人总是以自我为中心，这是人不快乐的根源。</p><ol start="15"><li></li></ol><p>我曾经碰到过一个学生，他的遭遇真的让我感动：高考没考好，有人跟他说，你只要交钱就可以先上车、后补票。后来他进入一个学校读书，有学生证、有饭卡、有班级，也有宿舍，每次考试也都一模一样，4年之后也有毕业证。</p><p>但最后发现毕业证是假的。他考研也考上了，法考也通过了，但是最后因为毕业证是假的，考研作废、法考也作废，如果你是这个学生，你会怎么办？你会崩溃、你会发狂、你会自暴自弃。</p><p>但这个学生怎么着？他花了一年半的时间通过自考，又重新参加法考，又参加考研。</p><p>爱比克泰德曾经说过的一句话，“我们登上并非我们所选择的舞台，演出并非我们所选择的剧本”。</p><p>仔细想一想，我们这一生中其实自己能够决定的东西很少，我们决定不了我们的出身、我们决定不了我们的智商、我们更决定不了我们这一生的贵人相助。</p><p>很多时候我们经常会羡慕别人的剧本。我有的时候非常羡慕别人的剧本，但是没有谁的剧本值得羡慕，你只能把你自己的剧本给演好。</p><p>如果在你的一生中真的遭遇到这些挫折，那对不起，这就是你的剧本。</p><p>你有两种选择，一种选择是弃演，一种选择就是把既定的剧本给选好，把它演好。所以希望大家能够演好自己的剧本。</p><ol start="16"><li></li></ol><p>我经常怀疑我的选择，我也经常怀疑这个世界上有没有正义，我也经常怀疑我所从事的职业有没有意义，我甚至在怀疑，我此刻讲课有没有意义。</p><p>但是怀疑的目的是为了修正和确信，怀疑的目的不在于彻底的抛弃和放弃。</p><p>一切的怀疑，都是为了通向确信。<br><img src="https://img1.baidu.com/it/u=1180020136,890661279&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="有你的地方就有暖阳"><br>17.</p><p>看见的不用相信，但看不见的才需要相信。</p><ol start="18"><li></li></ol><p>你如果成功，得到的会是假朋友和真敌人，但不管怎样，你还是要成功；</p><p>你耗费数年所建设的，可能会毁于一旦，但不管怎样，还是要建设；</p><p>心胸最博大、最宽容的人，可能会被心胸狭窄的人击倒，但不管怎样，还是要志存高远；</p><p>当你将你自己拥有的最好的东西献给这个世界，你可能会被反咬一口，但不管怎样，还是要把最宝贵的东西献给世界。</p><p>我们今生活着的唯一目的，就是超越今生。<br><img src="https://img0.baidu.com/it/u=3061910970,2975428971&fm=253&fmt=auto&app=120&f=JPEG?w=500&h=500" alt="有你的地方就有暖阳"></p>]]></content>
      
      
      <categories>
          
          <category> 男孩文案 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 关于生活--罗翔 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>世界的美好与你环环相扣</title>
      <link href="/2023/12/01/%E6%96%87%E6%A1%A3/%E7%94%B7%E5%AD%A9%E6%96%87%E6%A1%881/"/>
      <url>/2023/12/01/%E6%96%87%E6%A1%A3/%E7%94%B7%E5%AD%A9%E6%96%87%E6%A1%881/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img0.baidu.com/it/u=2042627467,524957980&fm=253&fmt=auto?w=1280&h=800" alt="世界的美好与你环环相扣"></p><h1 id="世界的美好与你环环相扣"><a href="#世界的美好与你环环相扣" class="headerlink" title="世界的美好与你环环相扣"></a>世界的美好与你环环相扣</h1><p>1.人生都是走着走着就开阔了，现在的你，不用着急。</p><p>2.我淋过雨所以愿意为你撑伞。</p><p>3.我生来就普通，没必要惊艳谁，我野蛮生长，自己便是月亮。</p><p>4.随心所欲的生活更顺风顺水顺财神。（顺财神我自己加的，啊哈哈哈~）</p><p>5.像一朵云，不一定温柔，但一定自由。<br><img src="https://img2.baidu.com/it/u=4153848551,2430715780&fm=253&fmt=auto&app=120&f=JPEG?w=1422&h=800" alt="世界的美好与你环环相扣"></p><p>6.别听世俗的耳语，去看自己喜欢的风景。</p><p>7.别害怕，万物皆有裂痕，那才是阳光照进来的地方。</p><p>8.时间并不会真的帮我们解决什么问题，它只是把原来怎么也想不通的问题，变得不再重要了。</p><p>9.找不到答案的时候就找自己。<br><img src="https://img0.baidu.com/it/u=1335991290,3838939281&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="世界的美好与你环环相扣"></p><p>10.总有一天你也会是别人翘首以盼的惊喜。</p><p>11.花与温柔我都自给自足。</p><p>12.世界的美好与你环环相扣。<br>活在当下，及时行乐，因为未来没有哪一天比今天更年轻了。<br><img src="https://img0.baidu.com/it/u=4086150723,2649495626&fm=253&fmt=auto&app=120&f=JPEG?w=1280&h=800" alt="世界的美好与你环环相扣"></p>]]></content>
      
      
      <categories>
          
          <category> 男孩文案 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 世界的美好与你环环相扣 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>希望你身边总有人告诉你，你的开心比什么都重要</title>
      <link href="/2023/11/17/%E6%96%87%E6%A1%A3/%E7%94%B7%E5%AD%A9%E6%96%87%E6%A1%882/"/>
      <url>/2023/11/17/%E6%96%87%E6%A1%A3/%E7%94%B7%E5%AD%A9%E6%96%87%E6%A1%882/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img1.baidu.com/it/u=53227060,775735538&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" alt="事不会压垮人，但是情绪会"></p><h1 id="希望你身边总有人告诉你，你的开心比什么都重要"><a href="#希望你身边总有人告诉你，你的开心比什么都重要" class="headerlink" title="希望你身边总有人告诉你，你的开心比什么都重要"></a>希望你身边总有人告诉你，你的开心比什么都重要</h1><p>小时候觉得开心就好，现在才发现，小时候才是人间清醒，因为最后发现真的开心就好！</p><p>在不知所措的年纪，或许很多不如意；白天里的沉稳理性总在夜里翻了船。</p><p>今天因为拒绝了一些人和事，陷入了一阵emo，好在身边总有好朋友对我说，没关系！你的开心比什么都重要！</p><p><img src="https://img2.baidu.com/it/u=606642695,1053105384&fm=253&fmt=auto?w=1280&h=800" alt="事不会压垮人，但是情绪会"><br>本来心情像乌云住进了身体，亮着灯也觉得压抑。</p><p>后来我放过了自己，并不是什么大不了的事情，人生不过三万多天，真的开心快乐最重要，其他什么事情都不值得你浪费60秒的快乐！</p><p>终于知道，事不会压垮人，但是情绪会。</p><p>所以，希望不管遇到任何事情，你身边总有人对你说：没关系，你的开心最重要！<br><img src="https://img2.baidu.com/it/u=2370933087,1200442796&fm=253&fmt=auto&app=120&f=JPEG?w=1422&h=800" alt="事不会压垮人，但是情绪会"></p><p>努力不一定有结果，不努力一定很舒服，过分期待就会事与愿违，不如好好享受当下。</p><p>生活是活给自己看的，你有多大成色，世界才会给你多大脸色。</p><p>万般皆苦，唯有自渡，但你善意的语言，是别人寒冬里的温暖。<br><img src="https://img0.baidu.com/it/u=1755476452,3373982415&fm=253&fmt=auto&app=120&f=JPEG?w=1422&h=800" alt="事不会压垮人，但是情绪会"></p>]]></content>
      
      
      <categories>
          
          <category> 男孩文案 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 希望你身边总有人告诉你，你的开心比什么都重要 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动心语录</title>
      <link href="/2023/11/16/%E6%96%87%E6%A1%A3/%E7%94%B7%E5%AD%A9%E6%96%87%E6%A1%883/"/>
      <url>/2023/11/16/%E6%96%87%E6%A1%A3/%E7%94%B7%E5%AD%A9%E6%96%87%E6%A1%883/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img1.baidu.com/it/u=2499852056,1624916917&fm=253&fmt=auto&app=120&f=JPEG?w=1422&h=800" alt="有你的地方就有暖阳"></p><h1 id="时间会告诉我们，简单的喜欢最长远，平凡中的陪伴最心安，懂你的人最温暖"><a href="#时间会告诉我们，简单的喜欢最长远，平凡中的陪伴最心安，懂你的人最温暖" class="headerlink" title="时间会告诉我们，简单的喜欢最长远，平凡中的陪伴最心安，懂你的人最温暖"></a>时间会告诉我们，简单的喜欢最长远，平凡中的陪伴最心安，懂你的人最温暖</h1><p>1.喜欢你的我就好像是个亡命天涯的赌徒，永远不可能翻盘，我把前半辈子写在纸上，余生请多指教。</p><p>2.从看到你的那一刻起，我的心跳就告诉我你是我今生等待的人。你给了我勇气和动力，我会用一生的努力来呵护这份心动的。</p><p>3.时间会告诉我们，简单的喜欢最长远，平凡中的陪伴最心安，懂你的人最温暖。</p><p>4.我这小半生唯一的亮点就是遇见你，仿佛后来遇见再多的人，都是为了告诉我你有多好。</p><p>5.你身上的味道最好闻，你笑起来的样子最好看。你陪着我的时候，我从没羡慕过任何人，很想陪你走完这一生。<br><img src="https://img0.baidu.com/it/u=3640113242,2504318366&fm=253&fmt=auto&app=120&f=JPEG?w=1280&h=800" alt="有你的地方就有暖阳"><br>6.我知道在你心中，我不是什么，可是在我的心中，你就好像那月亮，拥有星星的月亮才是最美的，而我就是那星星，永远陪伴着你！</p><p>7.当风不再追云，当冰不再化水，当火不再炽热，当石不再坚硬，当世上没有爱情，我才能停止爱你。</p><p>8.从很久前开始，我就不相信爱情这回事，可是偏偏遇见了你，后来我想啊，人这一辈子总有相信一次，哪怕一次也好，那么你呢，可不可以让我相信，一生一次。</p><p>9.请你想起我的名字，在你缺少安慰的时候，我要你记得，我就是那个时刻惦念你的人，我就是那个，关心你的人，我就是喜欢你的人！<br><img src="https://img0.baidu.com/it/u=121226822,1667307602&fm=253&fmt=auto&app=120&f=JPEG?w=1280&h=800" alt="有你的地方就有暖阳"><br>10.我会给你我的一切，我会用行动告诉你，你的选择没错！我能给你的，倾尽所有温柔只为爱你。</p><p>11.生命中最好的事情就是找到那个知道你所有的错误和缺点，却依然认为你非常棒的人。</p><p>12.时间见证着爱的点滴，空间弥漫着相思的努力，心跳改变自从见你那天起，爱你的情节充盈这条信息，愿幸福属于我和最爱的你。<br><img src="https://img1.baidu.com/it/u=3154851822,2059277726&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="有你的地方就有暖阳"></p>]]></content>
      
      
      <categories>
          
          <category> 男孩文案 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 动心语录 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>换位思考，真的挺好</title>
      <link href="/2023/08/12/%E6%96%87%E6%A1%A3/%E6%8D%A2%E4%BD%8D%E6%80%9D%E8%80%83%EF%BC%8C%E7%9C%9F%E7%9A%84%E6%8C%BA%E5%A5%BD/"/>
      <url>/2023/08/12/%E6%96%87%E6%A1%A3/%E6%8D%A2%E4%BD%8D%E6%80%9D%E8%80%83%EF%BC%8C%E7%9C%9F%E7%9A%84%E6%8C%BA%E5%A5%BD/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img0.baidu.com/it/u=2893899063,510147381&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="互相理解,彼此包容"></p><h1 id="换位思考，真的挺好"><a href="#换位思考，真的挺好" class="headerlink" title="换位思考，真的挺好"></a>换位思考，真的挺好</h1><p>活在世上的每一个人，</p><p>没有十全十美的，</p><p>都有缺点和不足。</p><p>所以，</p><p><strong>互相理解一点，</strong></p><p><strong>彼此包容一点，</strong></p><p>不要咄咄逼人，斤斤计较。</p><p>我们都有心事，</p><p>都想有个可以倾诉的人。<br><img src="https://img2.baidu.com/it/u=1081304896,1891420375&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="人无完人，请多包容"><br>我们都不容易，</p><p>都想有个懂得我们的人。</p><p>太多的委屈只能自己隐藏，</p><p>太多的压力只能自己去扛，</p><p>想要的安慰没有，</p><p>知心的伙伴没有。</p><p>感情再深，不理解也会淡，</p><p>关系再近，不包容也会断。</p><p>人和人相处，不仅仅是真心，</p><p>更多的就是换位思考，</p><p>你体谅我的难处，</p><p>我理解你的苦衷。<br><img src="https://img2.baidu.com/it/u=3513122640,3690165328&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="谁都不易，请多体谅"><br>事无完美，人无完人，</p><p>不要拿自己的长处比别人的短处，</p><p>不要用自己的优点比别人的缺点。</p><p>尺有所短，寸有所长，</p><p>普通人也有优势，</p><p>大人物也有不足！</p><p>与人交往，包容大度，</p><p>与人相处，放宽心胸，</p><p>有了矛盾，先反省自己，</p><p>发生冲突，先找找原因，</p><p>不要动不动就责怪别人，</p><p>不要总把责任推给别人。</p><p>你对别人包容，别人就会对你大度，</p><p>你对别人抱怨，别人就会对你计较。</p><p><img src="https://img2.baidu.com/it/u=3217963915,3854451579&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="包容，让相处更轻松"><br>不管发生什么事，</p><p>不管面对什么人，</p><p>当你愤怒的时候，</p><p>当你冲动的时候，</p><p>先提醒自己静一静，</p><p>站在别人的角度想一下，</p><p>也许你会发现，</p><p>事情没有你想象中的那样糟糕。</p><p><strong>换位思考，真的挺好，</strong></p><p>可以减少矛盾。</p><p>设身处地，为人考虑，</p><p>可以缓解关系。</p><p>多一份体谅，就少一个敌人，</p><p>多一些理解，就少一些误解。</p><p><strong>人无完人，请多包容，</strong></p><p><strong>谁都不易，请多体谅，</strong></p><p><strong>包容，让相处更轻松，</strong></p><p><strong>体谅，让感情更稳固！</strong><br><img src="https://img1.baidu.com/it/u=2301815714,2557992341&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="互相理解,彼此包容"></p>]]></content>
      
      
      <categories>
          
          <category> 菲露露 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 换位思考，真的挺好 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>人生如路</title>
      <link href="/2023/07/17/%E6%96%87%E6%A1%A3/%E4%BA%BA%E7%94%9F%E5%A6%82%E8%B7%AF/"/>
      <url>/2023/07/17/%E6%96%87%E6%A1%A3/%E4%BA%BA%E7%94%9F%E5%A6%82%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img0.baidu.com/it/u=776700311,2035419948&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" alt="人生如路"><br>漫漫人生路，<br>我们都是赶路者，</p><p>走走停停，<br>独自前行。</p><p>形形色色的人，<br>和我们擦肩而过，<br>谁也不能为谁永久停留。<br><img src="https://img0.baidu.com/it/u=776156460,3458258941&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" alt="友如路人"><br>遇见，是一场意外，<br>离开，却无法阻拦。<br>命中注定，要随缘，<br>顺其自然，心放宽。<br><img src="https://img1.baidu.com/it/u=3043814270,3927858424&fm=253&fmt=auto&app=138&f=JPEG?w=786&h=500" alt="命中注定"><br>相识一场，<br>有的人还在身边，<br>有的人早已离开。<br>有的人，把我们伤害。<br>有的人，最后却说再见。<br><img src="https://img0.baidu.com/it/u=2227115770,270944948&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=281" alt="顺其自然"><br>人生如路，<br>从起点走到终点，<br>要几十年的时间。<br>友如路人，<br>从陌生到熟悉。<br><img src="https://img1.baidu.com/it/u=3043814270,3927858424&fm=253&fmt=auto&app=138&f=JPEG?w=786&h=500" alt="春风十里不如你"><br>陌生的会渐渐熟悉，<br>熟悉的会慢慢疏远。<br>谁也不能保证，<br>谁能永远陪在谁的身边。<br>这一生，要遇见多少人，<br>有的人，<br>陪着我们，不离不弃，<br>有的人，<br>爱着我们，不求回报，<br>还有的人，<br>动心后又变心，<br>结果让我们伤心。<br><img src="https://img1.baidu.com/it/u=4094586565,2631286442&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500" alt="有你的地方便有暖"><br>不是所有人都值得付出，<br>有的人，讨我们开心，<br>有的人，让我们伤心，</p><p>还有的人，<br>对我们漠不关心。</p><p>活在这个世上，<br>一定要好好爱自己，<br>不要让在乎你的人担心。</p><p>一定要好好疼自己，<br>不要让讨厌你的人得意。<br><img src="https://img1.baidu.com/it/u=2705880818,3552204348&fm=253&fmt=auto&app=138&f=JPEG?w=750&h=500" alt="你若在便是晴天"><br>记住了：<br>路走不通，绕着走，<br>事想不通，换角度，<br>情得不到，别强求，<br>人留不住，让他走。<br><img src="https://img2.baidu.com/it/u=3581263182,1724343244&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="不离不弃"><br>路，在脚下，自己好好走。<br>梦，在心中，努力去完成。<br>情，在身边，好好去守候！<br>这就是人生！</p>]]></content>
      
      
      <categories>
          
          <category> 菲露露 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 人生如路 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>不经一事，不懂一人</title>
      <link href="/2023/07/07/%E6%96%87%E6%A1%A3/%E4%B8%8D%E7%BB%8F%E4%B8%80%E4%BA%8B,%E4%B8%8D%E6%87%82%E4%B8%80%E4%BA%BA/"/>
      <url>/2023/07/07/%E6%96%87%E6%A1%A3/%E4%B8%8D%E7%BB%8F%E4%B8%80%E4%BA%8B,%E4%B8%8D%E6%87%82%E4%B8%80%E4%BA%BA/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img1.baidu.com/it/u=1788850120,2124170545&fm=253&fmt=auto&app=120&f=JPEG?w=1422&h=800" alt="开开心心"></p><h1 id="不经一事，不懂一人"><a href="#不经一事，不懂一人" class="headerlink" title="不经一事，不懂一人"></a>不经一事，不懂一人</h1><p>网上有段很经典的话：</p><p>当你饿的时候，有的人会把馒头分给你一半，这是友情；</p><p>有的人会把馒头让给你先吃，这是爱情；</p><p>有的人会把馒头全给你，这是亲情；</p><p>有的人会把馒头藏了起来，对你说他也饿，这就是社会。 </p><p>深以为然。</p><p><strong>正所谓：苍茫一生，真情可贵；飘萍过客，真心难得。</strong></p><p>在这个匆忙与现实的世界里，有福同享的人很多，有难同当的人很少；薄情寡义的人很多，能一路珍惜陪伴的人很少。</p><p>不经一事，不懂一人。<br><strong>这世间，太多的事，只有经历过，才知冷暖；太多的人，只有患难过，方知真假。</strong><br><img src="https://img2.baidu.com/it/u=2478272615,3022855553&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=281" alt="开开心心"></p><h2 id="1-时间识人，落难知心"><a href="#1-时间识人，落难知心" class="headerlink" title="1.时间识人，落难知心"></a>1.时间识人，落难知心</h2><p>在我们的一生中，会遇到形形色色，各种各样的人。</p><p>有些人刚接触时，甜言蜜语，看似真诚，然而在一起久了，才发现这只是巧言令色，虚情假意。</p><p>有些人不假言辞，眼笨口拙，但当时光轮转，却始终伴你前行，知你所需，予你所求，即使不在身边，心也未曾分离。</p><p>常言道：“事不出，不知谁近谁远；人不品，不知谁浓谁淡。”</p><p>一个人只有遇事了，才会知道谁对你是心中牵挂，谁对你是转身天涯，只有落难了，才会明白谁对你是雪中送炭，谁对你是熟视无睹。</p><p>有些人，只是路过客串，不会倾情出演；有些人，只会搬弄是非，不会排忧解难。</p><p>时间能识人，落难能知心。</p><p>只有经历时间的考验，才会认清一个人的真正面目；只有经历艰难的困境，才会明白一颗心的真假。</p><p><strong>很喜欢一句话：“时间不会说谎，说的都是真相。”</strong></p><p><strong>所以，相信时间，它最终会告诉你：谁是虚伪的脸，谁是真心的伴，会离开的都是风景，能留下的，才是最真最好的。</strong><br><img src="https://img1.baidu.com/it/u=3898423942,4076211846&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="开开心心"></p><h2 id="2-以心交心，以情暖情"><a href="#2-以心交心，以情暖情" class="headerlink" title="2.以心交心，以情暖情"></a>2.以心交心，以情暖情</h2><p>孟子曾说：</p><p>“人之相识，贵在相知，人之相知，贵在知心。”</p><p>人与人之间的交往，讲究的是以心交心，以情暖情，投之以木桃，报之以琼瑶。</p><p>都说感情是一座天平，你若对别人好，别人亦会视你如知己；你若虚情假意，别人也会默默远离。</p><p>世间所有的关系都是相互的，有的人是过客，有的人是知己，区别就在于有没有以心换心，用情暖情。</p><p>所以，只有真诚的人，才能走进了心里；虚伪的人，永远是人人远而避之。</p><p>人，不怕走错路，就怕交错了人；心，不怕太认真，就怕敲错了门；情，不怕太辛苦，就怕用错了人。</p><p><strong>两个人的情感，只有真心相待，才能不离不弃；只有用心呵护，才能温暖相依。</strong></p><p><strong>风起，一起挡风；雨落，一起遮雨。</strong></p><p>如此这般互相扶持，两个人的心才得以维系，情才能天长地久。</p><p>3.不经一事，不懂一人<br>三毛曾写道：</p><p>“朋友这种关系，最美在于锦上添花；最可贵，贵在雪中送炭；朋友中的极品，便如好茶，淡而不涩，清香而不扑鼻，缓缓飘来，似水长流。”</p><p>有的朋友，平日里恭维不断，总以笑脸相迎，可你一有难处，躲得最快的就是他们。</p><p>有的朋友，平时默默无闻，但却能成为你受难时，最有力的支柱。</p><p>俗话说：画虎画皮难画骨，知人知面不知心。</p><p>不经事，不懂人，经一事，辨真心。</p><p>真正对你好的人，是无论你身处何种困境，也愿意主动伸出手来拉你一把。假仁假义的人，你无论怎么付出，也是枉然一场。</p><p>因此，当你四处碰壁，不遗余力帮你的人，别忘；当你身处逆境，仍然不离不弃的人，别丢。</p><p><strong>友不在多，贵在风雨同行；情不论久，重在有求必应。</strong></p><p><strong>谁都可以和你同富贵，但只有和你共患难，风雨同行的那个人，才值得你用一生去深交。</strong></p><p><strong>而那些在你落难时远而避之的人，不过是你人生里的过客罢了。</strong></p><p>记得：</p><p><strong>世态炎凉，别太善良，人情冷暖，须辨真假。</strong></p><p><strong>人生路上，选对那个陪自己同行的人，很重要。</strong><br><img src="https://img2.baidu.com/it/u=3515940641,1579642146&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="开开心心"></p>]]></content>
      
      
      <categories>
          
          <category> 菲露露 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 不经一事，不懂一人 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>爱一个人的最好方式</title>
      <link href="/2023/06/27/%E6%96%87%E6%A1%A3/%E7%88%B1%E4%B8%80%E4%B8%AA%E4%BA%BA%E6%9C%80%E5%A5%BD%E7%9A%84%E6%96%B9%E5%BC%8F/"/>
      <url>/2023/06/27/%E6%96%87%E6%A1%A3/%E7%88%B1%E4%B8%80%E4%B8%AA%E4%BA%BA%E6%9C%80%E5%A5%BD%E7%9A%84%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img2.baidu.com/it/u=2684288295,47449666&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="学会爱自己是一个人成熟的表现"></p><h1 id="爱一个人的最好方式"><a href="#爱一个人的最好方式" class="headerlink" title="爱一个人的最好方式"></a>爱一个人的最好方式</h1><p>两个人的世界里，</p><p>总要一个闹着、一个笑着，</p><p>一个吵着、一个哄着。</p><p>如果一个人总是输，不是他口才不够好，</p><p>只是不忍心把最伤人的话说出口，</p><p>所以选择了沉默。</p><p><strong>希望你遇到一个，</strong><br><strong>和你真正绝配的爱人，</strong><br><strong>用最舒服的方式相爱，</strong><br><strong>一生很长彼此打磨，</strong><br><strong>却成为最默契的那一对。</strong></p><p>你为他改一点，他为你改一点，</p><p>你不主动的时候他主动，</p><p>他不主动的时候你主动，</p><p>不会冷战会多沟通，能够分担也能分享，</p><p>有个梦想一起进步，然后过完这一生。<br><img src="https://img0.baidu.com/it/u=239053534,1963245711&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" alt="学会爱自己是一个人成熟的表现"><br>你啊，</p><p>最好等到可以真正平淡的看待那些回忆</p><p>可以管理好自己的情绪之后，</p><p>再去考虑感情，</p><p>去全心全意的开始下一段感情，</p><p>把一整颗完整的不残缺的心交给一个人。</p><p>所以，一切都不急。</p><p><strong>没必要什么事都据理力争，</strong><br><strong>教蠢货做人又不是你义务。</strong></p><p><img src="https://img1.baidu.com/it/u=590690035,2247808740&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="学会爱自己是一个人成熟的表现"><br>生活就像一杯白开水，</p><p>你每天都在喝，<br>不要羡慕别人喝的饮料有各种颜色。</p><p>其实未必有你的白开水解渴，</p><p>人生不是靠心情活着，</p><p>而要靠心态去生活，调整心态看生活，</p><p>处处都是阳光。</p><p>置身事外，谁都可以心平气和，</p><p>身处其中，谁还可以淡定从容？</p><p>所以请不要轻易评论任何人，</p><p>因为你不在其中。知人不评人，</p><p>才是一个人应该有的教养。<br><img src="https://img1.baidu.com/it/u=3285517640,2875261265&fm=253&fmt=auto&app=120&f=JPEG?w=1422&h=800" alt="学会爱自己是一个人成熟的表现"><br><strong>爱一个人最好的方式，是经营好自己，</strong></p><p>给对方一个优质的爱人。</p><p>不是拼命对一个人好，那人就会拼命爱你。</p><p><strong>俗世的感情难免有现实的一面：</strong></p><p><strong>你有价值，你的付出才有人重视。</strong><br><img src="https://img2.baidu.com/it/u=1723782534,1899475254&fm=253&fmt=auto&app=120&f=JPEG?w=1422&h=800" alt="学会爱自己是一个人成熟的表现"></p>]]></content>
      
      
      <categories>
          
          <category> 菲露露 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 爱一个人的最好方式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>总有一句话治愈你</title>
      <link href="/2023/06/12/%E6%96%87%E6%A1%A3/%E6%80%BB%E6%9C%89%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%B2%BB%E6%84%88%E4%BD%A0/"/>
      <url>/2023/06/12/%E6%96%87%E6%A1%A3/%E6%80%BB%E6%9C%89%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%B2%BB%E6%84%88%E4%BD%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img0.baidu.com/it/u=2741789970,1392333292&fm=253&fmt=auto&app=120&f=JPEG?w=1422&h=800" alt="顺气自然,心放宽"></p><h1 id="总有一句话治愈你"><a href="#总有一句话治愈你" class="headerlink" title="总有一句话治愈你"></a>总有一句话治愈你</h1><p>“真正能给你撑腰的，是丰富的知识储备，足够的经济基础，持续的情绪稳定，可控的生活节奏，和那个打不败的自己。”<br>             —— ​​蔡崇达《皮囊》 ​ ​​​</p><p>从你来到世界上这一天开始，你所有的每一种行动，出发点都是为了你自己，都是因为你需要些什么。</p><p>   —— 戴尔·卡耐基《人性的弱点》 ​​​</p><p>“ 能让你温柔的人，肯定是给了你极致的爱；能让你变得沉默的人，肯定是给了你极大的伤害；能让你变得暴躁的人，肯定是让你受尽委屈。”</p><pre><code>            — —杨绛 ​ ​​​</code></pre><p><img src="https://img2.baidu.com/it/u=3119865981,1780073087&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="余生很贵,请勿浪费"><br>浮躁，乃性格所致；</p><p>稳重，则是意识所为。</p><pre><code>           ——《半山文集》 ​​​</code></pre><p>你之所以相信一个人说的话，是因为他说了你想听的话。</p><pre><code>             ——《摆渡人》 ​​​</code></pre><p>“凡是脾气温和的人，福气都深厚，活的都快乐。凡是脾气狂暴的人，福气都浅薄，活的都痛苦。人这辈子所有的福气，都藏在自己的脾气里。不要让你的脾气挡住了你的福气。别忘了，一念嗔恨起，百万瘴门开。”</p><pre><code>              ——《弘一法师》</code></pre><p><img src="https://img1.baidu.com/it/u=3452692521,910542602&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=281" alt="春风十里，不如你"><br>会看花的人，就会看云、看月、看星辰，并且在人世中的一切看到智慧。</p><pre><code>             ——林清玄 ​​​</code></pre><p>世界上最大的监狱，是人的思维。我们每个人都被自己的认知牢牢禁锢其中。</p><pre><code>            ——叔本华 ​​​</code></pre><p>如果处于逆境，请你放下情绪，放下纠结，放下怨恨，心怀慈悲，常怀感恩，用一颗柔软的心去化解矛盾，他日因缘会聚时，自会有一番柳暗花明的景象。 ​​​</p><p>多记别人的好，少记别人的仇。不要因为一点小事就否定了一个人的品行，谁都有不足和缺点，谁都会自私和犯错，要有容人之量。 ​​​</p><p>现在发生的一切，都是过去种下的因，无论好坏，不必抗拒。如果想要一个无悔的未来，那就努力修好当下，因为当下就是未来的因。 如果喜欢记得赞赏下吖。​​<br><img src="https://img1.baidu.com/it/u=3241622280,420858474&fm=253&fmt=auto&app=120&f=JPEG?w=1422&h=800" alt="有你的地方便有暖阳"></p>]]></content>
      
      
      <categories>
          
          <category> 菲露露 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总有一句话治愈你 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信上这样回你消息的人，最值得深交，一定要常联系！</title>
      <link href="/2023/06/07/%E6%96%87%E6%A1%A3/%E5%BE%AE%E4%BF%A1%E8%BF%99%E6%A0%B7%E5%9B%9E/"/>
      <url>/2023/06/07/%E6%96%87%E6%A1%A3/%E5%BE%AE%E4%BF%A1%E8%BF%99%E6%A0%B7%E5%9B%9E/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img2.baidu.com/it/u=892765772,1595330666&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" alt="遥遥相见，世世相安"></p><h1 id="微信上这样回你消息的人，最值得深交，一定要常联系！"><a href="#微信上这样回你消息的人，最值得深交，一定要常联系！" class="headerlink" title="微信上这样回你消息的人，最值得深交，一定要常联系！"></a>微信上这样回你消息的人，最值得深交，一定要常联系！</h1><p>唐代诗人张籍的《秋思》中有言：</p><p>“洛阳城里见秋风，欲作家书意万重。复恐匆匆说不尽，行人临发又开封。”</p><p>从前，与亲友的联系全靠书信，如今，就算要与素未谋面的人交流，也只需打开微信。</p><p>尽管彼此相隔于屏幕，但是在你来我往的字里行间中，亦能察觉出对方的修养与品行。</p><p>在微信里，我们认识的人可能很多，但真正能去交心的人却很少，也并非所有人都值得自己费心耗力。</p><p>窥一斑而见全豹，观滴水可知沧海。</p><p>若是有人在微信上这样回复你的消息，请一定要与之深交，并好好珍惜这份真情。<br><img src="https://img0.baidu.com/it/u=3621237629,349209444&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=307" alt="遥遥相见，世世相安"></p><h2 id="及时回复，是尊重"><a href="#及时回复，是尊重" class="headerlink" title="及时回复，是尊重"></a>及时回复，是尊重</h2><p>在知乎上，曾经有人提出过这样一个问题：微信聊天时，你最讨厌对方回复什么？</p><p>底下的众多回答中，获得最高赞的答案，只有四个字：已读不回。</p><p>的确如此，相比较那些能够预料到的糟糕答案，什么话都不回复，要让人恼火得多。</p><p>想象一下这个场景：</p><p>你有急事寻找对方，又是打字又是语音，结果对方却毫无动静，如失踪一般不言不语。</p><p>你着急地像是热锅上的蚂蚁，对方却不紧不慢，明明看到了消息却一声不吭，懒得搭理。</p><p>如此敷衍地对待，其实就是对他人的一种不尊重，更是没礼貌和不靠谱的表现。</p><p>《礼记》中有言：“君子贵人贱己，先人而后己。”</p><p>尊重他人，不一定非要将自己置于人后，而是对别人的及时回复与认真对待。</p><p>真正有修养且靠谱的人，即便因为繁忙没能第一时间回复，也会在过后和对方解释清楚。</p><p>而不是故意晾着他人，让别人白白浪费时间焦急等待，徒增彼此的失望与误会。</p><p>前段时间，新闻曾报道一个员工被公司开除，就是因为这个员工从不回复别人的消息。</p><p>无论是甲方提的诉求，还是领导给的要求，即使@到他本人，也犹如石沉大海，毫无音讯。</p><p>人与人都是相互的，在任何社交关系中，没人愿意唱独角戏。</p><p>样样有交代，事事有回应，件件有着落，这样的人才值得信任。<br><img src="https://img1.baidu.com/it/u=293757779,711633116&fm=253&fmt=auto&app=120&f=JPEG?w=1280&h=800" alt="遥遥相见，世世相安"></p><h2 id="把握分寸，是成熟"><a href="#把握分寸，是成熟" class="headerlink" title="把握分寸，是成熟"></a>把握分寸，是成熟</h2><p>周国平曾说：“分寸感，是爱成熟的标志，它让人懂得遵守人与人之间必要的距离。”</p><p>每个人都有自己的心事，或是不为人知的隐私，或是不愿提及的过往。</p><p>即便是与自己再亲密无间的人，一旦触及到这些个人的秘密，也会让人感觉到不适与排斥。</p><p>可有些人就是喜欢刨根问底，对别人的私事穷追不舍，非要问个清楚明白，毫无应有的分寸。</p><p>明知道对方有对象，还要在聊天时语言暧昧，开一些不合时宜的玩笑，让别人麻烦缠身。</p><p>喜欢把毒舌和刻薄，当成所谓朋友间的幽默，说一些言辞过分的话语，让别人尴尬难堪。</p><p>别人的底线，被他们随意的践踏，别人的痛处，被他们胡乱的评论。</p><p>非常认同网上的一句话：</p><p>“一个聊天没有分寸感的人，要么是情商不够，要么就是是人品有问题。”</p><p>真正成熟有分寸的人，懂得站在对方的角度思考，内心有尺，说话有度，更不会危难他人。</p><p>这种界限和分寸感，是对人与人距离的把握，也是对别人的尊重，更是对自己的保护。</p><p>就像心理学中提到的“刺猬效应”：</p><p>在寒冷的冬天，两只刺猬若是靠得太远，就会各自冻死，靠得太近，则会刺伤对方。</p><p>只有保持一个合适的距离，才能既不伤害彼此，还能获得对方身上的温度。</p><p>世界很大，容得下所有人，每个人也应该有属于自己的一片空间，为彼此的交往适度留白。</p><p>善良，虽然是根植于每个人内心中的天性，但随着时间的流逝，能始终坚守善良的人却并不多。</p><p>许多人历经了人海浮沉，看遍了世态炎凉，对于人与事都愈发的麻木与冷漠。</p><p>甚至有些人习惯了消极面对生活，在与别人交流沟通时，也常常充满了“丧气”的味道。</p><p>几个月前，震惊全国的“张家界4人跳崖事件”，就是源自于负能量满满的“约死群”。</p><p>在那里，群里的人对生活都报以绝望的心态，有人想要自寻短见，其他人便恶意地怂恿。</p><p>也正是因为这群人极力撺掇，才导致了无数的人弃生赴死，也让无数家庭支离破碎。</p><p>正如苏霍姆林斯基所说：</p><p>“没有善良，一个人给予另一个人的真正发自肺腑的温暖，就不可能有精神的美。”</p><p>在这个高速发展的时代，人与人之间的沟通距离越来越近，但心与心的距离却越来越远。</p><p>就连一份最微不足道的善良，在这个戾气横飞的网络上，仿佛也显得弥足珍贵了。</p><p>隔着冰冷的屏幕交流，很多人只想发泄情绪，并不在乎对错，很多话张口就来，丝毫不管后果。</p><p>偏偏忘了，可能自己一句不经意的话语，就可能成为压死骆驼的最后一根稻草。</p><p>而一个真正品性善良，而且有修养的人，总能将自己善意寄予言语之中，保留应有的体谅。</p><p>对他人多一份理解和包容，对自己多一份忍耐和克制，才能让彼此的交往更加舒服。</p><p>▽<br>特别喜欢伏尔泰的一句名言：</p><p>“使人疲惫的不是远方的高山，而是鞋子里的一粒沙。”</p><p>微信回复，虽然只是一件微小之事，却藏着一个人的品行，和彼此关系的真正面貌。</p><p>一言一行，可辨人品；一朝一夕，可见人心。</p><p>想要看清一个人的本性，恰恰要从这样的细节入手。</p><p>及时回复的人，稳重靠谱；把握分寸的人，恰如其分；满怀善意的人，温柔敦厚。</p><p>人与人之间的相处，贵在真诚，重在舒服，张弛有度，方能长久稳定。<br><img src="https://img1.baidu.com/it/u=2564895678,2806223097&fm=253&fmt=auto&app=138&f=JPEG?w=916&h=500" alt="遥遥相见，世世相安"><br>@一星期一本书</p>]]></content>
      
      
      <categories>
          
          <category> 塔坦 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 微信上这样回你消息的人 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>9件很微小的事，治愈精神内耗</title>
      <link href="/2023/05/21/%E6%96%87%E6%A1%A3/%E6%B2%BB%E6%84%88%E7%B2%BE%E7%A5%9E%E5%86%85%E8%80%97/"/>
      <url>/2023/05/21/%E6%96%87%E6%A1%A3/%E6%B2%BB%E6%84%88%E7%B2%BE%E7%A5%9E%E5%86%85%E8%80%97/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img1.baidu.com/it/u=4111313423,154971030&fm=253&fmt=auto&app=138&f=JPEG?w=867&h=500" alt="逆风的方向，更适合飞翔"></p><h1 id="9件很微小的事，治愈精神内耗"><a href="#9件很微小的事，治愈精神内耗" class="headerlink" title="9件很微小的事，治愈精神内耗"></a>9件很微小的事，治愈精神内耗</h1><p>尼采说：“一个人知道自己为什么而活，就可以忍受任何一种生活。”</p><p>而现实中，我们感到焦虑不安，很大原因就是因为不知道自己为了什么而活，在这种情绪下，我们往往陷入到迷茫、不安、恐慌、摇摆不定的状态之中，这种状态被称为精神内耗。</p><p>如果一个人长期陷入精神内耗之中，不仅会影响到自己的生活，甚至还危害到自己的命运。</p><p>如何摆脱精神内耗，其实很简单。</p><p>只要踏踏实实地去做每一件小事，让自己活在真实中，而不是虚幻中。</p><p>人民日报建议的9件有生活气息的小事，可以治愈我们烦乱的内心。</p><h2 id="01-一顿早餐：开启一天的元气生活"><a href="#01-一顿早餐：开启一天的元气生活" class="headerlink" title="01  一顿早餐：开启一天的元气生活"></a>01  一顿早餐：开启一天的元气生活</h2><p>一日之计在于晨，一天的心情也是从早晨开始的。</p><p>若能吃上一顿精致可口的早餐，一天的精神气都会很饱满。</p><p>不要小瞧一餐一饮对我们的重要性，有时候简单的一餐就足以治愈我们的烦躁不安。</p><p>汪曾祺说：四方食事，不过一碗人间烟火。</p><p>我们活着，就离不开烟火气，治愈内心的第一步就是好好吃饭。</p><h2 id="02-一首歌曲-戴上耳机，那是属于你的世界"><a href="#02-一首歌曲-戴上耳机，那是属于你的世界" class="headerlink" title="02 一首歌曲:戴上耳机，那是属于你的世界"></a>02 一首歌曲:戴上耳机，那是属于你的世界</h2><p>音乐，是生活中很美好的存在。</p><p>当音符流动，歌声响起的时候，我们都能受到音乐的感染，一下子就身心放松。</p><p>在上班的路上，在工作的闲暇时，或者心烦意乱的时候，安静地听上一首歌，也是很美妙的事。</p><p>虽然生活苦难重重，但生活里依然有很多美妙的事物，值得我们认真拥抱生活。</p><h2 id="03-一段阅读：幸福感从字句标点开始"><a href="#03-一段阅读：幸福感从字句标点开始" class="headerlink" title="03 一段阅读：幸福感从字句标点开始"></a>03 一段阅读：幸福感从字句标点开始</h2><p> 当你沉浸在阅读之中时，不仅会感觉到文字的奇妙，还往往会被书中的内容打动，不管是故事还是哲理，总能带给你心灵的启发。</p><p>每天读上几页书，不仅能提升自己的眼界，还可以陶冶自己的灵魂。</p><p>当你专注在读书的过程中，你就进入了一个独属于自己的世界里，并可以用书中所得来感悟生活。</p><p>正如杨绛说：</p><p>“年轻的时候我常常以为不读书的人不足以了解人生，直到后来才发现，如果不了解世界，是读不懂书的。”</p><p>读书的意义大概就是用生活所感去读书，用读书所得去生活。<br><img src="https://img1.baidu.com/it/u=2466440143,19310405&fm=253&fmt=auto&app=120&f=JPEG?w=1422&h=800" alt="逆风的方向，更适合飞翔"></p><h2 id="04-一阵放空：给心灵来一场旅行"><a href="#04-一阵放空：给心灵来一场旅行" class="headerlink" title="04 一阵放空：给心灵来一场旅行"></a>04 一阵放空：给心灵来一场旅行</h2><p>每个人都需要独处时光，哪怕是再亲密的人，有时候也无法理解自己的小纠结和突如其来的伤感。</p><p>适当地发发呆，放放空，自己安静地待一会，也是一种很好的治愈方式。</p><p>什么都不做，什么也不想，只是呆呆地看看窗外，把所有思绪都抛下，把所有压力都释放，在这一刻时光里，只做自己。</p><p>一个人最难得的是有自愈能力。</p><p>不管遭遇多大的磨难，也能意志坚强地迈出新生活的步伐。</p><h2 id="05-一场日落：和爱的人散步在美好夕阳下"><a href="#05-一场日落：和爱的人散步在美好夕阳下" class="headerlink" title="05 一场日落：和爱的人散步在美好夕阳下"></a>05 一场日落：和爱的人散步在美好夕阳下</h2><p>大自然中，有很多美妙的时刻。你若能步入其中，不管是落叶还是开花，都有着极致的生命之美。</p><p>心情不好的时候，就到大自然中去。和自己喜欢的人一起漫步在树林中，一起去看看日出日落，用大自然的力量治愈自己的内心。</p><p>哪怕只有自己一个人，也可以沉浸在一年四季的自然变化中，观察一片美丽的枫叶，欣赏一朵可爱的小花，能可以让我们的内心受到触动，去感受这种天然的美好。</p><p>哪怕是去楼下观察一棵硕果累累的石榴树，你的心灵就是一场远行。</p><h2 id="06-一部电影：寻找治愈的瞬间"><a href="#06-一部电影：寻找治愈的瞬间" class="headerlink" title="06 一部电影：寻找治愈的瞬间"></a>06 一部电影：寻找治愈的瞬间</h2><p>一部好剧，可以让人又哭又笑，可以让我们反思生活，悟出真理。</p><p>每个人活着，其实都差不多，不是在感情中左右为难，就是在经济上苦苦追求，我们都在为自己所爱的人奋力前行。</p><p>人活一世，不过是亲情、爱情和友情，而在看电影的过程中，某些桥段和情节，总能让你陷入回忆，想起心底的某一个爱的人。</p><p>谁也无法真的拯救谁，生命的救赎还要靠自己。</p><p>只有放弃自己的枷锁，抛开对过往的执念，人才能真的轻松自由。<br><img src="https://img2.baidu.com/it/u=1820312050,1927040787&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="但行前路，不负韶华"></p><h2 id="07-一场交谈：敞开心扉，拥抱生活"><a href="#07-一场交谈：敞开心扉，拥抱生活" class="headerlink" title="07 一场交谈：敞开心扉，拥抱生活"></a>07 一场交谈：敞开心扉，拥抱生活</h2><p>朋友易得，而知己难求。</p><p>我们活着，都希望找到和自己心灵契合的人，能明白自己的追求，能懂得自己的苦楚。</p><p>人生若有三五知己，一起畅聊人生，一起互相鼓励，一起展望未来，那就是很宝贵的财富。</p><p>难过的时候，别什么事都藏在心里，和朋友诉说一下，能很大程度缓解内心的郁结。</p><p>每个人灵魂深处的美好与落寞，都需要另一个人来读懂，所以世间才有了朋友。</p><h2 id="08-一刻小憩：听，那是呼吸的声音"><a href="#08-一刻小憩：听，那是呼吸的声音" class="headerlink" title="08 一刻小憩：听，那是呼吸的声音"></a>08 一刻小憩：听，那是呼吸的声音</h2><p>每个人都在追求着自己梦想中的生活，所以我们步履不停，不停忙碌。</p><p>闲暇，确实是人生中难得的时刻，若有一刻空闲，希望你能全身心地放松一会，哪怕是闭着眼睛小憩一会，就可以全身充满活力。</p><p>忙碌虽然是生活的常态，但也要学着对自己好一点，找到让自己身心放松的方式，哪怕一天之中只有那么几分钟，也足以让我们有热爱生活的动力。</p><h2 id="09-一股暖流：送人玫瑰，手有余香"><a href="#09-一股暖流：送人玫瑰，手有余香" class="headerlink" title="09 一股暖流：送人玫瑰，手有余香"></a>09 一股暖流：送人玫瑰，手有余香</h2><p>这个世间，正是因为有爱，才得以传承。</p><p>爱可以治愈一切，有时候，不会爱不光顾你，而是你自己没有学会怎么去爱。</p><p>当你在落魄的时候，若有一个人伸手拉你一把，你一定觉得这个世界很温暖。</p><p>同样当你付出自己的真心，去认真帮助一个人的时候，你的内心一样会有一股暖流流过。</p><p>爱，是我们活在世间的唯一理由。你可以爱阳光，爱河流，爱身边的每一个人。</p><p>▽ </p><p>汪曾祺说：</p><p>“慢点走，品品茶，喝喝酒，听听曲，写写字，人生少忧虑，生活才好玩。”</p><p>人活着，其实并不复杂，不过是一日三餐，一盏灯火，还有一颗热爱生命的心。</p><p>简单点，就会更快乐点，少想那些没用的，把烦恼抛开了，才有身心舒畅的机会。<br><img src="https://img0.baidu.com/it/u=948813974,1924196317&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="逆风的方向，更适合飞翔"></p>]]></content>
      
      
      <categories>
          
          <category> 塔坦 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 治愈精神内耗 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>故事很短，道理很深</title>
      <link href="/2023/05/01/%E6%96%87%E6%A1%A3/%E6%95%85%E4%BA%8B%E5%BE%88%E7%9F%AD/"/>
      <url>/2023/05/01/%E6%96%87%E6%A1%A3/%E6%95%85%E4%BA%8B%E5%BE%88%E7%9F%AD/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img0.baidu.com/it/u=3795114358,2689893991&fm=253&fmt=auto&app=120&f=JPEG?w=750&h=500" alt="但行前路，不负韶华"><br>每个人都希望，在自己的人生路上，能有如指明灯一般的人，给予一两句箴言，指引自己前进。</p><p>经历过人生的起起落落才发现，人生的很多智慧，其实就藏在生活的点点滴滴之中。</p><h2 id="01"><a href="#01" class="headerlink" title="01"></a>01</h2><p>鸡叫了天会亮，鸡不叫天也会亮，天亮不亮不是鸡说了算，关键是谁醒了。</p><p>醒来的过了一天，没醒的过了一生。</p><p>感悟：</p><p>每天醒来，都是新生。</p><p>健康地活着，是世界上最重要、最幸福的事。</p><p>趁着阳光正好，出去走一走吧！这世间的一草一木、一花一鸟，皆是美好，不要辜负了这美好的时光。</p><h2 id="02"><a href="#02" class="headerlink" title="02"></a>02</h2><p>有个人买了一箱梨，天气热怕梨坏了可惜，每天挑几个最差的吃掉，最后吃了一箱烂梨。</p><p>总结一下，作幅对联：</p><p>上联：放着好的吃烂的<br>下联：吃了烂的烂好的<br>横批：永远吃烂的</p><p>感悟：</p><p>人生亦如吃梨，因为在意每天不开心的事，一辈子都得糟心下去；</p><p>把糟心的事放下扔掉，每天阳光一点，你就灿烂一辈子！</p><p>珍惜当下，积极快乐！时刻留意，不要让自己栽在坏情绪中！</p><h2 id="03"><a href="#03" class="headerlink" title="03"></a>03</h2><p>鹦鹉遇到乌鸦，笼中的鹦鹉安逸；野外的乌鸦自由。</p><p>鹦鹉羡慕乌鸦自由，乌鸦羡慕鹦鹉安逸，二鸟便商议互换。</p><p>乌鸦得到安逸，但难得主人欢喜，最后抑郁而死；鹦鹉得到自由，但长期安逸，不能独立生存，最终饥饿而死。</p><p>感悟：</p><p>不要盲目羡慕他人的幸福，也许那并不适合你。</p><p>人生于世，不要去攀比，过好自己的日子，享受自己的生活才是王道！</p><h2 id="04"><a href="#04" class="headerlink" title="04"></a>04</h2><p>一滴墨汁落在一杯清水里，这杯水立即变色，不能喝了；</p><p>一滴墨汁融在大海里，大海依然是蔚蓝色的大海；</p><p>为什么？因为两者的肚量不一样。</p><p>不熟的麦穗直刺刺地向上挺着，成熟的麦穗低垂着头。</p><p>为什么？因为两者的份量不一样。</p><p>感悟：</p><p>宽容别人，就是肚量；谦卑自己，就是份量；合起来，就是一个人的质量。</p><p>格局越大，越懂得宽容；情商越高，越懂得低头。</p><p>愿我们都能成为一个具有大格局的高情商之人。<br><img src="https://img2.baidu.com/it/u=4255997526,4051689682&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" alt="但行前路，不负韶华"></p><h2 id="05"><a href="#05" class="headerlink" title="05"></a>05</h2><p>香水，95%都是水，只有5%不同，那是各家秘方。</p><p>人也是这样，95%的东西基本相似，差别就是其中很关键性的5%，包括人的修养、品格、欲望，决定了人的快乐、痛苦。</p><p>感悟：</p><p>香精要熬个五年、十年才加到香水里面去，人也是一样，要经过成长锻炼，才有自己独一无二的味道。</p><p>所以，学习很重要！坚持很重要！</p><h2 id="06"><a href="#06" class="headerlink" title="06"></a>06</h2><p>一对父子牵着驴上街，两人都步行，有人说他们脑袋笨；</p><p>儿子骑，有人说儿子不孝顺；</p><p>父亲骑，有人说父亲太狠心；</p><p>父子同骑，有人说他们不爱驴……</p><p>最后，父子只好抬着驴回家了。</p><p>感悟：</p><p>人，不能活在别人的议论之中。</p><p>如果自己没有主见和定力，处处为别人的言行所左右，只能干出“父子抬驴”的傻事。</p><h2 id="07"><a href="#07" class="headerlink" title="07"></a>07</h2><p>狐狸发现一窝鸡，因太胖钻不进去，于是饿了三天终于进入。</p><p>饱餐后又出不来了，只好重新饿三天才出来，最终它哀叹自己在这个过程中除了过嘴瘾，就是白忙活。</p><p>感悟：</p><p>人生何尝不是如此！赤条条来，赤条条去，无人能带走一生经营的财富与功名。</p><p>用青春赚的钱，难以买回青春；用生命赚的钱，难以买回生命；用时间挣来的钱，难以挣回时间。</p><p>即使用一生得到全世界的钱，用全世界的钱也买不回自己的一生。</p><p>所以，学会休息和快乐很重要！</p><h2 id="08"><a href="#08" class="headerlink" title="08"></a>08</h2><p>家长会上，老师在黑板上做了这四道题：</p><p>2+2&#x3D;4；4+4&#x3D;8；8+8&#x3D;16；9+9&#x3D;20。</p><p>家长们纷纷说道：“你算错了一道。”</p><p>老师转过身来，慢慢地说道：</p><p>“是的，大家看得很清楚，这道题是算错了。<br>可是前面我算对了三道题，为什么没有人夸奖我，而只是看到我算错的一道呢！”</p><p>老师接着意味深长地说：“家长们，教育的真谛不在于发现孩子错误之处，而是赏识他们做得对的地方！”</p><p>感悟：</p><p>做人也是这样，你对他百次好，也许他忘记了；一次不顺心，也许会抹杀所有！</p><p>这就是100－1＝0的人性道理。朋友之间是如此，亲戚家人之间亦如此。</p><p>今天提此话题，就是为了让友谊长存，亲情永在！</p><p>朋友之间退一步为上，亲人之间让一步为高。受过人滴水之恩，理应涌泉回报。这才是做人的道理！</p><p>孩子如此，成人亦是，共勉之！</p><h2 id="09"><a href="#09" class="headerlink" title="09"></a>09</h2><p>最真实的批注，值得永久收藏！</p><p>胸口摸得着的尺寸叫——胸围；<br>胸口摸不到的尺寸叫——胸怀。</p><p>眼睛看得到的地方叫——视线；<br>眼睛看不到的地方叫——视野。</p><p>嘴里说得出来的话叫——内容；<br>嘴里说不出来的话叫——内涵。</p><p>手上比划出来的动作叫——手势；<br>手上比划不出来的动作叫——手段。</p><p>脑子里测得出的东西叫——智商；<br>脑子里测不出来的东西叫——智慧。</p><p>耳朵听得到的动静叫——声音；<br>耳朵听不到的动静叫——声誉。</p><p>证件上印出来的叫——文凭；<br>证件上印不出来的叫——文化。<br>温度计量得出来的叫——温度；<br>温度计量不出来的叫——温暖。</p><p>手指写得出来的文字叫——文章；<br>手指写不出来的文字叫——文学。</p><p>镜子里看得到的是——自己；<br>镜子里看不到的是——自我。</p><p>金钱衡量得出的是——价格；<br>金钱衡量不出的是——价值。</p><p>存款显示出来的叫——财产；<br>存款显示不出来的叫——财富。</p><p>牵挂在嘴上的叫——情话；<br>牵挂在心里的叫——情感。</p><p>看完后转发出去的叫——分享；<br>看完后不转发出去的叫——独享。<br><img src="https://img0.baidu.com/it/u=1378373671,2406487365&fm=253&fmt=auto&app=120&f=JPEG?w=1280&h=800" alt="但行前路，不负韶华"></p>]]></content>
      
      
      <categories>
          
          <category> 塔坦 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 故事很短，道理很深 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>十个顶级思维习惯，养成受用无穷！</title>
      <link href="/2023/03/17/%E6%96%87%E6%A1%A3/%E9%A1%B6%E7%BA%A7%E6%80%9D%E7%BB%B4/"/>
      <url>/2023/03/17/%E6%96%87%E6%A1%A3/%E9%A1%B6%E7%BA%A7%E6%80%9D%E7%BB%B4/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img0.baidu.com/it/u=3140259713,3964708096&fm=253&fmt=auto&app=120&f=JPEG?w=1280&h=800" alt="遥遥相见，世世相安"></p><h1 id="十个顶级思维习惯，养成受用无穷"><a href="#十个顶级思维习惯，养成受用无穷" class="headerlink" title="十个顶级思维习惯，养成受用无穷"></a>十个顶级思维习惯，养成受用无穷</h1><p>心理学家卡罗尔·德韦克在《终身成长》中写道：</p><p>“决定人与人之间差异的，不是天赋，而是思维模式。”</p><p>很多时候，正确的思维方式，比努力和天赋更重要。</p><p>只有思维方式对了，行动才能对；</p><p>行动对了，生活也就顺了。</p><p>今天和大家分享10个让你变厉害的思维习惯，助你更好地掌控人生。</p><h2 id="1-借力思维"><a href="#1-借力思维" class="headerlink" title="1.借力思维"></a>1.借力思维</h2><p>《塔木德》中记载了一个故事：</p><p>有位犹太人在小岛上建了度假村，但游客却很少。</p><p>朋友建议他在周围种满树木，打造绿色生态。</p><p>但这要消耗大量金钱，他无力支付。</p><p>后来，他想到个办法：告诉游客可以通过在岛上种纪念树，纪念重要的日子。</p><p>消息传开后，很多人都前来种树留念。</p><p>短短一年时间，岛上就种满了树。</p><p>犹太人此举不仅吸引了游客，还赚了不少钱。</p><p>史学家陈寿说：</p><p>“能用众力，则无敌于天下矣；能用众智，则无畏于圣人矣。”</p><p>一个人再有天赋，也有不擅长的领域；再有能力，也有办不到的事情。</p><p>真正有智慧的人，都懂得借人所长，以突破“自我”局限，取得更大的成就。</p><p>正所谓：“他山之石，可以攻玉。”</p><p>敢借力，会借力的人，往往能更快闯出属于自己的一片天。</p><h2 id="2-上游思维"><a href="#2-上游思维" class="headerlink" title="2.上游思维"></a>2.上游思维</h2><p>看过一个故事：</p><p>美国有个小镇常常发生火灾，因此消防队总是忙于救火，在火场出生入死。</p><p>后来，有人提醒他们应该重视防火。</p><p>于是在救火之余，消防队经常上街处理容易引起火灾的隐患，检修救火设备。</p><p>几个月后，火情明显减少很多。</p><p>自此，消防队将更多的精力放在巡查上，又过了一段时间，小镇几乎不再发生火灾。</p><p>组织行为学家丹·希思，曾提出“上游思维”的概念：</p><p>做好上游水土保持工作，下游洪灾发生概率就会大幅减少。</p><p>生活和工作也是如此，遇到问题时，不妨在补救之余，多问几个为什么？</p><p>找到原因，从根源予以解决，才不会整日忙于“救火”。</p><p>只有学会防患于未然，生活才会变得轻松。</p><h2 id="3-概率思维"><a href="#3-概率思维" class="headerlink" title="3.概率思维"></a>3.概率思维</h2><p>俗话说：“谋事在人，成事在天。”</p><p>世上没有100%成功的事情，但是厉害的人都会优先选择做成功率大的事。</p><p>自媒体人木兵有个师弟，大学毕业后在报社做编辑。</p><p>一次，木兵问师弟对工作有什么期望，师弟说：“希望能年薪20万，买车买房。”</p><p>木兵听完立刻表示，这个期望大概率无法实现。</p><p>因为传统报业在走下坡路，能保证不失业都不容易，更别提颇丰的收入。</p><p>师弟觉得很有道理，就果断离职去互联网公司做策划。</p><p>当时互联网行业正在快速兴起，仅用了3年，他就年薪几十万，买了车房，而报社的同事正处在失业边缘。</p><p>著名数学家拉普拉斯说：“人生中最重要的问题，绝大多数都是概率问题。”</p><p>面临选择时，先结合社会趋势和自身情况，多做一些调查和思考，选择成功率大的事情。</p><p>然后通过学习与改进，将成功率变得更大。</p><p>如此，才能在不确定性中找到确定性，收获更好的人生。</p><h2 id="4-目标思维"><a href="#4-目标思维" class="headerlink" title="4.目标思维"></a>4.目标思维</h2><p>美国作家托马斯·科里曾用5年时间，采访数百位白手起家的富豪和一百多位穷人。</p><p>他发现，80%以上的富豪都有明确的人生目标，他们的选择和行为，大多围绕目标进行。</p><p>即使遇到失败，也会朝着目标再次努力。</p><p>而在那些穷人里，只有3%的人有目标，更多人都没有明确的努力方向，整日活得浑浑噩噩。</p><p>作家约翰·拉斯金说过一句话：“无目标而生活，犹如没有罗盘而航行。”</p><p>只有目标明确，方能避免被无意义的事物干扰前进的步伐，在挫折中披荆斩棘，勇往直前。</p><p>相反，没有目标，就没有方向；</p><p>没有方向，就不知该如何行动，甚至还会经常把精力用在不重要的事情上，难以看到成效。<br><img src="https://img2.baidu.com/it/u=855865225,2410796825&fm=253&fmt=auto&app=120&f=JPEG?w=1422&h=800" alt="遥遥相见，世世相安"></p><h2 id="5-绿灯思维"><a href="#5-绿灯思维" class="headerlink" title="5.绿灯思维"></a>5.绿灯思维</h2><p>成甲在《好好学习》中，提到绿灯思维的概念：</p><p>拥有绿灯思维的人，始终保持开放的心态，摄取新的知识，拓宽边界。</p><p>有位金融自媒体达人，讲过自己的一段经历：</p><p>有一次，他和新东方总裁俞敏洪见面，谈完正事后，他们聊起对教育行业的看法。</p><p>没想到他刚开口，俞敏洪就拿起本子和笔，开始做笔记，最终记了满满三页纸。</p><p>这件事让他感慨万分：俞敏洪明明已是行业大佬，却仍能耐心倾听并记录他人的想法。</p><p>在俞敏洪看来：</p><p>“见识是可以不断提高的，前提是要有一个开放的心态，愿意接纳身边人和事所产生的知识。”</p><p>社会在不停发展，技术和思想也在日益更新。</p><p>多倾听不同的声音、持续学习，不断拓宽视野和能力，才会拥有应对变化的底气。</p><h2 id="6-迁移思维"><a href="#6-迁移思维" class="headerlink" title="6.迁移思维"></a>6.迁移思维</h2><p>罗振宇在跨年演讲中提过一个人。</p><p>她叫袁媛，毕业于建筑设计专业，在万科干了4年后，毅然离职，改行做婚礼策划。</p><p>对此，身边人都感到惋惜，觉得她浪费了干建筑师的经验。</p><p>但是，真的浪费了吗？</p><p>转行后，她将建筑师的空间美学，应用到婚礼布置上：</p><p>在雪山上搭建婚礼圣坛，在厂房里营造北美风情；</p><p>用10万米长的绣线，搭建“雕刻光线”空间。</p><p>她一系列的新奇想法，形成了独特风格，收到不少客户的夸赞。</p><p>比尔·盖茨曾说：</p><p>“学习和经验是可以迁移的，它们不会因为你变老而消失。”</p><p>任何时候，都不存在绝对的稳定，我们随时都可能踏入新领域、学习新技能。</p><p>但过往经历中收获的每一点思考和专业能力，都会成为日后做事的本钱。</p><p>面对新的起点，多思考如何将过去的经验和能力迁移，更好地发挥自己的优势。</p><h2 id="7-复盘思维"><a href="#7-复盘思维" class="headerlink" title="7.复盘思维"></a>7.复盘思维</h2><p>复盘本是围棋术语，指棋手为了提高棋艺，要在对弈后，对过程进行回顾，找出双方的攻守漏洞。</p><p>人生也是如此，不复盘，便难有进步。</p><p>足球巨星C罗，因自律而闻名，但很多人都忽略了：</p><p>他相当注重对球赛的复盘。</p><p>纪录片《C罗》中，有个片段：每次比赛结束后，他都会找团队拿比赛录像。</p><p>晚上，他会一边播放录像，一边对比赛中的表现进行分析。</p><p>每一次传球、射门等细节他都会反复回看，找到自己的漏洞和不足，思索怎样才能做到更好。</p><p>德国诗人海涅说：</p><p>“反省是一面镜子，它能将我们的错误清楚地照出来，使我们有改正的机会。”</p><p>之前做的每一件事，无论结果如何，都能从中总结出一些成功的经验，或失败的教训。</p><p>懂得复盘，就拥有了更新自己的能力，通过反思和改进，成就更好的自己。</p><h2 id="8-深度思维"><a href="#8-深度思维" class="headerlink" title="8.深度思维"></a>8.深度思维</h2><p>猎豹创始人傅盛曾是周鸿祎公司的员工，有次他被安排做会议纪要。</p><p>会议上，周鸿祎思维跳跃，讲了两个多小时。</p><p>一般人做纪要，大概只会将周鸿祎的发言整理、罗列出来。</p><p>但傅盛并未如此，他花了好几个小时，对着纪要不断思考和推敲：</p><p>周总为什么要讲这句话？这两个话题之间有什么逻辑？</p><p>通过深度思考，他不仅理清了周鸿祎的发言逻辑，写出直观易懂的会议纪要，还学到了他的思考方式。</p><p>在之后的工作中，傅盛也始终保持深度思考的习惯，很快便成为公司高管。</p><p>很多时候，十次流于表象的努力，都不如一次直击本质的深度思考，更具威力。</p><p>就像《教父》里说的：</p><p>“花半秒钟就看透事物本质的人，和花一辈子都看不清事物本质的人，注定是截然不同的命运。”</p><p>凡事多思考，锻炼自己快速发现事物本质的能力，才有可能在激烈的竞争中脱颖而出。</p><h2 id="9-转弯思维"><a href="#9-转弯思维" class="headerlink" title="9.转弯思维"></a>9.转弯思维</h2><p>林语堂曾说：“明智的放弃，好过盲目的执着。”</p><p>人生本就充满无限可能，遇到问题时，不必一条路走到黑。</p><p>这条路走不通，那就换一条。</p><p>成龙曾在采访中谈到自己刚出道时，立志成为第二个李小龙。</p><p>然而拍了几部功夫硬汉型的电影后，观众并不买单，票房十分惨淡。</p><p>古龙甚至直言成龙从不是他心中的侠客形象，他的剧本是给英俊小生演的。</p><p>对此，成龙思索很久，最终决定放弃传统武打动作，将滑稽搞笑融入到打戏中，开创了独一无二的“功夫喜剧”风格，深受观众喜爱。</p><p>很多时候，当原本的路线难以达到想要的目标时，果断变换方向，好过固守僵局。</p><p>勇敢地换条路、换个角度思考，或许下一秒就会发现新机遇。</p><h2 id="10-护城河思维"><a href="#10-护城河思维" class="headerlink" title="10.护城河思维"></a>10.护城河思维</h2><p>巴菲特提出过“护城河理论”，意思是搭建好自己的优势壁垒，才不会被对手淘汰。</p><p>博主@李苦李25岁那年，入职百度。</p><p>当时公司内部竞争激烈，他每天都努力学习各种知识，和同事卷加班，可始终没能拿到突出的业绩。</p><p>这时一位老同事提醒他，如果不能花时间打造属于自己的专长，迟早会面临淘汰。</p><p>听完这句话，李苦李彻底醒悟：</p><p>他放下一切杂念，除了完成基本工作外，全身心投入在数据库的学习上。</p><p>一年之后，他重构了公司数据层，将系统负担降低了40%，受到内部关注。</p><p>三年后，他成为数据库骨干，职级连升3级，收入大幅提升。</p><p>后来，他离职回西安老家，凭着过硬的专业能力轻松入职华为。</p><p>如今社会竞争日益激烈，没有独特优势的人，将很难站稳脚跟。</p><p>唯有找准立足点，并不断深耕，构筑出属于自己的护城河，才能更从容地面对未来。</p><p>▽<br>刘润曾说：</p><p>“只想取得一些小进步，就改变行为；想取得较大进步，必须改变思维。”</p><p>人与人最大的差距，就是思维习惯。</p><p>不同的思维习惯，决定了一个人看待世界的角度，更决定了他的命运层次。</p><p>未来愿我们都能持续养成正确的思维习惯，成就更好的自己。<br><img src="https://img2.baidu.com/it/u=3924672623,2871714196&fm=253&fmt=auto?w=1366&h=768" alt="遥遥相见，世世相安"></p>]]></content>
      
      
      <categories>
          
          <category> 塔坦 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 顶级思维习惯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>最好的生活方式</title>
      <link href="/2023/03/01/%E6%96%87%E6%A1%A3/%E6%9C%80%E5%A5%BD%E7%9A%84%E7%94%9F%E6%B4%BB%E6%96%B9%E5%BC%8F/"/>
      <url>/2023/03/01/%E6%96%87%E6%A1%A3/%E6%9C%80%E5%A5%BD%E7%9A%84%E7%94%9F%E6%B4%BB%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="最好的生活方式：存钱、运动、早起、读书"><a href="#最好的生活方式：存钱、运动、早起、读书" class="headerlink" title="最好的生活方式：存钱、运动、早起、读书"></a>最好的生活方式：存钱、运动、早起、读书</h1><p><img src="https://img1.baidu.com/it/u=3627887605,631839797&fm=253&fmt=auto&app=120&f=JPEG?w=608&h=679" alt="余生很贵，请勿浪费"></p><p>想一想，这是不是你的日常：</p><p>明知道跑步能健身，却始终迈不开腿；</p><p>嘴上说存钱，却还在疯狂购物；</p><p>阅读计划做了一堆，却总是安慰自己:“明天再开始吧”；</p><p>发誓要早睡早起，结果凌晨两三点还在刷手机……</p><p>作家吴晓波说过：</p><blockquote><p>每一件与众不同的绝世好东西，都是以无比的勤奋为前提的。要么是血，要么是汗，要么是大把大把的好时光。</p></blockquote><p>年轻时所有偷过的懒，都会变成中年时给自己挖的坑；</p><p>年轻时所有流过的汗，都会在中年后变成享不尽的福。</p><p>我们与牛人之间的差距，不过就是“自律”二字。</p><p><strong>优秀的人，总能在与自我较劲中，比别人多磨一会，然后拉开人生的差距。</strong></p><p><img src="https://img2.baidu.com/it/u=2457703703,3734452150&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="余生很贵，请勿浪费"></p><h2 id="存钱，是最实用的自律"><a href="#存钱，是最实用的自律" class="headerlink" title="存钱，是最实用的自律"></a>存钱，是最实用的自律</h2><p>想起之前的一个真实故事：</p><p>一对中年夫妻不幸遭遇车祸，被送往医院，伤势都很重，女子脚骨折只能躺着，男子满脸是血，嘴上的伤疼得无法说话。</p><p>可男子翻遍全身才凑够了14元挂号费，银行卡上也仅有几十元。</p><p>陷入窘迫的他欲向亲戚借钱，翻了好几遍手机却不知道打给谁，能打的电话都打了一遍，对方不是说在外地，就是在忙，匆匆挂了电话，男子瞬间崩溃。</p><p>网友评论道：“让成年人崩溃，缺一次钱就够了！”</p><p>生活总是欺软怕硬，只有银行卡里的存款，才是抵御风险的盾牌，遇事“手中有钱”，才能“心中不慌。”</p><p>看到过一段网络热语：“世人慌慌张张，不过图碎银几两，偏偏这碎银几两，能解世间万种惆怅。”</p><p>说得真实又扎心，人活一世，样样都需要钱。</p><p>不管收入多少，一定要养成存钱的习惯，懂得存钱，是未雨绸缪的远见。</p><p>王尔德曾说：</p><p><strong>我年轻的时候，以为金钱是世界上最重要的东西，等我老了才知道，真是这样。</strong></p><p>看到过一位网友的分享:</p><p>她上初中，爸妈经营着一个普通小吃店，一家三口挤在几平米的小屋，店里要用的食材、调料、编织袋等堆满了大半个屋子，一家人衣服全部手洗，做一份水煮肉片可以吃4顿。</p><p>没有旅游和假期，每天重复着早出晚归的生活，她妈妈每周要做的一件事，就是把这一周挣到、攒下的钱都存到银行里。</p><p>可是，就是这样困窘的父母，在她上大学后每月能拿出几千块生活费给她，结婚后，全款在她工作的城市买下一套小三室。</p><p>后来，他们家已经有三个商铺，两套商品房，每年收租加理财就有二十几万元收入。</p><p>古人云：</p><p>一日一钱，千日千钱。绳锯木断，水滴石穿。</p><p><strong>每日一笔小钱的积累，细水长流，也会累积成一笔巨款。</strong></p><p>会存钱的人，都懂得延迟满足，克制自己，为长远打算，为未来存下保障。</p><p>所以，努力挣钱，自觉存钱才是硬道理。</p><p><img src="https://img1.baidu.com/it/u=3398260720,802208518&fm=253&fmt=auto&app=138&f=JPEG?w=400&h=500" alt="余生很贵，请勿浪费"></p><h2 id="运动，是最养生的自律"><a href="#运动，是最养生的自律" class="headerlink" title="运动，是最养生的自律"></a>运动，是最养生的自律</h2><p>知乎上有个提问：“一个不运动的人和经常运动的人身体素质有多大的差距？”</p><p>其中一个高赞回答是：</p><p>时常运动的人，体内生态系统犹如一汪清泉，久坐不动的人，体内生态系统则更像是一潭死水。</p><p>达·芬奇曾说：</p><p>运动，是一切生命的源泉。</p><p>苏格拉底也曾说：</p><p>身体的健康因不动而破坏，因运动练习而长期保持。</p><p>运动是保持健康的最好方式，也是治愈一切的良药。</p><p><strong>运动带来的变化，也许不会立竿见影地显现，但在日复一日的坚持中，人与人的差距将会是肉眼可见的。</strong></p><p>前几月，“健身顶流”刘畊宏爆火，已经五十岁的他，完全找不出年过半百的迹象，有的是一身腱子肉，英姿勃发。</p><p>殊不知，他坚持健身长达29年，不仅在健身房训练，还时不时参加马拉松，铁人三项比赛，身体年龄足以秒杀许多20多岁的小伙子。</p><p>数十年如一日地坚持运动，岁月报之以不老容颜、健硕身躯，重启了人生的高光时刻。</p><p>当运动成为习惯，身体自然会给你最好的反馈。</p><p>有句话说：</p><p>舍得对自己下狠手，生活才会对你温柔。</p><p>那些看起来毫不费力的人，其实都离不开超强的自律力。无论是健康，财富，或是坦途，都是坚持自律为自己积攒的福气。</p><p>白岩松曾被诊断高血压，必须终身服药，他却通过2个月的运动调整，每天快走一小时，配合跑步，将血压控制到正常范围。</p><p>古语有云：</p><p>活动有方，五脏自和。</p><p><strong>想要保持健康，不妨从多运动开始。</strong></p><p>不可否认，运动的过程很辛苦，伴随着大汗淋漓和一身的酸痛，但是，请坚持下来，时间会给你最好的答案。</p><p>放弃很容易，但坚持更酷。<br><img src="https://img0.baidu.com/it/u=2125391947,550316435&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=334" alt="余生很贵，请勿浪费"></p><h2 id="读书，是最养心的自律"><a href="#读书，是最养心的自律" class="headerlink" title="读书，是最养心的自律"></a>读书，是最养心的自律</h2><p>民族英雄郑成功，书房里挂着一副自勉联：</p><p>养心莫善寡欲，至乐无如读书。</p><p><strong>修身养性最好的办法，莫过于清心寡欲，一个人最大的快乐，莫过于读书。</strong></p><p>很多时候，人之所以烦恼、迷茫，根源就在于读书太少，才会为现状焦虑，为未来担忧，人也越来越抑郁。</p><p>而读书多的人，很少盲目，不焦躁，不迷失，遇事笃定自如。</p><p>在娱乐圈里，有一位音乐诗人，他就是李健。</p><p>他常年保持大量阅读的习惯，书架上满满当当的全是书籍。</p><p>酷爱读书的他曾说:</p><p>读书就像精神层面的一日三餐，人要吃饭，那你的心灵，也要不断地给予能量给予滋润。</p><p>他的音乐灵感，很多都来源于书中，笔下的歌词，更是温柔雅致富有诗意。</p><p>《格言联璧》中写道：</p><p>鱼离水则身枯，心离书则神索。”大意是鱼离水则亡；心离书将精神枯竭。</p><p>读书，是一辈子的修行，不论财富多寡和地位高低，都能通过读书重塑内心，活出自我。</p><p>作家周岭36岁开始潜心阅读，大量涉猎各领域书籍，向内觉醒，向外探索，最终写出改变无数人的畅销书；</p><p>樊登老师通过精读论语，阅读海量书籍，改变忧心忡忡的心态，直面生活的无奈，实现自我疗愈。</p><p>正如毕淑敏所说：</p><p>书不是棍棒，却会使人铿锵有力；书不是羽毛，却会使人飞翔。</p><p><strong>读书，才是一个人灵魂最大的支柱，面对生活的百般肆虐，依然能够逆风翻盘。</strong></p><p><img src="https://img1.baidu.com/it/u=698757615,4099908372&fm=253&fmt=auto&app=120&f=JPEG?w=1280&h=800" alt="余生很贵，请勿浪费"></p><h2 id="早起，是最低成本的自律"><a href="#早起，是最低成本的自律" class="headerlink" title="早起，是最低成本的自律"></a>早起，是最低成本的自律</h2><p>人常说：</p><p>能够驯服早晨的人，必能驯服人生。</p><p>一个人的习惯里，往往藏着他的未来。你越是早起床，生活越精彩，从容的生活节奏，饱满的情绪，能让我们掌控一天的好状态。</p><p>作家李筱懿每天早上4：45起床写稿，每天早上写2500字，一年365天，几乎从不中断。</p><p>早上安静，时间完整，精力也更集中，带给她更高效的创作，也让她养成每天午休、早睡的规律作息。</p><p>她利用早起时间，一年可以写90万字，6年间写下五百多万字，出版8本畅销书，成功转型成自己梦想中的女作家。</p><p>她在分享中说道:</p><p>我喜欢从容规律的生活，这让我对人生更有耐心。</p><p><strong>可以说，早起是最低成本的升值方式，坚持早起，是一种了不起的好习惯，它带来的改变，往往也是了不起的。</strong></p><p>真正厉害的人，都懂得利用好早起时间。</p><p>比如那些成绩突飞猛进的“黑马”，并不是都比你聪明，而是比你有决心，每天早起读书、复习、做题等；</p><p>比如办公室里的销售精英，往往能够提前打卡，做好一天的准备工作，当你还在赖床时，他已经把做好的报告发邮抄送了；</p><p>再比如那些身材很好，身体比你健康的人，往往更喜欢早起跑步、健身，挥汗如雨。</p><p>富兰克林曾说过：</p><p>我从未见过一个早起勤奋的人抱怨命运不好，良好的品格、优秀的习惯，坚强的意志，是不会被假设所谓的命运击败的。</p><p>任何一个好习惯，只要坚持，就一定能看到改变，如果一时之间做不到自律，不如从早起这件小事开始约束自己。</p><p><img src="https://img0.baidu.com/it/u=3293797107,2875445281&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=889" alt="余生很贵，请勿浪费"></p><p>@十点读书</p>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 最好的生活方式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux-bash初始(2)</title>
      <link href="/2023/02/17/linux/Day01.2bash%E7%9A%84%E5%88%9D%E5%A7%8B/"/>
      <url>/2023/02/17/linux/Day01.2bash%E7%9A%84%E5%88%9D%E5%A7%8B/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="bash初始"><a href="#bash初始" class="headerlink" title="bash初始"></a>bash初始</h1><h2 id="bash-shell介绍"><a href="#bash-shell介绍" class="headerlink" title="bash shell介绍"></a>bash shell介绍</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Bash Shell是一个命令解释器，它在操作系统的最外层，负责用户程序与内核进行交互操作的一种接口，讲用户输入的命令翻译给操作系统，并将处理后的结果输出至屏幕。</span><br><span class="line"></span><br><span class="line">当我们使用远程连接工具连接linux服务，系统则会打开一个默认的shell，我们可以在这个界面执行命令，比如：获取系统当前时间，创建一个用户等等...</span><br></pre></td></tr></table></figure><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230228200840511.png" alt="image-20230228200840511"></p><h2 id="bash-shell的作用"><a href="#bash-shell的作用" class="headerlink" title="bash shell的作用"></a>bash shell的作用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">使用Shell实现对Linux系统的大部分管理，例如：</span><br><span class="line">1）文件管理</span><br><span class="line">2）权限管理</span><br><span class="line">3）用户管理</span><br><span class="line">4）磁盘管理</span><br><span class="line">5）网络管理</span><br><span class="line">6）软件管理</span><br><span class="line">7）应用管理</span><br><span class="line">...等等管理</span><br></pre></td></tr></table></figure><h2 id="bash-shell的执行方式"><a href="#bash-shell的执行方式" class="headerlink" title="bash shell的执行方式"></a>bash shell的执行方式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输入命令方式 ===&gt; 效率低 ===&gt;适合少量工作</span></span><br><span class="line">useradd xxx</span><br><span class="line"><span class="comment"># shell script ===&gt; 效率高 ===&gt;适合复杂的工作</span></span><br><span class="line">sh useradd.sh</span><br><span class="line"></span><br><span class="line">~ = /root</span><br></pre></td></tr></table></figure><h2 id="shell命令提示符"><a href="#shell命令提示符" class="headerlink" title="shell命令提示符"></a>shell命令提示符</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;$&#x27;</span> = 普通用户</span><br><span class="line"><span class="string">&#x27;#&#x27;</span> = root用户（超级管理员）</span><br><span class="line"> </span><br><span class="line"><span class="comment">#查看当前用户</span></span><br><span class="line">[root@db04 ~]<span class="comment"># whoami</span></span><br><span class="line">root</span><br><span class="line"> </span><br><span class="line"><span class="comment">#查看当前命令提示符</span></span><br><span class="line">[root@db04 ~]<span class="comment"># echo $PS1</span></span><br><span class="line">[\u@\h \W]\$</span><br><span class="line"> </span><br><span class="line">root:当前系统的用户</span><br><span class="line">db04:当前系统的主机名</span><br><span class="line">~:当前所在的位置</span><br><span class="line"><span class="comment">#:超级管理员身份（root用户）</span></span><br><span class="line">$:普通用户</span><br></pre></td></tr></table></figure><h2 id="修改命令提示符"><a href="#修改命令提示符" class="headerlink" title="修改命令提示符"></a>修改命令提示符</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$PS1</span></span><br><span class="line">[\u@\H \W \t]\$</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如何修改命令提示符</span></span><br><span class="line">vi .bashrc</span><br><span class="line">i 进入编辑模式</span><br><span class="line">最底下会有个</span><br><span class="line">-- INSERT --</span><br><span class="line"></span><br><span class="line">在<span class="keyword">fi</span>的下面插入要修改的命令提示符格式</span><br><span class="line">PS1=<span class="string">&#x27;\[\e[32;40m\] \[[\u@\h \w \t]\$ \[\e[0m\]&#x27;</span></span><br><span class="line">ESC保存退出</span><br><span class="line"><span class="built_in">source</span> .bashrc执行</span><br><span class="line"></span><br><span class="line"><span class="comment">#例子</span></span><br><span class="line">PS1=<span class="string">&#x27;\[\e[32;40m\] \[[\u@\h \w \t]\$ \[\e[0m\]&#x27;</span></span><br><span class="line">PS1=<span class="string">&quot;\[\e[37;40m\][\[\e[32;40m\]\u\[\e[37;40m\]@\h \[\e[36;40m\]\w\[\e[0m\]]\\$ &quot;</span></span><br><span class="line">&#123;1&#125;</span><br><span class="line">PS1=<span class="string">&quot;\[\e[37;40m\][\[\e[32;40m\]\u\[\e[37;40m\]@\[\e[35;40m\]\h\[\e[0m\] \</span></span><br><span class="line"><span class="string">[\e[36;40m\]\w\[\e[0m\]]\\$ &quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux-bash shell的特性(3)</title>
      <link href="/2023/02/17/linux/Day02bash%20shell%E7%9A%84%E7%89%B9%E6%80%A7/"/>
      <url>/2023/02/17/linux/Day02bash%20shell%E7%9A%84%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="Bash-Shell的基本特性"><a href="#Bash-Shell的基本特性" class="headerlink" title="Bash Shell的基本特性"></a>Bash Shell的基本特性</h1><h2 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">命令 选项 参数</span><br><span class="line"><span class="built_in">command</span> option argument</span><br><span class="line"></span><br><span class="line"><span class="comment"># 光一个命令 没有选项没有参数</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">展开当前所在的目录</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命令 选项 没有参数</span></span><br><span class="line">[root@xxx ~]<span class="comment"># ls -a</span></span><br><span class="line">! .. 2 4 .bash_history .bash_profile .cshrc niu_wa .tcshrc</span><br><span class="line">. 1 3 anaconda-ks.cfg .bash_logout .bashrc niuwa nohup.out useradd.sh</span><br><span class="line">[root@xxx ~]<span class="comment"># ls -la</span></span><br><span class="line">total 44</span><br><span class="line">-rw-r--r--. 1 root root 8 Oct 31 10:22 !</span><br><span class="line">dr-xr-x---. 2 root root 242 Oct 31 12:28 .</span><br><span class="line">dr-xr-xr-x. 17 root root 224 Oct 27 08:55 ..</span><br><span class="line">-rw-r--r--. 1 root root 92 Oct 31 10:29 1</span><br><span class="line">-rw-r--r--. 1 root root 34 Oct 31 10:07 2</span><br><span class="line">-rw-r--r--. 1 root root 0 Oct 31 10:07 3</span><br><span class="line">-rw-r--r--. 1 root root 0 Oct 31 10:07 4</span><br><span class="line">-rw-------. 1 root root 1448 Oct 27 08:57 anaconda-ks.cfg</span><br><span class="line">-rw-------. 1 root root 3548 Oct 31 15:22 .bash_history</span><br><span class="line">-rw-r--r--. 1 root root 18 Dec 29 2013 .bash_logout</span><br><span class="line">-rw-r--r--. 1 root root 176 Dec 29 2013 .bash_profile</span><br><span class="line">-rw-r--r--. 1 root root 298 Oct 31 12:25 .bashrc</span><br><span class="line">-rw-r--r--. 1 root root 100 Dec 29 2013 .cshrc</span><br><span class="line">-rw-r--r--. 1 root root 0 Oct 31 10:07 niuwa</span><br><span class="line">-rw-r--r--. 1 root root 0 Oct 31 10:08 niu_wa</span><br><span class="line">-rw-------. 1 root root 0 Oct 28 10:59 nohup.out</span><br><span class="line">-rw-r--r--. 1 root root 129 Dec 29 2013 .tcshrc</span><br><span class="line">-rw-r--r--. 1 root root 104 Oct 28 11:55 useradd.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命令 选项 参数</span></span><br><span class="line">[root@xxx ~]<span class="comment"># ls -a /etc</span></span><br></pre></td></tr></table></figure><h2 id="命令补全"><a href="#命令补全" class="headerlink" title="命令补全"></a>命令补全</h2><p>当使用windows查找一个目录层级特别多的文件时，打开的效率会非常的慢，但如果使用linux查找一个目录层级特别多的文件时，可以通过tab键快速补全。</p><p>命令补全<br>选项补全<br>参数补全</p><p>PS：tab键可以实命令补全，路径补全，在实际生产中tab补全往往是我们使用的最多的，因为可以减少执行命令以及路径出错率，还能提高输入效率。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看本机IP，忘记了具体命令</span></span><br><span class="line">[root@db04 ~]<span class="comment"># ifc</span></span><br><span class="line">ifcfg     ifconfig</span><br><span class="line"><span class="comment">#按下tab键会自动补全</span></span><br><span class="line">[root@db04 ~]<span class="comment"># ifconfig</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#按一下tab没有反应，那么需要按两下tab键，列出所有if开头的命令</span></span><br><span class="line">[root@db04 ~]<span class="comment"># if</span></span><br><span class="line"><span class="keyword">if</span>         ifcfg      ifconfig   ifdown     ifenslave  ifnames    ifrename   iftop      ifup</span><br><span class="line"> </span><br><span class="line"><span class="comment">#Linux目录比较深，经常会使用tab键进行补全，如果路径出错是没有办法补全的</span></span><br><span class="line">[root@db04 ~]<span class="comment"># ls /etc/sysconfig/network-scripts/ifcfg-eth0</span></span><br><span class="line">/etc/sysconfig/network-scripts/ifcfg-eth0</span><br></pre></td></tr></table></figure><p>如果无法补全选项，那么需要安装一个扩展包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@db04 ~]<span class="comment"># yum install -y bash-completion</span></span><br></pre></td></tr></table></figure><h2 id="命令快捷键"><a href="#命令快捷键" class="headerlink" title="命令快捷键"></a>命令快捷键</h2><p>命令的快捷键可以帮助我们大大提升工作效率</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + a    <span class="comment">#光标跳转至正在输入的命令行的首部</span></span><br><span class="line">Ctrl + e    <span class="comment">#光标跳转至正在输入的命令行的尾部</span></span><br><span class="line">Ctrl + w    <span class="comment">#按照空格来删除bash内容</span></span><br><span class="line">Ctrl + c    <span class="comment">#终止前台运行的程序</span></span><br><span class="line">Ctrl + d    <span class="comment">#在shell中，ctrl-d表示退出当前shell。（logout、exit）</span></span><br><span class="line">Ctrl + z    <span class="comment">#将任务暂停，挂至后台</span></span><br><span class="line">Ctrl + l    <span class="comment">#清屏，和clear命令等效。</span></span><br><span class="line">Ctrl + k    <span class="comment">#删除从光标到行末的所有字符</span></span><br><span class="line">Ctrl + u    <span class="comment">#删除从光标到行首的所有字符</span></span><br><span class="line">Ctrl + r    <span class="comment">#搜索历史命令, 利用关键字</span></span><br><span class="line">Ctrl + s    <span class="comment">#锁屏</span></span><br><span class="line">Ctrl + q    <span class="comment">#解锁</span></span><br><span class="line">Ctrl + 左右  <span class="comment">#按照单词快速跳转光标（Xshell提供的）</span></span><br><span class="line">ESC  + .    <span class="comment">#获取最后的指令</span></span><br><span class="line"><span class="comment">#在命令行前加面加 &quot;#&quot; 则该命令不会被执行</span></span><br></pre></td></tr></table></figure><h2 id="历史命令"><a href="#历史命令" class="headerlink" title="历史命令"></a>历史命令</h2><p>历史命令的作用：追溯之前的发生情况，在企业中，十分重要，涉及到运维的责任，记录历史命令对于运维人员来说，也有一个专业名词：审计</p><p>-w:保存命令历史到文件 write</p><p>-c:清空命令历史记录，不会清空文件 clear</p><p>-d:删除命令历史的第N行 delete</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看历史记录</span></span><br><span class="line">[root@db04 ~]<span class="comment"># history</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#清空历史记录</span></span><br><span class="line">[root@db04 ~]<span class="comment"># history -c</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#指定一条历史记录删除</span></span><br><span class="line">[root@db04 ~]<span class="comment"># history -d 110</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#保存历史命令</span></span><br><span class="line">[root@db04 ~]<span class="comment"># history -w</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#执行上一条命令</span></span><br><span class="line">[root@db04 ~]<span class="comment"># !!</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#执行上一条ls相关命令</span></span><br><span class="line">[root@db04 ~]<span class="comment"># !ls</span></span><br><span class="line"><span class="built_in">ls</span> /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">/etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line"> </span><br><span class="line"><span class="comment">#执行历史命令中的第74条命令</span></span><br><span class="line">[root@db04 ~]<span class="comment"># !74</span></span><br></pre></td></tr></table></figure><h2 id="命令的别名"><a href="#命令的别名" class="headerlink" title="命令的别名"></a>命令的别名</h2><p>命令别名讲用户经常使用的复杂命令简单化，创建出属于自己的命令别名。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">创建语法：<span class="built_in">alias</span> 别名=”命令“</span><br><span class="line">取消语法：<span class="built_in">unalias</span> 别名</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义临时别名，查看网络是否可以通，ping 百度,只对当前shell生效</span></span><br><span class="line">[root@db04 ~]<span class="comment"># alias tong=&quot;ping baidu.com&quot;</span></span><br><span class="line">[root@db04 ~]<span class="comment"># tong</span></span><br><span class="line">PING baidu.com (123.125.114.144) 56(84) bytes of data.</span><br><span class="line">64 bytes from 123.125.114.144: icmp_seq=1 ttl=128 time=44.2 ms</span><br><span class="line">64 bytes from 123.125.114.144: icmp_seq=2 ttl=128 time=47.5 ms</span><br><span class="line">64 bytes from 123.125.114.144: icmp_seq=3 ttl=128 time=46.3 ms</span><br><span class="line"> </span><br><span class="line"><span class="comment">#查看所有定义的别名</span></span><br><span class="line">[root@db04 ~]<span class="comment"># alias</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">cp</span>=<span class="string">&#x27;cp -i&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> l.=<span class="string">&#x27;ls -d .* --color=auto&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> ll=<span class="string">&#x27;ls -l --color=auto&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">ls</span>=<span class="string">&#x27;ls --color=auto&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">mv</span>=<span class="string">&#x27;mv -i&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">rm</span>=<span class="string">&#x27;rm -i&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> tong=<span class="string">&#x27;ping baidu.com&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">which</span>=<span class="string">&#x27;alias | /usr/bin/which --tty-only --read-alias --show-dot --show-tilde&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#取消别名</span></span><br><span class="line">[root@db04 ~]<span class="comment"># unalias oldboy</span></span><br><span class="line">[root@db04 ~]<span class="comment"># oldboy</span></span><br><span class="line">-bash: tong: <span class="built_in">command</span> not found</span><br><span class="line"> </span><br><span class="line"><span class="comment">#永久生效</span></span><br><span class="line">[root@db04 ~]<span class="comment"># vim /etc/bashrc</span></span><br><span class="line"><span class="built_in">alias</span> oldboy=<span class="string">&quot;ping baidu.com&quot;</span></span><br></pre></td></tr></table></figure><h2 id="获取命令帮助"><a href="#获取命令帮助" class="headerlink" title="获取命令帮助"></a>获取命令帮助</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取ls命令的帮助</span></span><br><span class="line">[root@db04 ~]<span class="comment"># ls --help</span></span><br><span class="line">用法：<span class="built_in">ls</span> [选项]... [文件]...</span><br><span class="line"> </span><br><span class="line"><span class="comment">#ls常见选项</span></span><br><span class="line">-a  //查看目录下的所有文件，包括隐藏文件</span><br><span class="line">-l  //以长格式的方式显示文件的详细内容</span><br><span class="line">-h  //以人性化的方式显示内容，配合-l使用</span><br><span class="line">-d  //只列出目录名，不列出目录以下的内容</span><br><span class="line">-t  //按修改时间进行排序</span><br><span class="line">-i  //显示文件的inode（该文件在该分区的一个编号）</span><br><span class="line">-r  //倒叙 </span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># man ls</span></span><br></pre></td></tr></table></figure><p>查看Linux命令的站点：</p><p><a href="http://linux.51yip.com/">http://linux.51yip.com/</a></p><p><a href="http://man.linuxde.net/">http://man.linuxde.net/</a></p><h2 id="命令执行的流程"><a href="#命令执行的流程" class="headerlink" title="命令执行的流程"></a>命令执行的流程</h2><p>当我们执行一个命令，整个命令执行流程如下：</p><p>1.判断命令是否通过绝对路径执行</p><p>2.判断命令是否存在别名</p><p>3.判断用户输入的内部命令还是外部命令</p><p>4.内部命令直接执行，外部命令检测是否存在缓存</p><p>5.检测PATH路径，有执行，无报错</p><p>内部命令：shell程序自带的命令</p><p>外部命令：在系统PATH变量的某个路径下的可执行程序。</p><p>使用<code>type</code>命令检测用户输入的命令属于内部命令还是外部命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#cd命令属于shell内部命令</span></span><br><span class="line">[root@db04 ~]<span class="comment"># type -a cd</span></span><br><span class="line"><span class="built_in">cd</span> is a shell <span class="built_in">builtin</span></span><br><span class="line"><span class="built_in">cd</span> is /usr/bin/cd</span><br><span class="line"> </span><br><span class="line"><span class="comment">#ping属于外部命令, 同时会打印当前命令路径</span></span><br><span class="line">[root@db04 ~]<span class="comment"># type -a  ping</span></span><br><span class="line">ping is /bin/ping</span><br></pre></td></tr></table></figure><p>PATH变量定义的路径, 作用是告诉Bash执行的外部命令存放的位置，Bash会在这些路径中进行逐个扫描。</p><p>事实上执行过的外部命令都会保存在内存缓存中, 当再次执行相同的命令, 会通过缓存调取执行, 也就意味着不会搜索PATH路径。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//表缓存命令所在位置</span><br><span class="line">[root@db04 ~]<span class="comment"># hash</span></span><br><span class="line">hits    <span class="built_in">command</span></span><br><span class="line">   1    /usr/bin/tty</span><br><span class="line">   3    /sbin/ifconfig</span><br><span class="line"> </span><br><span class="line">//已缓存命令,如果移动位置会导致无法找到该命令</span><br><span class="line">[root@db04 ~]<span class="comment"># mv /sbin/ifconfig /bin/</span></span><br><span class="line">[root@db04 ~]<span class="comment"># ifconfig</span></span><br><span class="line">-bash: /sbin/ifconfig: No such file or directory</span><br><span class="line"> </span><br><span class="line">//删除缓存过的ifconfig命令, 即可执行</span><br><span class="line">[root@db04 ~]<span class="comment"># hash -d ifconfig</span></span><br><span class="line">[root@db04 ~]<span class="comment"># ifconfig</span></span><br><span class="line"> </span><br><span class="line">//当然可以清空缓存表</span><br><span class="line">[root@db04 ~]<span class="comment"># hash -r</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">//命令缓存<span class="built_in">hash</span>需要注意如下情况:</span><br><span class="line">1.如果执行外部命令1次就会对该命令进行缓存</span><br><span class="line">2.如果将命令移动了位置</span><br><span class="line">    a.使用绝对路径执行</span><br><span class="line">    b.删除<span class="built_in">hash</span>表的缓存指令</span><br></pre></td></tr></table></figure><p>总结，当我们执行了一个ping命令之后，整个命令执行的流程步骤如下：</p><p>1.检查执行的是否是绝对路径执行</p><p>2.检查该ping命令是否存在别名</p><p>3.检查该ping命令是内部命令还是外部命令</p><p>4.如果是内部指令直接执行，如果是外部命令</p><p>5.检测该命令是否有缓存，如果没有，查找PATH变量</p><p>6.检查PATH路径直到查到该命令然后执行</p><p>7.如果没有找到该命令则返回错误。command not found</p>]]></content>
      
      
      <categories>
          
          <category> Linux云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux-用户管理(7)</title>
      <link href="/2023/02/17/linux/Day06Linux%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/"/>
      <url>/2023/02/17/linux/Day06Linux%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="Linux用户管理-用户的基本操作"><a href="#Linux用户管理-用户的基本操作" class="headerlink" title="Linux用户管理-用户的基本操作"></a>Linux用户管理-用户的基本操作</h1><h2 id="用户的基本概述"><a href="#用户的基本概述" class="headerlink" title="用户的基本概述"></a>用户的基本概述</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#什么是用户</span></span><br><span class="line">用户指的是能够正常登录Linux或windows系统</span><br><span class="line">那linux和windows系统的用户有什么区别?</span><br><span class="line">本质都是登录系统的，只不过linux支持多用户同时登录，windows默认不支持，但是修改组策略的情况下也是可以多用户登录的</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1）系统上的每一个进程(运行的程序)都需要特定的用户运行</span><br><span class="line">2）每一个文件都有特定的用户拥有，所以访问一个文件或目录受到用户的限制</span><br><span class="line">3）进程能够以何种方式访问某一个文件或目录, 与进程所关联的用户有关</span><br></pre></td></tr></table></figure><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230316200642200.png" alt="image-20230316200642200"></p><h2 id="查看系统中存在的用户"><a href="#查看系统中存在的用户" class="headerlink" title="查看系统中存在的用户"></a>查看系统中存在的用户</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看当前系统用户信息</span></span><br><span class="line">[root@db04 ~]<span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) 组=0(root)</span><br><span class="line">[root@db04 ~]<span class="comment"># id zls</span></span><br><span class="line">uid=602(zls) gid=602(zls) 组=602(zls)</span><br><span class="line"><span class="comment">#每一个文件都有所有者</span></span><br><span class="line">[root@db04 tmp]<span class="comment"># ll</span></span><br><span class="line">总用量 12</span><br><span class="line">drwxr-xr-x 2 zls     zls     4096 6月   2 20:44 zls</span><br><span class="line">drwxr-xr-x 2 oldboy  oldboy  4096 6月   2 20:44 oldboy</span><br><span class="line">drwxr-xr-x 2 student student 4096 6月   2 20:44 student</span><br><span class="line"><span class="comment">#每一个进程都有用户运行</span></span><br><span class="line">ps -ef|less</span><br></pre></td></tr></table></figure><h2 id="用户相关配置文件"><a href="#用户相关配置文件" class="headerlink" title="用户相关配置文件"></a>用户相关配置文件</h2><p>用户的信息存放在&#x2F;etc&#x2F;passwd用户的密码都保存在&#x2F;etc&#x2F;shadow这两个文件是linux系统中最重要的文件之一。 如果没有这两个文件或者这两个文件出问题，会导致无法正常登录linux系统。 &#x2F;etc&#x2F;passwd 账户文件</p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230316201056742.png" alt="image-20230316201056742"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@zls ~]<span class="comment"># head -1 /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"> </span><br><span class="line">// /etc/passwd由 <span class="string">&#x27;:&#x27;</span> 为分割符, 分为7个字段，每个字段的具体含义如下:</span><br><span class="line">字段名称               注释说明</span><br><span class="line">1.用户名称             //用户的账号名称</span><br><span class="line">2.密码占位符         //存放账户的口令,暂用x表示,密码保存在/etc/shadow</span><br><span class="line">3.用户的UID        //用户标识号</span><br><span class="line">4.用户基本组GID      //组标识号</span><br><span class="line">5.用户注释          //用户详细信息</span><br><span class="line">6.用户家目录         //root家目录是/root普通用户家目录存在/home/username(可自定义)</span><br><span class="line">7.用户登录Shell     //用户登录Linux使用的shell  <span class="comment">#cat /etc/shells</span></span><br></pre></td></tr></table></figure><p>&#x2F;etc&#x2F;shadow用户密码文件</p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230316201202422.png" alt="image-20230316201202422"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@zls ~]<span class="comment"># tail -1 /etc/shadow</span></span><br><span class="line">zls1:!!:16312:0:99999:7:::</span><br><span class="line"> </span><br><span class="line">//  /etc/shadow由 <span class="string">&#x27;:&#x27;</span> 为分割符, 分为9个字段，每个字段的具体含义如下:</span><br><span class="line">字段名称                       注释说明</span><br><span class="line">1.用户登陆名             //用户的账号名称</span><br><span class="line">2.加密后的密码            //用户密码,这是加密过的口令(未设密码时为!!)</span><br><span class="line">3.最近一次密码更改时间     //从1970年到最近一次更改密码时间之间过了多少天</span><br><span class="line">4.密码最少使用几天        //密码最少使用几天才可以更改密码(0表示无限制)</span><br><span class="line">5.密码最长使用几天      //密码使用多少天需要修改密码(默认99999永不过期)</span><br><span class="line">6.密码到期前警告期限     //密码过期前多少天提醒用户更改密码(默认过期提前7天警告)</span><br><span class="line">7.密码到期后保持活动的天数 //在此期限内, 用户依然可以登陆系统并更改密码, 指定天数过后, 账户被锁定</span><br><span class="line">8.账户到期时间        //从1970年起,账户在这个日期前可使用，到期后失效。</span><br><span class="line">9.标志                        //保留</span><br></pre></td></tr></table></figure><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230316201901975.png" alt="image-20230316201901975"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用chage更改用户密码密码使用情况</span></span><br><span class="line">-d //设置最近一次更改密码时间, 0下次登陆系统强制修改密码</span><br><span class="line">-m //设置用户两次改变密码之间使用<span class="string">&quot;最小天数&quot;</span></span><br><span class="line">-M //设置用户两次改变密码之间使用<span class="string">&quot;最大天数&quot;</span></span><br><span class="line">-W //设置密码更改警告时间 将过期警告天数设为“警告天数”</span><br><span class="line">-I //设置密码过期天数后, 密码为失效状态</span><br><span class="line">-E //设置用户过期时间, 账户失效后无法登陆</span><br><span class="line">-l //显示用户信息</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">//修改时间为2014年08月31日,和图中时间匹配,方便后续验证</span><br><span class="line">[root@zls ~]<span class="comment"># date -s &#x27;20140831&#x27;</span></span><br><span class="line">Sun Aug 31 00:00:00 CST 2014</span><br><span class="line">[root@zls ~]<span class="comment"># date</span></span><br><span class="line">Sun Aug 31 00:00:01 CST 2014</span><br><span class="line">[root@zls ~]<span class="comment"># useradd zls1</span></span><br><span class="line">[root@zls ~]<span class="comment"># echo &quot;123&quot; |passwd --stdin zls1</span></span><br><span class="line">[root@zls ~]<span class="comment"># tail -1 /etc/shadow</span></span><br><span class="line">zls1:!!:16312:0:99999:7:::</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">//设置最近一次修改密码时间</span><br><span class="line">[root@zls ~]<span class="comment"># chage -d &quot;2014-09-01&quot; zls1</span></span><br><span class="line">[root@zls ~]<span class="comment"># tail -n1 /etc/shadow</span></span><br><span class="line">zls1:!!:16314:0:99999:7:::</span><br><span class="line"> </span><br><span class="line">//设置最短使用密码时间</span><br><span class="line">[root@zls ~]<span class="comment"># chage -m 2 zls1</span></span><br><span class="line">[root@zls ~]<span class="comment"># tail -n1 /etc/shadow</span></span><br><span class="line">zls1:!!:16314:2:99999:7:::</span><br><span class="line"> </span><br><span class="line">//设置密码最长使用时间</span><br><span class="line">[root@zls ~]<span class="comment"># chage -M 15 zls1</span></span><br><span class="line">[root@zls ~]<span class="comment"># tail -n1 /etc/shadow</span></span><br><span class="line">zls1:!!:16314:2:15:7:::</span><br><span class="line"> </span><br><span class="line">//设置密码警告时间</span><br><span class="line">[root@zls ~]<span class="comment"># chage -W 6 zls1</span></span><br><span class="line">[root@zls ~]<span class="comment"># tail -n1 /etc/shadow</span></span><br><span class="line">zls1:!!:16314:2:15:6:::</span><br><span class="line">[root@zls ~]<span class="comment"># chage -W 7 zls1</span></span><br><span class="line">[root@zls ~]<span class="comment"># tail -n1 /etc/shadow</span></span><br><span class="line">zls1:!!:16314:2:15:7:::</span><br><span class="line"> </span><br><span class="line">//设置密码过期时间</span><br><span class="line">[root@zls ~]<span class="comment"># chage -I 5 zls1</span></span><br><span class="line">[root@zls ~]<span class="comment"># tail -n1 /etc/shadow</span></span><br><span class="line">zls1:!!:16314:2:15:6:5::</span><br><span class="line"> </span><br><span class="line">//设置用户过期时间</span><br><span class="line">[root@zls ~]<span class="comment"># chage -E &quot;20115-08-31&quot; zls1</span></span><br><span class="line">[root@zls ~]<span class="comment"># tail -n1 /etc/shadow</span></span><br><span class="line">zls1:!!:16314:2:15:6:5:6627567:</span><br><span class="line"> </span><br><span class="line">[root@zls ~]<span class="comment"># chage -l zls1</span></span><br><span class="line">Last password change            : Sep 01, 2014       //最近一次更改密码时间</span><br><span class="line">Password expires                : Sep 16, 2014      //密码过期时间</span><br><span class="line">Password inactive               : Sep 21, 2014     //密码失效时间</span><br><span class="line">Account expires                 : Aug 31, 2015     //用户失效时间</span><br><span class="line">Minimum number of days between password change      : 2  //密码最短使用时间</span><br><span class="line">Maximum number of days between password change      : 15 //密码最长使用时间</span><br><span class="line">Number of days of warning before password expires   : 7 //密码过期前警告天数</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">//如何验证,只调整时间为如下进行验证:</span><br><span class="line"> </span><br><span class="line">1.验证普通用户是否能修改密码, 不需要调整时间。</span><br><span class="line"> </span><br><span class="line">2.普通用户登陆系统后, 会提示警告密码还剩多少天过期</span><br><span class="line">[root@zls ~]<span class="comment"># date -s &quot;2014-09-12&quot;</span></span><br><span class="line"> </span><br><span class="line">3.普通用户登陆系统后, 强制要求修改密码</span><br><span class="line">[root@zls ~]<span class="comment"># date -s &quot;2014-09-18&quot;</span></span><br><span class="line"> </span><br><span class="line">4.普通用户登陆系统后, 提示账户已过期</span><br><span class="line">[root@zls ~]<span class="comment"># date -s &quot;2014-09-23&quot;</span></span><br></pre></td></tr></table></figure><h2 id="用户相关的命令"><a href="#用户相关的命令" class="headerlink" title="用户相关的命令"></a>用户相关的命令</h2><h3 id="增"><a href="#增" class="headerlink" title="增"></a>增</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用useradd和adduser这两个命令来创建用户</span></span><br><span class="line"><span class="comment">#使用useradd命令新增用户，注意：adduser命令软链接指向useradd命令</span></span><br><span class="line"><span class="string">&#x27;-u&#x27;</span> 指定用户的UID,不能和现有ID冲突</span><br><span class="line"><span class="string">&#x27;-g&#x27;</span> 指定用户用户默认基本组</span><br><span class="line"><span class="string">&#x27;-G&#x27;</span> 指定用户附加组,用逗号隔开添加多个附加组</span><br><span class="line"><span class="string">&#x27;-d&#x27;</span> 指定用户家目录</span><br><span class="line"><span class="string">&#x27;-c&#x27;</span> 指定用户注释信息</span><br><span class="line"><span class="string">&#x27;-M&#x27;</span> 不建立家目录</span><br><span class="line"><span class="string">&#x27;-s&#x27;</span> 指定用户默认shell</span><br><span class="line"><span class="string">&#x27;-r&#x27;</span> 创建系统账户, 没有家目录</span><br><span class="line"><span class="string">&#x27;-a&#x27;</span> 附加组，都留下，配合-G，追加</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">//创建zls用户,指定UID5001,基本组students 附加组sa,dba 注释信息：one newB user, 登陆的shell:/bin/bash</span><br><span class="line">[root@zls ~]<span class="comment"># groupadd sa</span></span><br><span class="line">[root@zls ~]<span class="comment"># groupadd dba</span></span><br><span class="line">[root@zls ~]<span class="comment"># groupadd students</span></span><br><span class="line">[root@zls ~]<span class="comment"># useradd -u 5001 -g students -G sa,dba -c &quot;one newB user&quot; -d /home/zls -s /bin/bash zls</span></span><br><span class="line">[root@zls ~]<span class="comment"># tail -1 /etc/passwd</span></span><br><span class="line">zls:x:5001:505:one newB user:/home/zls:/bin/bash</span><br><span class="line"> </span><br><span class="line">//创建系统用户，不建立用户家目录 指定nologin使其用户无法登陆系统</span><br><span class="line">[root@zls ~]<span class="comment"># useradd mysql -M -s /sbin/nologin</span></span><br><span class="line">[root@zls ~]<span class="comment"># useradd -r dba -s /sbin/nologin</span></span><br></pre></td></tr></table></figure><h3 id="改"><a href="#改" class="headerlink" title="改"></a>改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用usermod命令修改用户组</span></span><br><span class="line"><span class="string">&#x27;-u&#x27;</span>    修改用户的UID</span><br><span class="line"><span class="string">&#x27;-g&#x27;</span>    修改用户所属的基本组GID</span><br><span class="line"><span class="string">&#x27;-G&#x27;</span>    修改用户附加组, 使用逗号隔开多个附加组, 覆盖原有的附加组</span><br><span class="line"><span class="string">&#x27;-a&#x27;</span>    追加更多的附加组, 必须和-G使用: -aG 追加附加组</span><br><span class="line"><span class="string">&#x27;-m&#x27;</span>    家目录迁移, 必须和-d一起使用, 移动用户的家目录到新的位置</span><br><span class="line"><span class="string">&#x27;-d&#x27;</span>    指定用户的家目录新位置  </span><br><span class="line"><span class="string">&#x27;-c&#x27;</span>    修改用户的注释信息 </span><br><span class="line"><span class="string">&#x27;-s&#x27;</span>    更改用户使用的shell</span><br><span class="line"><span class="string">&#x27;-l&#x27;</span>    更改用户登录名</span><br><span class="line"><span class="string">&#x27;-L&#x27;</span>    锁定用户</span><br><span class="line"><span class="string">&#x27;-U&#x27;</span>    解锁用户</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[root@zls ~]<span class="comment"># grep &quot;zls&quot; /etc/passwd</span></span><br><span class="line">zls:x:5001:505:2018 new student:/home/zls:/bin/bash</span><br><span class="line"> </span><br><span class="line">//修改用户uid,gid, 附加组, 注释信息, 用户家目录, 登录shell, 登录名</span><br><span class="line"> </span><br><span class="line">//建立组,指定组gid</span><br><span class="line">[root@zls ~]<span class="comment"># groupadd -g 5008 network_sa</span></span><br><span class="line">[root@zls ~]<span class="comment"># groupadd -g 5009 devops</span></span><br><span class="line"> </span><br><span class="line">//修改用户属性</span><br><span class="line">[root@zls ~]<span class="comment"># usermod -u 6001 -g5008 -a -G 5009 -c &quot;2019 new student&quot; -md /zls -s /bin/sh -l zls_zls zls</span></span><br><span class="line"> </span><br><span class="line">//检查是否修改成功</span><br><span class="line">[root@zls ~]<span class="comment"># grep &quot;zls&quot; /etc/passwd</span></span><br><span class="line">zls_zls:x:6001:5008:2019 new student:/zls:/bin/sh</span><br><span class="line"> </span><br><span class="line">[root@zls ~]<span class="comment"># id zls_zls</span></span><br><span class="line">uid=6001(zls_zls) gid=5008(network_sa) <span class="built_in">groups</span>=5008(network_sa),503(sa),504(dba),5009(devops)</span><br><span class="line"> </span><br><span class="line">//验证家目录</span><br><span class="line">[root@zls ~]<span class="comment"># ll -d /zls</span></span><br><span class="line">drwx------. 2 zls_zls network_sa 4096 2014-09-23 00:13 /zls</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">锁定用户</span><br><span class="line">[root@zls ~]<span class="comment"># echo &quot;123&quot; |passwd --stdin zls_zls</span></span><br><span class="line">[root@zls ~]<span class="comment"># usermod -L zls_zls</span></span><br><span class="line">//无法正常登录系统</span><br><span class="line">➜  ~ ssh zls_zls@192.168.56.11</span><br><span class="line">zls_zls@192.168.56.11<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">Permission denied, please try again.</span></span><br><span class="line"><span class="string">&#123;1&#125;</span></span><br><span class="line"><span class="string">解锁用户</span></span><br><span class="line"><span class="string">[root@zls ~]# usermod -U zls_zls</span></span><br><span class="line"><span class="string">//正常登录系统</span></span><br><span class="line"><span class="string">➜  ~ ssh zls_zls@192.168.56.11</span></span><br><span class="line"><span class="string">zls_zls@192.168.56.11&#x27;</span>s password:</span><br><span class="line">Welcome to Aliyun Esc Linux</span><br><span class="line">-sh-4.1$</span><br></pre></td></tr></table></figure><h2 id="查"><a href="#查" class="headerlink" title="查"></a>查</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span> + 用户名</span><br><span class="line"></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line"><span class="built_in">who</span></span><br></pre></td></tr></table></figure><h2 id="删"><a href="#删" class="headerlink" title="删"></a>删</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删 userdel</span></span><br><span class="line">userdel [option] 用户名</span><br><span class="line"><span class="comment"># 选项</span></span><br><span class="line">-r 删除用户和该用户的家目录</span><br><span class="line">语法 : userdel [-r] username //-r 同时删除家目录</span><br><span class="line"> </span><br><span class="line">[root@zls ~]<span class="comment"># userdel user1</span></span><br><span class="line">[root@zls ~]<span class="comment"># ll /home/user1/ -d</span></span><br><span class="line">drwx------. 3 501 501 4096 2017-11-15 12:40 /home/user1/</span><br><span class="line"> </span><br><span class="line">//连同家目录一起删除</span><br><span class="line">[root@zls ~]<span class="comment"># userdel -r user1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在当前用户的家目录下，想要删除所有文件，执行了如下命令</span></span><br><span class="line">[root@db04 ~]<span class="comment"># rm -fr .*</span></span><br><span class="line"><span class="comment">#结果再次登录时</span></span><br><span class="line">-bash-4.1<span class="comment">#</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#解决办法</span></span><br><span class="line">-bash-4.1<span class="comment"># cp /etc/skel/.bash* .</span></span><br><span class="line"><span class="comment">#再次登录 即可恢复</span></span><br><span class="line">[root@db04 ~]<span class="comment">#</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux-文件管理(4)</title>
      <link href="/2023/02/17/linux/Day03%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/"/>
      <url>/2023/02/17/linux/Day03%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="linux系统入门-文件管理"><a href="#linux系统入门-文件管理" class="headerlink" title="linux系统入门-文件管理"></a>linux系统入门-文件管理</h1><h2 id="文件管理概述"><a href="#文件管理概述" class="headerlink" title="文件管理概述"></a>文件管理概述</h2><p>谈到Linux文件管理，首先我们需要了解的就是，我们要对文件做些什么事情？ 无非就是对文件进行以下操作： 创建 复制 移动 查看 编辑 压缩 查找 删除 等等</p><p>1.系统目录结构</p><p>2.文件路径定位</p><p>3.文件管理命令</p><p>4.文件类型file</p><p>5.链接文件ln</p><p>6.文件编辑vim</p><h2 id="系统目录结构"><a href="#系统目录结构" class="headerlink" title="系统目录结构"></a>系统目录结构</h2><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230228205830845.png" alt="image-20230228205830845"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230228205846330.png" alt="image-20230228205846330"></p><h2 id="“-“-根目录"><a href="#“-“-根目录" class="headerlink" title="“&#x2F;“ 根目录"></a>“&#x2F;“ 根目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">/           <span class="comment">#第一层次结构的根、整个文件系统层次结构的根目录。</span></span><br><span class="line">/bin/       <span class="comment">#需要在单用户模式可用的必要命令（可执行文件）；面向所有用户，例如：cat、ls、cp，和/usr/bin类似。</span></span><br><span class="line">/boot/      <span class="comment">#引导程序文件，例如：kernel、initrd；时常是一个单独的分区[6]</span></span><br><span class="line">/dev/       <span class="comment">#必要设备, 例如：, /dev/null.</span></span><br><span class="line">/etc/       <span class="comment">#特定主机，系统范围内的配置文件。关于这个名称目前有争议。在贝尔实验室关于UNIX实现文档的早期版本中，/etc 被称为/etcetra 目录，[7]这是由于过去此目录中存放所有不属于别处的所有东西（然而，FHS限制/etc存放静态配置文件，不能包含二进制文件）。[8]自从早期文档出版以来，目录名称已被以各种方式重新称呼。最近的解释包括反向缩略语如：&quot;可编辑的文本配置&quot;（英文 &quot;Editable Text Configuration&quot;）或&quot;扩展工具箱&quot;（英文 &quot;Extended Tool Chest&quot;)。[9]</span></span><br><span class="line">/etc/opt/       <span class="comment">#/opt/的配置文件</span></span><br><span class="line">/etc/X11/       <span class="comment">#X_Window系统(版本11)的配置文件</span></span><br><span class="line">/etc/sgml/      <span class="comment">#SGML的配置文件</span></span><br><span class="line">/etc/xml/       <span class="comment">#XML的配置文件</span></span><br><span class="line">/home/          <span class="comment">#用户的家目录，包含保存的文件、个人设置等，一般为单独的分区。</span></span><br><span class="line">/lib/           <span class="comment">#/bin/ and /sbin/中二进制文件必要的库文件。</span></span><br><span class="line">/media/         <span class="comment">#可移除媒体(如CD-ROM)的挂载点 (在FHS-2.3中出现)。</span></span><br><span class="line">/lost+found     <span class="comment">#在ext3文件系统中，当系统意外崩溃或机器意外关机，会产生一些文件碎片在这里。当系统在开机启动的过程中fsck工具会检查这里，并修复已经损坏的文件系统。当系统发生问题。可能会有文件被移动到这个目录中，可能需要用手工的方式来修复，或移到文件到原来的位置上。</span></span><br><span class="line">/mnt/       <span class="comment">#临时挂载的文件系统。比如cdrom,u盘等，直接插入光驱无法使用，要先挂载后使用</span></span><br><span class="line">/opt/       <span class="comment">#可选应用软件包。</span></span><br><span class="line">/proc/      <span class="comment">#虚拟文件系统，将内核与进程状态归档为文本文件（系统信息都存放这目录下）。例如：uptime、 network。在Linux中，对应Procfs格式挂载。该目录下文件只能看不能改（包括root）</span></span><br><span class="line">/root/      <span class="comment">#超级用户的家目录</span></span><br><span class="line">/sbin/      <span class="comment">#必要的系统二进制文件，例如： init、 ip、 mount。sbin目录下的命令，普通用户都执行不了。</span></span><br><span class="line">/srv/       <span class="comment">#站点的具体数据，由系统提供。</span></span><br><span class="line">/tmp/       <span class="comment">#临时文件(参见 /var/tmp)，在系统重启时目录中文件不会被保留。</span></span><br><span class="line">/usr/       <span class="comment">#默认软件都会存于该目录下。用于存储只读用户数据的第二层次；包含绝大多数的(多)用户工具和应用程序。</span></span><br><span class="line">/var/       <span class="comment">#变量文件——在正常运行的系统中其内容不断变化的文件，如日志，脱机文件和临时电子邮件文件。有时是一个单独的分区。如果不单独分区，有可能会把整个分区充满。如果单独分区，给大给小都不合适。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###重点记住</span></span><br><span class="line">/etc        系统重要配置文件, 以及常用服务配置文件</span><br><span class="line">/var        存放系统引导启动时产生的可变文件,文件通常动态更改的,例如: 缓存目录,日志文件</span><br><span class="line">/run        系统启动后, 运行的程序产生的运行时数据, 包括进程的pid文件,锁文件等</span><br><span class="line">/home       普通用户的主目录, 普通用户的家目录默认为/HOME/USERNAME</span><br><span class="line">/root       超级管理员的主目录, 普通用户无权操作</span><br><span class="line">/tmp        存放临时文件, 一般存放超过10天以上都会自动删除,可以更改删除临时文件的期限</span><br><span class="line">/boot       存放系统引导时候需要的文件</span><br><span class="line">/dev        存放设备文件</span><br><span class="line">/usr        安装的软件, 共享库, 重要的子目录有</span><br><span class="line">/usr/bin    用户命令目录</span><br><span class="line">/usr/sbin   管理员命令目录</span><br><span class="line">/usr/local  本地自定义安装的软件</span><br><span class="line"> </span><br><span class="line">//注意:在Linux7系统中, /bin, /sbin, /lib, /lib64都以软链接的形式链接到/usr/目录下,例如:</span><br><span class="line">/bin  --&gt; /usr/bin</span><br><span class="line">/sbin --&gt; /usr/sbin</span><br><span class="line">lib -&gt; usr/lib</span><br><span class="line">lib64 -&gt; usr/lib64</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="绝对路径和相对路径"><a href="#绝对路径和相对路径" class="headerlink" title="绝对路径和相对路径"></a>绝对路径和相对路径</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 绝对路径</span></span><br><span class="line">/etc/.......</span><br><span class="line"></span><br><span class="line"><span class="comment"># 相对路径</span></span><br><span class="line">etc/sysconfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># 特殊绝对路径</span></span><br><span class="line">~ = /root</span><br></pre></td></tr></table></figure><h2 id="文件管理命令"><a href="#文件管理命令" class="headerlink" title="文件管理命令"></a>文件管理命令</h2><h2 id="cd"><a href="#cd" class="headerlink" title="cd"></a>cd</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#切换目录</span></span><br><span class="line">.  表示用户所处的当前目录</span><br><span class="line">.. 表示上级目录;</span><br><span class="line">~  表示当前用户自己的家目录</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="built_in">cd</span> -    <span class="comment">#切换上次所在目录</span></span><br><span class="line"><span class="built_in">cd</span> ~    <span class="comment">#切换至当前用户家目录</span></span><br><span class="line"><span class="built_in">cd</span>      <span class="comment">#切换至当前用户家目录</span></span><br><span class="line"><span class="built_in">cd</span> .    <span class="comment">#.代表当前目录,一般在拷贝、移动等情况下使用</span></span><br><span class="line"><span class="built_in">cd</span> ..   <span class="comment">#切换至当前目录的上级目录</span></span><br></pre></td></tr></table></figure><h2 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a>mkdir</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建目录</span></span><br><span class="line"><span class="built_in">mkdir</span> [OPTION]... DIRECTORY...</span><br><span class="line"><span class="built_in">mkdir</span>+ 选项 （要创建的目录名）</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当期目录</span></span><br><span class="line"><span class="built_in">mkdir</span> niubi</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建到/etc下</span></span><br><span class="line">mkidr /etc/niubi</span><br><span class="line"></span><br><span class="line"><span class="comment">## 选项</span></span><br><span class="line">-p 递归</span><br><span class="line">-v 显示过程</span><br><span class="line"><span class="built_in">mkdir</span> -p /code/index</span><br></pre></td></tr></table></figure><h2 id="touch"><a href="#touch" class="headerlink" title="touch"></a>touch</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建文件</span></span><br><span class="line"><span class="built_in">touch</span> [OPTION]... FILE...</span><br><span class="line"><span class="built_in">touch</span> + 选项 （要创建的文件名）</span><br><span class="line"></span><br><span class="line">注意:</span><br><span class="line">1.创建文件，必须要创建在一个存在的目录中</span><br><span class="line">2.和创建目录不同的是，创建相同的文件不会报错</span><br><span class="line">3.创建相同的文件，源文件内容不会被覆盖</span><br><span class="line">4.在Linux当中一切皆文件</span><br><span class="line">[root@db04 ~]<span class="comment"># echo 123 &gt; file1</span></span><br><span class="line">[root@db04 ~]<span class="comment"># cat file1</span></span><br><span class="line">123</span><br><span class="line">[root@db04 ~]<span class="comment"># touch file1</span></span><br><span class="line">[root@db04 ~]<span class="comment"># cat file1</span></span><br><span class="line">123</span><br></pre></td></tr></table></figure><h2 id="tree"><a href="#tree" class="headerlink" title="tree"></a>tree</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#以树状的形式，显示目录和文件</span></span><br><span class="line">yum install -y tree</span><br><span class="line">tree</span><br><span class="line">树状形式展示目录文件结构</span><br><span class="line">-L 查看指定目录层级</span><br><span class="line">-d 只查看目录，不查看文件</span><br><span class="line">[root@xxx ~]<span class="comment"># tree -d /root/</span></span><br><span class="line">/root/</span><br><span class="line">├── 4</span><br><span class="line">├── 5</span><br><span class="line">├── 6</span><br><span class="line">└── dbx</span><br><span class="line"></span><br><span class="line">[root@xxx ~]<span class="comment"># tree /root/</span></span><br><span class="line">/root/</span><br><span class="line">├── 1</span><br><span class="line">├── 1.txt</span><br><span class="line">├── 2</span><br><span class="line">├── 4</span><br><span class="line">├── 5</span><br><span class="line">├── 6</span><br><span class="line">└── dbx</span><br><span class="line">└── caidian</span><br></pre></td></tr></table></figure><h2 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#复制命令</span></span><br><span class="line"><span class="built_in">cp</span> copy</span><br><span class="line"></span><br><span class="line">语法</span><br><span class="line"><span class="built_in">cp</span> [OPTION]... [-T] SOURCE DEST</span><br><span class="line"><span class="built_in">cp</span> 选项 源文件 目标文件</span><br><span class="line"><span class="built_in">cp</span> 1.txt /opt/2.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> [OPTION]... SOURCE... DIRECTORY</span><br><span class="line"><span class="built_in">cp</span> + 选项 源文件 目标的目录</span><br><span class="line"><span class="built_in">cp</span> /root/1.txt /opt/</span><br><span class="line"></span><br><span class="line"><span class="comment">## 选项</span></span><br><span class="line">-r 递归，拷贝目录及子目录和所有文件</span><br><span class="line">-p 保持文件的所有属性</span><br><span class="line">-a 又是递归又是保持文件属性</span><br><span class="line">-v 显示拷贝的一个过程</span><br><span class="line">-i 安全机制，当文件名重复或者目录名重复，会提示是否覆盖</span><br></pre></td></tr></table></figure><h2 id="mv"><a href="#mv" class="headerlink" title="mv"></a>mv</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#移动命令</span></span><br><span class="line">1 目标文件不存在，就相当于改名</span><br><span class="line">2.目标文件如果是一个目录。就是直接移动到目标目录底下</span><br><span class="line">move</span><br><span class="line"></span><br><span class="line"><span class="built_in">mv</span> [OPTION]... [-T] SOURCE DEST</span><br><span class="line"><span class="built_in">mv</span> 选项 源文件 目标文件</span><br><span class="line"></span><br><span class="line"><span class="comment">## 选项</span></span><br><span class="line">-i 安全机制，如果文件名或者目录名相同，会提示是否覆盖</span><br></pre></td></tr></table></figure><h2 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除</span></span><br><span class="line">remove</span><br><span class="line"><span class="built_in">rm</span> + file directory</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">-f force 强制删除</span><br><span class="line">-r 递归删除 删除目录及目录底下的所有文件和目录</span><br><span class="line">-i 安全机制，缺点是否真的要删除</span><br><span class="line">-v 显示过程</span><br></pre></td></tr></table></figure><h2 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看命令</span></span><br><span class="line">用法：<span class="built_in">cat</span> [选项]... [文件]...</span><br><span class="line">将[文件]或标准输入组合输出到标准输出。</span><br><span class="line"> </span><br><span class="line">  -A, --show-all           等于-vET</span><br><span class="line">  -b, --number-nonblank    对非空输出行编号</span><br><span class="line">  -e                       等于-vE</span><br><span class="line">  -E, --show-ends          在每行结束处显示<span class="string">&quot;$&quot;</span></span><br><span class="line">  -n, --number             对输出的所有行编号</span><br><span class="line">  -t                       与-vT 等价</span><br><span class="line">  -T, --show-tabs          将跳格字符显示为^I</span><br><span class="line">  -u                       (被忽略)</span><br><span class="line">  -v, --show-nonprinting   使用^ 和M- 引用，除了LFD和 TAB 之外</span><br><span class="line">      --<span class="built_in">help</span>                  显示此帮助信息并退出</span><br><span class="line">      --version            显示版本信息并退出</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看more</span></span><br><span class="line">more /etc/services</span><br><span class="line"><span class="comment">#查看less</span></span><br><span class="line">less /etc/services</span><br><span class="line"><span class="comment">#查看文件头部head</span></span><br><span class="line"><span class="built_in">head</span> /etc/services</span><br><span class="line"><span class="built_in">head</span> -n 5 /etc/services</span><br><span class="line"><span class="built_in">head</span> -3 /etc/services</span><br><span class="line"><span class="comment">#查看文件尾部tail</span></span><br><span class="line"><span class="built_in">tail</span> /etc/services</span><br><span class="line"><span class="built_in">tail</span> -n 5 /etc/services</span><br></pre></td></tr></table></figure><h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#过滤</span></span><br><span class="line">[root@db04 ~]<span class="comment"># grep &#x27;风&#x27; zls</span></span><br><span class="line">江山风景美如画，</span><br><span class="line">一句卧槽风好大。</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># grep &#x27;^江山&#x27; zls</span></span><br><span class="line">江山风景美如画，</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># grep &#x27;。$&#x27; zls</span></span><br><span class="line">本想吟诗赠天下。</span><br><span class="line">一句卧槽风好大。</span><br><span class="line">就这么地吧。</span><br><span class="line">谢谢大家。</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># grep &#x27;，$&#x27; zls</span></span><br><span class="line">江山风景美如画，</span><br><span class="line">奈何自己没文化，</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># grep &#x27;*&#x27; zls</span></span><br><span class="line">[root@db04 ~]<span class="comment"># grep &#x27;.*&#x27; zls</span></span><br><span class="line">卧槽</span><br><span class="line">作者：曾老湿</span><br><span class="line">江山风景美如画，</span><br><span class="line">本想吟诗赠天下。</span><br><span class="line">奈何自己没文化，</span><br><span class="line">一句卧槽风好大。</span><br><span class="line">江风啦啦啦</span><br><span class="line">就这么地吧。</span><br><span class="line">谢谢大家。</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># grep -n &#x27;风&#x27; zls</span></span><br><span class="line">3:江山风景美如画，</span><br><span class="line">6:一句卧槽风好大。</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># grep -A 1 &#x27;风&#x27; zls</span></span><br><span class="line">江山风景美如画，</span><br><span class="line">本想吟诗赠天下。</span><br><span class="line">--</span><br><span class="line">一句卧槽风好大。</span><br><span class="line">就这么地吧。</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># grep -nA 1 &#x27;风&#x27; zls</span></span><br><span class="line">3:江山风景美如画，</span><br><span class="line">4-本想吟诗赠天下。</span><br><span class="line">--</span><br><span class="line">6:一句卧槽风好大。</span><br><span class="line">7-就这么地吧。</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># grep -nB 1 &#x27;风&#x27; zls</span></span><br><span class="line">2-作者：曾老湿</span><br><span class="line">3:江山风景美如画，</span><br><span class="line">--</span><br><span class="line">5-奈何自己没文化，</span><br><span class="line">6:一句卧槽风好大。</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># grep -nC 1 &#x27;风&#x27; zls</span></span><br><span class="line">2-作者：曾老湿</span><br><span class="line">3:江山风景美如画，</span><br><span class="line">4-本想吟诗赠天下。</span><br><span class="line">5-奈何自己没文化，</span><br><span class="line">6:一句卧槽风好大。</span><br><span class="line">7-就这么地吧。</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># grep -v &#x27;风&#x27; zls</span></span><br><span class="line">卧槽</span><br><span class="line">作者：曾老湿</span><br><span class="line">本想吟诗赠天下。</span><br><span class="line">奈何自己没文化，</span><br><span class="line">就这么地吧。</span><br><span class="line">谢谢大家。</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># grep &#x27;风景|卧槽&#x27; zls</span></span><br><span class="line">[root@db04 ~]<span class="comment"># grep -E &#x27;风景|卧槽&#x27; zls</span></span><br><span class="line">卧槽</span><br><span class="line">江山风景美如画，</span><br><span class="line">一句卧槽风好大。</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># vim alex.txt</span></span><br><span class="line">alex is a dsb</span><br><span class="line">ALEX is a DSB</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># grep &#x27;alex&#x27; alex.txt</span></span><br><span class="line">alex is a dsb</span><br><span class="line">[root@db04 ~]<span class="comment"># grep -i &#x27;alex&#x27; alex.txt</span></span><br><span class="line">alex is a dsb</span><br><span class="line">ALEX is a DSB</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="文件上传下载命令"><a href="#文件上传下载命令" class="headerlink" title="文件上传下载命令"></a>文件上传下载命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">wget        //文件下载</span><br><span class="line">-O          //指定下载地址,更改名称  </span><br><span class="line">-T          //超时时间</span><br><span class="line">-q          //安静下载(关闭wget输出)</span><br><span class="line">--spider    //网络爬虫   </span><br><span class="line"> </span><br><span class="line">示例：wget http://www.baidu.com</span><br><span class="line"> </span><br><span class="line">curl    //文件下载</span><br><span class="line">示例：curl -o http://www.baidu.com</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">yum install lrzsz</span><br><span class="line">rz  //文件上传</span><br><span class="line"> </span><br><span class="line">sz  //文件下载</span><br><span class="line">示例：sz filename</span><br></pre></td></tr></table></figure><h3 id="文件查找命令"><a href="#文件查找命令" class="headerlink" title="文件查找命令"></a>文件查找命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">locate //查找文件或者目录</span><br><span class="line">示例：locate /etc/sh       //搜索含有/etc/sh的目录或文件</span><br><span class="line">[root@db04 ~]<span class="comment"># locate /etc/sh</span></span><br><span class="line">/etc/shadow</span><br><span class="line">/etc/shadow-</span><br><span class="line">/etc/shells</span><br><span class="line">/usr/local/etc/shadow</span><br><span class="line">/usr/local/etc/shadow-</span><br><span class="line">/usr/local/etc/shells</span><br><span class="line"> </span><br><span class="line">示例：locate -i /etc/sh    //忽略大小写</span><br><span class="line"> </span><br><span class="line"><span class="built_in">which</span>   //查找系统PATH变量目录下的命令(绝对路径)</span><br><span class="line">[root@db04 ~]<span class="comment"># which ls</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">ls</span>=<span class="string">&#x27;ls --color=auto&#x27;</span></span><br><span class="line">    /bin/ls</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># type -a ls</span></span><br><span class="line"><span class="built_in">ls</span> is aliased to `<span class="built_in">ls</span> --color=auto<span class="string">&#x27;</span></span><br><span class="line"><span class="string">ls is /bin/ls</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">[root@db04 ~]# which useradd</span></span><br><span class="line"><span class="string">/usr/sbin/useradd</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">whereis //查找文件索引数据库下的命令、源文件、man文件。非PATH变量查找，所以查找的面比which要广 -b,-m</span></span><br><span class="line"><span class="string">[root@db04 man1]# whereis ls</span></span><br><span class="line"><span class="string">ls: /bin/ls /usr/share/man/man1/ls.1 /usr/share/man/man1p/ls.1p.gz</span></span><br><span class="line"><span class="string">[root@db04 man1]# whereis -b ls</span></span><br><span class="line"><span class="string">ls: /bin/ls</span></span><br></pre></td></tr></table></figure><h3 id="字符处理命令"><a href="#字符处理命令" class="headerlink" title="字符处理命令"></a>字符处理命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#排序命令sort</span></span><br><span class="line">在有些情况下，需要对一个无序的文本进行数据的排序，这时就需要用到<span class="built_in">sort</span>进行排序了。</span><br><span class="line"><span class="comment">## 选项</span></span><br><span class="line">-k 分割区域进行排序</span><br><span class="line">-t 指定分割符 （默认以空格为分割符）</span><br><span class="line">-n 按照数值大小进行排序</span><br><span class="line">-r 降序排列 （默认是升序</span><br><span class="line">用法：<span class="built_in">sort</span> [选项]... [文件]...</span><br><span class="line">　或：<span class="built_in">sort</span> [选项]... --files0-from=F</span><br><span class="line"></span><br><span class="line">[root@db04 ~]<span class="comment"># cat &gt;&gt; sort.txt &lt;&lt;EOF</span></span><br><span class="line">b:3</span><br><span class="line">c:2</span><br><span class="line">a:4</span><br><span class="line">e:5</span><br><span class="line">d:1</span><br><span class="line">f:11</span><br><span class="line">EOF</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># sort sort.txt</span></span><br><span class="line">a:4</span><br><span class="line">b:3</span><br><span class="line">c:2</span><br><span class="line">d:1</span><br><span class="line">e:5</span><br><span class="line">f:11</span><br><span class="line"> </span><br><span class="line"><span class="comment">#可观察到, sort文件具有一个特点, 第一个字符是字母, 第三个字符是数字, 中间是用冒号隔开。</span></span><br><span class="line"><span class="comment">#这样我们可以使用-t指定分隔符, 使用-k指定用于排序的列了。</span></span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># sort -t &#x27;:&#x27; -k 2 sort.txt</span></span><br><span class="line">d:1</span><br><span class="line">f:11            //为什么11在第二个？？？</span><br><span class="line">c:2</span><br><span class="line">b:3</span><br><span class="line">a:4</span><br><span class="line">e:5</span><br><span class="line"> </span><br><span class="line"><span class="comment">#-n 按照数字顺序排序</span></span><br><span class="line">[root@db04 ~]<span class="comment"># sort -t &#x27;:&#x27; -k 2 -n sort.txt</span></span><br><span class="line">d:1</span><br><span class="line">c:2</span><br><span class="line">b:3</span><br><span class="line">a:4</span><br><span class="line">e:5</span><br><span class="line">f:11</span><br><span class="line"> </span><br><span class="line"><span class="comment">#倒叙</span></span><br><span class="line">[root@db04 ~]<span class="comment"># sort -t &#x27;:&#x27; -k 2 -n -r sort.txt</span></span><br><span class="line">f:11</span><br><span class="line">e:5</span><br><span class="line">a:4</span><br><span class="line">b:3</span><br><span class="line">c:2</span><br><span class="line">d:1</span><br></pre></td></tr></table></figure><h3 id="去重操作unip"><a href="#去重操作unip" class="headerlink" title="去重操作unip"></a>去重操作unip</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">如果文件中有多行完全相同的内容, 当前是希望能删除重复的行，同时还可以统计出完全相同的行出现的总次数, 那么就可以使用<span class="built_in">uniq</span>命令解决这个问题(但是必须配合<span class="built_in">sort</span>使用)。</span><br><span class="line"><span class="comment">## 配合sort是使用</span></span><br><span class="line">去除重复的</span><br><span class="line"><span class="built_in">uniq</span> + 文件名</span><br><span class="line">-c 统计</span><br><span class="line">[root@xxx ~]<span class="comment"># sort 3.txt | uniq</span></span><br><span class="line">123</span><br><span class="line">abc</span><br><span class="line">efg</span><br><span class="line"></span><br><span class="line">[root@xxx ~]<span class="comment"># sort 3.txt | uniq -c</span></span><br><span class="line">3 123</span><br><span class="line">2 abc</span><br><span class="line">1 efg</span><br><span class="line">[root@db04 ~]<span class="comment"># cat &gt;&gt; uniq.txt &lt;&lt;EOF</span></span><br><span class="line">abc</span><br><span class="line">123</span><br><span class="line">abc</span><br><span class="line">123</span><br><span class="line">EOF</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># uniq uniq.txt</span></span><br><span class="line">abc</span><br><span class="line">123</span><br><span class="line">abc</span><br><span class="line">123</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># sort uniq.txt</span></span><br><span class="line">123</span><br><span class="line">123</span><br><span class="line">abc</span><br><span class="line">abc</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># sort uniq.txt |uniq</span></span><br><span class="line">123</span><br><span class="line">abc</span><br><span class="line"> </span><br><span class="line">[root@db04 ~]<span class="comment"># sort uniq.txt |uniq -c</span></span><br><span class="line">      2 123</span><br><span class="line">      2 abc</span><br></pre></td></tr></table></figure><h3 id="截取命令cut"><a href="#截取命令cut" class="headerlink" title="截取命令cut"></a>截取命令cut</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@db04 ~]<span class="comment"># cat &gt;&gt; info.txt &lt;&lt;EOF</span></span><br><span class="line">I<span class="string">&#x27;m zls,18 years old QQ 133411023</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">[root@db04 ~]# cut -d &#x27;</span> <span class="string">&#x27; -f 2,6 info.txt</span></span><br><span class="line"><span class="string">zls,18 133411023</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">[root@db04 ~]# cut -d &#x27;</span> <span class="string">&#x27; -f 2,6 info.txt |cut -d &#x27;</span>,<span class="string">&#x27; -f 1,2</span></span><br><span class="line"><span class="string">zls,18 133411023</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">[root@db04 ~]# cut -d &#x27;</span> <span class="string">&#x27; -f 2,6 info.txt |cut -c 1-3,8-16</span></span><br><span class="line"><span class="string">zls133411023</span></span><br></pre></td></tr></table></figure><p>注意：其实还有两个牛逼的命令可以处理 awk(取列)和sed(取行，替换)</p><h3 id="统计命令wc"><a href="#统计命令wc" class="headerlink" title="统计命令wc"></a>统计命令wc</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@db04 ~]<span class="comment"># wc /etc/services</span></span><br><span class="line"> 10774  58108 641020 /etc/services</span><br><span class="line"> </span><br><span class="line"><span class="comment">#字节</span></span><br><span class="line">[root@db04 ~]<span class="comment"># wc -c /etc/services</span></span><br><span class="line">641020 /etc/services</span><br><span class="line"><span class="comment">#单词</span></span><br><span class="line">[root@db04 ~]<span class="comment"># wc -w /etc/services</span></span><br><span class="line">58108 /etc/services</span><br><span class="line"><span class="comment">#行数</span></span><br><span class="line">[root@db04 ~]<span class="comment"># wc -l /etc/services</span></span><br><span class="line">10774 /etc/services</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux-属性及类型(5)</title>
      <link href="/2023/02/17/linux/Day04%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7%E5%8F%8A%E7%B1%BB%E5%9E%8B/"/>
      <url>/2023/02/17/linux/Day04%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7%E5%8F%8A%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="linux文件管理-文件属性及类型"><a href="#linux文件管理-文件属性及类型" class="headerlink" title="linux文件管理-文件属性及类型"></a>linux文件管理-文件属性及类型</h1><h2 id="linux系统文件属性"><a href="#linux系统文件属性" class="headerlink" title="linux系统文件属性"></a>linux系统文件属性</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-rw-------. 1 root root 4434 May 30 13:58 ks.cfg</span><br><span class="line"> </span><br><span class="line">-rw-------. ①:文件类型与权限</span><br><span class="line">1           ②:硬链接次数</span><br><span class="line">root        ③:所属用户</span><br><span class="line">root        ④:所属组</span><br><span class="line">4434        ⑤:文件大小</span><br><span class="line">May30 13:58 ⑥⑦⑧:最新修改的时间与日期</span><br><span class="line">ks.cfg      ⑨:文件或目录名称</span><br></pre></td></tr></table></figure><h2 id="linux系统文件类型"><a href="#linux系统文件类型" class="headerlink" title="linux系统文件类型"></a>linux系统文件类型</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过颜色或者后缀判断文件类型不一定准确</span></span><br><span class="line"><span class="built_in">ls</span> -l 文件名 //看第一个字符</span><br><span class="line">格式             说明</span><br><span class="line">-   普通文件(文本, 二进制, 压缩, 图片, 日志等) </span><br><span class="line">d   目录文件</span><br><span class="line">b   设备文件(块设备)存储设备硬盘 /dev/sda1, /dev/sda2</span><br><span class="line">c   设备文件(字符设备)打印机，终端 /dev/tty1, /dev/zero</span><br><span class="line">s   套接字文件, 进程间通信(socket)</span><br><span class="line">p   管道文件</span><br><span class="line">l   链接文件</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看文件类型命令file</span></span><br><span class="line">[root@zls ~]<span class="comment"># file /etc/hosts</span></span><br><span class="line">/etc/hosts: ASCII text</span><br><span class="line"> </span><br><span class="line">[root@zls ~]<span class="comment"># file /bin/ls</span></span><br><span class="line">/bin/ls: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), <span class="keyword">for</span> GNU/Linux 2.6.32, BuildID[sha1]=aa7ff68f13de25936a098016243ce57c3c982e06, stripped</span><br><span class="line"> </span><br><span class="line">[root@zls ~]<span class="comment"># file /dev/sda</span></span><br><span class="line">/dev/sda: block special</span><br><span class="line"> </span><br><span class="line">[root@zls ~]<span class="comment"># file /dev/tty1</span></span><br><span class="line">/dev/tty1: character special</span><br><span class="line"> </span><br><span class="line">[root@zls ~]<span class="comment"># file /etc/grub2.cfg</span></span><br><span class="line">/etc/grub2.cfg: broken symbolic <span class="built_in">link</span> to `../boot/grub2/grub.cfg<span class="string">&#x27;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">[root@zls ~]# file /home</span></span><br><span class="line"><span class="string">/home: directory</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">[root@zls ~]# file /run/dmeventd-client</span></span><br><span class="line"><span class="string">/run/dmeventd-client: fifo (named pipe)</span></span><br></pre></td></tr></table></figure><h2 id="系统链接文件"><a href="#系统链接文件" class="headerlink" title="系统链接文件"></a>系统链接文件</h2><p>文件有文件名和数据，在Linux上被分成两个部分：用户数据(user data)与元数据(metadata) 用户数据：文件数据块（data block），数据块是记录文件真实内容的地方，我们将其称为Block 元数据：文件的附加属性，例如：文件大小，创建时间，属组，属主…等，我们称其为Inode 在Linux中，inode是文件元数据的一部分，但其并不包含文件名，inode号即索引节点号 文件名仅是为了方便人们的记忆和使用，系统或者程序通过inode号寻找正确的文件数据块。 下图为文件读取的流程：</p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230315084229892.png" alt="image-20230315084229892"></p><p>Linux系统引入了两种链接： 1.硬链接（hard link） 2.软链接（又叫：符号链接即soft link或symbolic link）</p><h3 id="软链接"><a href="#软链接" class="headerlink" title="软链接"></a>软链接</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#软链接相当于windows的快捷方式，软链接文件会将inode指向源文件的block</span></span><br><span class="line"></span><br><span class="line">当我们访问这个软链接文件时，其实就是在访问源文件的本身。</span><br><span class="line">1.那么当我们对一个文件创建多个软链接时，其实就是多个inode指向同一个block。</span><br><span class="line">2.那么当我们删除软链接文件时，其实只是删除了一个inode的指向，并不会对源文件造成影响。</span><br><span class="line">3.如果我们删除的是源文件，那么该文件的所有软链接文件都会失效</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@db04 ~]<span class="comment"># touch soft_link</span></span><br><span class="line">[root@db04 ~]<span class="comment"># ln -s soft_link /tmp/soft_link</span></span><br><span class="line">[root@db04 ~]<span class="comment"># ls -li soft_link /tmp/soft_link</span></span><br><span class="line">662184 -rw-r--r-- 1 root root 0 6月   1 10:42 soft_link</span><br><span class="line">915769 lrwxrwxrwx 1 root root 9 6月   1 10:42 /tmp/soft_link -&gt; soft_link</span><br></pre></td></tr></table></figure><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230315085005476.png" alt="image-20230315085005476"></p><p>2.软链接的应用场景 1）软件升级 2）代码发布 3）不方便移动的目录 4）数据回滚 5）程序读取</p><h3 id="硬链接"><a href="#硬链接" class="headerlink" title="硬链接"></a>硬链接</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">若一个inode号对应多个文件名，则称这些文件为硬链接。换句话说，硬链接就是同一个文件使用了多个别名，如下图所示hard <span class="built_in">link</span>就是file的一个别名，他们有共同的inode</span><br><span class="line"></span><br><span class="line">[root@db04 ~]<span class="comment"># ls -li /tmp/hard_link</span></span><br><span class="line">662189 -rw-r--r-- 2 root root 0 6月   1 12:21 /tmp/hard_link</span><br><span class="line">[root@db04 ~]<span class="comment"># ls -li hard_link</span></span><br><span class="line">662189 -rw-r--r-- 2 root root 0 6月   1 12:21 hard_link</span><br></pre></td></tr></table></figure><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230315085118516.png" alt="image-20230315085118516"></p><h3 id="软链接与硬链接的区别"><a href="#软链接与硬链接的区别" class="headerlink" title="软链接与硬链接的区别"></a>软链接与硬链接的区别</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1）创建命令不同</span><br><span class="line">    软链接：<span class="built_in">ln</span> -s</span><br><span class="line">    硬链接：<span class="built_in">ln</span></span><br><span class="line">2）目录不能创建硬链接，并且硬链接不可以跨越系统的分区，软链接可以</span><br><span class="line">3）硬链接文件与源文件inode相同，软链接文件与源文件inode不同</span><br><span class="line">4）删除软链接文件，对源文件无影响，但是删除软链接源文件对软链接文件有影响</span><br><span class="line">5）删除硬链接文件，对源文件也无影响，并且删除源文件，对硬链接文件也无影响</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux-vim编辑(6)</title>
      <link href="/2023/02/17/linux/Day05vim%E7%BC%96%E8%BE%91/"/>
      <url>/2023/02/17/linux/Day05vim%E7%BC%96%E8%BE%91/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="linux文件管理-VIM编辑"><a href="#linux文件管理-VIM编辑" class="headerlink" title="linux文件管理-VIM编辑"></a>linux文件管理-VIM编辑</h1><h2 id="vim基本介绍"><a href="#vim基本介绍" class="headerlink" title="vim基本介绍"></a>vim基本介绍</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#什么是vim</span></span><br><span class="line">vi和vim命令是linux中强大的文本编辑器, 由于Linux系统一切皆文件，而配置一个服务就是在修改其配置文件的参数。</span><br><span class="line">vim编辑器是运维工程师必须掌握的一个工具, 没有它很多工作都无法完成。</span><br><span class="line">vim其实是vi的升级版</span><br><span class="line"><span class="comment">#为什么要使用vim</span></span><br><span class="line">因为linux系统一切皆文件，而我们工作最多的就是修改某个服务的配置、系统优化、应用优化（其实就是修改文件内容）</span><br><span class="line">也就是说，如果没有vi或者vim，我们很多工作都无法完成。</span><br><span class="line"><span class="comment">#vim是学习linux最重要的命令之一</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#vi和vim有什么区别</span></span><br><span class="line">vi不显示高亮颜色语法</span><br><span class="line">vim显示高亮颜色语法</span><br><span class="line">其他功能没有什么区别</span><br><span class="line">所以在linux系统下，使用vi还是vim取决个人习惯</span><br><span class="line">如果在刚装完的CentOS操作系统下没有vim这个命令，可以使用如下命令安装：</span><br><span class="line">yum install -y vim</span><br></pre></td></tr></table></figure><h2 id="vim模式介绍"><a href="#vim模式介绍" class="headerlink" title="vim模式介绍"></a>vim模式介绍</h2><p>Vim编辑器中设置了三种模式: 命令模式、编辑模式、末行模式，每种模式分别又支持多种不同的命令快捷键，大大提高了工作效率，而且用户在习惯之后也会觉得相当顺手。要想高效率地操作文本，就必须先搞清这三种模式的操作区别以及模式之间的切换方法。</p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230315090414730.png" alt="image-20230315090414730"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#普通模式: 控制光标移动, 可对文本进行查看、翻页、复制、粘贴、删除、剪切等工作。</span></span><br><span class="line">使用vim filename 编辑一个文件时，一进入该文件就是命令模式了。</span><br><span class="line">在这个模式下，可以进行光标移动、复制、删除、粘贴操作。</span><br><span class="line"></span><br><span class="line"><span class="comment">#编辑模式: 正常的文本写入。</span></span><br><span class="line">从命令模式进入编辑模式，只需你按一个键即可（i, I, a, A, o, O, r, R,s,S）。</span><br><span class="line">当进入编辑模式时，会在屏幕的最下一行出现“INSERT的字样。</span><br><span class="line">从编辑模式回到命令模式只需要按键盘左上方的 ESC 键即可。</span><br><span class="line"></span><br><span class="line"><span class="comment">#末行模式: 保存或退出文档，以及设置编辑环境</span></span><br><span class="line">在命令模式下，输入 <span class="string">&quot;:&quot;</span> 或者 <span class="string">&quot;/&quot;</span> 即可进入末行模式。</span><br><span class="line">在该模式下，可以进行的操作有，显示行号、搜索、替换、保存、退出。</span><br></pre></td></tr></table></figure><p>vim编辑器配置文件整体流程如下: 1.默认打开文件处于普通模式 2.需要从普通模式切换至编辑模式 3.编辑模式修改配置文件, 然后返回普通模式. 4.最后通过普通模式进入末行模式,保存和退出操作.</p><p>注意: 在vim中，无法直接从编辑模式切换到末行模式。</p><h3 id="vim普通模式"><a href="#vim普通模式" class="headerlink" title="vim普通模式"></a>vim普通模式</h3><p>普通模式: (默认打开文件进入的是普通模式)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#命令光标跳转</span></span><br><span class="line">G（<span class="built_in">shift</span> + g）    //跳转光标至末尾</span><br><span class="line">gg               //跳转光标至开头</span><br><span class="line">Ngg              //跳转光标至当前文件内的N行(N为数字)</span><br><span class="line">$                //将当前光标跳转至光标所在行的末端(尾部)</span><br><span class="line">^|0              //将当前光标跳转至光标所在行的头部  —&gt; 数字0 可实现类似效果</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#文件内容较多</span></span><br><span class="line">ctrl+f              //往下翻页(行比较多)</span><br><span class="line">ctrl+b              //往上翻页</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#复制粘贴</span></span><br><span class="line">yy               //复制当前光标所在的行</span><br><span class="line">Nyy|yNy          //复制当前光标以及光标向下N行（N为数字）</span><br><span class="line">p(小写)           //粘贴至当前光标下一行   </span><br><span class="line">P(大写)           //粘贴至当前光标上一行</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除剪切</span></span><br><span class="line"><span class="built_in">dd</span>              //删除当前光标所在的行   </span><br><span class="line">Ndd|dNd         //删除当前光标所在的行以及往下的N行(N为数字)</span><br><span class="line">dG              //删除当前光标以后的所有行</span><br><span class="line">D               //删除当前光标及光标以后的内容  </span><br><span class="line">x               //删除当前光标标记往后的字符</span><br><span class="line">X               //删除当前光标标记往前的字符</span><br><span class="line">ddp             //先删除<span class="built_in">dd</span>(number <span class="built_in">dd</span>)，后粘贴p</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#撤销替换回滚</span></span><br><span class="line">u           撤销上一次的操作(类似windows下的ctrl+z</span><br><span class="line">r           替换当前光标标记的单个字符</span><br><span class="line">R           进入REPLACE模式, 连续替换，ESC结束</span><br><span class="line">Ctrl+r      当你执行了撤销u的时候，发现撤销错了，回滚</span><br></pre></td></tr></table></figure><h3 id="vim编辑模式"><a href="#vim编辑模式" class="headerlink" title="vim编辑模式"></a>vim编辑模式</h3><p>编辑模式（从命令行模式进入到编辑模式）</p><p>进入编辑模式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">i   进入编辑模式，光标不做任何操作</span><br><span class="line">I   进入编辑模式，并且光标会跳转至本行的头部</span><br><span class="line"> </span><br><span class="line">a   进入编辑模式，将当前光标往后一位</span><br><span class="line">A   进入编辑模式，将光标移动至本行的尾部</span><br><span class="line"> </span><br><span class="line">o   进入编辑模式，并在当前光标下添加一行空白内容</span><br><span class="line">O   进入编辑模式，并在当前光标上添加一行空白内容</span><br><span class="line"> </span><br><span class="line">s   进入编辑模式，并删除当前光标下的字符</span><br><span class="line">S   进入编辑模式，并删除当前光标所在行</span><br></pre></td></tr></table></figure><h3 id="vim末行"><a href="#vim末行" class="headerlink" title="vim末行"></a>vim末行</h3><p>末行模式主要用于搜索, 保存, 退出文件, 还可以让用户执行外部的Linux命令或跳转到所编写文档的特定行数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">:w          //保存当前状态</span><br><span class="line">:w!         //强制保存当前状态</span><br><span class="line">:q          //退出当前文档(文档必须保存才能退出)</span><br><span class="line">:q!         //强制退出文档不会修改当前内容</span><br><span class="line">:wq         //先保存，在退出</span><br><span class="line">:wq!        //强制保存并退出</span><br><span class="line">:x          //先保存，在退出</span><br><span class="line">ZZ          //保存退出, shfit+zz</span><br><span class="line">:number     //跳转至对应的行号,和普通模式Ngg一个意思</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#末行模式（查找和替换）</span></span><br><span class="line">查找  /string 需要搜索的内容（查找）</span><br><span class="line">        n 按搜索到的内容依次往下进行查找</span><br><span class="line">        N 按搜索到的内容依次往上进行查找</span><br><span class="line">替换</span><br><span class="line">    :1,5s<span class="comment">#sbin#test#g          替换1-5行中包含sbin的内容为test</span></span><br><span class="line">    :%s<span class="comment">#sbin#test#g            替换整个文本文件中包含sbin的替换为test</span></span><br><span class="line">    :%s<span class="comment">#sbin#test#gc           替换内容时时提示是否需要替换</span></span><br><span class="line">    %表示所有行   s表示替换   g表示所有匹配到的内容     c表示提示</span><br><span class="line">    </span><br><span class="line">    替换为 w (y/n/a/q/l/^E/^Y)？</span><br><span class="line">    y:替换一次</span><br><span class="line">    n:选中下一个</span><br><span class="line">    a:全部替换</span><br><span class="line">    q:退出</span><br><span class="line">    l:替换一次并退出询问</span><br><span class="line"> </span><br><span class="line">另存</span><br><span class="line">:w /root/test  将文件所有内容另存为/root/test</span><br><span class="line">    </span><br><span class="line">读入</span><br><span class="line">:r  /etc/hosts  读入/etc/hosts文件至当前光标下面</span><br><span class="line">:5r /etc/hosts  指定/etc/hosts文件当前文件的哪行下面</span><br></pre></td></tr></table></figure><h3 id="vim视图模式"><a href="#vim视图模式" class="headerlink" title="vim视图模式"></a>vim视图模式</h3><p>视图模式（从命令行模式进入视图模式）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ctrl+v  进入VISUAL BLOCK 选中需要注释的行（可视块模式）</span><br><span class="line">    1.插入:按<span class="built_in">shift</span>+i进入编辑模式,输入<span class="comment">#,结束按ESC键</span></span><br><span class="line">    2.删除:选中内容后，按x或者d键删除</span><br><span class="line">    3.替换:选中需要替换的内容, 按下r键,然后输入替换后的内容</span><br><span class="line"><span class="built_in">shift</span>+v 进入VISUAL LINE 选中行内容（可视行模式）</span><br><span class="line">    1.复制:选中行内容后按y键及可复制。</span><br><span class="line">    2.删除:选中行内容后按d键删除。</span><br></pre></td></tr></table></figure><h3 id="vim环境变量"><a href="#vim环境变量" class="headerlink" title="vim环境变量"></a>vim环境变量</h3><p>环境变量临时生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">set</span> nu 显示行号</span><br><span class="line">:<span class="built_in">set</span> ic 忽略大小写, 在搜索的时候有用</span><br><span class="line">:<span class="built_in">set</span> ai 自动缩进</span><br><span class="line">:<span class="built_in">set</span> list   显示制表符(空行、tab键)</span><br><span class="line">:<span class="built_in">set</span> no[nu|ic|ai…]  取消临时设定的变量</span><br></pre></td></tr></table></figure><p>环境变量永久生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">~/.vimrc 个人环境变量(优先级高) /etc/vimrc  全局环境变量</span><br><span class="line"><span class="comment"># vim  ~/.vimrc</span></span><br><span class="line"> </span><br><span class="line">syntax on</span><br><span class="line"><span class="built_in">set</span> fenc=utf-8</span><br><span class="line"><span class="built_in">set</span> fencs=utf-8,usc-bom,euc-jp,gb18030,gbk,gb2312,cp936</span><br><span class="line"><span class="built_in">set</span> number</span><br><span class="line"><span class="built_in">set</span> autoindent</span><br><span class="line"><span class="built_in">set</span> smartindent</span><br><span class="line"><span class="built_in">set</span> tabstop=4</span><br><span class="line"><span class="built_in">set</span> shiftwidth=4</span><br><span class="line"><span class="built_in">set</span> ruler</span><br><span class="line"><span class="built_in">set</span> incsearch</span><br><span class="line"><span class="built_in">set</span> showmatch</span><br><span class="line"><span class="built_in">set</span> matchtime=10</span><br><span class="line"><span class="built_in">set</span> ignorecase</span><br><span class="line"><span class="built_in">set</span> cursorline</span><br><span class="line"><span class="built_in">set</span> t_Co=256</span><br><span class="line">colorscheme molokai</span><br><span class="line"> </span><br><span class="line"><span class="comment">#语法检查及高亮</span></span><br><span class="line">syntax on</span><br><span class="line"><span class="comment">#设定默认解码</span></span><br><span class="line"><span class="built_in">set</span>?fenc=utf-8?</span><br><span class="line"><span class="built_in">set</span>?fencs=utf-8,usc-bom,euc-jp,gb18030,gbk,gb2312,cp936</span><br><span class="line"><span class="comment">#显示行号</span></span><br><span class="line"><span class="built_in">set</span>?number?</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#vim使用自动对齐，也就是把当前行的对齐格式应用到下一行</span></span><br><span class="line"><span class="built_in">set</span>?autoindent?</span><br><span class="line"><span class="comment">#依据上面的对齐格式，智能的选择对齐方式</span></span><br><span class="line"><span class="built_in">set</span>?smartindent?</span><br><span class="line"><span class="comment">#设置tab键为4个空格</span></span><br><span class="line"><span class="built_in">set</span>?tabstop=4?</span><br><span class="line"><span class="comment">#设置当行之间交错时使用4个空格</span></span><br><span class="line"><span class="built_in">set</span>?shiftwidth=4?</span><br><span class="line"><span class="comment">#设置在编辑过程中,于右下角显示光标位置的状态行</span></span><br><span class="line"><span class="built_in">set</span>?ruler?</span><br><span class="line"><span class="comment">#设置增量搜索,这样的查询比较smart</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">set</span>?incsearch?</span><br><span class="line"><span class="comment">#高亮显示匹配的括号</span></span><br><span class="line"><span class="built_in">set</span>?showmatch?</span><br><span class="line"><span class="comment">#匹配括号高亮时间(单位为?1/10?s)</span></span><br><span class="line"><span class="built_in">set</span>?matchtime=10?</span><br><span class="line"> </span><br><span class="line"><span class="comment">#在搜索的时候忽略大小写</span></span><br><span class="line"><span class="built_in">set</span>?ignorecase?</span><br><span class="line"><span class="comment">#禁止生成临时</span></span><br><span class="line"><span class="comment">#set?nobackup?</span></span><br><span class="line"><span class="comment">#当前行高亮</span></span><br><span class="line"><span class="built_in">set</span>?cursorline?</span><br><span class="line"><span class="comment">#支持256色</span></span><br><span class="line"><span class="built_in">set</span>?t_Co=256?</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#使用molokai颜色模板</span></span><br><span class="line"><span class="comment">#colorscheme molokai</span></span><br><span class="line"> </span><br><span class="line">//如果个人vim环境没有配置, 则使用全局vim环境变量配置。</span><br><span class="line">//如果个人vim环境和全局环境变量产生冲突, 优先使用个人vim环境变量。</span><br></pre></td></tr></table></figure><h3 id="vim扩展知识"><a href="#vim扩展知识" class="headerlink" title="vim扩展知识"></a>vim扩展知识</h3><p>1.如何同时编辑多个文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim -o file1 file2 水平分割</span><br><span class="line">vim -O file1 file2 垂直分割</span><br><span class="line">//ctrl+ww 文件间切换</span><br></pre></td></tr></table></figure><p>2.相同文件之间差异对比</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">diff 文件对比（用的不多）</span><br><span class="line">vimdiff 以vim方式打开两个文件对比，标记不同的内容</span><br></pre></td></tr></table></figure><p>3.如果VIN非正常退出（ctrl+z）挂出或强制退出终端没关闭VIN后</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//删除同文件名的.swp文件即可解决</span><br><span class="line">.filename.swp   <span class="built_in">rm</span> -f .filename.swp</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux介绍(1)</title>
      <link href="/2023/02/17/linux/Day1.1Linux%E4%BB%8B%E7%BB%8D/"/>
      <url>/2023/02/17/linux/Day1.1Linux%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Linux系统入门介绍"><a href="#Linux系统入门介绍" class="headerlink" title="Linux系统入门介绍"></a>Linux系统入门介绍</h1><h2 id="Linux简介"><a href="#Linux简介" class="headerlink" title="Linux简介"></a>Linux简介</h2><p>Linux，全称GNU&#x2F;Linux，是一种类似Unix的操作系统，可以免费使用，自由传播。它是一个基于POSIX的多用户、多任务、多线程、多CPU的操作系统。</p><h3 id="快速了解Linux"><a href="#快速了解Linux" class="headerlink" title="快速了解Linux"></a>快速了解Linux</h3><p>大家日常使用电脑听歌、打游戏娱乐或处理日常工作时，接触到最多的就是Windows操作系统，电脑如果不安装Windows系统是无法进行娱乐和工作的，所有的软件程序都必须运行在操作系统之上，但我们大众百姓常用的操作系统是个人版的，也就是给个人用的，熟称桌面版系统。和Windows操作系统一样，Linux也是一个操作系统软件，只不过它是企业级服务器操作系统。</p><p><strong>Linux和我们常见的windows一样，都是操作系统，但不同的是：</strong></p><p>windows：收费，不开源，主要用于日常办公、游戏、娱乐多一些。<br>Linux：免费，开源，主要用于服务器领域，性能稳定，安全。<br>例如：淘宝，百度，腾讯等互联网公司，他们使用的服务器全都是Linux系统。</p><p>大家日常使用电脑听歌、打游戏娱乐或处理日常工作时，接触到最多的就是Windows操作系统，电脑如果不安装Windows系统是无法进行娱乐和工作的，所有的软件程序都必须运行在操作系统之上，但我们大众百姓常用的操作系统是个人版的，也就是给个人用的，熟称桌面版系统。和Windows操作系统一样，Linux也是一个操作系统软件，只不过它是企业级服务器操作系统。</p><h3 id="Linux优点"><a href="#Linux优点" class="headerlink" title="Linux优点"></a>Linux优点</h3><p>1.Linux系统兼容Unix系统、几乎具备Unix所有优秀特性。<br>2.Linux系统基于GNU许可(GNU is Not Unix)、开放源代码的程序、可自由修改。<br>3.Linux系统基于GPL通用许可，免费、开源、随意修改、随意传播、无任何版权限制。<br>4.Linux系统兼容x86系列的CPU架构、并且高效稳定、可靠、安全。<br>5.Linux系统拥有完善的多用户、多任务、多进程、多CPU的系统。<br>6.Linux系统具有大量的第三方免费应用程序、中小型企业完全够用。</p><h3 id="Linux常见发行版"><a href="#Linux常见发行版" class="headerlink" title="Linux常见发行版"></a>Linux常见发行版</h3><p><strong>Redhat</strong> 1993年，将Linux的内核进行编译安装相应软件进行发行。</p><p><strong>CentOS</strong> 社区企业级操作系统，改Redhat，完全开源。</p><p><strong>Ubuntu</strong> 社区维护，现在主要做手机系统和电脑桌面系统。</p><h3 id="Linux应用领域"><a href="#Linux应用领域" class="headerlink" title="Linux应用领域"></a>Linux应用领域</h3><p><strong>企业服务器：</strong>为中小企业提供开源的WEB、数据库、负载均衡、存储等架构。降低企业的运营成本，也无需考虑系统的稳定性和安全性，且没有商业软件版权以及收费问题。<br><strong>桌面系统：</strong>日常办公、收发电子邮件、文件编辑、多媒体应用。<br><strong>嵌入式开发：</strong>智能手机、路由器、点餐系统、自动售货机、等等。</p>]]></content>
      
      
      <categories>
          
          <category> Linux云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux-用户组管理(8)</title>
      <link href="/2023/02/17/linux/Day07linux%E7%94%A8%E6%88%B7%E7%BB%84%E7%AE%A1%E7%90%86%E5%92%8C%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86/"/>
      <url>/2023/02/17/linux/Day07linux%E7%94%A8%E6%88%B7%E7%BB%84%E7%AE%A1%E7%90%86%E5%92%8C%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="linux用户组管理"><a href="#linux用户组管理" class="headerlink" title="linux用户组管理"></a>linux用户组管理</h1><h2 id="用户密码管理"><a href="#用户密码管理" class="headerlink" title="用户密码管理"></a>用户密码管理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建完账户后，默认是没有设置密码的，所以该账户是没有办法登陆操作系统。只有使用passwd设置好密码后方可登录系统。</span></span><br><span class="line"></span><br><span class="line">使用passwd为用户创建密码时，为了安全起见，请尽量设置复杂一些。可以按照如下规则设置密码：</span><br><span class="line"></span><br><span class="line">1.密码的长度最好大于10位字符</span><br><span class="line">2.密码中包含大小写字母数字以及特殊字符 ! @ <span class="comment"># $</span></span><br><span class="line">3.不规则性（不要出现自己名字、公司名字、自己电话、等等简单的密码)</span><br><span class="line"></span><br><span class="line">需要注意:</span><br><span class="line"></span><br><span class="line">1.普通用户只能更改自己的密码(密码必须满足8位字符)</span><br><span class="line">2.管理员用户能更改任何人的密码(密码长度无限制)</span><br></pre></td></tr></table></figure><h2 id="使用passwd命令修改密码"><a href="#使用passwd命令修改密码" class="headerlink" title="使用passwd命令修改密码"></a>使用passwd命令修改密码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">语法: passwd [username]</span><br><span class="line"> </span><br><span class="line">//<span class="string">&#x27;passwd&#x27;</span>后面不加[username]则是修改当前登陆终端用户的密码。</span><br><span class="line">//如果你登陆的是root管理员用户，后面可以指定要修改的用户。</span><br><span class="line">//只有root管理员才可以修该其他用户的密码，普通账户只能修改自己的密码，并且普通用户没有修改其他用户密码的权限</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">//root管理员用户登陆，修改root用户密码</span><br><span class="line">[root@localhost ~]<span class="comment"># passwd  </span></span><br><span class="line">更改用户 root 的密码。</span><br><span class="line">新的 密码：</span><br><span class="line">重新输入新的 密码：</span><br><span class="line">passwd：所有的身份验证令牌已经成功更新。</span><br><span class="line"> </span><br><span class="line">//root用户登陆，修改其他用户的密码</span><br><span class="line">[root@localhost ~]<span class="comment"># passwd zls</span></span><br><span class="line">更改用户 zls 的密码</span><br><span class="line">新的 密码：</span><br><span class="line">重新输入新的 密码：</span><br><span class="line">passwd： 所有的身份验证令牌已经成功更新。</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">//普通用户修改root管理员密码</span><br><span class="line">[zls@zls ~]$ passwd root</span><br><span class="line">passwd: Only root can specify a user name.</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">//无需用户交互修改密码, 将前者的输出结果, 成为后者的输入</span><br><span class="line">[root@zls ~]<span class="comment"># echo &quot;123&quot; | passwd --stdin zls</span></span><br><span class="line">Changing password <span class="keyword">for</span> user zls.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure><h2 id="用户组管理"><a href="#用户组管理" class="headerlink" title="用户组管理"></a>用户组管理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#组账号信息保存在/etc/group和/etc/gshadow两个文件中。</span></span><br><span class="line">/etc/group组账户信息</span><br><span class="line"></span><br><span class="line">[root@zls ~]<span class="comment"># head -2 /etc/group</span></span><br><span class="line">root:x:0:</span><br><span class="line">bin:x:1:bin,daemon</span><br><span class="line"> </span><br><span class="line">// /etc/group由<span class="string">&#x27;:&#x27;</span> 分割, 分割为4个字段，每个字段的具体含义如下:</span><br><span class="line">字段名称</span><br><span class="line">1.组的名称</span><br><span class="line">2.组的密码(存在/etc/gshadow)</span><br><span class="line">3.组GID信息</span><br><span class="line">4.仅显示附加成员,基本成员不显示</span><br><span class="line"></span><br><span class="line">/etc/gshadow组密码信息</span><br><span class="line"></span><br><span class="line">[root@zls ~]<span class="comment"># head -2 /etc/gshadow</span></span><br><span class="line">root:::</span><br><span class="line">bin:::bin,daemon</span><br><span class="line"> </span><br><span class="line">// /etc/gshadow由 <span class="string">&#x27;:&#x27;</span> 分割, 分割为4个字段，每个字段的具体含义如下:</span><br><span class="line">字段名称</span><br><span class="line">1.组名称</span><br><span class="line">2.组密码</span><br><span class="line">3.组管理员</span><br><span class="line">4.仅显示附加成员,基本成员不显示</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.使用groupadd命令新增组groupadd [-g GID] groupname</span></span><br><span class="line"></span><br><span class="line">//创建基本组, 不指定gid</span><br><span class="line">[root@zls ~]<span class="comment"># groupadd no_gid</span></span><br><span class="line">[root@zls ~]<span class="comment"># tail -n1 /etc/group</span></span><br><span class="line">no_gid:x:1000:</span><br><span class="line"> </span><br><span class="line">//创建基本组, 指定gid为5555</span><br><span class="line">[root@zls ~]<span class="comment"># groupadd -g 5555 yes_gid</span></span><br><span class="line">[root@zls ~]<span class="comment"># tail -n1 /etc/group</span></span><br><span class="line">yes_gid:x:5555:</span><br><span class="line"> </span><br><span class="line">//创建系统组，gid从201-999</span><br><span class="line">[root@zls ~]<span class="comment"># groupadd -r sys_group</span></span><br><span class="line">[root@zls ~]<span class="comment"># tail -n1 /etc/group</span></span><br><span class="line">sys_group:x:990:</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.使用groupmod命令新增组</span></span><br><span class="line"></span><br><span class="line">//-g 修改组gid</span><br><span class="line">[root@zls ~]<span class="comment"># groupmod -g 1111 no_gid</span></span><br><span class="line">[root@zls ~]<span class="comment"># tail -1 /etc/group</span></span><br><span class="line">no_gid:x:1111:</span><br><span class="line"> </span><br><span class="line">//-n 修改组名称</span><br><span class="line">[root@zls ~]<span class="comment"># groupmod -n active_group yes_gid</span></span><br><span class="line">[root@zls ~]<span class="comment"># tail -1 /etc/group</span></span><br><span class="line">active_group:x:5555:</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.使用groupdel删除组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#删除组</span></span><br><span class="line">[root@zls ~]<span class="comment"># groupdel active_group</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#删除用户附加组</span></span><br><span class="line">[root@docker ~]<span class="comment"># id zls</span></span><br><span class="line">uid=1069(zls) gid=5005(zls) <span class="built_in">groups</span>=5005(zls),5004(devops)</span><br><span class="line">[root@docker ~]<span class="comment"># groupdel devops</span></span><br><span class="line">[root@docker ~]<span class="comment"># id zls</span></span><br><span class="line">uid=1069(zls) gid=5005(zls) <span class="built_in">groups</span>=5005(zls)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#无法删除用户基本组</span></span><br><span class="line">[root@zls ~]<span class="comment"># tail -n1 /etc/group</span></span><br><span class="line">network_sa:x:5008:</span><br><span class="line">[root@zls ~]<span class="comment"># groupdel network_sa</span></span><br><span class="line">groupdel: cannot remove the primary group of user <span class="string">&#x27;zls_zls&#x27;</span></span><br><span class="line"><span class="comment">#只有删除用户或者用户变更基本后,方可删除该组</span></span><br></pre></td></tr></table></figure><h2 id="用户身份切换"><a href="#用户身份切换" class="headerlink" title="用户身份切换"></a>用户身份切换</h2><p>Linux系统中，有时候普通用户有些事情是没办法操作，除非是root管理员用户才能做到。这时就需要临时切换到root管理员身份来做事了。那么在学习如何切换用户之前,我们先来了解下用户工作环境。 如何在普通用户的情况下，完成日常工作？ 1）su 切换用户，使用普通用户登录，然后使用su命令切换到root。 优点：简单，方便 缺点：需要知道root密码,不安全，切换到root没有日志审计功能 2）sudo 提权，当需要使用root权限时，进行提权，而无需切换至root用户。 优点：安全，方便 缺点：复杂 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#shell分类</span></span><br><span class="line">交互式shell    //等待用户输入执行的命令(终端操作,需要不断提示)</span><br><span class="line">非交互式shell   //执行shell脚本, 脚本执行结束后shell自动退出</span><br><span class="line"> </span><br><span class="line">登陆shell     //需要输入用户名和密码才能进入shell su - zls</span><br><span class="line">非登陆shell    //不需要输入用户和密码就能进入,比如执行sh, bash, su username</span><br><span class="line"> </span><br><span class="line">//查看登陆shell</span><br><span class="line">[root@zls ~]<span class="comment"># pstree</span></span><br><span class="line"> </span><br><span class="line">//临时设置,永久设置需要写配置文件</span><br><span class="line">[root@zls ~]<span class="comment"># export PS1=&#x27;[\h@\u \t]#&#x27;</span></span><br><span class="line">[zls@root 02:06:28]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Basketball Boy</title>
      <link href="/2023/02/16/%E6%96%87%E6%A1%A3/%E7%AF%AE%E7%90%83/"/>
      <url>/2023/02/16/%E6%96%87%E6%A1%A3/%E7%AF%AE%E7%90%83/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img0.baidu.com/it/u=3052297249,256944548&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" alt="热爱篮球，热爱生活"><br>在一个阳光明媚的小镇上，有一个名叫小明的男孩，他是一个十足的篮球迷。每当放学后，他总是会迅速完成作业，然后冲到户外，带着他心爱的篮球，开始他的篮球训练。</p><p>小明的篮球技能并不是天生就有的，他曾经是一个对篮球一窍不通的孩子。然而，他对于篮球的热爱让他愿意付出一切努力去学习、去提高。他每天都会练习投篮、运球、传球，无论风雨无阻。</p><p>他的努力逐渐得到了回报。他的投篮越来越准，运球越来越熟练，传球也越来越到位。他的篮球技能得到了老师和同学们的认可，他开始在学校里的篮球队中担任重要的角色。</p><p>小明对于篮球的热爱也让他结识了很多志同道合的朋友。他们一起讨论篮球的战术，一起分享比赛的喜悦和挫折。他们的友谊让小明的篮球之路更加充满了乐趣和动力。</p><p>然而，篮球之路并不是一帆风顺的。有一次，小明在比赛中受伤了，让他不得不暂时停止篮球训练。这对于小明来说是一个巨大的打击，他感到十分沮丧和失落。然而，他的家人和朋友并没有放弃他，他们鼓励他要有信心，相信自己的能力，相信自己能够克服困难。</p><p>在家人和朋友的鼓励下，小明重新振作起来。他开始了康复训练，慢慢地恢复身体和技能。他知道这是一个漫长的过程，但是他没有放弃。他每天都坚持训练，不管遇到多大的困难和挫折，他总是能够坚持下去。</p><p>终于有一天，小明重新回到了赛场上。他看起来更加自信、更加坚定。他的技能得到了更好的发挥，他的表现让所有人都为他欢呼。他知道，他已经不再是那个受伤的小男孩了，他已经成长为一个真正的篮球男孩。<br><img src="https://img1.baidu.com/it/u=379379921,1580036201&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=281" alt="热爱篮球，热爱生活"></p>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 休闲娱乐 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>人生小建议</title>
      <link href="/2023/02/12/%E6%96%87%E6%A1%A3/%E4%BA%BA%E7%94%9F%E5%B0%8F%E5%BB%BA%E8%AE%AE/"/>
      <url>/2023/02/12/%E6%96%87%E6%A1%A3/%E4%BA%BA%E7%94%9F%E5%B0%8F%E5%BB%BA%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img1.baidu.com/it/u=1547959004,616195561&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="开开心心 快快乐乐"></p><p>1.早起的人，远比熬夜的人可怕。</p><p>2.入错行，泪两行。</p><p>3.最短的距离是从手到嘴，最长的距离是从说到做。</p><p>4.不谈恋爱死不了，脱贫比脱单更重要。</p><p>5.不要跟眼界不一样的人争辩<br><img src="https://img1.baidu.com/it/u=35511346,801696396&fm=253&fmt=auto&app=120&f=JPEG?w=1142&h=642" alt="开开心心 快快乐乐"></p><p>6.做你害怕做的事情，然后你发现，不过如此。</p><p>7.三观不合真的很难做朋友，因为思想，经历，感官，全都不一样。就像我说大海很漂亮，你却说淹死过很多人。</p><p>8.年轻的时候，我们爱得死去活来，可随着年岁渐长，你就会发现，爱情并不是生活的全部。善良，努力，读书，健身，学习让自己变得更好才是人生最重要的事。</p><p>9.人们并不是害怕失去，而是害怕失去以后没有更好的可以代替。</p><p>10.如果你是对的，你没必要发脾气；如果你是错的，你没资格发脾气。</p><p>11.求人不如求己，靠得住的永远都是自己。<br><img src="https://img0.baidu.com/it/u=3481094089,3970349497&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=1083" alt="开开心心 快快乐乐"></p><p>12.再爱的前任，提一次复合就够了，你可以爱三五个人渣，但你不能爱一个人渣三五次。</p><p>13.生活是否永远艰辛？总是如此。成人的世界里，本没有容易二字。</p><p>14.结婚过日子，钱真的很重要。</p><p>15.能用钱解决的事情，千万不要用人情。</p><p>16.品质好的东西，给钱那一刻是心疼的，用的时侯每天都是快乐的，感觉特别值得。<br><img src="https://img0.baidu.com/it/u=2202412226,450428817&fm=253&fmt=auto&app=120&f=JPEG?w=800&h=500" alt="开开心心 快快乐乐"></p><p>17.你越在意什么，什么就会折磨你。</p><p>18.所有的失恋都是在给真爱铺路。</p><p>19.想送你回家的人，东南西北都顺路；愿陪你吃饭的人，酸甜苦辣都爱吃；想见你的人，千山万水都能赶来。</p><p>20.那些依靠投机取巧走上“人生巅峰”的人，总有一天，会因为一件不经意的小事露出马脚。</p>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 休闲娱乐 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深海</title>
      <link href="/2023/02/07/%E6%96%87%E6%A1%A3/%E6%B7%B1%E6%B5%B7/"/>
      <url>/2023/02/07/%E6%96%87%E6%A1%A3/%E6%B7%B1%E6%B5%B7/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img2.baidu.com/it/u=1107008963,1697250059&fm=253&fmt=auto&app=120&f=JPEG?w=500&h=636" alt="那些打不开的心结 就系成蝴蝶结吧"></p><p>那些打不开的心结 就系成蝴蝶结吧!<br>总要学会拿得起放得下的勇气 希望我们都能走出困境 活出更精彩的人生 不要在意别人的看法 怎么开心怎么来 希望你开心 希望你有南河 希望你没有南河自己就是南河</p>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 休闲娱乐 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>喜爱余华</title>
      <link href="/2023/02/07/%E6%96%87%E6%A1%A3/%E5%96%9C%E7%88%B1%E4%BD%99%E5%8D%8E/"/>
      <url>/2023/02/07/%E6%96%87%E6%A1%A3/%E5%96%9C%E7%88%B1%E4%BD%99%E5%8D%8E/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img2.baidu.com/it/u=2607799025,3814758796&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" alt="余生很贵，请勿浪费"><br>“当你的压力大到快要崩溃时，不要和别人去讲，也不要觉得自己委屈，要像余华说的那样，在夜深人静的时候，把心掏出来，自己缝缝补补，然后睡一觉，醒来又是信心百倍。无人问津也好，技不如人也罢，你都要试着安静下来，自己该干什么就干什么，而不是让烦躁和焦虑毁掉你本就不多的热情和定力。心可以碎，手不能停，该干什么干什么，在崩溃中继续前行，才是一个成年人的素养。”</p>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 休闲娱乐 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell变量(2)</title>
      <link href="/2023/01/07/Shell/Day02shell%E5%8F%98%E9%87%8F/"/>
      <url>/2023/01/07/Shell/Day02shell%E5%8F%98%E9%87%8F/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="shell变量"><a href="#shell变量" class="headerlink" title="shell变量"></a>shell变量</h1><h2 id="什么是变量"><a href="#什么是变量" class="headerlink" title="什么是变量"></a>什么是变量</h2><p>变量即变化的量，核心是“变”与“量”二字，变即变化，量即衡量状态。</p><p>量:是记录现实世界当中的某种状态 变:指的是记录的状态是可以发生变化的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name=zls</span><br><span class="line">age=18</span><br></pre></td></tr></table></figure><h2 id="如何使用变量"><a href="#如何使用变量" class="headerlink" title="如何使用变量"></a>如何使用变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">变量名 赋值符号 变量值</span><br><span class="line">name=zls <span class="comment">#shell中的定义变量</span></span><br><span class="line">age=18</span><br><span class="line"></span><br><span class="line">name: xxx    <span class="comment">#yml中的定义变量</span></span><br><span class="line"></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author: _DriverZeng_</span></span><br><span class="line"><span class="comment">#Date: _1999-12-21_</span></span><br><span class="line"><span class="comment">#Name: _Print Message_</span></span><br><span class="line"> </span><br><span class="line">name=zls</span><br><span class="line">age=18</span><br><span class="line"> </span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$name</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$age</span></span><br><span class="line"> </span><br><span class="line">[root@m01 ~]<span class="comment"># sh test.sh</span></span><br><span class="line">zls</span><br><span class="line">18</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522091628015.png" alt="image-20230522091628015"></p><h2 id="定义变量名规范"><a href="#定义变量名规范" class="headerlink" title="定义变量名规范"></a>定义变量名规范</h2><p>变量名的命名规则： 1.大前提：变量名的命名应该能够反映出值记录的状态。 2.变量是用来访问变量值的，所以变量名应该遵循一定规范，来方便我们标识存到内存中值的功能。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.变量名只能是 字母、数字或下划线的任意组合(区分大小写)</span><br><span class="line">例如：</span><br><span class="line">x=1</span><br><span class="line">X=2</span><br><span class="line">是两个变量</span><br><span class="line"></span><br><span class="line">2.变量名的第一个字符不能是数字</span><br><span class="line">例如：</span><br><span class="line">1x=1</span><br><span class="line">123_x=1</span><br><span class="line"></span><br><span class="line">3.尽量不要使用命令设置变量</span><br><span class="line">例如：[<span class="built_in">echo</span>,<span class="built_in">ls</span>,<span class="built_in">cd</span>,<span class="built_in">pwd</span>...]</span><br></pre></td></tr></table></figure><h2 id="定义变量方式"><a href="#定义变量方式" class="headerlink" title="定义变量方式"></a>定义变量方式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下划线+纯小写</span></span><br><span class="line">name_of_wzk=<span class="string">&#x27;wengzikun&#x27;</span></span><br><span class="line">name_of_hqw=<span class="string">&#x27;heqingwen&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 驼峰体</span></span><br><span class="line">NameOfWzk=<span class="string">&#x27;wengzikuyn&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$NameOfWzk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下划线+纯大写</span></span><br><span class="line">NAME_OF_WENGZIKYUN=<span class="string">&#x27;wengzikuyn&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$NAME_OF_WENGZIKYUN</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> shell脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell入门(1)</title>
      <link href="/2023/01/07/Shell/Day01shell%E5%85%A5%E9%97%A8/"/>
      <url>/2023/01/07/Shell/Day01shell%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="shell入门"><a href="#shell入门" class="headerlink" title="shell入门"></a>shell入门</h1><h2 id="shell的基本概述"><a href="#shell的基本概述" class="headerlink" title="shell的基本概述"></a>shell的基本概述</h2><h3 id="为什么要使用shell"><a href="#为什么要使用shell" class="headerlink" title="为什么要使用shell"></a>为什么要使用shell</h3><p>1.安装操作系统(CentOS)自动化安装操作系统(kickstart cobbler)底层shell</p><p>2.初始化&#x2F;优化操作系统 1）ntp时间同步 2）更改默认yum源 3）ssh优化 4）关闭Selinux 5）关闭&#x2F;开启 防火墙<br>(C6:iptables C7:</p><p>3.安装服务 1）Nginx 2）PHP 3）MySQL 4）Redis 5）MHA 6）Rsync 7）NFS 8）MongoDB 9）Zabbix … 4.启动<br>服务（系统默认的shell脚本）</p><p>5.脚本实现自动化代码上线</p><p>6.监控服务（使用shell）</p><p>7.结合定时任务使用shell</p><p>8.重复性工作写入脚本 1）日志切割 2）日志分析 3）数据统计 4）机器巡检 5）数据备份 …</p><h2 id="shell的编程和基础知识"><a href="#shell的编程和基础知识" class="headerlink" title="shell的编程和基础知识"></a>shell的编程和基础知识</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1）熟练使用vim编辑器</span><br><span class="line">2）熟悉ssh终端（Xshell、CRT）</span><br><span class="line">3）熟练掌握linux常用命令</span><br><span class="line">4）熟练掌握linux正则表达式及三剑客命令</span><br></pre></td></tr></table></figure><h2 id="如何写好shell的编程"><a href="#如何写好shell的编程" class="headerlink" title="如何写好shell的编程"></a>如何写好shell的编程</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.环境变量</span><br><span class="line">2.条件表达式</span><br><span class="line">3.流程控制语句</span><br><span class="line">4.循环</span><br><span class="line">5.数组</span><br><span class="line">6.函数</span><br><span class="line"></span><br><span class="line">学习shell三部曲：</span><br><span class="line">先读懂shell</span><br><span class="line">再修改shell</span><br><span class="line">自己写shell</span><br><span class="line"></span><br><span class="line">找一本合适的教材、或者自己认真做的较为全面的笔记</span><br><span class="line">大忌：不可拿来主义，可以模仿，但是要自己嚼烂了在吃下</span><br><span class="line">学完shell 可解决企业中大部分脚本问题</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522091601258.png" alt="image-20230522091601258"></p><h2 id="什么是shell脚本"><a href="#什么是shell脚本" class="headerlink" title="什么是shell脚本"></a>什么是shell脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">把在命令行执行的命令放在一个文件里统一执行，称为Shell脚本 包含若干1 个linux命令、循环语句，条件语句等。</span><br></pre></td></tr></table></figure><h2 id="shell的规范"><a href="#shell的规范" class="headerlink" title="shell的规范"></a>shell的规范</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.目录统一 2.shell脚本的结尾要以.sh结尾 3.脚本的开头需要有解释器</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br></pre></td></tr></table></figure><h2 id="shell模板"><a href="#shell模板" class="headerlink" title="shell模板"></a>shell模板</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.首先先编辑一个模板文件，该模板文件可以叫任何名字</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># vim /usr/share/vim/vimfiles/template.zls</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author: _DriverZeng_</span></span><br><span class="line"><span class="comment">#Date: _1999-12-21_</span></span><br><span class="line"><span class="comment">#Name: _Print Message_</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 2.写完之后，我们需要修改一下vim的配置文件</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># vim /etc/vimrc</span></span><br><span class="line">autocmd BufNewFile *.spec 0r /usr/share/vim/vimfiles/template.spec</span><br><span class="line"><span class="comment">## 在第28行，autocmd自动保存模板文件，修改一下，因为我们是要写shell脚本的模板</span></span><br><span class="line"><span class="comment">## 所以我们要把*.spec 修改成*.sh</span></span><br><span class="line"><span class="comment">## 然后将后面的模板文件改成你定义的模板文件名</span></span><br><span class="line">autocmd BufNewFile *.sh 0r /usr/share/vim/vimfiles/template.zls</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 3.接下来，我们编辑所有只要以sh结尾的文件，都会带有作者信息</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># vim test_zls.sh</span></span><br></pre></td></tr></table></figure><h2 id="shell脚本的执行方式"><a href="#shell脚本的执行方式" class="headerlink" title="shell脚本的执行方式"></a>shell脚本的执行方式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># vim test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author: _DriverZeng_</span></span><br><span class="line"><span class="comment">#Date: _1999-12-21_</span></span><br><span class="line"><span class="comment">#Name: _Print Message_</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#执行脚本</span></span><br><span class="line">[root@m01 ~]<span class="comment"># sh test.sh</span></span><br><span class="line">Hello World</span><br><span class="line">[root@m01 ~]<span class="comment"># bash test.sh</span></span><br><span class="line">Hello World</span><br><span class="line">[root@m01 ~]<span class="comment"># ./test.sh</span></span><br><span class="line">Hello World</span><br><span class="line">[root@m01 ~]<span class="comment"># /root/test.sh</span></span><br><span class="line">Hello World</span><br><span class="line">[root@m01 ~]<span class="comment"># . test.sh</span></span><br><span class="line">Hello World</span><br><span class="line">[root@m01 ~]<span class="comment"># source test.sh</span></span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure><p>. 和 source 都是在父shell下执行的 sh ， bash ， 相对路径 ， 绝对路径都是在子shell下执行的</p><h2 id="开发语言中程序代码的分类"><a href="#开发语言中程序代码的分类" class="headerlink" title="开发语言中程序代码的分类"></a>开发语言中程序代码的分类</h2><h3 id="编译型"><a href="#编译型" class="headerlink" title="编译型"></a>编译型</h3><p>写完后，需要编译才能运行。开发书写的代码，无法直接运行，需要编译（Java、C语言、等）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑代码</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim hello.c</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"> </span><br><span class="line">void <span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">#编译成二进制文件</span></span><br><span class="line">[root@m01 ~]<span class="comment"># gcc hello.c -o hello.bin</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[root@m01 ~]<span class="comment"># ll</span></span><br><span class="line">总用量 16</span><br><span class="line">-rwxr-xr-x 1 root root 8440 8月  26 09:40 hello.bin</span><br><span class="line">-rw-r--r-- 1 root root   60 8月  26 09:39 hello.c</span><br><span class="line"> </span><br><span class="line">[root@m01 ~]<span class="comment"># file hello.bin</span></span><br><span class="line">hello.bin: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), <span class="keyword">for</span> GNU/Linux 2.6.32, BuildID[sha1]=c248ed9f695c05ece7d46731556e86eb0ac6bc11, not stripped</span><br><span class="line"> </span><br><span class="line">[root@m01 ~]<span class="comment"># ./hello.bin</span></span><br><span class="line">hello world</span><br></pre></td></tr></table></figure><h3 id="解释型"><a href="#解释型" class="headerlink" title="解释型"></a>解释型</h3><p>书写完成，通过命令解释器运行。书写完成后，使用对应的命令解释器（shell、python、等）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># vim hello.sh</span></span><br><span class="line">[root@m01 ~]<span class="comment"># cat hello.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line">[root@m01 ~]<span class="comment"># ll</span></span><br><span class="line">总用量 20</span><br><span class="line">-rwxr-xr-x 1 root root 8440 8月  26 09:40 hello.bin</span><br><span class="line">-rw-r--r-- 1 root root   60 8月  26 09:39 hello.c</span><br><span class="line">-rw-r--r-- 1 root root   31 8月  26 09:44 hello.sh</span><br><span class="line">[root@m01 ~]<span class="comment"># file hello.sh</span></span><br><span class="line">hello.sh: Bourne-Again shell script, ASCII text executable</span><br><span class="line">[root@m01 ~]<span class="comment"># sh hello.sh</span></span><br><span class="line">hello world</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> shell脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell编程-运算符(4)</title>
      <link href="/2023/01/07/Shell/Day04shell%E7%BC%96%E7%A8%8B-%E8%BF%90%E7%AE%97%E7%AC%A6/"/>
      <url>/2023/01/07/Shell/Day04shell%E7%BC%96%E7%A8%8B-%E8%BF%90%E7%AE%97%E7%AC%A6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="shell的运算符"><a href="#shell的运算符" class="headerlink" title="shell的运算符"></a>shell的运算符</h1><h2 id="运算符号"><a href="#运算符号" class="headerlink" title="运算符号"></a>运算符号</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#常用运算符号</span></span><br><span class="line">+：加</span><br><span class="line">-：减</span><br><span class="line">*：乘</span><br><span class="line">/：除</span><br><span class="line">%：取余</span><br><span class="line">++：自增</span><br><span class="line">--：自减</span><br></pre></td></tr></table></figure><h3 id="余数的使用"><a href="#余数的使用" class="headerlink" title="余数的使用"></a>余数的使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 1.使用RANDOM取随机数</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo $RANDOM</span></span><br><span class="line">27899</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 随机数的范围是 ：man bash 可以查到 0 and 32767 总共32768个数</span></span><br><span class="line"><span class="comment">## 但是有时候，我想在一个范围内随机，例如，咱们班有100个学生，我想在100内随机抽取一名幸运观众。</span></span><br><span class="line"><span class="comment">## 那么就需要使用取余的方式来完成了。</span></span><br><span class="line"> </span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo $((RANDOM%10))</span></span><br><span class="line">9</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo $((RANDOM%10))</span></span><br><span class="line">7</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo $((RANDOM%10))</span></span><br><span class="line">5</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo $((RANDOM%10))</span></span><br><span class="line">4</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo $((RANDOM%10))</span></span><br><span class="line">9</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo $((RANDOM%10))</span></span><br><span class="line">8</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo $((RANDOM%10))</span></span><br><span class="line">6</span><br></pre></td></tr></table></figure><h3 id="自增的使用"><a href="#自增的使用" class="headerlink" title="自增的使用"></a>自增的使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一般在使用运算的时候，有时候会写 i=i+1那么我们就可以简写成 i++</span></span><br><span class="line"><span class="comment"># for循环中</span></span><br><span class="line"><span class="keyword">for</span>(i=1;i++;i&lt;=10)&#123;</span><br><span class="line">    这个循环就相当于，第一次循环的时候，i=1</span><br><span class="line">    第二次循环的时候，i=i+1 也就是 i=1+1即 i=2</span><br><span class="line">    第三次循环的时候，i=i+1 也就是 i=2+1即 i=3</span><br><span class="line">    第四次循环的时候，i=i+1 也就是 i=3+1即 i=4</span><br><span class="line">    第五次循环的时候，i=i+1 也就是 i=4+1即 i=5</span><br><span class="line">    第六次循环的时候，i=i+1 也就是 i=5+1即 i=6</span><br><span class="line">    ...</span><br><span class="line">    一直循环到10，因为i给了一个最大范围是小于等于10</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="逻辑符号"><a href="#逻辑符号" class="headerlink" title="逻辑符号"></a>逻辑符号</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#常用逻辑符号</span></span><br><span class="line">&amp;&amp;：且，前面的命令执行成功后，再执行后面的命令，前面的不成功，则后面的也不执行</span><br><span class="line">||：或，前面的命令执行不成功，才能执行后面的命令，前面的成功，则后面的不执行</span><br><span class="line">!：非，取反</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522091659486.png" alt="image-20230522091659486"></p><h2 id="运算方式"><a href="#运算方式" class="headerlink" title="运算方式"></a>运算方式</h2><h3 id="方法一：（（））"><a href="#方法一：（（））" class="headerlink" title="方法一：（（））"></a>方法一：（（））</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方法一: (())</span></span><br><span class="line"> <span class="comment">#1.常规运算</span></span><br><span class="line"> 0 ? 15:21:08 root@web01,172.16.1.7:~ <span class="comment"># echo $((1+1))</span></span><br><span class="line">2</span><br><span class="line">  0 ? 15:21:34 root@web01,172.16.1.7:~ <span class="comment"># echo $((2-1))</span></span><br><span class="line">1</span><br><span class="line">  0 ? 15:22:01 root@web01,172.16.1.7:~ <span class="comment"># echo $((2*3))</span></span><br><span class="line">6</span><br><span class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</span><br><span class="line">  0 ? 15:22:24 root@web01,172.16.1.7:~ <span class="comment"># echo $((6/2))</span></span><br><span class="line">3</span><br><span class="line">  0 ? 15:22:48 root@web01,172.16.1.7:~ <span class="comment"># echo $((5%2))</span></span><br><span class="line">1</span><br><span class="line"><span class="comment">#2.变量运算</span></span><br><span class="line">0 ✓ 15:25:46 root@web01,172.16.1.7:~ <span class="comment"># a1=11</span></span><br><span class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</span><br><span class="line">  0 ✓ 15:27:11 root@web01,172.16.1.7:~ <span class="comment"># a2=22</span></span><br><span class="line">  0 ✓ 15:27:24 root@web01,172.16.1.7:~ <span class="comment"># echo $((a1+a2))</span></span><br><span class="line">33</span><br><span class="line"><span class="comment">#3.运算赋值</span></span><br><span class="line"><span class="comment"># 方法一</span></span><br><span class="line">[root@zabbix01 script]<span class="comment"># n3=`echo $((n1*n2))`</span></span><br><span class="line">[root@zabbix01 script]<span class="comment"># echo $n3</span></span><br><span class="line">24642</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 方法二</span></span><br><span class="line">[root@zabbix01 script]<span class="comment"># ((n4=n1*n2))</span></span><br><span class="line">[root@zabbix01 script]<span class="comment"># echo $n4</span></span><br><span class="line">24642</span><br></pre></td></tr></table></figure><h3 id="不支持非整形"><a href="#不支持非整形" class="headerlink" title="不支持非整形"></a>不支持非整形</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 只要有小数，咋写都报错</span></span><br><span class="line">[root@zabbix01 script]<span class="comment"># echo $((2.5*4))</span></span><br><span class="line">-bash: 2.5*4: syntax error: invalid arithmetic operator (error token is <span class="string">&quot;.5*4&quot;</span>)</span><br><span class="line">[root@zabbix01 script]<span class="comment"># echo $(( 2.5 *4 ))</span></span><br><span class="line">-bash: 2.5 *4 : syntax error: invalid arithmetic operator (error token is <span class="string">&quot;.5 *4 &quot;</span>)</span><br><span class="line">[root@zabbix01 script]<span class="comment"># echo $(( 2.5*4 ))</span></span><br><span class="line">-bash: 2.5*4 : syntax error: invalid arithmetic operator (error token is <span class="string">&quot;.5*4 &quot;</span>)</span><br><span class="line">[root@zabbix01 script]<span class="comment"># echo $(( 2.5 * 4 ))</span></span><br><span class="line">-bash: 2.5 * 4 : syntax error: invalid arithmetic operator (error token is <span class="string">&quot;.5 * 4 &quot;</span>)</span><br><span class="line">[root@zabbix01 script]<span class="comment"># a=2.5</span></span><br><span class="line">[root@zabbix01 script]<span class="comment"># b=4</span></span><br><span class="line">[root@zabbix01 script]<span class="comment"># echo $((a*b))</span></span><br><span class="line">-bash: 2.5: syntax error: invalid arithmetic operator (error token is <span class="string">&quot;.5&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="方法二：let"><a href="#方法二：let" class="headerlink" title="方法二：let"></a>方法二：let</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方法二:let</span></span><br><span class="line">[root@zabbix01 script]<span class="comment"># let a=1+2</span></span><br><span class="line">[root@zabbix01 script]<span class="comment"># echo $a</span></span><br><span class="line">3</span><br><span class="line"> </span><br><span class="line">[root@zabbix01 script]<span class="comment"># i=1</span></span><br><span class="line">[root@zabbix01 script]<span class="comment"># let i++</span></span><br><span class="line">[root@zabbix01 script]<span class="comment"># echo $i</span></span><br><span class="line">2</span><br><span class="line"> </span><br><span class="line">[root@zabbix01 script]<span class="comment"># n=10</span></span><br><span class="line">[root@zabbix01 script]<span class="comment"># let n+=2</span></span><br><span class="line">[root@zabbix01 script]<span class="comment"># echo $n</span></span><br><span class="line">12</span><br><span class="line"></span><br><span class="line"><span class="comment">#不支持非整形</span></span><br><span class="line"> 0 ✓ 15:48:45 root@web01,172.16.1.7:~ <span class="comment"># let 2+2.5</span></span><br><span class="line">-bash: <span class="built_in">let</span>: 2+2.5: syntax error: invalid arithmetic operator (error token is <span class="string">&quot;.5&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="方法三：expr"><a href="#方法三：expr" class="headerlink" title="方法三：expr"></a>方法三：expr</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix01 script]<span class="comment"># expr 2 + 2</span></span><br><span class="line">4</span><br><span class="line"></span><br><span class="line">[root@zabbix01 script]<span class="comment"># expr 2 \* 3</span></span><br><span class="line">6</span><br><span class="line"></span><br><span class="line"><span class="comment">## expr可以用来判断某一个数字是不是整型</span></span><br><span class="line"><span class="comment"># 如果变量是一个字符串</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># age=xxx</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># expr 1 + $age</span></span><br><span class="line"><span class="built_in">expr</span>: non-integer argument</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo $?</span></span><br><span class="line">2</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 如果变量是整型</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># age=18</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># expr 1 + $age</span></span><br><span class="line">19</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo $?</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不支持整形</span></span><br><span class="line"></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># expr 1 + 2.5</span></span><br><span class="line"><span class="built_in">expr</span>: non-integer argument</span><br></pre></td></tr></table></figure><h3 id="方法四：bc"><a href="#方法四：bc" class="headerlink" title="方法四：bc"></a>方法四：bc</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix01 ~]<span class="comment"># echo 1+2 |bc</span></span><br><span class="line">3</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo 2.5+3 |bc</span></span><br><span class="line">5.5</span><br><span class="line"> </span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo 1/3 |bc</span></span><br><span class="line">0</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo 1/3 |bc -l</span></span><br><span class="line">.33333333333333333333</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 它是交互式的</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># bc</span></span><br><span class="line">bc 1.06.95</span><br><span class="line">Copyright 1991-1994, 1997, 1998, 2000, 2004, 2006 Free Software Foundation, Inc.</span><br><span class="line">This is free software with ABSOLUTELY NO WARRANTY.</span><br><span class="line">For details <span class="built_in">type</span> `warranty<span class="string">&#x27;.</span></span><br><span class="line"><span class="string">1+1</span></span><br><span class="line"><span class="string">2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 在bc中幂运算，只能用 ^不能用 **，跟开发语言有关</span></span><br><span class="line"><span class="string">2^10</span></span><br><span class="line"><span class="string">1024</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 进制转换</span></span><br><span class="line"><span class="string"># 十六进制</span></span><br><span class="line"><span class="string">[root@zabbix01 ~]# echo &#x27;</span>obase=16;16<span class="string">&#x27;|bc</span></span><br><span class="line"><span class="string">10</span></span><br><span class="line"><span class="string">[root@zabbix01 ~]# echo &#x27;</span>obase=16;15<span class="string">&#x27;|bc</span></span><br><span class="line"><span class="string">F</span></span><br><span class="line"><span class="string">[root@zabbix01 ~]# echo &#x27;</span>obase=16;13<span class="string">&#x27;|bc</span></span><br><span class="line"><span class="string">D</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 二进制</span></span><br><span class="line"><span class="string">[root@zabbix01 ~]# echo &#x27;</span>obase=2;15<span class="string">&#x27;|bc</span></span><br><span class="line"><span class="string">1111</span></span><br><span class="line"><span class="string">[root@zabbix01 ~]# echo &#x27;</span>obase=2;18<span class="string">&#x27;|bc</span></span><br><span class="line"><span class="string">10010</span></span><br></pre></td></tr></table></figure><h3 id="方法五：awk"><a href="#方法五：awk" class="headerlink" title="方法五：awk"></a>方法五：awk</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 支持多运算</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># awk &#x27;BEGIN&#123;print 1+2,2**10&#125;&#x27;</span></span><br><span class="line">3 1024</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 直接显示小数</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># awk &#x27;BEGIN&#123;print 1+2,2**10,2.5*3,1/3&#125;&#x27;</span></span><br><span class="line">3 1024 7.5 0.333333</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 正确姿势</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># awk -v x=1 -v y=2 &#x27;BEGIN&#123;print x/y&#125;&#x27;</span></span><br><span class="line">0.5</span><br><span class="line"><span class="comment"># 那么我们就可以引用命令行的变量了</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># awk -v x=$a -v y=$b &#x27;BEGIN&#123;print x/y&#125;&#x27;</span></span><br><span class="line">2</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> shell脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell变量的分类(3)</title>
      <link href="/2023/01/07/Shell/Day03%E5%8F%98%E9%87%8F%E7%9A%84%E5%88%86%E7%B1%BB/"/>
      <url>/2023/01/07/Shell/Day03%E5%8F%98%E9%87%8F%E7%9A%84%E5%88%86%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="变量的分类"><a href="#变量的分类" class="headerlink" title="变量的分类"></a>变量的分类</h1><h2 id="系统环境变量"><a href="#系统环境变量" class="headerlink" title="系统环境变量"></a>系统环境变量</h2><ul><li>env</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MAIL=/var/spool/mail/root</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line">PWD=/root</span><br><span class="line">LANG=en_US.UTF-8</span><br><span class="line">HISTCONTROL=ignoredups</span><br><span class="line">SHLVL=1</span><br><span class="line">HOME=/root</span><br><span class="line">LOGNAME=root</span><br><span class="line">SSH_CONNECTION=10.0.0.1 59638 10.0.0.8 22</span><br><span class="line">LESSOPEN=||/usr/bin/lesspipe.sh %s</span><br><span class="line">XDG_RUNTIME_DIR=/run/user/0</span><br><span class="line">_=/usr/bin/env</span><br></pre></td></tr></table></figure><ul><li>declare</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0 ✓ 17:55:30 root@web02,172.16.1.8:~ <span class="comment"># declare | grep PS1</span></span><br><span class="line">PS1=<span class="string">&#x27;\[\e[1;37m\]  0\[\e[0m\] \[\e[32m\]\342\234\223\[\e[0m\] \[\e[2;37m\]\t\[\e[0m\] \[\e[1;35m\]\u\[\e[0m\]@\[\e[1;33m\]web02\[\e[0m\],\[\e[4;32m\]172.16.1.8\[\e[0m\]:\[\e[36m\]\w\[\e[0m\] \[\e[1;37m\]\$\[\e[0m\] &#x27;</span></span><br><span class="line">    PS1=<span class="string">&quot;<span class="variable">$C_EC</span> &quot;</span>;</span><br><span class="line">        PS1+=<span class="string">&quot;<span class="variable">$C_Ok</span> &quot;</span>;</span><br><span class="line">        PS1+=<span class="string">&quot;<span class="variable">$C_Fail</span> &quot;</span>;</span><br><span class="line">    PS1+=<span class="string">&quot;<span class="variable">$C_Time</span> &quot;</span>;</span><br><span class="line">        PS1+=<span class="string">&quot;<span class="variable">$&#123;C_RootUser&#125;</span>@<span class="variable">$&#123;C_Host&#125;</span>:&quot;</span>;</span><br><span class="line">        PS1+=<span class="string">&quot;<span class="variable">$&#123;C_NormalUser&#125;</span>@<span class="variable">$&#123;C_Host&#125;</span>:&quot;</span>;</span><br><span class="line">    PS1+=<span class="string">&quot;<span class="variable">$C_Pwd</span> <span class="variable">$C_Marker</span> &quot;</span></span><br></pre></td></tr></table></figure><ul><li>export</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> -x MAIL=<span class="string">&quot;/var/spool/mail/root&quot;</span></span><br><span class="line"><span class="built_in">declare</span> -x OLDPWD</span><br><span class="line"><span class="built_in">declare</span> -x PATH=<span class="string">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/n:/root/bin&quot;</span></span><br><span class="line"><span class="built_in">declare</span> -x PWD=<span class="string">&quot;/root&quot;</span></span><br><span class="line"><span class="built_in">declare</span> -x SHELL=<span class="string">&quot;/bin/bash&quot;</span></span><br><span class="line"><span class="built_in">declare</span> -x SHLVL=<span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="built_in">declare</span> -x SSH_CLIENT=<span class="string">&quot;10.0.0.1 59638 22&quot;</span></span><br><span class="line"><span class="built_in">declare</span> -x SSH_CONNECTION=<span class="string">&quot;10.0.0.1 59638 10.0.0.8 22&quot;</span></span><br><span class="line"><span class="built_in">declare</span> -x SSH_TTY=<span class="string">&quot;/dev/pts/0&quot;</span></span><br><span class="line"><span class="built_in">declare</span> -x TERM=<span class="string">&quot;xterm&quot;</span></span><br><span class="line"><span class="built_in">declare</span> -x USER=<span class="string">&quot;root&quot;</span></span><br><span class="line"><span class="built_in">declare</span> -x XDG_RUNTIME_DIR=<span class="string">&quot;/run/user/0&quot;</span></span><br><span class="line"><span class="built_in">declare</span> -x XDG_SESSION_ID=<span class="string">&quot;1&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">30 ✗ 17:57:13 root@web02,172.16.1.8:~ <span class="comment"># echo $LANG</span></span><br><span class="line">en_US.UTF-8</span><br><span class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</span><br><span class="line"><span class="comment">#英文的量改成中文的</span></span><br><span class="line">vim /etc/profile</span><br><span class="line"><span class="comment">#在最后一行添加</span></span><br><span class="line">LANG=zh_CN.UTF-8</span><br><span class="line"><span class="comment">#生效</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment">#测试一下</span></span><br><span class="line"><span class="built_in">cp</span> --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><p><strong>重点</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">LANG <span class="comment"># 字符集语言</span></span><br><span class="line">PATH <span class="comment"># 该变量中的所有可执行文件，不需要加绝对路径</span></span><br><span class="line">PS1 <span class="comment"># 命令提示符</span></span><br><span class="line">UID <span class="comment"># 当前登录用户的UID</span></span><br><span class="line">HOSTNAME <span class="comment"># 当前主机名</span></span><br><span class="line">PWD <span class="comment"># 当前工作路径</span></span><br><span class="line">USER <span class="comment"># 当前登录的用户</span></span><br></pre></td></tr></table></figure><p><strong>次重点</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HISTSIZE <span class="comment"># 历史命令显示行数</span></span><br><span class="line">HISTFILESIZE <span class="comment"># 历史命令存放文件行数</span></span><br><span class="line">HISTFILE <span class="comment"># 历史命令保存路径</span></span><br><span class="line">TMOUT <span class="comment"># 超时时间</span></span><br><span class="line"><span class="built_in">export</span> HISTCONTROL=ignorespace <span class="comment"># 任何命令加空格都不会被历史记录</span></span><br><span class="line">PROMPT_COMMAND <span class="comment"># 跳板机专用变量</span></span><br></pre></td></tr></table></figure><h2 id="普通变量"><a href="#普通变量" class="headerlink" title="普通变量"></a>普通变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 普通变量没什么好强调的，但是有一点，变量分隔一定要注意</span></span><br><span class="line"><span class="comment">## 还记得在做rsync同步的时候，以主机名，IP，时间命名目录</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> +%F-%T)</span><br><span class="line">IP=$(ifconfig eth0|awk <span class="string">&#x27;NR==2&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> $DATE_$IP_<span class="variable">$HOSTNAME</span> <span class="comment">## 基本凉了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 注意使用大括号分隔变量</span></span><br><span class="line"><span class="built_in">mkdir</span> <span class="variable">$&#123;DATE&#125;</span>_<span class="variable">$&#123;IP&#125;</span>_<span class="variable">$&#123;HOSTNAME&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 与环境变量相关的文件</span></span><br><span class="line">/etc/profile</span><br><span class="line">/etc/bashrc</span><br><span class="line">~/.bashrc</span><br><span class="line">~/.bashrc_profile</span><br><span class="line">/etc/profile.d/*.sh</span><br></pre></td></tr></table></figure><h2 id="特殊变量-位置变量"><a href="#特殊变量-位置变量" class="headerlink" title="特殊变量-位置变量"></a>特殊变量-位置变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$n</span> 传递参数的个数</span><br><span class="line"><span class="variable">$#</span> 统计参数的总个数</span><br><span class="line">$* 获取所有的参数</span><br><span class="line"><span class="variable">$@</span> 获取所有的参数</span><br><span class="line"><span class="comment">#区别，加上引号，*是横着展示，@是竖着展示</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;$*结果:&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;$*&quot;</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span>结果:&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">0 ✓ 20:12:06 root@web02,172.16.1.8:~ <span class="comment"># sh a.sh a s d f </span></span><br><span class="line">a s d f结果:</span><br><span class="line">a s d f</span><br><span class="line">a s d f结果:</span><br><span class="line">a</span><br><span class="line">s</span><br><span class="line">d</span><br><span class="line">f</span><br></pre></td></tr></table></figure><h2 id="特殊变量-状态变量"><a href="#特殊变量-状态变量" class="headerlink" title="特殊变量-状态变量"></a>特殊变量-状态变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> $? <span class="comment">#上一条命令的返回值</span></span><br><span class="line"><span class="comment">#特殊命令的返回值</span></span><br><span class="line">-<span class="literal">false</span> </span><br><span class="line">-/bin/false</span><br><span class="line">-diff</span><br><span class="line"><span class="comment">#对比相同情况下不会有报错</span></span><br><span class="line">0 ✓ 20:18:04 root@web02,172.16.1.8:~ <span class="comment"># vim 2.txt</span></span><br><span class="line">  0 ✓ 20:18:14 root@web02,172.16.1.8:~ <span class="comment"># diff 1.txt 2.txt</span></span><br><span class="line">  0 ✓ 20:18:22 root@web02,172.16.1.8:~ <span class="comment"># vim 2.txt</span></span><br><span class="line">  0 ✓ 20:18:41 root@web02,172.16.1.8:~ <span class="comment"># diff 1.txt 2.txt</span></span><br><span class="line">1c1</span><br><span class="line">&lt; qwe</span><br><span class="line">---</span><br><span class="line">&gt; qwe1</span><br><span class="line">  1 ✗ 20:18:50 root@web02,172.16.1.8:~ <span class="comment"># </span></span><br><span class="line"></span><br><span class="line">$$ 表示当前运行的pid</span><br><span class="line">$! 获取上一个脚本的pid</span><br><span class="line"><span class="variable">$_</span> 上一个命令或者脚本的参数 类似ESC .</span><br></pre></td></tr></table></figure><h2 id="变量子串"><a href="#变量子串" class="headerlink" title="变量子串"></a>变量子串</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;#&#125;</span> 变量的长度</span><br><span class="line"><span class="comment"># 不需要传参</span></span><br><span class="line">name=xxx</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#name&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要传参</span></span><br><span class="line">name=<span class="variable">$1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#name&#125;</span></span><br><span class="line"></span><br><span class="line">time <span class="keyword">for</span> n <span class="keyword">in</span> &#123;1..10000&#125;;<span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$&#123;#n&#125;</span> &gt;/dev/null;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">time <span class="keyword">for</span> n <span class="keyword">in</span> &#123;1..10000&#125;;<span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$&#123;n&#125;</span>|awk <span class="string">&#x27;&#123;print length()&#125;&#x27;</span> &gt;/dev/null;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">time <span class="keyword">for</span> n <span class="keyword">in</span> &#123;1..10000&#125;;<span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$&#123;n&#125;</span>|<span class="built_in">wc</span> -L &gt;/dev/null;<span class="keyword">done</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 截取</span></span><br><span class="line"><span class="variable">$&#123;parameter:offset&#125;</span></span><br><span class="line"><span class="variable">$&#123;变量名:偏差值&#125;</span></span><br><span class="line">name=db01_xyzabcdef</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;name:2&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 截取之后指定长度 2就是2个字符集，3就是三个字符集</span></span><br><span class="line"><span class="variable">$&#123;parameter:offset:length&#125;</span></span><br><span class="line"><span class="variable">$&#123;变量名 ：步长&#125;</span></span><br><span class="line">name=db01_xyzabcdef</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;name:2:3&#125;</span></span><br><span class="line"></span><br><span class="line">0 ✓ 20:55:10 root@web02,172.16.1.8:~ <span class="comment"># cat 1.txt</span></span><br><span class="line">/tmp/1.txt</span><br><span class="line">/opt/abc/2.txt</span><br><span class="line">/etc/xyc/xxx/3.txt</span><br><span class="line">  0 ✓ 20:55:16 root@web02,172.16.1.8:~ <span class="comment"># cat 1.txt | awk -F / &#x27;&#123;print $NF&#125;&#x27;</span></span><br><span class="line">1.txt</span><br><span class="line">2.txt</span><br><span class="line">3.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="string">&#x27;cat /root/1.txt&#x27;</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$&#123;line##*/&#125;</span></span><br><span class="line"><span class="keyword">done</span> </span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;parameter#word&#125;</span> 从变量开头，删除最短匹配word的子串</span><br><span class="line"><span class="variable">$&#123;变量名#字符集&#125;</span></span><br><span class="line"><span class="variable">$&#123;parameter##word&#125;</span> 从变量开头，删除最长匹配word的子串</span><br><span class="line"><span class="variable">$&#123;变量名##字符集&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;parameter%word&#125;</span> 从变量结尾，删除最短匹配的word的子串</span><br><span class="line"><span class="variable">$&#123;变量名%字符集&#125;</span></span><br><span class="line"><span class="variable">$&#123;parameter%%word&#125;</span> 从变量结尾，删除最长匹配的word的子串</span><br><span class="line"><span class="variable">$&#123;变量名%%字符集&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;parameter/pattern/string&#125;</span> 使用string替换第一个pattern</span><br><span class="line"><span class="variable">$&#123;变量名/匹配内容/替换内容&#125;</span></span><br><span class="line"><span class="variable">$&#123;parameter//pattern/string&#125;</span> 使用string替换所有的pattern</span><br><span class="line"><span class="variable">$&#123;变量名//匹配内容/替换内容&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&#x27;请输入游戏名字:&#x27;</span> name</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;name/sb/kangkang&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&#x27;请输入游戏名字:&#x27;</span> name</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;name//sb/kangkang&#125;</span></span><br></pre></td></tr></table></figure><h2 id="拓展变量"><a href="#拓展变量" class="headerlink" title="拓展变量"></a>拓展变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;parameter:-string&#125;</span> 如果parameter没被赋值或其值为空，就以string作为默认值 前提是用户没有赋值</span><br><span class="line"><span class="variable">$&#123;变量名:-字符串&#125;</span></span><br><span class="line"><span class="variable">$&#123;parameter:=string&#125;</span> 如果parameter没被赋值或其值为空，就以string作为默认值，并将string赋值给</span><br><span class="line">parameter 前提是用户没有赋值</span><br><span class="line"><span class="variable">$&#123;变量名:=字符串&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;parameter:?string&#125;</span> 如果parameter没被赋值或其值为空，就以string作为错误输出，否则显示</span><br><span class="line">parameter内容</span><br><span class="line"><span class="variable">$&#123;变量名:?字符串&#125;</span></span><br><span class="line"><span class="variable">$&#123;parameter:+string&#125;</span> 如果parameter没被赋值或其值为空，就什么都不做，否则用string替换变量内容</span><br><span class="line"><span class="variable">$&#123;变量名:+字符串&#125;</span></span><br></pre></td></tr></table></figure><h2 id="交互赋值"><a href="#交互赋值" class="headerlink" title="交互赋值"></a>交互赋值</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">直接赋值 简单粗暴 name=xxx</span><br><span class="line">间接赋值 IP=`ifconfig eth0| awk <span class="string">&#x27;NR==2&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">交互赋值 <span class="built_in">read</span> -p <span class="string">&#x27;请输入kangknag:&#x27;</span> name</span><br><span class="line">传参赋值 <span class="built_in">echo</span> <span class="variable">$1</span> <span class="variable">$2</span> <span class="variable">$3</span> sh xx.sh 1 2 3</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span></span><br><span class="line">-p 打印一句话</span><br><span class="line"><span class="built_in">read</span> -p xxx</span><br><span class="line">-s 不显示输入内容</span><br><span class="line">-t 设置超时时间</span><br><span class="line">-a 将后面的所有结果放进数组</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">passwd=123</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&#x27;m01 login:&#x27;</span> -a name</span><br><span class="line"><span class="built_in">read</span> -t 5 -s -p <span class="string">&#x27;passwd:&#x27;</span> pass</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$pass</span> == <span class="variable">$passwd</span> ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;登录成功&#x27;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$&#123;name[0]&#125;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$&#123;name[1]&#125;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$&#123;name[2]&#125;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;登录失败&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h2 id="shell数据类型"><a href="#shell数据类型" class="headerlink" title="shell数据类型"></a>shell数据类型</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">字符串</span><br><span class="line">整型</span><br><span class="line">数组</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串</span></span><br><span class="line">赋值</span><br><span class="line">name=<span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 整型</span></span><br><span class="line">age=18 整型</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组类型</span></span><br><span class="line">list=(java python golong shell)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;list[0]&#125;</span> java</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;list[1]&#125;</span> python</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;list[2]&#125;</span> golong</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;list[3]&#125;</span> shell</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> shell脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell编程-字符串表达式(6)</title>
      <link href="/2023/01/07/Shell/Day06shell%E7%BC%96%E7%A8%8B-%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A1%A8%E8%BE%BE%E5%BC%8F%20%E5%92%8Cif%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/"/>
      <url>/2023/01/07/Shell/Day06shell%E7%BC%96%E7%A8%8B-%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A1%A8%E8%BE%BE%E5%BC%8F%20%E5%92%8Cif%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="字符串表达式"><a href="#字符串表达式" class="headerlink" title="字符串表达式"></a>字符串表达式</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意：大写的注意，在shell脚本中所有变量的调用，请一定加上双引号，尤其是和字符串相关的，千言万语汇成一句话<span class="string">&quot;加双引号&quot;</span>如果让我看见你不加，那么你帽子颜色和加双引号一个颜色。</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522091834883.png" alt="image-20230522091834883"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-n 非空为真不报错</span></span><br><span class="line"><span class="comment">#-Z 空则为真不报错</span></span><br><span class="line"><span class="comment">#等号左边字符串与右边字符串相等则成立</span></span><br><span class="line"><span class="comment">#等号左边字符串与右边字符串不相等则成立</span></span><br><span class="line">0 ✓ 15:42:16 root@web01,172.16.1.7:~ <span class="comment"># abc=liqi</span></span><br><span class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</span><br><span class="line">  0 ✓ 15:44:36 root@web01,172.16.1.7:~ <span class="comment"># echo $abc</span></span><br><span class="line">liqi</span><br><span class="line">  0 ✓ 15:44:42 root@web01,172.16.1.7:~ <span class="comment"># test -n &quot;$abc&quot;</span></span><br><span class="line">  0 ✓ 15:45:05 root@web01,172.16.1.7:~ <span class="comment"># test -z &quot;$abc&quot;</span></span><br><span class="line">  1 ✗ 15:45:16 root@web01,172.16.1.7:~ <span class="comment"># test -z &quot;$abc&quot;</span></span><br><span class="line">You have new mail <span class="keyword">in</span> /var/spool/mail/root</span><br><span class="line"></span><br><span class="line">abc=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">test</span> -n <span class="string">&quot;<span class="variable">$abc</span>&quot;</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;字符串不为空&#x27;</span> || <span class="built_in">echo</span> <span class="string">&#x27;字符串为空&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;str1&quot;</span> = <span class="string">&quot;str2&quot;</span></span><br><span class="line">等号左边字符串与等号右边字符串相等则成立</span><br><span class="line"><span class="built_in">test</span> <span class="string">&quot;abc&quot;</span> = <span class="string">&quot;abc&quot;</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;字符串相同&#x27;</span> || <span class="built_in">echo</span> <span class="string">&#x27;字符串不相同&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;str1&quot;</span> != <span class="string">&quot;str2&quot;</span></span><br><span class="line">等号左边字符串与右边字符串不等则成立</span><br><span class="line"><span class="built_in">test</span> <span class="string">&quot;abc&quot;</span> = <span class="string">&quot;abc1&quot;</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;字符串相同&#x27;</span> || <span class="built_in">echo</span> <span class="string">&#x27;字符串不相同&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="整数表达式"><a href="#整数表达式" class="headerlink" title="整数表达式"></a>整数表达式</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522091849638.png" alt="image-20230522091849638"></p><p>注意：当[[]] 遇到大于，基本就歇菜了，需要使用转译符，那么系统就推荐使用-ge，-gt这样的方式，如果使用这样的方式，那莫不如就用[]</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-eq等于</span><br><span class="line">-ne不等于</span><br><span class="line">-gt大于</span><br><span class="line">-ge大于等于</span><br><span class="line">-lt小于</span><br><span class="line">-le小于等于</span><br></pre></td></tr></table></figure><h2 id="的成员运算"><a href="#的成员运算" class="headerlink" title="[[]]的成员运算"></a>[[]]的成员运算</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">name=liqi</span><br><span class="line">[[ <span class="variable">$name</span> =~ <span class="string">&#x27;i&#x27;</span> ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;包含&#x27;</span> || <span class="built_in">echo</span> <span class="string">&#x27;不包含&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#^开头，$结尾  =~包含</span></span><br><span class="line">1. 正则表达式（regular expression）</span><br><span class="line"></span><br><span class="line">1.1 元字符</span><br><span class="line"></span><br><span class="line">1.1.1  ^ 表示以什么开头</span><br><span class="line"></span><br><span class="line">1.1.2  $ 表示以什么结尾</span><br><span class="line"></span><br><span class="line">1.1.3   <span class="string">&quot; . &quot;</span>表示任意单个字符</span><br><span class="line"></span><br><span class="line">1.1.4  *表示前面的字符出现0次或者任意次</span><br><span class="line"></span><br><span class="line"> .*表示所有的字符</span><br><span class="line"></span><br><span class="line">1.1.5  |表示或者</span><br><span class="line"></span><br><span class="line">1.1.6 ^$ 表示空行</span><br><span class="line"></span><br><span class="line">1.1.7  +表示前面字符出现1次以上</span><br><span class="line"></span><br><span class="line">1.2  方括号表达式</span><br><span class="line"></span><br><span class="line">1.2.1  [abc] 表示 a，b，c任意一个</span><br><span class="line"></span><br><span class="line"> 1.2.2  [a-z] 表示小写字母</span><br><span class="line"></span><br><span class="line">1.2.3  [A-Z] 表示大写字母</span><br><span class="line"></span><br><span class="line"> 1.2.4  [0-Z] 表示数字和字母</span><br><span class="line"></span><br><span class="line">1.2.5  ^在方括号里面和外面的区别</span><br><span class="line"></span><br><span class="line">1.3  []和 &#123;&#125;组合使用</span><br></pre></td></tr></table></figure><h2 id="逻辑表达式"><a href="#逻辑表达式" class="headerlink" title="逻辑表达式"></a>逻辑表达式</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522091904713.png" alt="image-20230522091904713"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522091936673.png" alt="image-20230522091936673"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522091954542.png" alt="image-20230522091954542"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">!</span><br><span class="line">&amp;&amp;   -a[[]] &amp;&amp; [[]][[ <span class="variable">$name</span> -eq 0 -a <span class="variable">$name2</span> -ne 3]]</span><br><span class="line">||   -o[[]] || [[]][[ <span class="variable">$name</span> -eq 0 -o <span class="variable">$name2</span> -ne 3]]</span><br></pre></td></tr></table></figure><h3 id="shell练习"><a href="#shell练习" class="headerlink" title="shell练习"></a>shell练习</h3><p>命令行中输入一个数字，如果数字是1，则输出1，如果是2则输出2，既不是1也不是2则显示脚本使用方法，并退出程序</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim a.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">num=<span class="variable">$1</span></span><br><span class="line">[ <span class="variable">$num</span> -eq 1 -o <span class="variable">$num</span> -eq 2 ] &amp;&amp; <span class="built_in">echo</span> <span class="variable">$num</span> || <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> &#123;1|2&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">sh a.sh 1</span><br><span class="line">sh a.sh 2</span><br></pre></td></tr></table></figure><h2 id="if流程控制"><a href="#if流程控制" class="headerlink" title="if流程控制"></a>if流程控制</h2><h3 id="if条件语句"><a href="#if条件语句" class="headerlink" title="if条件语句"></a>if条件语句</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#if语法单分支</span></span><br><span class="line"><span class="comment"># 写法一：</span></span><br><span class="line"><span class="keyword">if</span> [  ];<span class="keyword">then</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 写法二：</span></span><br><span class="line"><span class="keyword">if</span> [  ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">## 不过单分支，没有必要写if了，直接用条件表达式即可。</span></span><br><span class="line">[ 条件 ] &amp;&amp; &#123;</span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#if语法双分支</span></span><br><span class="line"><span class="comment"># 写法一：</span></span><br><span class="line"><span class="keyword">if</span> [  ];<span class="keyword">then</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 写法二：</span></span><br><span class="line"><span class="keyword">if</span> [  ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#if语法多分支</span></span><br><span class="line"><span class="keyword">if</span> [  ];<span class="keyword">then</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line"><span class="keyword">elif</span> [  ];<span class="keyword">then</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 写法二：</span></span><br><span class="line"><span class="keyword">if</span> [  ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line"><span class="keyword">elif</span> [  ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> shell脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell编程-条件表达式(5)</title>
      <link href="/2023/01/07/Shell/Day05shell%E7%BC%96%E7%A8%8B-%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
      <url>/2023/01/07/Shell/Day05shell%E7%BC%96%E7%A8%8B-%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><p>shell条件表达式</p><h2 id="条件表达式"><a href="#条件表达式" class="headerlink" title="条件表达式"></a>条件表达式</h2><p>条件表达式，我们非常的常用，可以说，任何编程语言，都离不开条件表达式，但是每种变成语言的写法都不太一样，在shell中，有一种独特的写法。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ 条件 ]<span class="comment">#不支持&gt; &lt;#支持 -le -ge</span></span><br><span class="line">[[ 条件 ]]<span class="comment">#支持&gt; &lt;   -le  -ge</span></span><br><span class="line"><span class="built_in">test</span> 条件<span class="comment">#都支持命令行使用test</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522091722694.png" alt="image-20230522091722694"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522091736869.png" alt="image-20230522091736869"></p><h2 id="条件表达式的选项"><a href="#条件表达式的选项" class="headerlink" title="条件表达式的选项"></a>条件表达式的选项</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#判断文件是否存在 -f</span></span><br><span class="line"><span class="built_in">test</span> -f /tmp/1.txt &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;存在&#x27;</span> || <span class="built_in">echo</span> <span class="string">&#x27;不存在&#x27;</span></span><br><span class="line"><span class="comment">#在脚本里面的写法</span></span><br><span class="line"><span class="comment">#！/bin/bash</span></span><br><span class="line">[ -f /tmp/1.txt ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;存在&#x27;</span> || <span class="built_in">echo</span> <span class="string">&#x27;不存在&#x27;</span></span><br><span class="line">[[ -f /tmp/1.txt ]] &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;存在&#x27;</span> || <span class="built_in">echo</span> <span class="string">&#x27;不存在&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#判断目录是否存在 -d</span></span><br><span class="line"><span class="built_in">test</span> -d /tmp</span><br><span class="line"><span class="built_in">test</span> -d /tmp &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;存在&#x27;</span> || <span class="built_in">echo</span> <span class="string">&#x27;不存在&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断是否存在 -e</span></span><br><span class="line"><span class="built_in">test</span> -e /tmp</span><br><span class="line"><span class="built_in">test</span> -e /tmp &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;存在&#x27;</span> ||  <span class="built_in">echo</span> <span class="string">&#x27;不存在&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断文件是否存在r权限 -r</span></span><br><span class="line"><span class="built_in">test</span> -r /root/1.txt</span><br><span class="line">tets -r /root/2.txt &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;可读&#x27;</span> || <span class="built_in">echo</span> <span class="string">&#x27;不可读&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#判断文件是否存在w权限 -w</span></span><br><span class="line"><span class="built_in">test</span> -w /opt/1.txt &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;可写&#x27;</span> || <span class="built_in">echo</span> <span class="string">&#x27;不可写&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#判断文件是否存在x权限  -x</span></span><br><span class="line"><span class="built_in">test</span> -x /opt/1.txt &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;可执行&#x27;</span> || <span class="built_in">echo</span> <span class="string">&#x27;不可执行&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#判断有没有软链接 -L</span></span><br><span class="line">制作软链接</span><br><span class="line"><span class="built_in">ln</span> -s /tmp/1.txt /root/anta</span><br><span class="line"><span class="built_in">test</span> -L /root/anta &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;有&#x27;</span> || <span class="string">&#x27;没有&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#判断文件里有没有内容 -s</span></span><br><span class="line"><span class="built_in">test</span> -s 1.txt</span><br><span class="line"><span class="built_in">test</span> -s /opt/1.txt &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;有内容&#x27;</span> || <span class="built_in">echo</span> <span class="string">&#x27;没内容&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#对比两个文件谁新</span></span><br><span class="line">-nt new <span class="keyword">then</span></span><br><span class="line"><span class="built_in">test</span> 3.txt -nt 2.txt</span><br><span class="line"><span class="built_in">test</span> 2.txt -nt 3.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> 3.txt -nt 2.txt &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;前者新&#x27;</span> || <span class="string">&#x27;后者旧&#x27;</span></span><br><span class="line"><span class="built_in">test</span> 2.txt -nt 3.txt &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;前者新&#x27;</span> || <span class="string">&#x27;后者旧&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#对比两个文件谁旧</span></span><br><span class="line">ot older <span class="keyword">then</span></span><br><span class="line"><span class="built_in">test</span> 3.txt -ot 2.txt</span><br><span class="line"><span class="built_in">test</span> 2.txt -ot 3.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> 3.txt -ot 2.txt &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;前者新&#x27;</span> || <span class="built_in">echo</span> <span class="string">&#x27;后者旧&#x27;</span></span><br><span class="line"><span class="built_in">test</span> 2.txt -ot 3.txt &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;前者新&#x27;</span> || <span class="built_in">echo</span> <span class="string">&#x27;后者旧&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="字符串表达式"><a href="#字符串表达式" class="headerlink" title="字符串表达式"></a>字符串表达式</h2><h3 id="字符串表达式的介绍"><a href="#字符串表达式的介绍" class="headerlink" title="字符串表达式的介绍"></a>字符串表达式的介绍</h3><p>大写的注意，在shell脚本中所有变量的调用，请一定加上双引号，尤其是和字符串相关的，千言万语汇成一句话”加双引号”如果让我看见你不加，那么你帽子颜色和加双引号一个颜色。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522091753283.png" alt="image-20230522091753283"></p><h3 id="整数表达式"><a href="#整数表达式" class="headerlink" title="整数表达式"></a>整数表达式</h3><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522091809207.png" alt="image-20230522091809207"></p>]]></content>
      
      
      <categories>
          
          <category> shell脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell编程-循环(9)</title>
      <link href="/2023/01/07/Shell/Day09shell%E7%BC%96%E7%A8%8B-%E5%BE%AA%E7%8E%AF/"/>
      <url>/2023/01/07/Shell/Day09shell%E7%BC%96%E7%A8%8B-%E5%BE%AA%E7%8E%AF/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="shell编程循环"><a href="#shell编程循环" class="headerlink" title="shell编程循环"></a>shell编程循环</h1><h2 id="循环的基本概述"><a href="#循环的基本概述" class="headerlink" title="循环的基本概述"></a>循环的基本概述</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522092153711.png" alt="image-20230522092153711"></p><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># while 当型循环</span></span><br><span class="line">就是当什么什么的时候</span><br><span class="line">条件表达式</span><br><span class="line">只要这个条件满足，就循环</span><br><span class="line">直到条件不满足停下</span><br><span class="line"><span class="keyword">while</span></span><br><span class="line">死循环</span><br><span class="line">有条件的循环</span><br><span class="line">一行行读取文件</span><br><span class="line"></span><br><span class="line"><span class="comment"># for 通用型循环</span></span><br><span class="line"><span class="keyword">while</span>能做的<span class="keyword">for</span>也能做</span><br><span class="line"><span class="keyword">for</span>能做到的一些<span class="keyword">while</span>不能做</span><br><span class="line">死循环</span><br><span class="line">不会结束一直循环下去</span><br><span class="line"><span class="keyword">for</span></span><br><span class="line">循环</span><br><span class="line">适配多种场景</span><br><span class="line"></span><br><span class="line"><span class="comment"># do until 直到循环</span></span><br><span class="line">后面接条件表达式</span><br><span class="line">但是它的这个条件只要不满足就一直循环下去</span><br><span class="line">一直循环到满足为止</span><br><span class="line"></span><br><span class="line"><span class="comment">## 什么条件可以一直满足</span></span><br><span class="line">[ 3 -gt 2 ]</span><br><span class="line">[ 1 -eq 1 ]</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="while循环语法"><a href="#while循环语法" class="headerlink" title="while循环语法"></a>while循环语法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> [条件表达式];<span class="keyword">do</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> [条件表达式]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> 没有女朋友;<span class="keyword">do</span></span><br><span class="line">  找到死</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> 话费充足;<span class="keyword">do</span></span><br><span class="line">  打电话</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">## 死循环 true:为真，当条件满足是一直循环</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;hei hei hei&#x27;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> [ 1 -eq 1 ];<span class="keyword">do</span> </span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;hei hei hei&#x27;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> :;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;hei hei hei&#x27;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="使用while模拟seq"><a href="#使用while模拟seq" class="headerlink" title="使用while模拟seq"></a>使用while模拟seq</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">i=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$i</span> -le 10 ];<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">    ((i++))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh seq.sh</span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td></tr></table></figure><h3 id="使用while从1加到100"><a href="#使用while从1加到100" class="headerlink" title="使用while从1加到100"></a>使用while从1加到100</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">i=1</span><br><span class="line">num=0</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$i</span> -le 100 ];<span class="keyword">do</span></span><br><span class="line">  ((num=num+i))</span><br><span class="line">  ((i++))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$num</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">## 如果你对命令很精通，那么其实一条命令可以完成这个循环。</span></span><br><span class="line"> </span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo &#123;1..100&#125;|tr &#x27; &#x27; &#x27;+&#x27;|bc</span></span><br><span class="line">5050</span><br><span class="line"> </span><br><span class="line">[root@zabbix01 ~]<span class="comment"># seq -s+ 100|bc</span></span><br><span class="line">5050</span><br><span class="line"> </span><br><span class="line">[root@zabbix01 ~]<span class="comment"># seq 100|awk &#x27;&#123;sum=sum+$1&#125;END&#123;print sum&#125;&#x27;</span></span><br><span class="line">5050</span><br><span class="line"> </span><br><span class="line">[root@zabbix01 ~]<span class="comment"># awk &#x27;BEGIN&#123;for(i=1;i&lt;=100;i++)sum=sum+i;print sum&#125;&#x27;</span></span><br><span class="line">5050</span><br></pre></td></tr></table></figure><h2 id="for循环语法"><a href="#for循环语法" class="headerlink" title="for循环语法"></a>for循环语法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.无法指定循环次数，表达式有多少内容就循环多少次</span></span><br><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> 变量表达式;<span class="keyword">do</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> 变量表达式</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 变量表达式：</span></span><br><span class="line">1.可以是以空格为分隔符的字符串</span><br><span class="line">2.可以是以空格为分隔符的数字</span><br><span class="line">3.可以是数组</span><br><span class="line">4.可以是命令结果</span><br><span class="line">5.可以是文件内容(但是要注意<span class="keyword">for</span>并不是按行读取，如果每一行都没有空格还行，但是一旦遇到空格就...)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 举例：for循环1到10</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> xxx <span class="keyword">in</span> `<span class="built_in">seq</span> 10`;<span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$xxx</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 例：</span></span><br><span class="line"><span class="comment">## 循环以空格为分隔符的字符串</span></span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> <span class="string">&quot;zls cls wls&quot;</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$name</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">## 循环以空格为分隔符的数字</span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> 1 2 3 4 5;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$num</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> &#123;1..10&#125;;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$num</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> zm <span class="keyword">in</span> &#123;a..z&#125;;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$zm</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">## 循环数组</span></span><br><span class="line">array=(<span class="string">&quot;zls&quot;</span> <span class="string">&quot;cls&quot;</span> <span class="string">&quot;wls&quot;</span> <span class="string">&quot;boduols&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> str <span class="keyword">in</span> <span class="variable">$&#123;array[@]&#125;</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$str</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">##  循环命令结果</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> `<span class="built_in">ls</span> -1 /`;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$file</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> text <span class="keyword">in</span> `<span class="built_in">cat</span> /etc/passwd`;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$text</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2.可指定循环次数格式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>((i=<span class="number">1</span>;i&lt;=<span class="number">10</span>;i++));<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#for也可以无限循环</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (( ; ; ));<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> 123</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="until循环语法"><a href="#until循环语法" class="headerlink" title="until循环语法"></a>until循环语法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">until</span> 循环执行一系列命令直至条件为 <span class="literal">true</span> 时停止。</span><br><span class="line"></span><br><span class="line"><span class="keyword">until</span> 循环与 <span class="keyword">while</span> 循环在处理方式上刚好相反。</span><br><span class="line"></span><br><span class="line">一般 <span class="keyword">while</span> 循环优于 <span class="keyword">until</span> 循环，但在某些时候—也只是极少数情况下，<span class="keyword">until</span> 循环更加有用。</span><br><span class="line"></span><br><span class="line"><span class="keyword">until</span> &lt;条件表达式&gt;;<span class="keyword">do</span></span><br><span class="line">  cmd1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">until</span> 话费是否充足;<span class="keyword">do</span></span><br><span class="line">  打电话</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#举例:满足10就停止</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">n=0</span><br><span class="line"><span class="keyword">until</span> [ <span class="variable">$n</span> -gt 10 ];<span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$n</span></span><br><span class="line">((n++))</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="循环控制语句"><a href="#循环控制语句" class="headerlink" title="循环控制语句"></a>循环控制语句</h2><h3 id="break跳出循环"><a href="#break跳出循环" class="headerlink" title="break跳出循环"></a>break跳出循环</h3><p>break命令允许跳出所有循环（终止执行后面的所有循环）。 下面的例子中，脚本进入死循环直至用户输入数字大于5。要跳出这个循环，返回到shell提示符下，需要使用break命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix01 ~]<span class="comment"># vim break.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">read</span> -p <span class="string">&#x27;Please Input A Number: &#x27;</span> num</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$num</span> -ne 5 ];<span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;你输入的是 <span class="variable">$num</span>&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">break</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh break.sh</span></span><br><span class="line">Please Input A Number: 1</span><br><span class="line">你输入的是 1</span><br><span class="line">Please Input A Number: 2</span><br><span class="line">你输入的是 2</span><br><span class="line">Please Input A Number: 3</span><br><span class="line">你输入的是 3</span><br><span class="line">Please Input A Number: 4</span><br><span class="line">你输入的是 4</span><br><span class="line">Please Input A Number: 5</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">n=0</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$n</span> -lt 10 ];<span class="keyword">do</span></span><br><span class="line">((n++))</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$n</span> -eq 5 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$n</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="continue跳出循环"><a href="#continue跳出循环" class="headerlink" title="continue跳出循环"></a>continue跳出循环</h3><p>continue命令与break命令类似，只有一点差别，它不会跳出所有循环，仅仅跳出当前循环。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">read</span> -p <span class="string">&#x27;Please Input A Number: &#x27;</span> num</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$num</span> -ne 5 ];<span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;你输入的是 <span class="variable">$num</span>&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">continue</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh continue.sh</span></span><br><span class="line">Please Input A Number: 1</span><br><span class="line">你输入的是 1</span><br><span class="line">Please Input A Number: 2</span><br><span class="line">你输入的是 2</span><br><span class="line">Please Input A Number: 3</span><br><span class="line">你输入的是 3</span><br><span class="line">Please Input A Number: 4</span><br><span class="line">你输入的是 4</span><br><span class="line">Please Input A Number: 5</span><br><span class="line">Please Input A Number: 6</span><br><span class="line">你输入的是 6</span><br><span class="line">Please Input A Number: 7</span><br><span class="line">你输入的是 7</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">n=0</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$n</span> -lt 10 ];<span class="keyword">do</span></span><br><span class="line">((n++))</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$n</span> -eq 5 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">continue</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$n</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="循环读取文件内容"><a href="#循环读取文件内容" class="headerlink" title="循环读取文件内容"></a>循环读取文件内容</h2><h3 id="while读取文件内容"><a href="#while读取文件内容" class="headerlink" title="while读取文件内容"></a>while读取文件内容</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 方法一：使用exec读取文件内容，然后进入while循环</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># cat student.txt</span></span><br><span class="line">曾老湿</span><br><span class="line">苍井空</span><br><span class="line">武藤兰</span><br><span class="line">天海翼</span><br><span class="line">西野翔</span><br><span class="line">        </span><br><span class="line">[root@zabbix01 ~]<span class="comment"># vim while.sh       </span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">exec</span> &lt; student.txt</span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> name;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$name</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;------&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh while.sh</span></span><br><span class="line">曾老湿</span><br><span class="line">------</span><br><span class="line">苍井空</span><br><span class="line">------</span><br><span class="line">武藤兰</span><br><span class="line">------</span><br><span class="line">天海翼</span><br><span class="line">------</span><br><span class="line">西野翔</span><br><span class="line">------</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">## 方法二：使用管道符，将文件内容交给while循环</span></span><br><span class="line"><span class="built_in">cat</span> student.txt|<span class="keyword">while</span> <span class="built_in">read</span> line_name;<span class="keyword">do</span></span><br><span class="line"> </span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$line_name</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;------&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">## 方法三：使用标准输入，将文件内容交给while循环</span></span><br><span class="line"><span class="comment">#!/bin/bash </span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> name;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$name</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;------&quot;</span></span><br><span class="line"><span class="keyword">done</span> &lt; student.txt</span><br></pre></td></tr></table></figure><h3 id="whlie读取文件练习"><a href="#whlie读取文件练习" class="headerlink" title="whlie读取文件练习"></a>whlie读取文件练习</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#写一个脚本，读取下面文件内容，并算出所有人年龄总和</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># cat student.txt</span></span><br><span class="line">曾老湿 18</span><br><span class="line">苍井空 20</span><br><span class="line">武藤兰 33</span><br><span class="line">天海翼 32</span><br><span class="line">西野翔 18</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">sum</span>=0</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line;<span class="keyword">do</span></span><br><span class="line">age=`<span class="built_in">echo</span> <span class="variable">$line</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">((sum+=age))</span><br><span class="line"><span class="keyword">done</span> &lt; 1.txt</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$sum</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> shell脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell端口检测(7)</title>
      <link href="/2023/01/07/Shell/Day07shell%E7%AB%AF%E5%8F%A3%E6%A3%80%E6%B5%8B/"/>
      <url>/2023/01/07/Shell/Day07shell%E7%AB%AF%E5%8F%A3%E6%A3%80%E6%B5%8B/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="shell端口检测"><a href="#shell端口检测" class="headerlink" title="shell端口检测"></a>shell端口检测</h1><h2 id="书写脚本常用监控命令"><a href="#书写脚本常用监控命令" class="headerlink" title="书写脚本常用监控命令"></a>书写脚本常用监控命令</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522092103116.png" alt="image-20230522092103116"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522092116991.png" alt="image-20230522092116991"></p><h2 id="本地检查端口是否开启"><a href="#本地检查端口是否开启" class="headerlink" title="本地检查端口是否开启"></a>本地检查端口是否开启</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看所有端口</span></span><br><span class="line">netstat -lntup</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看指定端口</span></span><br><span class="line">netstat -lntup|grep 22</span><br><span class="line"></span><br><span class="line"><span class="comment">#精确查找端口</span></span><br><span class="line">netstat -lntup|grep -w <span class="string">&#x27;22&#x27;</span></span><br><span class="line"></span><br><span class="line">ss -lntup|grep -w 22</span><br><span class="line"></span><br><span class="line"><span class="comment">#转化成数字（有值是启动，值为0是没启动 ）</span></span><br><span class="line">netstat -lntup|grep -w <span class="string">&#x27;22&#x27;</span>|<span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure><h2 id="远端检查端口是否开启"><a href="#远端检查端口是否开启" class="headerlink" title="远端检查端口是否开启"></a>远端检查端口是否开启</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#telnet</span></span><br><span class="line">telnet 10.0.0.8 80</span><br><span class="line">Trying 10.0.0.8...</span><br><span class="line">Connected to 10.0.0.8.</span><br><span class="line">Escape character is <span class="string">&#x27;^]&#x27;</span>.</span><br><span class="line">^]</span><br><span class="line">telnet&gt; quit</span><br><span class="line">Connection closed.</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;123&#x27;</span>| telnet 172.16.1.8 80</span><br><span class="line"><span class="comment">## 这是一个交互式的，需要我们手动退出，所以适合在命令行使用，不适合脚本中使用</span></span><br><span class="line"><span class="comment">## 当然也有方法能让他不交互。</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo | telnet 127.0.0.1 22</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo | telnet 127.0.0.1 22  2&gt;/dev/null|grep &#x27;Connected&#x27;|wc -l</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#检测端口脚本</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">IP=<span class="variable">$1</span></span><br><span class="line">NET=<span class="variable">$2</span></span><br><span class="line">port_count=`<span class="built_in">echo</span> <span class="string">&#x27;&#x27;</span> | telnet <span class="variable">$&#123;IP&#125;</span> <span class="variable">$&#123;NET&#125;</span> 2&gt;/dev/null | grep <span class="string">&#x27;Connected&#x27;</span> | <span class="built_in">wc</span> -l`</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$port_count</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;端口不存活&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;端口存活&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">sh check.sh 172.16.1.8 80</span><br></pre></td></tr></table></figure><h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#脚本扫描</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">. /etc/init.d/functions</span><br><span class="line">IP=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">for</span> port <span class="keyword">in</span> `<span class="built_in">seq</span> 65535`;<span class="keyword">do</span></span><br><span class="line">        port_count=`<span class="built_in">echo</span> <span class="string">&#x27;&#x27;</span> | telnet <span class="variable">$IP</span> <span class="variable">$port</span> 2&gt;/dev/null | grep <span class="string">&#x27;Connected&#x27;</span> | <span class="built_in">wc</span> -l`</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$port_count</span> -ne 0 ];<span class="keyword">then</span></span><br><span class="line">                action <span class="string">&quot;<span class="variable">$port</span> 端口&quot;</span> /bin/true</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"> sh a.sh 10.0.0.7</span><br><span class="line">22 端口                                                    [  OK  ]</span><br><span class="line">80 端口                                                    [  OK  ]</span><br><span class="line">111 端口                                                   [  OK  ]</span><br></pre></td></tr></table></figure><h2 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#nc      netcat</span></span><br><span class="line">nc 172.16.1.8 80</span><br><span class="line"><span class="built_in">echo</span> $?</span><br><span class="line">0</span><br><span class="line"><span class="comment">#如果连接是通的会卡住</span></span><br><span class="line"><span class="comment">#如果连接不通会报错</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&#x27;</span> | nc 172.16.1.8 80</span><br><span class="line"></span><br><span class="line"><span class="comment">#选项</span></span><br><span class="line">-u 指定nc可以使用udp端口</span><br><span class="line">-l 临时起一个端口</span><br><span class="line">-k 保持链接 可以搭配-l一起使用起一个新的端口不会因为nc而断开</span><br><span class="line">-s：指定发送数据的源IP地址，适用于多网卡机器</span><br><span class="line">-w：设置超时时间</span><br><span class="line">-z：扫描时不发送任何数据</span><br><span class="line"></span><br><span class="line">-l：创建端口</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># nc -l 8888</span></span><br><span class="line"> </span><br><span class="line">-k：保持连接</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># nc -lk 8888</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">## 可以跟端口建立连接，传输数据</span></span><br></pre></td></tr></table></figure><h2 id="扫描nmap"><a href="#扫描nmap" class="headerlink" title="扫描nmap"></a>扫描nmap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 扫描IP</span></span><br><span class="line">nmap 10.0.0.61</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 扫描一个主机的一个端口</span></span><br><span class="line">nmap -p 22 10.0.0.61</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 扫描一个主机的多个端口</span></span><br><span class="line">nmap -p 22-1024 10.0.0.61</span><br><span class="line">namp -p 0-65535 10.0.0.61</span><br><span class="line"><span class="comment">## 扫描多个主机的多个端口</span></span><br><span class="line">nmap -p 22-1024 10.0.0.61 baidu.com</span><br></pre></td></tr></table></figure><h2 id="服务检查-进程判断"><a href="#服务检查-进程判断" class="headerlink" title="服务检查 进程判断"></a>服务检查 进程判断</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看进程</span></span><br><span class="line">top</span><br><span class="line">ps -ef|grep nginx</span><br><span class="line">ps -ef|grep [n]ginx</span><br><span class="line">ps -ef|grep [n]ginx| <span class="built_in">wc</span> -l</span><br><span class="line"><span class="comment">#检测服务存活判断脚本</span></span><br><span class="line">vim a.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">proc_mount=<span class="string">&#x27;ps -ef|grep [n]ginx |wc -l&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$proc_mount</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;服务不存活&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;服务存活&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">sh a.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#把服务杀掉</span></span><br><span class="line"><span class="built_in">kill</span> -9 105576</span><br></pre></td></tr></table></figure><h2 id="网站检测"><a href="#网站检测" class="headerlink" title="网站检测"></a>网站检测</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#curl命令</span></span><br><span class="line">-I：只显示响应头信息</span><br><span class="line">-H：修改请求头信息</span><br><span class="line">-v：显示详细的请求过程</span><br><span class="line">-L --location：跟随跳转</span><br><span class="line">-s：不显示头部的统计信息</span><br><span class="line">-X：指定请求方式</span><br><span class="line">-w：取出指定内容，例如：%&#123;http_code&#125;取出状态码</span><br><span class="line">-o：指定输出位置</span><br><span class="line">-A：指定User-Agent</span><br><span class="line">-u：指定用户名密码</span><br><span class="line"> </span><br><span class="line"><span class="comment">##  举例：</span></span><br><span class="line"><span class="comment">## 访问百度</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># curl www.baidu.com</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">## 只显示响应头部信息</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># curl -I www.baidu.com</span></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line">Cache-Control: private, no-cache, no-store, proxy-revalidate, no-transform</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Length: 277</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Date: Wed, 01 Sep 2021 01:24:34 GMT</span><br><span class="line">Etag: <span class="string">&quot;575e1f60-115&quot;</span></span><br><span class="line">Last-Modified: Mon, 13 Jun 2016 02:50:08 GMT</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Server: bfe/1.0.8.18</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 只要状态码</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># curl -s -w &quot;%&#123;http_code&#125;&quot; -o /dev/null https://blog.driverzeng.com</span></span><br><span class="line">200</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 追踪跳转</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment">#   curl www.360buy.com</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment">#   curl -v www.360buy.com</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment">#   curl -v www.360buy.com -L</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">## -s取消头部信息，一般配合管道符使用</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># curl -I https://blog.driverzeng.com|awk &#x27;NR==1&#123;print $2&#125;&#x27;</span></span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0</span><br><span class="line">200</span><br><span class="line"> </span><br><span class="line">[root@zabbix01 ~]<span class="comment"># curl -I -s https://blog.driverzeng.com|awk &#x27;NR==1&#123;print $2&#125;&#x27;</span></span><br><span class="line">200</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 指定用户名密码</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># yum install -y nginx httpd-tools</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># htpasswd -b -c /etc/nginx/auth_conf zls zls</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># vim /etc/nginx/conf.d/zls.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name _;</span><br><span class="line">    access_log off;</span><br><span class="line"> </span><br><span class="line">    location /nginx_status &#123;</span><br><span class="line">        stub_status;</span><br><span class="line">        auth_basic <span class="string">&quot;Auth access Blog Input your Passwd!&quot;</span>;</span><br><span class="line">        auth_basic_user_file auth_conf;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 直接访问会报错401没有认证</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># curl 10.0.0.61/nginx_status</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;&lt;title&gt;401 Authorization Required&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;401 Authorization Required&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;nginx/1.20.1&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 加上用户名密码就可以了</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># curl -uzls:zls 10.0.0.61/nginx_status</span></span><br><span class="line">Active connections: 1</span><br><span class="line">server accepts handled requests</span><br><span class="line"> 5 5 3</span><br><span class="line">Reading: 0 Writing: 1 Waiting: 0</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 但是我推荐这么访问</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># curl http://zls:zls@10.0.0.61/nginx_status</span></span><br><span class="line">Active connections: 1</span><br><span class="line">server accepts handled requests</span><br><span class="line"> 6 6 4</span><br><span class="line">Reading: 0 Writing: 1 Waiting: 0</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 访问的时候，可以修改我们自己的User-Agent，偷偷的，不让别人发现</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># curl -A zls_chrome https://blog.driverzeng.com</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name _;</span><br><span class="line"></span><br><span class="line">location /&#123;</span><br><span class="line">root /code/test;</span><br><span class="line">index index.html;</span><br><span class="line">auth_basic <span class="string">&quot;Auth access Blog Input your Passwd!&quot;</span>;</span><br><span class="line">        auth_basic_user_file auth_conf;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#htpasswd -b -c /etc/nginx/auth_conf xxx xxx</span></span><br><span class="line"><span class="comment">#mkdir -p /code/test</span></span><br><span class="line">vim /code/test/index.html</span><br><span class="line">liqi</span><br><span class="line"><span class="comment">#curl -u xxx:xxx 10.0.0.8</span></span><br><span class="line">curl -u xxx:xxx -s -w <span class="string">&quot;%&#123;http_code&#125;&quot;</span> -o /dev/null 10.0.0.7</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#wget命令</span></span><br><span class="line">-O：指定输出位置 保存下载页面内容</span><br><span class="line">-r：递归下载</span><br><span class="line">--debug：类似于curl的-v显示过程</span><br><span class="line">-q：静默输出</span><br><span class="line">--spider：不下载，就访问（爬虫模式）</span><br><span class="line"> </span><br><span class="line"> [root@zabbix01 ~]<span class="comment"># wget -r https://nginx.org/en/docs/</span></span><br><span class="line"> </span><br><span class="line">[root@zabbix01 ~]<span class="comment"># wget -q --spider www.baidu.com</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo $?</span></span><br><span class="line">0</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># wget -q --spider www.baidu.com/asdasda</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo $?</span></span><br><span class="line">8</span><br><span class="line"></span><br><span class="line">wget www.baidu.com</span><br><span class="line"><span class="built_in">rm</span> -fr /code/test/index.html</span><br><span class="line"><span class="built_in">mv</span> index.html /code/test/</span><br></pre></td></tr></table></figure><h2 id="文件检测"><a href="#文件检测" class="headerlink" title="文件检测"></a>文件检测</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#md5sum</span></span><br><span class="line"><span class="comment"># 获取文件md5值</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># md5sum /etc/passwd</span></span><br><span class="line">38b06c70e862085e22f23838dc873ade  /etc/passwd</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 将md5值保存到文件中</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># md5sum /etc/passwd &gt; passwd.md5</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 检测md5</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># md5sum -c passwd.md5</span></span><br><span class="line">/etc/passwd: OK</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 如果内容有改动则md5会发生变化</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># useradd test_md5</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># md5sum -c passwd.md5</span></span><br><span class="line">/etc/passwd: FAILED</span><br><span class="line"><span class="built_in">md5sum</span>: WARNING: 1 computed checksum did NOT match</span><br><span class="line"></span><br><span class="line"><span class="comment">#列</span></span><br><span class="line"><span class="built_in">md5sum</span> 2.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">md5sum</span> 2.txt &gt; /tmp/check_2.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">md5sum</span> -c /tmp/check_2.txt</span><br><span class="line">2.txt:ok</span><br><span class="line"></span><br><span class="line"><span class="built_in">md5sum</span> -c /tmp/check_2.txt</span><br><span class="line">2.txt FAILED</span><br><span class="line"><span class="built_in">md5sum</span>: WARNING: 1 computed checksum did NOT match</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> shell脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell编程-函数(8)</title>
      <link href="/2023/01/07/Shell/Day08shell%E7%BC%96%E7%A8%8B-%E5%87%BD%E6%95%B0/"/>
      <url>/2023/01/07/Shell/Day08shell%E7%BC%96%E7%A8%8B-%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="shell编程函数"><a href="#shell编程函数" class="headerlink" title="shell编程函数"></a>shell编程函数</h1><h2 id="函数介绍"><a href="#函数介绍" class="headerlink" title="函数介绍"></a>函数介绍</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#什么是函数</span></span><br><span class="line">函数就是具备某一功能的工具</span><br><span class="line"></span><br><span class="line"><span class="comment">#为什么要使用函数</span></span><br><span class="line">如果不使用函数，那么你的代码：</span><br><span class="line">1.程序的组织结构不清晰，可读性差</span><br><span class="line">2.代码冗余</span><br><span class="line">3.可扩展性（功能需要修改的时候...对不起GG）</span><br><span class="line"></span><br><span class="line"><span class="comment">#如何使用函数</span></span><br><span class="line">函数的使用必须遵循的原则：先定义，后调用</span><br><span class="line">修理工事先准备好工具的过程，即，定义函数</span><br><span class="line">修理工遇到应用场景哪来工具就用即函数的调用</span><br></pre></td></tr></table></figure><h2 id="函数语法"><a href="#函数语法" class="headerlink" title="函数语法"></a>函数语法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">foo</span></span>() &#123;</span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line">  cmd3</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> foo &#123;</span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line">  cmd3</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">foo</span></span>() &#123;</span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line">  cmd3</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">#foo指函数名：就相当于一个变量名，指向函数的内存地址</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">## 函数优化，企业级，入职必做</span></span><br><span class="line">:()&#123; : | : &amp; &#125;;:</span><br><span class="line"></span><br><span class="line"><span class="comment">#举例</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">xxx</span></span>()&#123;</span><br><span class="line">        <span class="built_in">echo</span> 123</span><br><span class="line">&#125;</span><br><span class="line">xxx</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">name=<span class="variable">$1</span></span><br><span class="line"><span class="function"><span class="title">yyy</span></span>()&#123;</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$name</span></span><br><span class="line">&#125;</span><br><span class="line">yyy</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">name=<span class="variable">$1</span></span><br><span class="line"><span class="function"><span class="title">yyy</span></span>()&#123;</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$name</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$1</span></span><br><span class="line">yyy 1</span><br></pre></td></tr></table></figure><h2 id="函数的调用语法"><a href="#函数的调用语法" class="headerlink" title="函数的调用语法"></a>函数的调用语法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#直接使用函数名即可</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#函数传参语法</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">foo</span></span>() &#123;</span><br><span class="line">  args=<span class="variable">$1</span></span><br><span class="line">  cmd1</span><br><span class="line">  cmd2</span><br><span class="line">  cmd3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#举例</span></span><br><span class="line">函数分为两个阶段：</span><br><span class="line">1.调用阶段:运行函数体代码</span><br><span class="line">2.定义阶段:只检测语法，不执行代码</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author: _DriverZeng_</span></span><br><span class="line"><span class="comment">#Name: _Print Message_</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">max</span></span> ()&#123;</span><br><span class="line">  x=<span class="variable">$1</span></span><br><span class="line">  y=<span class="variable">$2</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$x</span> -gt <span class="variable">$y</span> ];<span class="keyword">then</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="variable">$x</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="variable">$y</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">max</span><br><span class="line"> </span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh foo.sh 1 2</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 传参无效，所以这里面我们需要知道，bash的参数和函数的参数不是一个</span></span><br></pre></td></tr></table></figure><h2 id="函数参数VS脚本参数"><a href="#函数参数VS脚本参数" class="headerlink" title="函数参数VS脚本参数"></a>函数参数VS脚本参数</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522092137663.png" alt="image-20230522092137663"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#函数的返回值</span></span><br><span class="line">函数的返回值，需要注意：</span><br><span class="line">在Python中</span><br><span class="line">1.返回值没有类型限制</span><br><span class="line">2.返回值没有个数限制</span><br><span class="line">1）如果返回1个值：调用函拿到的结果就是一个值</span><br><span class="line">2）如果返回多个值：调用函数拿到的结果就是一个元组</span><br><span class="line">3）如果返回0个值：调用函数拿到的结果就是None</span><br><span class="line"></span><br><span class="line">在Shell中</span><br><span class="line">1.函数返回值，必须是numeric，数字</span><br><span class="line"></span><br><span class="line">2.返回值有个数限制，只能写一个返回值</span><br><span class="line"><span class="comment">#举例</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">love</span></span>()&#123;</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;kisskiss&#x27;</span></span><br><span class="line">        <span class="built_in">return</span> 10</span><br><span class="line">&#125;</span><br><span class="line">love</span><br><span class="line">0 ✓ 12:18:43 root@web01,172.16.1.7:~ <span class="comment"># sh b.sh </span></span><br><span class="line">kisskiss</span><br><span class="line"> 10 ✗ 12:18:46 root@web01,172.16.1.7:~ <span class="comment"># echo $?</span></span><br><span class="line">10</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> shell脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell编程-case流程控制(10)</title>
      <link href="/2023/01/07/Shell/Day10shell%E7%BC%96%E7%A8%8B-case%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/"/>
      <url>/2023/01/07/Shell/Day10shell%E7%BC%96%E7%A8%8B-case%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="shell-case流程控制"><a href="#shell-case流程控制" class="headerlink" title="shell -case流程控制"></a>shell -case流程控制</h1><h2 id="case语句介绍"><a href="#case语句介绍" class="headerlink" title="case语句介绍"></a>case语句介绍</h2><p>case … esac 为多选择语句，与其他语言中的 switch … case 语句类似，是一种多分枝选择结构，每个 case 分支用右圆括号开始，用两个分号 ;; 表示 break，即执行结束，跳出整个 case … esac 语句，esac（就是 case 反过来）作为结束标记。 可以用 case 语句匹配一个值与一个模式，如果匹配成功，执行相匹配的命令。 在某些时候，case要优于if，少写很多判断</p><h2 id="case语句格式"><a href="#case语句格式" class="headerlink" title="case语句格式"></a>case语句格式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#case语法</span></span><br><span class="line"><span class="keyword">case</span> 值 <span class="keyword">in</span></span><br><span class="line">模式1)</span><br><span class="line">    command1</span><br><span class="line">    command2</span><br><span class="line">    ...</span><br><span class="line">    commandN</span><br><span class="line">    ;;</span><br><span class="line">模式2）</span><br><span class="line">    command1</span><br><span class="line">    command2</span><br><span class="line">    ...</span><br><span class="line">    commandN</span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> 工作方式如上所示，取值后面必须为单词 <span class="keyword">in</span>，每一模式必须以右括号结束。取值可以为变量或常数，匹配发现取值符合某一模式后，其间所有命令开始执行直至 ;;。</span><br><span class="line"></span><br><span class="line">取值将检测匹配的每一个模式。一旦模式匹配，则执行完匹配模式相应命令后不再继续其他模式。如果无一匹配模式，使用星号 * 捕获该值，再执行后面的命令。</span><br></pre></td></tr></table></figure><h2 id="用法举例"><a href="#用法举例" class="headerlink" title="用法举例"></a>用法举例</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#现实举例</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;你的个人条件&quot;</span> <span class="keyword">in</span></span><br><span class="line">          有钱）</span><br><span class="line">                能迎娶白美</span><br><span class="line">                ;;</span><br><span class="line">          有权)</span><br><span class="line">                能迎娶白富美</span><br><span class="line">                ;;</span><br><span class="line">          有才有能力有潜力)</span><br><span class="line">                能找到对象，白不白不一定，富美些许有点够呛</span><br><span class="line">                ;;</span><br><span class="line">          *都不满足)</span><br><span class="line">               研究研究，枕什么样的枕头，可以梦到迎娶白富美吧</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#程序举例</span></span><br><span class="line">请写一个，阿拉伯数字1-10转中文大写的程序，输入1，打印 壹...</span><br><span class="line"></span><br><span class="line">如果要用<span class="keyword">if</span>判断来实现，得写10个判断，这个时候使用<span class="keyword">case</span>就比较舒服。</span><br><span class="line"></span><br><span class="line">还有之前的ansible模块脚本，把<span class="keyword">if</span>判断换成<span class="keyword">case</span>就会很舒服。</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用if</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># cat if.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">num=<span class="variable">$1</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$num</span> -eq 1 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;壹&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$num</span> -eq 2 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;贰&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$num</span> -eq 3 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;叁&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$num</span> -eq 4 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;肆&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$num</span> -eq 5 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;伍&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$num</span> -eq 6 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;陆&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$num</span> -eq 7 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;柒&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$num</span> -eq 8 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;捌&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$num</span> -eq 9 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;玖&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$num</span> -eq 10 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;拾&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&#x27;请输入1-10的数字&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用case</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># cat case.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">num=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$num</span> <span class="keyword">in</span></span><br><span class="line">    1)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&#x27;壹&#x27;</span></span><br><span class="line">      ;;</span><br><span class="line">    2)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&#x27;贰&#x27;</span></span><br><span class="line">      ;;</span><br><span class="line">    3)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&#x27;叁&#x27;</span></span><br><span class="line">      ;;</span><br><span class="line">    4)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&#x27;肆&#x27;</span></span><br><span class="line">      ;;</span><br><span class="line">    5)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&#x27;伍&#x27;</span></span><br><span class="line">      ;;</span><br><span class="line">    6)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&#x27;陆&#x27;</span></span><br><span class="line">      ;;</span><br><span class="line">    7)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&#x27;柒&#x27;</span></span><br><span class="line">      ;;</span><br><span class="line">    8)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&#x27;捌&#x27;</span></span><br><span class="line">      ;;</span><br><span class="line">    9)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&#x27;玖&#x27;</span></span><br><span class="line">      ;;</span><br><span class="line">    10)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&#x27;拾&#x27;</span></span><br><span class="line">      ;;</span><br><span class="line">    *)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&#x27;请输入1-10的数字&#x27;</span></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"> </span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh case.sh 1</span></span><br><span class="line">壹</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh case.sh 2</span></span><br><span class="line">贰</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh case.sh 3</span></span><br><span class="line">叁</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh case.sh 4</span></span><br><span class="line">肆</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh case.sh 5</span></span><br><span class="line">伍</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh case.sh 6</span></span><br><span class="line">陆</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh case.sh 7</span></span><br><span class="line">柒</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh case.sh 8</span></span><br><span class="line">捌</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh case.sh 9</span></span><br><span class="line">玖</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh case.sh 10</span></span><br><span class="line">拾</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh case.sh 11</span></span><br><span class="line">请输入1-10的数字</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sh case.sh 12</span></span><br><span class="line">请输入1-10的数字</span><br></pre></td></tr></table></figure><h2 id="shell中给你点颜色看看"><a href="#shell中给你点颜色看看" class="headerlink" title="shell中给你点颜色看看"></a>shell中给你点颜色看看</h2><p>在我们使用shell的时候，难免会有一些带颜色的需求，比如说，在座的各位都喜欢的黄色，那么我们在shell中，如何给字符串加上自己想要的颜色呢？</p><h3 id="加颜色的固定格式"><a href="#加颜色的固定格式" class="headerlink" title="加颜色的固定格式"></a>加颜色的固定格式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">\e[1;31m 红色的zls\e[0m</span><br><span class="line"> </span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo -e &#x27;\e[1;31m 红色的zls\e[0m&#x27;</span></span><br><span class="line"> 红色的zls</span><br><span class="line"> </span><br><span class="line"> <span class="comment">## 分析</span></span><br><span class="line">1）开头的   \e 或者 \E 或者 \033  表示开始调整颜色</span><br><span class="line"> </span><br><span class="line">2）中括号中的第一个数字 1; 这里代表字体的状态</span><br><span class="line">0：表示正常</span><br><span class="line">1：表示加粗</span><br><span class="line">2：变浅</span><br><span class="line">3：斜体</span><br><span class="line">4：下划线</span><br><span class="line">5：闪烁</span><br><span class="line"> </span><br><span class="line">3）再往后 Nm表示字体颜色</span><br><span class="line">30m：黑色</span><br><span class="line">31m：红色</span><br><span class="line">32m：绿色</span><br><span class="line">33m：黄色</span><br><span class="line">34m：蓝色</span><br><span class="line">35m：紫色</span><br><span class="line">36m：天蓝</span><br><span class="line">37m：白色</span><br><span class="line"> </span><br><span class="line">4）背景颜色</span><br><span class="line">40：黑底</span><br><span class="line">41：红底</span><br><span class="line">42：绿底</span><br><span class="line">43：黄底</span><br><span class="line">44：蓝底</span><br><span class="line">45：紫底</span><br><span class="line">46：天蓝</span><br><span class="line">47：白底</span><br><span class="line"> </span><br><span class="line">例：</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># echo -e &#x27;\e[46;30m 天蓝底黑色的zls\e[0m&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="小练习"><a href="#小练习" class="headerlink" title="小练习"></a>小练习</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装apache和nginx</span></span><br><span class="line"></span><br><span class="line">vim install.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">+---------------+</span></span><br><span class="line"><span class="string">+ |  1.lnmp +   |+</span></span><br><span class="line"><span class="string">+---------------+</span></span><br><span class="line"><span class="string">+ |  2.lnmt +   |+</span></span><br><span class="line"><span class="string">+---------------+</span></span><br><span class="line"><span class="string">+ |  3.lamt +   |+</span></span><br><span class="line"><span class="string">+---------------+</span></span><br><span class="line"><span class="string">+ |  4.lamp +   |+</span></span><br><span class="line"><span class="string">+---------------+</span></span><br><span class="line"><span class="string">+ |  5.nginx +  |+</span></span><br><span class="line"><span class="string">+---------------+</span></span><br><span class="line"><span class="string">+ |  6.apache + |+</span></span><br><span class="line"><span class="string">+---------------+</span></span><br><span class="line"><span class="string">+ |  7.tomcat + |+</span></span><br><span class="line"><span class="string">+---------------+</span></span><br><span class="line"><span class="string">+ |  8.zabbix + |+</span></span><br><span class="line"><span class="string">+---------------+</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="function"><span class="title">check_yum</span></span>()&#123;</span><br><span class="line">        service=<span class="variable">$1</span></span><br><span class="line">        rpm -q <span class="variable">$service</span> &gt;/dev/null</span><br><span class="line">        <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$service</span> 已安装&quot;</span></span><br><span class="line">                <span class="built_in">return</span> 1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">install_yum_pkg</span></span>()&#123;</span><br><span class="line">        check_yum <span class="variable">$1</span></span><br><span class="line">        <span class="keyword">if</span> [ $? -ne 1 ];<span class="keyword">then</span></span><br><span class="line">                yum install -y <span class="variable">$1</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&#x27;请输入数字或者服务名: &#x27;</span> num</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$num</span> == <span class="string">&#x27;6&#x27;</span> -o <span class="variable">$num</span> == <span class="string">&#x27;apache&#x27;</span> ];<span class="keyword">then</span></span><br><span class="line">        install_yum_pkg httpd</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> shell脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>图形化跳板机(11)</title>
      <link href="/2023/01/07/Shell/Day11%E5%9B%BE%E5%BD%A2%E5%8C%96%E8%B7%B3%E6%9D%BF%E6%9C%BA/"/>
      <url>/2023/01/07/Shell/Day11%E5%9B%BE%E5%BD%A2%E5%8C%96%E8%B7%B3%E6%9D%BF%E6%9C%BA/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="图形化跳板机"><a href="#图形化跳板机" class="headerlink" title="图形化跳板机"></a>图形化跳板机</h1><p>whiptail</p><h2 id="消息框"><a href="#消息框" class="headerlink" title="消息框"></a>消息框</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#语法</span></span><br><span class="line">whiptail --title <span class="string">&quot;&lt;标题&gt;&quot;</span> --msgbox <span class="string">&quot;&lt;信息&gt;&quot;</span> &lt;高度&gt; &lt;宽度&gt;</span><br><span class="line"></span><br><span class="line">whiptail --title <span class="string">&quot;跳板机&quot;</span> --msgbox <span class="string">&quot;welcome to jumpserver&quot;</span> 10 60</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--title 指定标题内容</span><br><span class="line">--msgbox 指定信息内容</span><br><span class="line">10 信息框的高度</span><br><span class="line">60 信息框的宽度</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">whiptail --title <span class="string">&quot;<span class="variable">$HOSTNAME</span> DISK INFO&quot;</span> --msgbox <span class="string">&quot;`df -h`&quot;</span> 20 60</span><br><span class="line"></span><br><span class="line">--title 指定标题内容 <span class="string">&quot;<span class="variable">$HOSTNAME</span> DISK INFO&quot;</span></span><br><span class="line">--msgbox 指定信息内容 `<span class="built_in">df</span> -h`</span><br><span class="line">20 信息框的高度</span><br><span class="line">60 信息框的宽度</span><br></pre></td></tr></table></figure><h2 id="布尔值选择"><a href="#布尔值选择" class="headerlink" title="布尔值选择"></a>布尔值选择</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#语法</span></span><br><span class="line">whiptail --title <span class="string">&quot;&lt;标题&gt;&quot;</span> --yesno <span class="string">&quot;&lt;信息&gt;&quot;</span> &lt;高度&gt; &lt;宽度&gt;</span><br><span class="line"></span><br><span class="line">whiptail --title <span class="string">&quot;你确定要这么做吗？&quot;</span> --yesno <span class="string">&quot;请做出你的选择YES or NO !&quot;</span> 10 60</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">whiptail --title <span class="string">&quot;你确定要这么做吗？&quot;</span> --yesno <span class="string">&quot;请做出你的选择YES or NO !&quot;</span> 10 60</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;你输入的是yes&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;你输入的是no&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">whiptail --title <span class="string">&quot;安踏男孩的跳板机-10.0.0.60&quot;</span> --yes-button <span class="string">&quot;运维&quot;</span> --no-button <span class="string">&quot;开发&quot;</span> --yesno <span class="string">&quot;请选择你在公司的职位是?&quot;</span> 10 60</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;运维部门&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;开发部门&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h2 id="交互式输入框"><a href="#交互式输入框" class="headerlink" title="交互式输入框"></a>交互式输入框</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#语法</span></span><br><span class="line">whiptail --title <span class="string">&quot;&lt;标题&gt;&quot;</span> --inputbox <span class="string">&quot;&lt;信息&gt;&quot;</span> &lt;高度&gt; &lt;宽度&gt; &lt;默认值&gt;</span><br><span class="line"></span><br><span class="line">whiptail --title <span class="string">&quot;曾老湿跳板机-10.0.0.61&quot;</span> --inputbox <span class="string">&quot;请输入一个文件名路径：&quot;</span> 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">whiptail --title <span class="string">&quot;曾老湿跳板机-10.0.0.61&quot;</span> --inputbox <span class="string">&quot;请输入一个文件名路径 ：&quot;</span> 10 60 /etc/passwd 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#实践</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">source_file=`whiptail --title <span class="string">&quot;曾老湿跳板机-10.0.0.61&quot;</span> --inputbox <span class="string">&quot;请输入一个文件名路径 ：&quot;</span> 10 60 /etc/passwd 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3`</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">dest_file=`whiptail --title <span class="string">&quot;曾老湿跳板机-10.0.0.61&quot;</span> --inputbox <span class="string">&quot;请输入一个对端路径 ：&quot;</span> 10 60 /etc/passwd 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3`</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">scp <span class="variable">$source_file</span> 172.16.1.7:<span class="variable">$dest_file</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;请输入一个目标路径&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;请输入一个源文件路径&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h2 id="密码输入框"><a href="#密码输入框" class="headerlink" title="密码输入框"></a>密码输入框</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#语法</span></span><br><span class="line">PASSWD=$(whiptail --title <span class="string">&quot;安踏男孩跳板机&quot;</span> --passwordbox <span class="string">&quot;请输入一个密码名路径: &quot;</span> 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">PASSWD=$(whiptail --title <span class="string">&quot;安踏男孩跳板机&quot;</span> --passwordbox <span class="string">&quot;请输入一个密码名</span></span><br><span class="line"><span class="string">路径: &quot;</span> 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class="line"><span class="comment">#echo $PASSWD</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="variable">$PASSWD</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;密码为空&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;密码是: <span class="variable">$PASSWD</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#优化</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">PASSWD=$(whiptail --title <span class="string">&quot;安踏男孩跳板机&quot;</span> --passwordbox <span class="string">&quot;请输入一个密码名路径: &quot;</span> 10 60 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$&#123;#PASSWD&#125;</span> -eq 0  ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;密码为空&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;密码是: <span class="variable">$PASSWD</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;选择了取消&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h2 id="菜单栏"><a href="#菜单栏" class="headerlink" title="菜单栏"></a>菜单栏</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#语法</span></span><br><span class="line">OPTION=$(whiptail --title <span class="string">&quot;曾老湿跳板机-10.0.0.61&quot;</span> --menu <span class="string">&quot;根据菜单选吧老弟&quot;</span> 30 60 4 \</span><br><span class="line"><span class="string">&quot;1&quot;</span> <span class="string">&quot;lb01&quot;</span> \</span><br><span class="line"><span class="string">&quot;2&quot;</span> <span class="string">&quot;lb02&quot;</span> \</span><br><span class="line"><span class="string">&quot;3&quot;</span> <span class="string">&quot;web01&quot;</span> \</span><br><span class="line"><span class="string">&quot;4&quot;</span> <span class="string">&quot;web02&quot;</span> \</span><br><span class="line"><span class="string">&quot;5&quot;</span> <span class="string">&quot;web03&quot;</span> 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class="line"></span><br><span class="line">--menu 菜单栏</span><br><span class="line">30 高度</span><br><span class="line">60 宽</span><br><span class="line">4 菜单显示几行内容</span><br><span class="line"></span><br><span class="line"><span class="comment">#返回值</span></span><br><span class="line">选择ok 0</span><br><span class="line">选择cancel 1</span><br><span class="line"></span><br><span class="line"><span class="comment">#实践</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">OPTION=$(whiptail --title <span class="string">&quot;曾老湿跳板机-10.0.0.61&quot;</span> --menu <span class="string">&quot;根据菜单选吧老弟&quot;</span> 30 60 4 \</span><br><span class="line"><span class="string">&quot;1&quot;</span> <span class="string">&quot;lb01&quot;</span> \</span><br><span class="line"><span class="string">&quot;2&quot;</span> <span class="string">&quot;lb02&quot;</span> \</span><br><span class="line"><span class="string">&quot;3&quot;</span> <span class="string">&quot;web01&quot;</span> \</span><br><span class="line"><span class="string">&quot;4&quot;</span> <span class="string">&quot;web02&quot;</span> \</span><br><span class="line"><span class="string">&quot;5&quot;</span> <span class="string">&quot;web03&quot;</span> 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$OPTION</span> <span class="keyword">in</span></span><br><span class="line">1)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;连接到lb01&quot;</span></span><br><span class="line">;;</span><br><span class="line">3)</span><br><span class="line">ssh 172.16.1.7</span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;选择了退出&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="单选框"><a href="#单选框" class="headerlink" title="单选框"></a>单选框</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#语法</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">DISTROS=$(whiptail --title <span class="string">&quot;安踏男孩跳板机&quot;</span> --radiolist \</span><br><span class="line"><span class="string">&quot;请在下面内容选择一项，上下左右移动，空格选中&quot;</span> 10 60 4 \</span><br><span class="line"><span class="string">&quot;send&quot;</span> <span class="string">&quot;发送文件&quot;</span> ON \</span><br><span class="line"><span class="string">&quot;useradd&quot;</span> <span class="string">&quot;创建用户&quot;</span> OFF \</span><br><span class="line"><span class="string">&quot;ssh&quot;</span> <span class="string">&quot;远程连接&quot;</span> OFF \</span><br><span class="line"><span class="string">&quot;mem&quot;</span> <span class="string">&quot;查看内存&quot;</span> OFF 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class="line"></span><br><span class="line"><span class="comment">#实践</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">send</span></span>()&#123;</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;执行send函数&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">DISTROS=$(whiptail --title <span class="string">&quot;安踏男孩跳板机&quot;</span> --radiolist \</span><br><span class="line"><span class="string">&quot;请在下面内容选择一项，上下左右移动，空格选中&quot;</span> 10 60 4 \</span><br><span class="line"><span class="string">&quot;send&quot;</span> <span class="string">&quot;发送文件&quot;</span> ON \</span><br><span class="line"><span class="string">&quot;useradd&quot;</span> <span class="string">&quot;创建用户&quot;</span> OFF \</span><br><span class="line"><span class="string">&quot;ssh&quot;</span> <span class="string">&quot;远程连接&quot;</span> OFF \</span><br><span class="line"><span class="string">&quot;mem&quot;</span> <span class="string">&quot;查看内存&quot;</span> OFF 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3)</span><br><span class="line"><span class="variable">$DISIROS</span></span><br></pre></td></tr></table></figure><h2 id="多选框"><a href="#多选框" class="headerlink" title="多选框"></a>多选框</h2><h2 id="进度条"><a href="#进度条" class="headerlink" title="进度条"></a>进度条</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#语法</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> ((i = <span class="number">0</span> ; i &lt;= <span class="number">100</span> ; i+=<span class="number">20</span>)); <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">sleep</span> 1</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125; | whiptail --gauge <span class="string">&quot;等一下，在加载&quot;</span> 6 60 0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> shell脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux正则表达式(12.1)</title>
      <link href="/2023/01/07/Shell/Day12.1%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
      <url>/2023/01/07/Shell/Day12.1%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>TOC]</p><h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#正则历史</span></span><br><span class="line">正则表达式，简写：re，全拼：（regular expression） 在某些地区，管它叫做，正规表达式、规则表达式</span><br><span class="line">正则表达式的<span class="string">&quot;祖先&quot;</span>可以一直上溯至对人类神经系统如何工作的早期研究。Warren McCulloch 和 Walter Pitts 这两</span><br><span class="line">位神经生理学家研究出一种数学方式来描述这些神经网络。</span><br><span class="line">1956 年, 一位叫 Stephen Kleene 的数学家在 McCulloch 和 Pitts 早期工作的基础上，发表了一篇标题为<span class="string">&quot;神经网事</span></span><br><span class="line"><span class="string">件的表示法&quot;</span>的论文，引入了正则表达式的概念。正则表达式就是用来描述他称为<span class="string">&quot;正则集的代数&quot;</span>的表达式，因此采</span><br><span class="line">用<span class="string">&quot;正则表达式&quot;</span>这个术语。</span><br><span class="line">随后，发现可以将这一工作应用于使用 Ken Thompson 的计算搜索算法的一些早期研究，Ken Thompson 是 Unix</span><br><span class="line">的主要发明人。正则表达式的第一个实用应用程序就是 Unix 中的 qed 编辑器。</span><br><span class="line">如他们所说，剩下的就是众所周知的历史了。从那时起直至现在正则表达式都是基于文本的编辑器和搜索工具中的一</span><br><span class="line">个重要部分。</span><br></pre></td></tr></table></figure><h2 id="正则和通配符"><a href="#正则和通配符" class="headerlink" title="正则和通配符"></a>正则和通配符</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通配符</span></span><br><span class="line"><span class="built_in">ls</span> /*</span><br><span class="line">根下所有文件</span><br><span class="line"><span class="comment">#正则</span></span><br><span class="line">*</span><br><span class="line">前面的字符出现0次或者多次</span><br></pre></td></tr></table></figure><h2 id="为什么使用正则"><a href="#为什么使用正则" class="headerlink" title="为什么使用正则"></a>为什么使用正则</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.方便处理文本和字符串内容</span><br><span class="line">2.处理有规律的内容（手机号，身份证等等有规律的内容）</span><br><span class="line">3.正则一般给高级的开发语言使用</span><br><span class="line">python</span><br><span class="line">GO</span><br><span class="line">C++</span><br><span class="line">JAVA</span><br><span class="line">awk和sed</span><br><span class="line">搜索和替换操作 但是一般的命令，搜索和替换缺乏灵活性，基本写死。 所以我们可以通过正则表达式，灵活的动态</span><br><span class="line">匹配文本。</span><br><span class="line">例如： 1.可以测试输入字符串 以查看字符串内是否出现电话号码模式或信用卡号码模式。这称为数据验证。</span><br><span class="line">2.替换文本。 可以使用正则表达式来识别文档中的特定文本，完全删除该文本或者用其他文本替换它。</span><br><span class="line">3.基于模式匹配从字符串中提取子字符串。</span><br><span class="line">4.查找文档内或输入域内特定的文本。</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在开发里</span></span><br><span class="line">，回车和换行符是两码事</span><br><span class="line"></span><br><span class="line">\r 回车</span><br><span class="line">\n 换行</span><br></pre></td></tr></table></figure><h2 id="正则表达式在linux中的分类"><a href="#正则表达式在linux中的分类" class="headerlink" title="正则表达式在linux中的分类"></a>正则表达式在linux中的分类</h2><p>在正则表达式的语法中，主要有两个部分修饰符和元字符。 修饰符，我们在后面介绍，它主要不写在正则中，要写<br>在正则的外面。 元字符，在Linux中会把这些符号区分开，划分为基础正则和扩展正则<br>所谓的扩展正则其实也是元字符中的一部分，只不过在linux中，有些命令不能直接使用某些元字符，需要用一些参<br>数，才能使用。所以被一部分人称之为扩展正则<br>那么我们先简单介绍一下，这个分类，然后再总的来介绍所有修饰符和元字符。</p><h2 id="基础正则-（bre-basicc-regular-expression）"><a href="#基础正则-（bre-basicc-regular-expression）" class="headerlink" title="基础正则  （bre basicc regular expression）"></a>基础正则  （bre basicc regular expression）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">^ 以什么什么开头</span><br><span class="line">$ 以什么什么结尾</span><br><span class="line">. 任意字符</span><br><span class="line">* 前面的字符出现0次或者多次</span><br><span class="line"><span class="comment"># .* 配合使用</span></span><br><span class="line">[] 主要是一些范围 [0-9] [a-z]</span><br><span class="line">[^] 取反</span><br><span class="line">^[0-9]</span><br><span class="line">^[a-z]</span><br><span class="line">.......</span><br></pre></td></tr></table></figure><h2 id="拓展正则-（ere-extended-rugular-expression）"><a href="#拓展正则-（ere-extended-rugular-expression）" class="headerlink" title="拓展正则  （ere extended rugular expression）"></a>拓展正则  （ere extended rugular expression）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 比较常见的</span></span><br><span class="line">+ 前面的一个字符出现一次或者多次</span><br><span class="line">ifconfig eth0 | awk <span class="string">&#x27;NR==2&#123;print $2&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> 1.txt | awk -F <span class="string">&#x27;[ :]+&#x27;</span> <span class="string">&#x27;&#123;print $5&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> 1.txt </span><br><span class="line">qqq asadsad 12:as 111 dsfj</span><br><span class="line">  0 ? 21:17:32 root@web01,172.16.1.7:~ <span class="comment"># cat 1.txt | awk &#x27;&#123;print $4&#125;&#x27;</span></span><br><span class="line">111</span><br><span class="line"></span><br><span class="line"><span class="comment">## 贪婪匹配</span></span><br><span class="line">[ :]+ 里面的任意字符出现一次或者多次</span><br><span class="line">即使是这两个一起出现也会识别成一个</span><br><span class="line"></span><br><span class="line">| 或者的意思</span><br><span class="line">（） 被括起来的内容提供看做是一个整体</span><br><span class="line">也可以在sed命令中后项引用</span><br><span class="line">&#123;&#125; 中间写一个非负整数，表示大括号前面的内容出现指定次数</span><br><span class="line">比如匹配<span class="built_in">id</span></span><br><span class="line">[0-9].*</span><br><span class="line">[0-9]+</span><br><span class="line"> ✓ 21:30:38 root@web01,172.16.1.7:~ <span class="comment"># cat 1.txt </span></span><br><span class="line">qqq sdfsdfs 123:asdasda:;;:::::: 123 asd</span><br><span class="line">  0 ✓ 21:30:41 root@web01,172.16.1.7:~ <span class="comment"># cat 1.txt |awk -F &#x27;[ :]+&#x27; &#x27;&#123;print $5&#125;&#x27;</span></span><br><span class="line">;;</span><br><span class="line">grep -E <span class="string">&#x27;z&#123;3&#125;&#x27;</span></span><br><span class="line">grep -E <span class="string">&#x27;z&#123;1,3&#125;&#x27;</span></span><br><span class="line">? 前面的内容出现0次或者多次</span><br><span class="line">grep -E <span class="string">&#x27;z?&#x27;</span> 出现0次也行</span><br><span class="line">grep -E <span class="string">&#x27;z+&#x27;</span> 最少出现一次</span><br></pre></td></tr></table></figure><h2 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* 代表所有内容</span><br><span class="line">&#123;&#125;生成序列</span><br><span class="line"><span class="built_in">echo</span> &#123;1..10&#125;</span><br><span class="line"><span class="built_in">echo</span> &#123;1..10..2&#125;</span><br><span class="line"><span class="built_in">cp</span> /usr/lib/systemd/system/nginx.service&#123;,.bak&#125;</span><br><span class="line">?匹配任意一个字符</span><br><span class="line"><span class="built_in">touch</span> check_1.txt</span><br><span class="line"><span class="built_in">ls</span> -l /tmp/c?eck_?*</span><br><span class="line"><span class="built_in">ls</span> -l /tmp/???????????</span><br><span class="line"></span><br><span class="line">[] 和正则一样</span><br></pre></td></tr></table></figure><h2 id="正则表达式使用注意事项"><a href="#正则表达式使用注意事项" class="headerlink" title="正则表达式使用注意事项"></a>正则表达式使用注意事项</h2><p>1.所有符号皆为英文符号<br>2.使用三剑客时加引号<br>3.注意字符集，如果出现字符集问题，那么将字符集修改为C（小概率事件）<br>4.像素眼（空格，换行符，tab键）<br>5.测试的时候，推荐使用grep -E或者egrep，因为过滤出来的内容会加颜色</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> /tmp/check&#123;1..10&#125;.txt</span><br><span class="line">check10.txt</span><br><span class="line">check1.txt</span><br><span class="line">check 2.txt</span><br><span class="line">check 3.txt</span><br><span class="line">check4.txt</span><br><span class="line">check5.txt</span><br><span class="line">check6.txt</span><br><span class="line">check7.txt</span><br><span class="line">check8.txt</span><br><span class="line">check9.txt</span><br><span class="line"><span class="built_in">ls</span> -l check[0-9].txt</span><br><span class="line"><span class="built_in">ls</span> -l check[0-9][0-9].txt</span><br><span class="line"><span class="built_in">cat</span> 1.txt | awk <span class="string">&#x27;/\t/&#123;print&#125;</span></span><br><span class="line"><span class="string">check 3.txt</span></span><br><span class="line"><span class="string">cat 1.txt | awk &#x27;</span>/ /&#123;<span class="built_in">print</span>&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">check 2.txt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0 ✓ 12:01:14 root@web01,172.16.1.7:~ # cat -T a.sh</span></span><br><span class="line"><span class="string">check1.txt</span></span><br><span class="line"><span class="string">check 2.txt</span></span><br><span class="line"><span class="string">check   3.txt</span></span><br><span class="line"><span class="string">check^I4.txt</span></span><br><span class="line"><span class="string">check^I5.txt</span></span><br><span class="line"><span class="string">check6.txt</span></span><br><span class="line"><span class="string">check7.txt</span></span><br><span class="line"><span class="string">check8.txt</span></span><br><span class="line"><span class="string">check9.txt</span></span><br><span class="line"><span class="string">check10.txt</span></span><br><span class="line"><span class="string">cat -T a.sh | grep &#x27;</span>\^I<span class="string">&#x27;</span></span><br><span class="line"><span class="string">check^I4.txt</span></span><br><span class="line"><span class="string">check^I5.txt</span></span><br><span class="line"><span class="string">cat a.sh | awk &#x27;</span>/\t/&#123;<span class="built_in">print</span>&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">check4.txt</span></span><br><span class="line"><span class="string">check5.txt</span></span><br><span class="line"><span class="string">cat a.sh | awk &#x27;</span>/\ /&#123;<span class="built_in">print</span>&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">check 2.txt</span></span><br><span class="line"><span class="string">check   3.txt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">cat /etc/passwd | grep -E &#x27;</span>root|nginx<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">egrep &#x27;</span>root|nginx<span class="string">&#x27; /etc/passwd</span></span><br><span class="line"><span class="string">#egrep=grep -E</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#. 匹配任意字符</span></span><br><span class="line"><span class="string">.* 匹配任意字符的文件</span></span><br><span class="line"><span class="string">grep -o &#x27;</span>.*<span class="string">&#x27; /etc/passwd</span></span><br><span class="line"><span class="string">grep -o &#x27;</span>.<span class="string">&#x27; /etc/passwd</span></span><br><span class="line"><span class="string">#tab</span></span><br><span class="line"><span class="string">\t</span></span><br></pre></td></tr></table></figure><h2 id="正则表达式的修饰符"><a href="#正则表达式的修饰符" class="headerlink" title="正则表达式的修饰符"></a>正则表达式的修饰符</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s<span class="comment">#匹配内容#要替换的内容#g</span></span><br><span class="line">sed -i <span class="string">&#x27;s#查找的内容#替换的内容#g&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230522092226463.png" alt="image-20230522092226463"></p>]]></content>
      
      
      <categories>
          
          <category> shell脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux三剑客(13)</title>
      <link href="/2023/01/07/Shell/Day13linux%E4%B8%89%E5%89%91%E5%AE%A2/"/>
      <url>/2023/01/07/Shell/Day13linux%E4%B8%89%E5%89%91%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="linux三剑客"><a href="#linux三剑客" class="headerlink" title="linux三剑客"></a>linux三剑客</h1><p>Linux三剑客是指的grep、sed、awk三个命令，<strong>grep主打查找功能</strong>，<strong>sed主要是编辑</strong>，<strong>awk主要是分割处理</strong>。</p><h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#grep</span></span><br><span class="line">grep是global regular expressions <span class="built_in">print</span>的缩写。grep命令能够在一个或者多个文件中搜索某一特定的字符模式，此模式可以是单一的字符、字符串、单词或句子。grep可以在文本中查找指定的字符串，是linux中最常用的文本处理工具之一。</span><br><span class="line">正则表达式的通配符如下：</span><br><span class="line"></span><br><span class="line">* ： 将匹配0个或者多个字符。</span><br><span class="line">. ：将匹配任何一个字符，且只能是一个字符。</span><br><span class="line">[xyz] ：匹配方括号中的任意一个字符。</span><br><span class="line">[^xyz]：匹配方括号中的任意一个字符。</span><br><span class="line">^ ： 锁定行的开头。</span><br><span class="line">$ ：锁定行的结尾。</span><br><span class="line">? ：匹配前面的子表达式0次或者1次。</span><br><span class="line">+ ：匹配前面的子表达式1次或者多次。</span><br><span class="line">| ： 匹配于|符号前或后的正则表达式。</span><br><span class="line">&#123;n,m&#125; ：最少匹配n次，最多匹配m次和BRE的区别是不需要加\。</span><br><span class="line">在基本的正则表达式中，使用通配符原本的意思，需要添加\作为转义字符。</span><br><span class="line"></span><br><span class="line"><span class="comment">#grep命令用来在每一个文件搜索特定的模式，当使用grep时，包含指定字符模式的每一行内容，都会被打印到屏幕上，但是使用grep命令并不改变文件中的内容。</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">grep命令格式：grep [选项] 模式 文件名</span><br><span class="line">这里的模式，要么是字符串，要么是正则表达式。常用的选项如下表。</span><br><span class="line"></span><br><span class="line">-E 支持拓展正则</span><br><span class="line">-o 仅显示过滤内容</span><br><span class="line">-w 精确匹配</span><br><span class="line">-n 行号</span><br><span class="line">-v 取反</span><br><span class="line">-q 静默</span><br><span class="line">-c 统计匹配的行数</span><br><span class="line">-A after 打印过滤内容的后N行</span><br><span class="line">-B before 打印过滤内容的前N行</span><br><span class="line">-C center 打印过滤内容前后N行</span><br><span class="line">-G：支持基础正则</span><br><span class="line">-p 支持支持prel正则</span><br><span class="line">-i 忽略大小写</span><br><span class="line">-r 递归检索文件</span><br><span class="line">-l 只显示文件名</span><br><span class="line">-f 比较文件内容</span><br><span class="line"><span class="comment">#如果是搜索多个文件，grep命令的搜索结果只显示文件中发现匹配模式的文件名，如果搜索单个文件，grep命令的结果将显示每一个包含匹配模式的行。</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#实践</span></span><br><span class="line">grep -E <span class="string">&#x27;root|nginx&#x27;</span> /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">nginx1:x:1001:1001::/home/nginx1:/bin/bash</span><br><span class="line">nginx2:x:1002:1002::/home/nginx2:/bin/bash</span><br><span class="line">nginx3:x:1003:1003::/home/nginx3:/bin/bash</span><br><span class="line">nginx4:x:1004:1004::/home/nginx4:/bin/bash</span><br><span class="line">grep -o <span class="string">&#x27;nginx&#x27;</span> /etc/passwd</span><br><span class="line">nginx</span><br><span class="line">nginx</span><br><span class="line">nginx</span><br><span class="line">nginx</span><br><span class="line">nginx</span><br><span class="line">grep -w <span class="string">&#x27;nginx&#x27;</span> /etc/passwd</span><br><span class="line">nginx:x:998:996:Nginx web server:/var/lib/nginx:/sbin/nologin</span><br><span class="line">grep -nw <span class="string">&#x27;nginx&#x27;</span> /etc/passwd</span><br><span class="line">29:nginx:x:998:996:Nginx web server:/var/lib/nginx:/sbin/nologin</span><br><span class="line">grep <span class="string">&#x27;nginx&#x27;</span> /etc/passwd | <span class="built_in">wc</span> -l</span><br><span class="line">5</span><br><span class="line">grep <span class="string">&#x27;nginx&#x27;</span> /etc/passwd -c</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line"><span class="built_in">touch</span> css/style.ss</span><br><span class="line"><span class="built_in">touch</span> js/main.js</span><br><span class="line"><span class="built_in">touch</span> index.html</span><br><span class="line"><span class="built_in">cat</span> css/style.css </span><br><span class="line">www.baidu.com</span><br><span class="line"><span class="built_in">cat</span> js/main.js </span><br><span class="line">www.baidu.com</span><br><span class="line">man.baidu.com</span><br><span class="line"><span class="built_in">cat</span> index.html </span><br><span class="line">www.baidu.com</span><br><span class="line">map.baidu.com</span><br><span class="line">fanyi.baidu.com</span><br><span class="line"><span class="comment"># baidu改成xxx</span></span><br><span class="line">grep -r <span class="string">&#x27;www.xxx.com&#x27;</span> ./</span><br><span class="line">./css/style.css:www.xxx.com</span><br><span class="line">./js/main.js:www.xxx.com</span><br><span class="line">./index.html:www.xxx.com</span><br><span class="line">grep -lr <span class="string">&#x27;www.xxx.com&#x27;</span> ./</span><br><span class="line">./css/style.css</span><br><span class="line">./js/main.js</span><br><span class="line">./index.html</span><br><span class="line"><span class="comment">#改回来</span></span><br><span class="line">grep -lr <span class="string">&#x27;www.xxx.com&#x27;</span> ./ |xargs sed -i <span class="string">&#x27;s#www.xxx.com#www.baidu.com#g&#x27;</span></span><br><span class="line">grep -vf 2.txt 1.txt</span><br><span class="line"><span class="built_in">cat</span> 1.txt</span><br><span class="line">123</span><br><span class="line">456</span><br><span class="line"><span class="built_in">cat</span> 2.txt</span><br><span class="line">123</span><br></pre></td></tr></table></figure><h2 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h2><h3 id="sed原理"><a href="#sed原理" class="headerlink" title="sed原理"></a>sed原理</h3><p>sed是一种<strong>流编辑器</strong>，流编辑器会在编辑器处理数据之前基于预先提供一组规则来编辑数据流。<strong>sed编辑器可以根据命令来处理数据流中的数据</strong>，这些命令要么从命令行中输入，要么存储在一个命令文本中。</p><p>sed是操作、过滤和转换文本内容的强大工具，常用功能<strong>增删改查</strong>，<strong>过滤</strong>，<strong>取行</strong>。</p><p>sed命令的格式如下：<code>sed [options] [sed-commands] [input-file]</code></p><h3 id="sed的执行流程"><a href="#sed的执行流程" class="headerlink" title="sed的执行流程"></a>sed的执行流程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;3p&#x27;</span> zls.txt</span><br><span class="line"></span><br><span class="line">1.sed先是按行读取文件内容 2.每读取一行内容，都会进行一次判断，是不是你想要的行 3.如果不是，则判断是不是</span><br><span class="line">加了-n选项 4.如果加了-n，就读取下一行 5.如果没加-n，就会将所有内容输出到命令行（默认输出） 6.如果是，你想</span><br><span class="line">要的那一行（第三行）则判断执行的后续动作（p d s a i c） 7.动作处理完成后，输出指定的内容 8.即便是读取完</span><br><span class="line">了，内容也输出了，sed也会继续往后读，直到文件的最后一行</span><br></pre></td></tr></table></figure><h3 id="sed命令-查"><a href="#sed命令-查" class="headerlink" title="sed命令-查"></a>sed命令-查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#p 动作 打印</span></span><br><span class="line">p：<span class="built_in">print</span> 打印/显示</span><br><span class="line">-n：取消默认输出</span><br><span class="line">1,zls,666</span><br><span class="line">2,wls,777</span><br><span class="line">3,cls,888</span><br><span class="line">4,lls,999</span><br><span class="line">sed -n <span class="string">&#x27;3p&#x27;</span> zls.txt</span><br><span class="line">3,cls,888</span><br><span class="line">sed  <span class="string">&#x27;3p&#x27;</span> zls.txt</span><br><span class="line">1,zls,666</span><br><span class="line">2,wls,777</span><br><span class="line">3,cls,888</span><br><span class="line">3,cls,888</span><br><span class="line">4,lls,999</span><br><span class="line"></span><br><span class="line"><span class="comment">## 显示文件1-3行</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sed -n &#x27;1,3p&#x27; zls.txt</span></span><br><span class="line">1,zls,666</span><br><span class="line">2,wls,777</span><br><span class="line">3,cls,888</span><br><span class="line"><span class="comment">## sed模糊查询</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sed -n &#x27;/zls/p&#x27; zls.txt</span></span><br><span class="line">1,zls,666</span><br><span class="line"><span class="comment">## 使用正则模糊查询</span></span><br><span class="line"><span class="comment">#如果直接这么写，就凉了，需要让sed支持扩展正则</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sed -n &#x27;/zls|cls/p&#x27; zls.txt</span></span><br><span class="line">-r：支持扩展正则</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sed -nr &#x27;/zls|cls/p&#x27; zls.txt</span></span><br><span class="line">1,zls,666</span><br><span class="line">3,cls,888</span><br><span class="line"><span class="comment">## 过滤日志，12点-15点的内容：范围查询（不能按行号）</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sed -nr &#x27;/12:00/,/15:00/p&#x27; access.log</span></span><br><span class="line"><span class="comment">## 打印指定内容及后n行 类似 grep -A</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sed -nr &#x27;/zls/,+5p&#x27; access.log</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sed -nr &#x27;3,+5p&#x27; access.log</span></span><br><span class="line"><span class="comment">## 模拟seq 1 2 10，读一行隔一行在读一行</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sed -n &#x27;1~2p&#x27; zls.txt</span></span><br><span class="line">1,zls,666</span><br><span class="line">3,cls,888</span><br><span class="line"><span class="comment">## 排除，取反显示</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sed -n &#x27;/zls/p&#x27; zls.txt</span></span><br><span class="line">1,zls,666</span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sed -n &#x27;/zls/!p&#x27; zls.txt</span></span><br><span class="line">2,wls,777</span><br><span class="line">3,cls,888</span><br><span class="line">4,lls,999</span><br></pre></td></tr></table></figure><h3 id="sed-删"><a href="#sed-删" class="headerlink" title="sed-删"></a>sed-删</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">d delete</span><br><span class="line">d：delete</span><br><span class="line">将上面的p换成d就是删除,不影响源文件</span><br><span class="line"><span class="comment">## 删除第一行</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sed &#x27;1d&#x27; zls.txt</span></span><br><span class="line">2,wls,777</span><br><span class="line">3,cls,888</span><br><span class="line">4,lls,999</span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除最后一行</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sed &#x27;$d&#x27; zls.txt</span></span><br><span class="line">1,zls,666</span><br><span class="line">2,wls,777</span><br><span class="line">3,cls,888</span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除文件中，从包含cls的行，到最后一行</span></span><br><span class="line">[root@zabbix01 ~]<span class="comment"># sed &#x27;/cls/,$d&#x27; zls.txt</span></span><br><span class="line">1,zls,666</span><br><span class="line">2,wls,777</span><br></pre></td></tr></table></figure><h3 id="sed-增"><a href="#sed-增" class="headerlink" title="sed-增"></a>sed-增</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#c:replace 替换整行内容</span></span><br><span class="line">sed <span class="string">&#x27;1cwww.xxx.com&#x27;</span> zls.txt </span><br><span class="line">www.xxx.com</span><br><span class="line">2,wls,777</span><br><span class="line">3,cls,888</span><br><span class="line">4,lls,999</span><br><span class="line"></span><br><span class="line"><span class="comment">#a:append 追加</span></span><br><span class="line">sed <span class="string">&#x27;$a5,liqi,111&#x27;</span> zls.txt </span><br><span class="line">1,zls,666</span><br><span class="line">2,wls,777</span><br><span class="line">3,cls,888</span><br><span class="line">4,lls,999</span><br><span class="line">5,liqi,111</span><br><span class="line"></span><br><span class="line"><span class="comment">#i:insert在前面插入</span></span><br><span class="line">sed <span class="string">&#x27;1iwww.xxx.com&#x27;</span> zls.txt </span><br><span class="line">www.xxx.com</span><br><span class="line">1,zls,666</span><br><span class="line">2,wls,777</span><br><span class="line">3,cls,888</span><br><span class="line">4,lls,999</span><br></pre></td></tr></table></figure><h3 id="sed-改"><a href="#sed-改" class="headerlink" title="sed-改"></a>sed-改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">s : substitute 替换</span><br><span class="line">g ：global 全局</span><br><span class="line"><span class="comment"># 基础用法</span></span><br><span class="line">sed <span class="string">&#x27;s#wls#qqq#g&#x27;</span> zls.txt </span><br><span class="line">1,zls,666</span><br><span class="line">2,qqq,777</span><br><span class="line">3,cls,888</span><br><span class="line">4,lls,999</span><br><span class="line">sed <span class="string">&#x27;s#[0-9]#666#g&#x27;</span> zls.txt </span><br><span class="line">666,zls,666666666</span><br><span class="line">666,wls,666666666</span><br><span class="line">666,cls,666666666</span><br><span class="line">666,lls,666666666</span><br><span class="line"><span class="comment">#截取ip 后向引用</span></span><br><span class="line">ifconfig eth0</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 10.0.0.7  netmask 255.255.255.0  broadcast 10.0.0.255</span><br><span class="line">        inet6 fe80::20c:29ff:fe31:c611  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:31:c6:11  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 11597  bytes 3408365 (3.2 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 7349  bytes 726871 (709.8 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">ifconfig eth0 | sed -nr <span class="string">&#x27;s#^.*inet (.*) net.*$#\1#gp&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> shell脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux三剑客-awk(14)</title>
      <link href="/2023/01/07/Shell/Day14linux-awk/"/>
      <url>/2023/01/07/Shell/Day14linux-awk/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h1><h2 id="awk原理概述"><a href="#awk原理概述" class="headerlink" title="awk原理概述"></a>awk原理概述</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">awk原理</span><br><span class="line">awk是一个强大的文本分析工具，相对于grep的查找，sed的编辑，awk在其对数据进行分析并产生报告时，显得尤为强大。简单的说就是把文件逐行的读入，以空格为默认分隔符将每行切片，切开的部分在进行各种分析处理。</span><br><span class="line"></span><br><span class="line">awk概述</span><br><span class="line">awk 不是一个命令，是一门语言。</span><br><span class="line">awk 又叫做GNU awk，gawk</span><br><span class="line">ll -s /usr/bin/awk </span><br><span class="line"><span class="comment">#-F:指定分隔符</span></span><br><span class="line">awk -F <span class="string">&#x27;&#123;print&#125;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span> 变量</span><br><span class="line"><span class="string">&quot;&quot;</span> 是输出字母的</span><br><span class="line">&#123;&#125;必须使用单引号</span><br><span class="line"><span class="comment">#注意：awk输出变量使用单引号 bash输出变量使用双引号</span></span><br><span class="line"><span class="built_in">cat</span> zls.txt | awk -F <span class="string">&#x27;,&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line"><span class="built_in">cat</span> zls.txt | awk -F <span class="string">&#x27;,&#x27;</span> <span class="string">&#x27;&#123;print &quot;qqq&quot;&#125;&#x27;</span></span><br><span class="line">qqq</span><br><span class="line">qqq</span><br><span class="line">qqq</span><br><span class="line">qqq</span><br></pre></td></tr></table></figure><h2 id="awk的执行流程"><a href="#awk的执行流程" class="headerlink" title="awk的执行流程"></a>awk的执行流程</h2><ul><li><p>读取文件之前</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BEGIN&#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>读取文件时</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure><ul><li><p>读取文件之后</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">END&#123;&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">1.读取文件时一行一行去读,前提后面要有文件,文件有几行就输出几行</span><br><span class="line">读取一行后，判断是否满足条件，如果是就执行相对应的动作</span><br><span class="line">&#123;<span class="built_in">print</span> <span class="variable">$1</span>&#125;</span><br><span class="line">BEGIN 写一些操作，接下来干什么</span><br><span class="line">&#123;&#125; 中间读取文件</span><br><span class="line">END 做分析，把最后的结果从END里输出出来</span><br><span class="line"><span class="comment">#读取文件时</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print 1/3&#125;&#x27;</span> zls.txt </span><br><span class="line">0.333333</span><br><span class="line">0.333333</span><br><span class="line">0.333333</span><br><span class="line">0.333333</span><br><span class="line"><span class="comment">#读取文件前</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print 1/3&#125;&#x27;</span> zls.txt </span><br><span class="line">0.333333</span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print 1/3&#125;&#x27;</span></span><br><span class="line">0.333333</span><br><span class="line"><span class="comment">#读取文件之后</span></span><br><span class="line">awk <span class="string">&#x27;END&#123;print 1/3&#125;&#x27;</span> zls.txt </span><br><span class="line">0.333333</span><br><span class="line"></span><br><span class="line">awk -F: <span class="string">&#x27;BEGIN&#123;print &quot;name&quot;,&quot;uid&quot;&#125;&#123;print $1,$3&#125;END&#123;print &quot;文件处理完成&quot;&#125;&#x27;</span> /etc/passwd |column -t</span><br><span class="line">name             uid</span><br><span class="line">root             0</span><br><span class="line">bin              1</span><br><span class="line">daemon           2</span><br><span class="line">adm              3</span><br><span class="line">lp               4</span><br><span class="line"><span class="built_in">sync</span>             5</span><br><span class="line">shutdown         6</span><br><span class="line">halt             7</span><br><span class="line">mail             8</span><br><span class="line">operator         11</span><br><span class="line">games            12</span><br><span class="line">ftp              14</span><br><span class="line">nobody           99</span><br><span class="line">systemd-network  192</span><br><span class="line">dbus             81</span><br><span class="line">polkitd          999</span><br><span class="line">sshd             74</span><br><span class="line">postfix          89</span><br><span class="line">rpc              32</span><br><span class="line">rpcuser          29</span><br><span class="line">nfsnobody        65534</span><br><span class="line">ntp              38</span><br><span class="line">qqq              1000</span><br><span class="line">nginx1           1001</span><br><span class="line">nginx2           1002</span><br><span class="line">nginx3           1003</span><br><span class="line">nginx4           1004</span><br><span class="line">nging5           1005</span><br><span class="line">nginx            998</span><br><span class="line">文件处理完成</span><br></pre></td></tr></table></figure><h2 id="awk行和列"><a href="#awk行和列" class="headerlink" title="awk行和列"></a>awk行和列</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#行 record 记录</span></span><br><span class="line"><span class="comment">#列 field 字段</span></span><br><span class="line"><span class="comment">#读取找到zls这一行，然后取以逗号为分隔符的第一列</span></span><br><span class="line">awk -F <span class="string">&#x27;,&#x27;</span> <span class="string">&#x27;/zls/&#123;print $1&#125;&#x27;</span> zls.txt </span><br><span class="line">1</span><br></pre></td></tr></table></figure><h3 id="取行"><a href="#取行" class="headerlink" title="取行"></a>取行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">NR==1</span><br><span class="line">NR== number of record</span><br><span class="line"><span class="comment">#取zls.txt文件的第一行</span></span><br><span class="line">awk <span class="string">&#x27;NR==1&#x27;</span> zls.txt </span><br><span class="line">1,zls,666</span><br><span class="line"><span class="comment"># awk 取从第三行到最后一行</span></span><br><span class="line">awk <span class="string">&#x27;NR&gt;=3&#x27;</span> zls.txt</span><br><span class="line">awk <span class="string">&#x27;NR==3,NR==5&#x27;</span> zls.txt</span><br><span class="line"><span class="comment">#查看包含zls和cls的行</span></span><br><span class="line">awk <span class="string">&#x27;/zls|cls/&#x27;</span> zls.txt</span><br><span class="line">1,zls,666</span><br><span class="line">3,cls,88</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以逗号为每一行的换行符</span></span><br><span class="line">awk -vRS= ,</span><br><span class="line">awk -vRS=, <span class="string">&#x27;&#123;print &quot;这里是行号：&quot; NR,&quot;这里是每一行的内容：&quot;$0&#125;&#x27;</span> zls.txt</span><br><span class="line"></span><br><span class="line">这里是行号：1 这里是每一行的内容：1</span><br><span class="line">这里是行号：2 这里是每一行的内容：zls</span><br><span class="line">这里是行号：3 这里是每一行的内容：666</span><br><span class="line">2</span><br><span class="line">这里是行号：4 这里是每一行的内容：wls</span><br><span class="line">这里是行号：5 这里是每一行的内容：777</span><br><span class="line">3</span><br><span class="line">这里是行号：6 这里是每一行的内容：cls</span><br><span class="line">这里是行号：7 这里是每一行的内容：888</span><br><span class="line">4</span><br><span class="line">这里是行号：8 这里是每一行的内容：lls</span><br><span class="line">这里是行号：9 这里是每一行的内容：999</span><br></pre></td></tr></table></figure><h3 id="取列"><a href="#取列" class="headerlink" title="取列"></a>取列</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">FS 列分隔符</span><br><span class="line">-F</span><br><span class="line">-F: = -vFS=:</span><br><span class="line">$数字 / $内容</span><br><span class="line">NF = number of field</span><br><span class="line">FS</span><br><span class="line"><span class="comment"># 取第一列</span></span><br><span class="line">awk -vFS=: <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F <span class="string">&#x27;,&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> zls.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取最后一列</span></span><br><span class="line">awk -vFS=: <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">awk -vFS=: <span class="string">&#x27;&#123;print $1&quot;#&quot;$2&quot;#&quot;$3&quot;#&quot;$6&quot;|&quot;$NF&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F=: <span class="string">&#x27;&#123;print $1&quot;#&quot;$2&quot;#&quot;$3&quot;#&quot;$6&quot;#&quot;$NF&quot;#&quot;&#125;&#x27;</span> /etc/passwd</span><br><span class="line"><span class="comment"># 修改输出内容的分割符</span></span><br><span class="line">awk -F : -vOFS=<span class="string">&#x27;|&#x27;</span> <span class="string">&#x27;&#123;print $1,$2,$NF&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk -F : -vOFS=<span class="string">&#x27;# &#x27;</span>&#123;<span class="built_in">print</span> <span class="variable">$1</span>,<span class="variable">$2</span>,<span class="variable">$NF</span>&#125;<span class="string">&#x27; /etc/passwd</span></span><br></pre></td></tr></table></figure><h3 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Zeng Laoshi       133411023        :110:100:75</span><br><span class="line">Deng Ziqi            44002231        :250:10:88</span><br><span class="line">Zhang Xinyu      877623568      :120:300:200</span><br><span class="line">Gu Linazha         11029987         :120:30:79</span><br><span class="line">Di Lireba             253097001      :220:100:200</span><br><span class="line">Jiang Shuying    535432779       :309:10:2</span><br><span class="line">Ju Jingyi             68005178         :130:280:385</span><br><span class="line">Zhang Yuqi         376788757       :500:290:33</span><br><span class="line">Wen Zhang         259872003      :100:200:300</span><br><span class="line"></span><br><span class="line"><span class="comment">## 请找出姓氏是张的人，他们第二次捐款的数额及姓名</span></span><br><span class="line">awk -F <span class="string">&#x27;[: ]+&#x27;</span> <span class="string">&#x27;/^Zhang/&#123;print $1,$2,$5&#125;&#x27;</span> zuo.txt </span><br><span class="line">Zhang Xinyu 300</span><br><span class="line">Zhang Yuqi 290</span><br><span class="line"><span class="comment">## 显示所有以25开头的QQ号及姓名</span></span><br><span class="line">0 ✓ 16:15:18 root@m01,172.16.1.61:~ <span class="comment"># awk -F: &#x27;&#123;print $1&#125;&#x27; 1| awk &#x27;/25/&#123;print&#125;&#x27;</span></span><br><span class="line">Di Lireba 253097001</span><br><span class="line">Wen Zhang 25</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有QQ号最后一位是1或者3的人，全名及QQ</span></span><br><span class="line">awk <span class="string">&#x27;$3~/(1|3)$/ &#123;print $1,$2,$3&#125;&#x27;</span> 1</span><br><span class="line">awk <span class="string">&#x27;$3~/(1|3)/ &#123;print $1,$2,$3&#125;&#x27;</span> 1</span><br><span class="line"></span><br><span class="line"><span class="comment">## 显示每个捐款值都以$开头 $110:$00$75</span></span><br><span class="line">awk -F: -vOFS=<span class="string">&#x27;$&#x27;</span> <span class="string">&#x27;&#123;print $1,$2,$3,$4&#125;&#x27;</span> 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 综合应用：找出ifconfig中范围是1-255的数字</span></span><br><span class="line">ifconfig | awk -vRS=<span class="string">&#x27;[^0-9]+&#x27;</span> <span class="string">&#x27;$0&gt;0 &amp;&amp; $0&lt;256&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> shell脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux三剑客-awk的模式与动作(15)</title>
      <link href="/2023/01/07/Shell/Day15awk%E7%9A%84%E6%A8%A1%E5%BC%8F%E4%B8%8E%E5%8A%A8%E4%BD%9C/"/>
      <url>/2023/01/07/Shell/Day15awk%E7%9A%84%E6%A8%A1%E5%BC%8F%E4%B8%8E%E5%8A%A8%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h2 id="awk的模式与动作"><a href="#awk的模式与动作" class="headerlink" title="awk的模式与动作"></a>awk的模式与动作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F: <span class="string">&#x27;NR==1&#123;print 1 $1,$3&#125;&#x27;</span> /etc/passwd</span><br></pre></td></tr></table></figure><p>上面这条命令我们可以看到， ‘NR&#x3D;&#x3D;1{print $1,$3}’ 可以理解为， ‘模式{动作}’ &#x3D;&#x3D; ‘条件{指令}’</p><h2 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h2><ul><li><p>正则</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 正则表达式写法</span></span><br><span class="line"><span class="string">&#x27;/正则表达式/flag&#x27;</span></span><br><span class="line"><span class="string">&#x27;$1~/正则表达式/flag&#x27;</span></span><br><span class="line"><span class="string">&#x27;$1!~/正则表达式/flag&#x27;</span></span><br><span class="line"></span><br><span class="line">只不过我们在awk中很少使用flag</span><br></pre></td></tr></table></figure><ul><li><p>比较表达式</p></li><li><pre><code class="bash">NR==1NR&gt;=10NR&lt;=100NR&gt;=1 &amp;&amp; NR&lt;=10$1&gt;=100<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 范围</span><br><span class="line"></span><br><span class="line">  ```bash</span><br><span class="line">  ## 精确匹配行号：从第10行到第20行</span><br><span class="line">  NR==10,NR==20</span><br><span class="line">  ## 精确匹配字符串：从该字符串的行到另一个字符串所在行</span><br><span class="line">  &#x27;/root/,/zls/&#x27;</span><br><span class="line">  &#x27;/从哪个字符串所在行/,/到那个字符串所在行/&#x27; #中间的行都包含进去</span><br><span class="line">  ## 模糊匹配字符串：从含有该字符串所在行到含有另一字符串所在行</span><br><span class="line">  &#x27;$1~/oo/,$1~/zl/&#x27;</span><br></pre></td></tr></table></figure>- 特殊模式：BEGIN 和 END</code></pre></li></ul></li></ul><h2 id="动作"><a href="#动作" class="headerlink" title="动作"></a>动作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">在awk中，我们最常用的动作就是 <span class="built_in">print</span></span><br><span class="line">当然我们还有别的动作可以使用：</span><br><span class="line"><span class="built_in">print</span>打印</span><br><span class="line">gsub替换</span><br><span class="line">变量赋值</span><br><span class="line">统计计算</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#替换内容</span></span><br><span class="line">awk <span class="string">&#x27;&#123;gsub(/:/,&quot;$&quot;);print $0&#125;&#x27;</span> zuo.txt </span><br><span class="line">Zeng Laoshi       133411023        $110$100<span class="variable">$75</span></span><br><span class="line">Deng Ziqi            44002231        $250$10<span class="variable">$88</span></span><br><span class="line">Zhang Xinyu      877623568      $120$300<span class="variable">$200</span></span><br><span class="line">Gu Linazha         11029987         $120$30<span class="variable">$79</span></span><br><span class="line">Di Lireba             253097001      $220$100<span class="variable">$200</span></span><br><span class="line">Jiang Shuying    535432779       $309$10<span class="variable">$2</span></span><br><span class="line">Ju Jingyi             68005178         $130$280<span class="variable">$385</span></span><br><span class="line">Zhang Yuqi         376788757       $500$290<span class="variable">$33</span></span><br><span class="line">Wen Zhang         259872003      $100$200<span class="variable">$300</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="BEGIN和ENG模式"><a href="#BEGIN和ENG模式" class="headerlink" title="BEGIN和ENG模式"></a>BEGIN和ENG模式</h2><p>一般来说，END{}要比BEGIN{}重要一些，BEGIN{}可有可无，计算其实可以放在读取文件的时候，也可以执行<br>END{}中，大括号里面的内容，会在awk读取完文件的最后一行后，进行处理<br>作用：一般我们使用END{}来显示对日志内容分析后的一个结果 当然，还有其他功能，比如文件读取完了，可以显示<br>一些尾部信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#统计或计算</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print 1/3&#125;&#x27;</span></span><br><span class="line">0.333333</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计/etc/service文件中的一共有多少行</span></span><br><span class="line">awk <span class="string">&#x27;&#123;hang++;print hang&#125;&#x27;</span> /etc/services</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不需要过程只要结果</span></span><br><span class="line">awk <span class="string">&#x27;&#123;hang++&#125;END&#123;print hang&#125;&#x27;</span> /etc/services</span><br><span class="line">11176</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只能统计文件的所有行</span></span><br><span class="line">awk <span class="string">&#x27;END&#123;print NR&#125;&#x27;</span> /etc/services</span><br><span class="line">11176</span><br><span class="line"></span><br><span class="line"><span class="comment">## 其它方法</span></span><br><span class="line"><span class="built_in">wc</span> -l /etc/services</span><br><span class="line">11176 /etc/services</span><br><span class="line">grep -c <span class="string">&#x27;.*&#x27;</span> /etc/services</span><br><span class="line">11176</span><br><span class="line">sed -n <span class="string">&#x27;$=&#x27;</span> /etc/services</span><br><span class="line">11176</span><br><span class="line"><span class="built_in">cat</span> /etc/services | <span class="built_in">wc</span> -l</span><br><span class="line">11176</span><br><span class="line"><span class="comment">## 统计空行的数量</span></span><br><span class="line">awk <span class="string">&#x27;/^$/&#123;print&#125;&#x27;</span> /etc/services | <span class="built_in">wc</span> -l</span><br><span class="line">17</span><br><span class="line">awk <span class="string">&#x27;/^$/&#123;i++&#125;END&#123;print i&#125;&#x27;</span> /etc/services</span><br><span class="line">17</span><br></pre></td></tr></table></figure><h2 id="awk的数组"><a href="#awk的数组" class="headerlink" title="awk的数组"></a>awk的数组</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># awk的数组赋值</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;array[0]=&quot;hqw&quot;;arrat[1]=&quot;hbb&quot;&#125;&#x27;</span></span><br><span class="line"><span class="comment"># awk数组的取值</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;array[0]=&quot;hqw&quot;;array[1]=&quot;hbb&quot;;print array[0],array[1]&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="awk的循环数组"><a href="#awk的循环数组" class="headerlink" title="awk的循环数组"></a>awk的循环数组</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (</span><br><span class="line">动作</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> 条件；<span class="keyword">do</span>动作</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;array[0]=&quot;hqw&quot;;array[1]=&quot;hbb&quot;;for(num in array)print num&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;array[0]=&quot;hqw&quot;;array[1]=&quot;hbb&quot;;for(num in array)&#123;print num&#125;&#125;&#x27;</span></span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;array[0]=&quot;hqw&quot;;array[1]=&quot;hbb&quot;;for(num in array)&#123;print array[num]&#125;&#125;&#x27;</span></span><br><span class="line">hqw</span><br><span class="line">hbb</span><br></pre></td></tr></table></figure><h2 id="awk的判断"><a href="#awk的判断" class="headerlink" title="awk的判断"></a>awk的判断</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(条件)&#123;</span><br><span class="line">动作</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">## 判断磁盘空间使用率大于70%，大于就显示磁盘空间不足，不大就显示正常</span></span><br><span class="line"><span class="built_in">df</span> -h| awk -F <span class="string">&#x27;[ %]+&#x27;</span> <span class="string">&#x27;NR==2&#123;if($5&gt;70)&#123;print &quot;磁盘空间不足&quot;&#125;else&#123;print &quot;磁盘空间很够，现在的使 用率是：&quot;$5&quot;%&quot;&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> shell脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux正则表达式(12.2)</title>
      <link href="/2023/01/07/Shell/Day12.2linux%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
      <url>/2023/01/07/Shell/Day12.2linux%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="linux正则表达式"><a href="#linux正则表达式" class="headerlink" title="linux正则表达式"></a>linux正则表达式</h1><h2 id="基本正则表达式"><a href="#基本正则表达式" class="headerlink" title="基本正则表达式"></a>基本正则表达式</h2><h3 id="字符匹配"><a href="#字符匹配" class="headerlink" title="字符匹配"></a>字符匹配</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.    　　　　　　　　　匹配任意单个字符,不含空格</span><br><span class="line">[]    　　　　　　　　 匹配指定范围内的任意字符,如：[a-z]、[A-Z]、[0-9]</span><br><span class="line">[^]    　　　　　　　　匹配指定范围外的任意单个字符,取反</span><br><span class="line">[:alnum:]    　　　　字母和数字,与[A-Za-z0-9]等价</span><br><span class="line">[:alpa:]    　　　　 字母,与[A-Za-z]等价</span><br><span class="line">[:digit:]    　　　　数字,与[0-9]等价</span><br><span class="line">[:xdigit:]    　　　十六进制字符,与[0-9A-Fa-f]等价</span><br><span class="line">[:blank:]    　　　　空格和制表符</span><br><span class="line">[:lower:]    　　　　小写字母</span><br><span class="line">[:upper:]    　　　　大写字母</span><br><span class="line">[:space:]    　　　　空白字符,等价于[\t\r\n\v\f]</span><br><span class="line">[:punct:]    　　　　标点符号</span><br></pre></td></tr></table></figure><h3 id="匹配次数"><a href="#匹配次数" class="headerlink" title="匹配次数"></a>匹配次数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用在要指定次数的字符后面，用于指定前面的字符要出现的次数；</span></span><br><span class="line"></span><br><span class="line">*    　　　　　　贪婪模式, 匹配*号前面的字符任意次,仅表示次数: 0 次或多次(&gt;=0次), 与匹配文件的通配符意义不一样</span><br><span class="line">.*    　　　　　　任意长度的任意字符,含空格</span><br><span class="line">\?    　　　　　　匹配其前面的字符0或1次,即前面的字符可有可无</span><br><span class="line">\+    　　　　　　匹配其前面的字符至少1次</span><br><span class="line">\&#123;m,n\&#125;    　　　匹配至少m次，最多n次</span><br><span class="line">\&#123;m\&#125;    　　　　匹配前面的字符m次</span><br><span class="line">\&#123;m,\&#125;    　　　匹配前面的字符至少m次，多则不限</span><br></pre></td></tr></table></figure><h3 id="位置锚定"><a href="#位置锚定" class="headerlink" title="位置锚定"></a>位置锚定</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">^    　　　　　　　　行首锚定, 如：^root</span><br><span class="line">$    　　　　　　　　行尾锚定, 如：bash$</span><br><span class="line">^PATTERN$    　　　用于模式匹配整行,如: ^$ 表示空间</span><br><span class="line"></span><br><span class="line">\&lt;或\b    　　　　　词首锚定,用于单词模式的左侧</span><br><span class="line">\&gt;或\b    　　　　　词尾锚定,用于单词模式的右侧</span><br><span class="line">\&lt;PATTERN\&gt;    　　匹配整个单词</span><br></pre></td></tr></table></figure><h3 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">\(\)    将1个或多个字符捆绑在一起，当做一个整体进行处理,如: \(xy\)*ab</span><br><span class="line"></span><br><span class="line">分组括号中的模式匹配到的内容会被正则表达式引擎记录于内部的变量中，这些变量的命名方式为：\1,\2,\3....</span><br><span class="line">\1    　　从左侧起，第1个左括号以及与之匹配右括号之间的模式所匹配到的字符</span><br><span class="line"></span><br><span class="line"><span class="comment">#后向引用分组：</span></span><br><span class="line">引用前面的分组括号中的模式所匹配字符, 而非模式本身</span><br></pre></td></tr></table></figure><h2 id="扩展正则表达式"><a href="#扩展正则表达式" class="headerlink" title="扩展正则表达式"></a>扩展正则表达式</h2><h3 id="元字符字符匹配"><a href="#元字符字符匹配" class="headerlink" title="元字符字符匹配"></a>元字符字符匹配</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.    　　　　　　匹配任意单个字符,不含空格</span><br><span class="line">[]    　　　　　匹配指定范围内的任意字符,如：[a-z]、[A-Z]、[0-9]</span><br><span class="line">[^]    　　　　匹配指定范围外的任意单个字符,取反</span><br></pre></td></tr></table></figure><h3 id="次数匹配"><a href="#次数匹配" class="headerlink" title="次数匹配"></a>次数匹配</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*    　　　　　　贪婪模式, 匹配*号前面的字符任意次,仅表示次数: 0 次或多次(&gt;=0次), 与匹配文件的通配符意义不一样</span><br><span class="line">?    　　　　　　匹配其前面的字符0或1次,即前面的字符可有可无</span><br><span class="line">+    　　　　　　匹配其前面的字符至少1次</span><br><span class="line">&#123;m&#125;    　　　　　匹配前面的字符m次</span><br><span class="line">&#123;m,n&#125;    　　　　匹配至少m次，最多n次</span><br></pre></td></tr></table></figure><h3 id="锚定"><a href="#锚定" class="headerlink" title="锚定"></a>锚定</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">^    　　　　　　行首锚定, 如：^root</span><br><span class="line">$    　　　　　　行尾锚定, 如：bash$</span><br><span class="line">\&lt;,\b    　　　　词首锚定,用于单词模式的左侧</span><br><span class="line">\&gt;,\b    　　　　词尾锚定,用于单词模式的右侧</span><br></pre></td></tr></table></figure><h3 id="分组或者表示"><a href="#分组或者表示" class="headerlink" title="分组或者表示"></a>分组或者表示</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">()</span><br><span class="line">a|b    　　a或b</span><br><span class="line">C|<span class="built_in">cat</span>    　C或<span class="built_in">cat</span></span><br></pre></td></tr></table></figure><h2 id="正则支持表"><a href="#正则支持表" class="headerlink" title="正则支持表"></a>正则支持表</h2><table><thead><tr><th>字符</th><th>说明</th><th>Basic RegEx</th><th>Extended RegEx</th><th>python RegEx</th><th>Perl regEx</th></tr></thead><tbody><tr><td>转义</td><td></td><td>\</td><td>\</td><td>\</td><td>\</td></tr><tr><td>^</td><td>匹配行首，例如’^dog’匹配以字符串dog开头的行（注意：awk 指令中，’^’则是匹配字符串的开始）</td><td>^</td><td>^</td><td>^</td><td>^</td></tr><tr><td>$</td><td>匹配行尾，例如：’^、dog匹配以字符串为结尾的行（注意：指令中，’则是匹配字符串的结尾）</td><td>$</td><td>$</td><td>$</td><td>$</td></tr><tr><td>^$</td><td>匹配空行</td><td>^$</td><td>^$</td><td>^$</td><td>^$</td></tr><tr><td>^string$</td><td>匹配行，例如：’^dog$’匹配只含一个字符串 dog 的行</td><td>^string$</td><td>^string$</td><td>^string$</td><td>^string$</td></tr><tr><td>&lt;</td><td>匹配单词，例如：’&lt;frog’ （等价于’\bfrog’），匹配以 frog 开头的单词</td><td>&lt;</td><td>&lt;</td><td><strong>不支持</strong></td><td><strong>不支持</strong>（但可以使用\b来匹配单词，例如：’\bfrog’）</td></tr><tr><td>&gt;</td><td>匹配单词，例如：’frog&gt;’（等价于’frog\b ‘），匹配以 frog 结尾的单词</td><td>&gt;</td><td>&gt;</td><td><strong>不支持</strong></td><td><strong>不支持</strong>（但可以使用\b来匹配单词，例如：’frog\b’）</td></tr><tr><td><x></td><td>匹配一个单词或者一个特定字符，例如：’<frog>‘（等价于’\bfrog\b’）、’<G>‘</td><td><x></td><td><x></td><td><strong>不支持</strong></td><td><strong>不支持</strong>（但可以使用\b来匹配单词，例如：’\bfrog\b’</td></tr><tr><td>()</td><td>匹配表达式，例如：不支持’（frog）’</td><td><strong>不支持</strong>（但可以使用，如：dogdog</td><td>()</td><td>()</td><td>()</td></tr><tr><td></td><td>匹配表达式，例如：不支持’（frog）’</td><td></td><td><strong>不支持</strong>（同())</td><td><strong>不支持</strong>（同())</td><td><strong>不支持</strong>（同())</td></tr><tr><td>？</td><td>匹配前面的子表达式 0 次或 1 次（等价于{0,1}），例如：where(is)?能匹配”where” 以及”whereis”</td><td><strong>不支持</strong>（同?)</td><td>？</td><td>？</td><td>？</td></tr><tr><td>?</td><td>匹配前面的子表达式 0 次或 1 次（等价于’{0,1}’），例如：’whereisis? ‘能匹配 “where”以及”whereis”</td><td>?</td><td><strong>不支持</strong>（同?)</td><td><strong>不支持</strong>（同?)</td><td><strong>不支持</strong>（同?)</td></tr><tr><td>?</td><td>当该字符紧跟在任何一个其他限制符（*, +, ?, {n},{n,}, {n,m}） 后面时，匹配模式是非贪婪的。非贪婪模式尽可能少的匹配所搜索的字符串，而默认的贪婪模式则尽可能多的匹配所搜索的字符串。例如，对于字符串 “oooo”，’o+?’ 将匹配单个”o”，而 ‘o+’ 将匹配所有 ‘o’</td><td><strong>不支持</strong></td><td><strong>不支持</strong></td><td><strong>不支持</strong></td><td><strong>不支持</strong></td></tr><tr><td>.</td><td>匹配除换行符（’\n’）之外的任意单个字符（注意：awk 指令中的句点能匹配换行符）</td><td>.</td><td>.（如果要匹配包括“\n”在内的任何一个字符，请使用：’(^$)|（.）</td><td>.</td><td>.（如果要匹配包括“\n”在内的任何一个字符，请使用：’ [.\n] ‘</td></tr><tr><td>*</td><td>匹配前面的子表达式 0 次或多次（等价于{0, }），例如：zo* 能匹配 “z”以及 “zoo”</td><td>*</td><td>*</td><td>*</td><td>*</td></tr><tr><td>+</td><td>匹配前面的子表达式 1 次或多次（等价于’{1, }’），例如：’whereisis+ ‘能匹配 “whereis”以及”whereisis”</td><td>+</td><td><strong>不支持</strong>（同+)</td><td><strong>不支持</strong>（同+)</td><td><strong>不支持</strong>（同+)</td></tr><tr><td>+</td><td>匹配前面的子表达式 1 次或多次（等价于{1, }），例如：zo+能匹配 “zo”以及 “zoo”，但不能匹配 “z”</td><td><strong>不支持</strong>（同+)</td><td>+</td><td>+</td><td>+</td></tr><tr><td>{n}</td><td>n 必须是一个 0 或者正整数，匹配子表达式 n 次，例如：zo{2}能匹配</td><td><strong>不支持</strong>（同{n})</td><td>{n}</td><td>{n}</td><td>{n}</td></tr><tr><td>{n,}</td><td>“zooz”，但不能匹配 “Bob”n 必须是一个 0 或者正整数，匹配子表达式大于等于 n次，例如：go{2,}</td><td><strong>不支持</strong>（同{n,})</td><td>{n,}</td><td>{n,}</td><td>{n,}</td></tr><tr><td>{n,m}</td><td>能匹配 “good”，但不能匹配 godm 和 n 均为非负整数，其中 n &lt;&#x3D; m，最少匹配 n 次且最多匹配 m 次 ，例如：o{1,3}将配”fooooood” 中的前三个 o（请注意在逗号和两个数之间不能有空格）</td><td><strong>不支持</strong>（同{n,m})</td><td>{n,m}</td><td>{n,m}</td><td>{n,m}</td></tr><tr><td>x|y</td><td>匹配 x 或 y，例如： 不支持’z|（food）’ 能匹配 “z” 或”food”；’（z|f）ood’ 则匹配”zood” 或 “food”</td><td><strong>不支持</strong>（同x|y)</td><td>x|y</td><td>x|y</td><td>x|y</td></tr><tr><td>[0-9]</td><td>匹配从 0 到 9 中的任意一个数字字符（注意：要写成递增）</td><td>[0-9]</td><td>[0-9]</td><td>[0-9]</td><td>[0-9]</td></tr><tr><td>[xyz]</td><td>字符集合，匹配所包含的任意一个字符，例如：’[abc]’可以匹配”lay” 中的 ‘a’（注意：如果元字符，例如：. *等，它们被放在[ ]中，那么它们将变成一个普通字符）</td><td>[xyz]</td><td>[xyz]</td><td>[xyz]</td><td>[xyz]</td></tr><tr><td>[^xyz]</td><td>负值字符集合，匹配未包含的任意一个字符（注意：不包括换行符），例如：’[^abc]’ 可以匹配 “Lay” 中的’L’（注意：[^xyz]在awk 指令中则是匹配未包含的任意一个字符+换行符）</td><td>[^xyz]</td><td>[^xyz]</td><td>[^xyz]</td><td>[^xyz]</td></tr><tr><td>[A-Za-z]</td><td>匹配大写字母或者小写字母中的任意一个字符（注意：要写成递增）</td><td>[A-Za-z]</td><td>[A-Za-z]</td><td>[A-Za-z]</td><td>[A-Za-z]</td></tr><tr><td>[^A-Za-z]</td><td>匹配除了大写与小写字母之外的任意一个字符（注意：写成递增）</td><td>[^A-Za-z]</td><td>[^A-Za-z]</td><td>[^A-Za-z]</td><td>[^A-Za-z]</td></tr><tr><td><strong>\d</strong></td><td>匹配从 0 到 9 中的任意一个数字字符（等价于 [0-9]）</td><td><strong>不支持</strong></td><td><strong>不支持</strong></td><td>\d</td><td>\d</td></tr><tr><td><strong>\D</strong></td><td>匹配非数字字符（等价于 [^0-9]）</td><td><strong>不支持</strong></td><td><strong>不支持</strong></td><td>\D</td><td>\D</td></tr><tr><td>\S</td><td>匹配任何非空白字符（等价于[^\f\n\r\t\v]）</td><td><strong>不支持</strong></td><td><strong>不支持</strong></td><td>\S</td><td>\S</td></tr><tr><td>\s</td><td>匹配任何空白字符，包括空格、制表符、换页符等等（等价于[ \f\n\r\t\v]）</td><td><strong>不支持</strong></td><td><strong>不支持</strong></td><td>\s</td><td>\s</td></tr><tr><td>\W</td><td>匹配任何非单词字符 (等价于[^A-Za-z0-9_])</td><td>\W</td><td>\W</td><td>\W</td><td>\W</td></tr><tr><td>\w</td><td>匹配包括下划线的任何单词字符（等价于[A-Za-z0-9_]）</td><td>\w</td><td>\w</td><td>\w</td><td>\w</td></tr><tr><td>\B</td><td>匹配非单词边界，例如：’er\B’ 能匹配 “verb” 中的’er’，但不能匹配”never” 中的’er’</td><td>\B</td><td>\B</td><td>\B</td><td>\B</td></tr><tr><td>\b</td><td>匹配一个单词边界，也就是指单词和空格间的位置，例如： ‘er\b’ 可以匹配”never” 中的 ‘er’，但不能匹配 “verb” 中的’er’</td><td>\b</td><td>\b</td><td>\b</td><td>\b</td></tr><tr><td>\t</td><td>匹配一个横向制表符（等价于 \x09和 \cI）</td><td><strong>不支持</strong></td><td><strong>不支持</strong></td><td>\t</td><td>\t</td></tr><tr><td>\v</td><td>匹配一个垂直制表符（等价于 \x0b和 \cK）</td><td><strong>不支持</strong></td><td><strong>不支持</strong></td><td>\v</td><td>\v</td></tr><tr><td>\n</td><td>匹配一个换行符（等价于 \x0a 和\cJ）</td><td><strong>不支持</strong></td><td><strong>不支持</strong></td><td>\n</td><td>\n</td></tr><tr><td>\f</td><td>匹配一个换页符（等价于\x0c 和\cL）</td><td><strong>不支持</strong></td><td><strong>不支持</strong></td><td>\f</td><td>\f</td></tr><tr><td>\r</td><td>匹配一个回车符（等价于 \x0d 和\cM）</td><td><strong>不支持</strong></td><td><strong>不支持</strong></td><td>\r</td><td>\r</td></tr><tr><td>\</td><td>匹配转义字符本身””</td><td>\</td><td>\</td><td>\</td><td>\</td></tr><tr><td>\cx</td><td>匹配由 x 指明的控制字符，例如：\cM匹配一个Control-M 或回车符，x 的值必须为A-Z 或 a-z 之一，否则，将 c 视为一个原义的 ‘c’ 字符</td><td><strong>不支持</strong></td><td><strong>不支持</strong></td><td></td><td>\cx</td></tr><tr><td>\xn</td><td>匹配 n，其中 n 为十六进制转义值。十六进制转义值必须为确定的两个数字长，例如：’\x41’ 匹配 “A”。’\x041’ 则等价于’\x04’ &amp; “1”。正则表达式中可以使用 ASCII 编码</td><td><strong>不支持</strong></td><td><strong>不支持</strong></td><td></td><td>\xn</td></tr><tr><td>\num</td><td>匹配 num，其中 num是一个正整数。表示对所获取的匹配的引用</td><td><strong>不支持</strong></td><td>\num</td><td>\num</td><td></td></tr><tr><td>[:alnum:]</td><td>匹配任何一个字母或数字（[A-Za-z0-9]），例如：’[[:alnum:]] ‘</td><td>[:alnum:]</td><td>[:alnum:]</td><td>[:alnum:]</td><td>[:alnum:]</td></tr><tr><td>[:alpha:]</td><td>匹配任何一个字母（[A－Za－z]）， 例如：’ [[:alpha:]] ‘</td><td>[:alpha:]</td><td>[:alpha:]</td><td>[:alpha:]</td><td>[:alpha:]</td></tr><tr><td>[:digit:]</td><td>匹配任何一个数字（[0-9]），例如：’[[:digit:]] ‘</td><td>[:digit:]</td><td>[:digit:]</td><td>[:digit:]</td><td>[:digit:]</td></tr><tr><td>[:lower:]</td><td>匹配任何一个小写字母（[a-z]）， 例如：’ [[:lower:]] ‘</td><td>[:lower:]</td><td>[:lower:]</td><td>[:lower:]</td><td>[:lower:]</td></tr><tr><td>[:upper:]</td><td>匹配任何一个大写字母（[A-Z]）</td><td>[:upper:]</td><td>[:upper:]</td><td>[:upper:]</td><td>[:upper:]</td></tr><tr><td>[:space:]</td><td>任何一个空白字符： 支持制表符、空格，例如：’ [[:space:]] ‘</td><td>[:space:]</td><td>[:space:]</td><td>[:space:]</td><td>[:space:]</td></tr><tr><td>[:blank:]</td><td>空格和制表符（横向和纵向），例如：’[[:blank:]]’ó’[\s\t\v]’</td><td>[:blank:]</td><td>[:blank:]</td><td>[:blank:]</td><td>[:blank:]</td></tr><tr><td>[:graph:]</td><td>任何一个可以看得见的且可以打印的字符（注意：不包括空格和换行符等），例如：’[[:graph:]] ‘</td><td>[:graph:]</td><td>[:graph:]</td><td>[:graph:]</td><td>[:graph:]</td></tr><tr><td>[:print:]</td><td>任何一个可以打印的字符（注意：不包括：[:cntrl:]、字符串结束符’\0’、EOF 文件结束符（-1）， 但包括空格符号），例如：’[[:print:]] ‘</td><td>[:print:]</td><td>[:print:]</td><td>[:print:]</td><td>[:print:]</td></tr><tr><td>[:cntrl:]</td><td>任何一个控制字符（ASCII 字符集中的前 32 个字符，即：用十进制表示为从 0 到31，例如：换行符、制表符等等），例如：’ [[:cntrl:]]’</td><td>[:cntrl:]</td><td>[:cntrl:]</td><td>[:cntrl:]</td><td>[:cntrl:]</td></tr><tr><td>[:punct:]</td><td>任何一个标点符号（不包括：[:alnum:]、[:cntrl:]、[:space:]这些字符集）</td><td>[:punct:]</td><td>[:punct:]</td><td>[:punct:]</td><td>[:punct:]</td></tr><tr><td>[:xdigit:]</td><td>任何一个十六进制数（即：0-9，a-f，A-F）</td><td>[:xdigit:]</td><td>[:xdigit:]</td><td>[:xdigit:]</td><td>[:xdigit:]</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> shell脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ansible基本playbook(3)</title>
      <link href="/2023/01/07/ansible/03.Ansible%E5%89%A7%E6%9C%ACplaybook/"/>
      <url>/2023/01/07/ansible/03.Ansible%E5%89%A7%E6%9C%ACplaybook/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Ansible剧本playbook"><a href="#Ansible剧本playbook" class="headerlink" title="Ansible剧本playbook"></a>Ansible剧本playbook</h1><blockquote><p> <strong>Q：什么是playbook？</strong></p><p>playbook：剧本，兵书之意</p><p>playbook是由什么组成</p><ul><li><p>play：定义主机和角色（主角，配角定义）</p></li><li><p>task：任务（角色的台词和动作）</p></li></ul><p>在playbook中一个play可以由多个task组成</p></blockquote><h2 id="playbook语法"><a href="#playbook语法" class="headerlink" title="playbook语法"></a>playbook语法</h2><h3 id="yaml语法"><a href="#yaml语法" class="headerlink" title="yaml语法"></a>yaml语法</h3><ul><li><p>缩进：每一个层级，要缩进两个空格</p></li><li><p>冒号：除了以冒号结尾的内容，冒号后面都要加一个空格</p></li><li><p>横杠：横杠后面要有空格（Python 列表数据类型）</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- hosts: web_group <span class="comment">## play部分，指定要执行的主机 </span></span><br><span class="line">  remote_user: root <span class="comment">## 以root身份执行 （默认） </span></span><br><span class="line">  tasks: <span class="comment">## 定义任务 </span></span><br><span class="line">  - name: install httpd and php <span class="comment">## 给任务起名 </span></span><br><span class="line">yum: <span class="comment">## 模块 </span></span><br><span class="line">- httpd <span class="comment">## 动作 </span></span><br><span class="line">- php </span><br><span class="line">  - name: configure httpd conf </span><br><span class="line">copy: </span><br><span class="line">      src: /root/web/httpd.conf </span><br><span class="line">      dest: /etc/httpd/conf</span><br></pre></td></tr></table></figure><p>ansible 写playbook后缀 .yml 或者 .yaml</p><p>saltstack 写sls文件 后缀 .sls</p><h2 id="playbook小练习"><a href="#playbook小练习" class="headerlink" title="playbook小练习"></a>playbook小练习</h2><p><strong>安装httpd</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.创建工作目录 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># mkdir /root/ansible</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.编写httpd剧本 </span></span><br><span class="line">[root@m01 ansible]<span class="comment"># vim httpd.yml</span></span><br><span class="line">- hosts: web_group </span><br><span class="line">  tasks: </span><br><span class="line">  - name: Install httpd </span><br><span class="line">  yum:</span><br><span class="line">  name: httpd </span><br><span class="line">  state: present</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.执行剧本 </span></span><br><span class="line">[root@m01 ansible]<span class="comment"># ansible-playbook httpd.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 检测剧本语法 </span></span><br><span class="line">[root@m01 ansible]<span class="comment"># ansible-playbook --syntax-check httpd.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 测试执行 </span></span><br><span class="line">[root@m01 ansible]<span class="comment"># ansible-playbook -C httpd.yml</span></span><br></pre></td></tr></table></figure><p><strong>启动httpd并加入开机自启</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- hosts: web_group </span><br><span class="line">  tasks: </span><br><span class="line">  - name: Install httpd </span><br><span class="line">    yum:</span><br><span class="line">      name: httpd </span><br><span class="line">      state: present </span><br><span class="line">  - name: Start httpd Service </span><br><span class="line">    service: </span><br><span class="line">      name: httpd </span><br><span class="line">      state: started </span><br><span class="line">      enabled: True</span><br></pre></td></tr></table></figure><p><strong>编写http前端页面</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ansible]<span class="comment"># cat httpd.yml </span></span><br><span class="line">- hosts: web_group </span><br><span class="line">  tasks: </span><br><span class="line">    - name: Install httpd </span><br><span class="line">      yum:</span><br><span class="line">        name: httpd </span><br><span class="line">        state: present </span><br><span class="line">    - name: Start httpd Service </span><br><span class="line">      service: </span><br><span class="line">        name: httpd </span><br><span class="line">        state: started </span><br><span class="line">        enabled: True </span><br><span class="line">    - name: Set Web Index </span><br><span class="line">      copy: </span><br><span class="line">        content: roger_http_web </span><br><span class="line">        dest: /var/www/html/index.html</span><br></pre></td></tr></table></figure><p><strong>不同的主机配置不同的网站</strong></p><p>目前来说，想要根据不同主机配置不同的网站，我们可以使用多个play的方式，但是在生产环境中，我们需要写循环，来满足我们的需求，多个play了解即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ansible]<span class="comment"># cat httpd.yml </span></span><br><span class="line">- hosts: web_group </span><br><span class="line">  tasks: </span><br><span class="line">  - name: Install httpd </span><br><span class="line">    yum:</span><br><span class="line">      name: httpd </span><br><span class="line">      state: present </span><br><span class="line">  - name: Start httpd Service </span><br><span class="line">    service: </span><br><span class="line">      name: httpd </span><br><span class="line">      state: started </span><br><span class="line">      enabled: True </span><br><span class="line"></span><br><span class="line">- hosts: web01 </span><br><span class="line">  tasks: </span><br><span class="line">  - name: Set Web01 Index </span><br><span class="line">    copy: </span><br><span class="line">      content: roger_http_web01 </span><br><span class="line">      dest: /var/www/html/index.html </span><br><span class="line">    </span><br><span class="line">- hosts: web02 </span><br><span class="line">  tasks: </span><br><span class="line">  - name: Set Web01 Index </span><br><span class="line">    copy: </span><br><span class="line">      content: roger_http_web02 </span><br><span class="line">      dest: /var/www/html/index.html</span><br></pre></td></tr></table></figure><h2 id="playbook实战"><a href="#playbook实战" class="headerlink" title="playbook实战"></a>playbook实战</h2><p>1.部署rsync</p><p>2.部署nfs</p><p>3.部署httpd，载上传作业的目录</p><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><table><thead><tr><th align="center">主机名</th><th align="center">WanIP</th><th align="center">LanIP</th><th align="center">角色</th><th align="center">应用</th></tr></thead><tbody><tr><td align="center">m01</td><td align="center">10.0.0.61</td><td align="center">172.16.1.61</td><td align="center">ansible管理机</td><td align="center">ansible</td></tr><tr><td align="center">web01</td><td align="center">10.0.0.7</td><td align="center">172.16.1.7</td><td align="center">作业网站</td><td align="center">httpd、php、nfs</td></tr><tr><td align="center">web02</td><td align="center">10.0.0.8</td><td align="center">172.16.1.8</td><td align="center">作业网站</td><td align="center">httpd、php、nfs</td></tr><tr><td align="center">nfs</td><td align="center">10.0.0.31</td><td align="center">172.16.1.31</td><td align="center">共享存储</td><td align="center">nfs、rsync</td></tr><tr><td align="center">backup</td><td align="center">10.0.0.41</td><td align="center">172.16.1.41</td><td align="center">实时同步备份</td><td align="center">nfs、rsync</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#准备工作</span></span><br><span class="line">[root@m01 web]<span class="comment"># ll </span></span><br><span class="line">total 44 </span><br><span class="line">-rw-r--r-- 1 root root 11753 Jun 28 16:41 httpd.conf </span><br><span class="line">-rw-r--r-- 1 root root 26868 Jun 28 16:52 kaoshi.tgz </span><br><span class="line">-rw-r--r-- 1 root root 336 Jun 27 20:35 rsyncd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#剧本编辑</span></span><br><span class="line">[root@m01 ansible]<span class="comment"># vim lnmp.yml</span></span><br><span class="line">- hosts: all</span><br><span class="line">  tasks:</span><br><span class="line">  - name: Create www group</span><br><span class="line">    group:</span><br><span class="line">      name: www</span><br><span class="line">      gid: 666</span><br><span class="line">      </span><br><span class="line">  - name: Create www user</span><br><span class="line">    user:</span><br><span class="line">      name: www</span><br><span class="line">      uid: 666</span><br><span class="line">      group: <span class="string">&#x27;666&#x27;</span></span><br><span class="line">      shell: /sbin/nologin</span><br><span class="line">      create_home: False</span><br><span class="line">      </span><br><span class="line">- hosts: rsyncd</span><br><span class="line">  tasks:</span><br><span class="line">  - name: Install rsync,nfs-utils Service</span><br><span class="line">    yum:</span><br><span class="line">      name:</span><br><span class="line">        - rsync</span><br><span class="line">        - nfs-utils</span><br><span class="line">      state: present</span><br><span class="line">      </span><br><span class="line">- hosts: backup</span><br><span class="line">  tasks:</span><br><span class="line">  - name: Configure rsync Conf</span><br><span class="line">    copy:</span><br><span class="line">      src: /root/web/rsyncd.conf</span><br><span class="line">      dest: /etc/</span><br><span class="line">      </span><br><span class="line">  - name: Configure rsync.passwd File</span><br><span class="line">    copy:</span><br><span class="line">      content: rsync_backup:123</span><br><span class="line">      dest: /etc/rsync.passwd</span><br><span class="line">      mode: 0600</span><br><span class="line">      </span><br><span class="line">  - name: Create backup Directory</span><br><span class="line">    file:</span><br><span class="line">      path: /backup</span><br><span class="line">      owner: www</span><br><span class="line">      group: www</span><br><span class="line">      mode: 0755</span><br><span class="line">      state: directory</span><br><span class="line">      </span><br><span class="line">  - name: Start rsync Service</span><br><span class="line">    service:</span><br><span class="line">      name: rsyncd</span><br><span class="line">      state: started</span><br><span class="line">      enabled: True</span><br><span class="line"> </span><br><span class="line">- hosts: nfs</span><br><span class="line">  tasks:</span><br><span class="line">  - name: Create Client rsync.passwd File</span><br><span class="line">    copy:</span><br><span class="line">      content: 123</span><br><span class="line">      dest: /etc/rsync.passwd</span><br><span class="line">      mode: 0600</span><br><span class="line">      </span><br><span class="line">  - name: Configure nfs Conf</span><br><span class="line">    copy:</span><br><span class="line">      content: <span class="string">&quot;/data 172.16.1.0/24(rw,sync,anonuid=666,anongid=666,all_squash)</span></span><br><span class="line"><span class="string">      dest: /etc/exports</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">  - name: Create nfs Directory</span></span><br><span class="line"><span class="string">    file:</span></span><br><span class="line"><span class="string">      path: /data</span></span><br><span class="line"><span class="string">      owner: www</span></span><br><span class="line"><span class="string">      group: www</span></span><br><span class="line"><span class="string">      mode: 0755</span></span><br><span class="line"><span class="string">      state: directory</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">  - name: Start nfs Service</span></span><br><span class="line"><span class="string">    service:</span></span><br><span class="line"><span class="string">      name: nfs</span></span><br><span class="line"><span class="string">      state: started</span></span><br><span class="line"><span class="string">      enabled: True</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">- hosts: web_group</span></span><br><span class="line"><span class="string">  tasks:</span></span><br><span class="line"><span class="string">  - name: Install httpd,php Service</span></span><br><span class="line"><span class="string">    yum:</span></span><br><span class="line"><span class="string">      name:</span></span><br><span class="line"><span class="string">        - httpd</span></span><br><span class="line"><span class="string">        - php</span></span><br><span class="line"><span class="string">      state: present</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">  - name: Configure httpd Conf</span></span><br><span class="line"><span class="string">    copy:</span></span><br><span class="line"><span class="string">      src: /root/web/httpd.conf</span></span><br><span class="line"><span class="string">      dest: /etc/httpd/conf</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  - name: Unarchive php Service</span></span><br><span class="line"><span class="string">    unarchive:</span></span><br><span class="line"><span class="string">      src: /root/web/kaoshi.tgz</span></span><br><span class="line"><span class="string">      dest: /var/www/html</span></span><br><span class="line"><span class="string">      owner: www</span></span><br><span class="line"><span class="string">      group: www</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">  - name: Deplay kaoshi Code</span></span><br><span class="line"><span class="string">    unarchive:</span></span><br><span class="line"><span class="string">      src: /root/web/kaoshi.tgz</span></span><br><span class="line"><span class="string">      dest: /var/www/html</span></span><br><span class="line"><span class="string">      owner: www</span></span><br><span class="line"><span class="string">      group: www</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">  - name: Create user_data Directory</span></span><br><span class="line"><span class="string">    file:</span></span><br><span class="line"><span class="string">      path: /var/www/html/user_data</span></span><br><span class="line"><span class="string">      owner: www</span></span><br><span class="line"><span class="string">      group: www</span></span><br><span class="line"><span class="string">      mode: 0755</span></span><br><span class="line"><span class="string">      state: directory</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">  - name: Mount user_data Directory</span></span><br><span class="line"><span class="string">    mount:</span></span><br><span class="line"><span class="string">      src: 172.16.1.31:/data</span></span><br><span class="line"><span class="string">      path: /var/www/html/user_data</span></span><br><span class="line"><span class="string">      fstype: nfs</span></span><br><span class="line"><span class="string">      state: mounted</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">  - name: Start httpd Service</span></span><br><span class="line"><span class="string">    service:</span></span><br><span class="line"><span class="string">      name: httpd</span></span><br><span class="line"><span class="string">      state: started</span></span><br><span class="line"><span class="string">      enabled: True</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">stat -c %a /var/www/html/user_data/</span></span><br></pre></td></tr></table></figure><h2 id="playbook部署wordpress"><a href="#playbook部署wordpress" class="headerlink" title="playbook部署wordpress"></a>playbook部署wordpress</h2><table><thead><tr><th align="center">主机名</th><th align="center">WanIP</th><th align="center">LanIP</th><th align="center">角色</th><th align="center">应用</th></tr></thead><tbody><tr><td align="center">m01</td><td align="center">10.0.0.61</td><td align="center">172.16.1.61</td><td align="center">ansible管理机</td><td align="center">ansible</td></tr><tr><td align="center">web01</td><td align="center">10.0.0.7</td><td align="center">172.16.1.7</td><td align="center">wordpress</td><td align="center">httpd、php、nfs</td></tr><tr><td align="center">web02</td><td align="center">10.0.0.8</td><td align="center">172.16.1.8</td><td align="center">wordpress</td><td align="center">httpd、php、nfs</td></tr><tr><td align="center">nfs</td><td align="center">10.0.0.31</td><td align="center">172.16.1.31</td><td align="center">共享存储</td><td align="center">nfs、rsync</td></tr><tr><td align="center">backup</td><td align="center">10.0.0.41</td><td align="center">172.16.1.41</td><td align="center">实时同步备份</td><td align="center">nfs、rsync</td></tr><tr><td align="center">db01</td><td align="center">10.0.0.51</td><td align="center">172.16.1.51</td><td align="center">数据库</td><td align="center">MariaDB、MySQL-python</td></tr></tbody></table><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.规划目录 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># tree /root/wordpress_ansible/</span></span><br><span class="line">/root/wordpress_ansible/</span><br><span class="line">├── base</span><br><span class="line">│    ├── hosts</span><br><span class="line">│    └── ssh_key.sh</span><br><span class="line">├── lnmp.yml </span><br><span class="line">├── mariadb </span><br><span class="line">│    ├── my.cnf </span><br><span class="line">│    └── wp_ansible.sql</span><br><span class="line">├── nfs </span><br><span class="line">│    └── 2022.tgz </span><br><span class="line">├── nginx_php </span><br><span class="line">│    ├── blog.roger.com.conf</span><br><span class="line">│    ├── nginx.conf </span><br><span class="line">│    ├── nginx_php.tgz</span><br><span class="line">│    └── www.conf </span><br><span class="line">├── rsync </span><br><span class="line">│    └── rsyncd.conf</span><br><span class="line">├── test.yml</span><br><span class="line">├── wordpress</span><br><span class="line">│    └── wordpress.tgz</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.安装wordpress</span></span><br><span class="line"><span class="comment">## 创建用户</span></span><br><span class="line">[root@m01 ngx_php]<span class="comment"># groupadd www -g 666 </span></span><br><span class="line">[root@m01 ngx_php]<span class="comment"># useradd www -u 666 -g 666 -s /sbin/nologin -M</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改nginx配置文件</span></span><br><span class="line">[root@m01 ngx_php]<span class="comment"># vim /etc/nginx/nginx.conf</span></span><br><span class="line">user www;</span><br><span class="line">[root@m01 ngx_php]<span class="comment"># cp /etc/nginx/nginx.conf /root/wordpress_ansible/nginx_php/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改php配置文件</span></span><br><span class="line">[root@m01 ngx_php]<span class="comment"># vim /etc/php-fpm.d/www.conf</span></span><br><span class="line">[www] </span><br><span class="line">user = www </span><br><span class="line">group = www </span><br><span class="line">listen = /dev/shm/php.sock </span><br><span class="line">listen.owner = www </span><br><span class="line">listen.group = www</span><br><span class="line">[root@m01 ngx_php]<span class="comment"># cp /etc/php-fpm.d/www.conf /root/wordpress_ansible/nginx_php/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 编辑nginx服务配置</span></span><br><span class="line">[root@m01 ngx_php]<span class="comment"># vim /etc/nginx/conf.d/blog.roger.com.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">listen 80; </span><br><span class="line">server_name blog.roger.com; </span><br><span class="line">root /code/wordpress; </span><br><span class="line">index index.php index.html; </span><br><span class="line"></span><br><span class="line">location ~ \.php$ &#123; </span><br><span class="line">fastcgi_pass unix:/dev/shm/php.sock; </span><br><span class="line">fastcgi_param SCRIPT_FILENAME $document_root<span class="variable">$fastcgi_script_name</span>; </span><br><span class="line">include fastcgi_params; </span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line">[root@m01 ngx_php]<span class="comment"># cp /etc/nginx/conf.d/blog.roger.com.conf /root/wordpress_ansible/nginx_php/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动nginx、php服务</span></span><br><span class="line">[root@m01 ngx_php]<span class="comment"># systemctl start nginx php-fpm</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 部署wordpress</span></span><br><span class="line">[root@m01 ngx_php]<span class="comment"># mkdir /code </span></span><br><span class="line">[root@m01 ngx_php]<span class="comment"># wget https://cn.wordpress.org/latest-zh_CN.tar.gz -O /code/latest- zh_CN.tar.gz</span></span><br></pre></td></tr></table></figure><h3 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 code]<span class="comment"># tar zcf wordpress.tgz wordpress/ </span></span><br><span class="line">[root@db01 ~]<span class="comment"># mysqldump -uroot -p123 wordpress &gt; /opt/wp_ansible.sql </span></span><br><span class="line">[root@db01 ~]<span class="comment"># scp /opt/wp_ansible.sql 172.16.1.61:/root/wordpress_ansible/mariadb </span></span><br><span class="line">[root@m01 code]<span class="comment"># cp wordpress.tgz /root/wordpress_ansible/wordpress/</span></span><br><span class="line">[root@m01 code]<span class="comment"># vim /root/wordpress_ansible/rsync/rsyncd.conf</span></span><br><span class="line">uid = www </span><br><span class="line">gid = www </span><br><span class="line">port = 873 </span><br><span class="line">fake super = <span class="built_in">yes</span> </span><br><span class="line">use <span class="built_in">chroot</span> = no </span><br><span class="line">max connections = 200 </span><br><span class="line"><span class="built_in">timeout</span> = 600 </span><br><span class="line">ignore errors </span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span> </span><br><span class="line">list = <span class="literal">false</span> </span><br><span class="line">auth <span class="built_in">users</span> = rsync_backup </span><br><span class="line">secrets file = /etc/rsync.passwd </span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log </span><br><span class="line"><span class="comment">##################################### </span></span><br><span class="line">[backup] </span><br><span class="line">comment = welcome to oldboyedu backup! </span><br><span class="line">path = /backup</span><br></pre></td></tr></table></figure><h3 id="lnmp-yml"><a href="#lnmp-yml" class="headerlink" title="lnmp.yml"></a>lnmp.yml</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line">- hosts: all</span><br><span class="line">  tasks:</span><br><span class="line">  - name: 创建www组</span><br><span class="line">    group:</span><br><span class="line">      name: www</span><br><span class="line">      gid: 666</span><br><span class="line"></span><br><span class="line">  - name: 创建www用户</span><br><span class="line">    user:</span><br><span class="line">      name: www</span><br><span class="line">      uid: 666</span><br><span class="line">      group: 666</span><br><span class="line">      shell: /sbin/nologin</span><br><span class="line">      create_home: False</span><br><span class="line"></span><br><span class="line">  - name: 更新yum缓存</span><br><span class="line">    shell: yum makecache</span><br><span class="line"></span><br><span class="line">- hosts: rsyncd</span><br><span class="line">  tasks:</span><br><span class="line">  - name: 安装rsync, nfs-utils服务</span><br><span class="line">    yum:</span><br><span class="line">      name:</span><br><span class="line">        - rsync</span><br><span class="line">        - nfs-utils</span><br><span class="line">      state: present</span><br><span class="line"></span><br><span class="line">- hosts: backup_group</span><br><span class="line">  tasks:</span><br><span class="line">  - name: 创建backup目录</span><br><span class="line">    file:</span><br><span class="line">      path: /backup</span><br><span class="line">      owner: www </span><br><span class="line">      group: www </span><br><span class="line">      mode: 0755</span><br><span class="line">      state: directory</span><br><span class="line"></span><br><span class="line">  - name: 推送rsync配置文件</span><br><span class="line">    copy:</span><br><span class="line">      src: /root/ansible_wordpress/rsync/rsyncd.conf</span><br><span class="line">      dest: /etc</span><br><span class="line"></span><br><span class="line">  - name: 创建rsync密码文件</span><br><span class="line">    copy:</span><br><span class="line">      content: <span class="string">&#x27;rsync_backup:123&#x27;</span></span><br><span class="line">      dest: /etc/rsync.passwd</span><br><span class="line">      mode: 0600</span><br><span class="line"></span><br><span class="line">  - name: 启动rsync服务</span><br><span class="line">    service:</span><br><span class="line">      name: rsyncd</span><br><span class="line">      state: started</span><br><span class="line">      enabled: True</span><br><span class="line"></span><br><span class="line">- hosts: nfs_group</span><br><span class="line">  tasks:</span><br><span class="line">  - name: 创建data目录</span><br><span class="line">    file:</span><br><span class="line">      path: /data</span><br><span class="line">      owner: www </span><br><span class="line">      group: www </span><br><span class="line">      mode: 0755</span><br><span class="line">      state: directory</span><br><span class="line"></span><br><span class="line">  - name: 创建rsync密码文件</span><br><span class="line">    copy:</span><br><span class="line">      content: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">      dest: /etc/rsync.passwd</span><br><span class="line">      mode: 0600</span><br><span class="line"></span><br><span class="line">  - name: 修改nfs配置文件</span><br><span class="line">    copy:</span><br><span class="line">      content: <span class="string">&#x27;/data 172.16.1.0/24(rw,sync,anonuid=666,anongid=666,all_squash)&#x27;</span></span><br><span class="line">      dest: /etc/exports</span><br><span class="line"></span><br><span class="line">  - name: 解压静态图片</span><br><span class="line">    unarchive:</span><br><span class="line">      src: /root/ansible_wordpress/nfs/2023.tar.gz</span><br><span class="line">      dest: /data</span><br><span class="line">      owner: www</span><br><span class="line">      group: www</span><br><span class="line">      mode: 0755</span><br><span class="line"></span><br><span class="line">  - name: 启动nfs服务</span><br><span class="line">    service:</span><br><span class="line">      name: nfs</span><br><span class="line">      state: started</span><br><span class="line">      enabled: True</span><br><span class="line"></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">  - name: 安装nfs-utils</span><br><span class="line">    yum:</span><br><span class="line">      name: nfs-utils</span><br><span class="line">      state: present</span><br><span class="line"></span><br><span class="line">  - name: 创建站点目录</span><br><span class="line">    file:</span><br><span class="line">      path: /code</span><br><span class="line">      owner: www</span><br><span class="line">      group: www </span><br><span class="line">      mode: 0755</span><br><span class="line">      state: directory</span><br><span class="line"></span><br><span class="line">  - name: 推送nginx,php安装包</span><br><span class="line">    unarchive:</span><br><span class="line">      src: /root/ansible_wordpress/nginx_php/nginx_php.tgz</span><br><span class="line">      dest: /code</span><br><span class="line"></span><br><span class="line">  - name: 安装nginx,php服务</span><br><span class="line">    shell: <span class="string">&#x27;cd /code &amp;&amp; yum localinstall -y *.rpm&#x27;</span></span><br><span class="line"></span><br><span class="line">  - name: 推送nginx.conf配置</span><br><span class="line">    copy:</span><br><span class="line">      src: /root/ansible_wordpress/nginx_php/nginx.conf</span><br><span class="line">      dest: /etc/nginx</span><br><span class="line"></span><br><span class="line">  - name: 推送nginx配置</span><br><span class="line">    copy:</span><br><span class="line">      src: /root/ansible_wordpress/nginx_php/blog.roger.com.conf</span><br><span class="line">      dest: /etc/nginx/conf.d</span><br><span class="line"></span><br><span class="line">  - name: 推送php配置</span><br><span class="line">    copy:</span><br><span class="line">      src: /root/ansible_wordpress/nginx_php/www.conf</span><br><span class="line">      dest: /etc/php-fpm.d</span><br><span class="line"></span><br><span class="line">  - name: 部署wordpress</span><br><span class="line">    unarchive:</span><br><span class="line">      src: /root/ansible_wordpress/wordpress/wordpress.tar.gz</span><br><span class="line">      dest: /code</span><br><span class="line"></span><br><span class="line">  - name: 挂载共享目录</span><br><span class="line">    mount:</span><br><span class="line">      src: 172.16.1.31:/data</span><br><span class="line">      path: /code/wordpress/wp-content/uploads</span><br><span class="line">      fstype: nfs</span><br><span class="line">      state: mounted</span><br><span class="line"></span><br><span class="line">  - name: 启动nginx服务</span><br><span class="line">    service:</span><br><span class="line">      name: nginx</span><br><span class="line">      state: started</span><br><span class="line">      enabled: True</span><br><span class="line"></span><br><span class="line">  - name: 启动php-fpm服务</span><br><span class="line">    service:</span><br><span class="line">      name: php-fpm</span><br><span class="line">      state: started</span><br><span class="line">      enabled: True</span><br><span class="line"></span><br><span class="line">- hosts: db_group</span><br><span class="line">  tasks:</span><br><span class="line">  - name: 安装mariadb服务</span><br><span class="line">    yum:</span><br><span class="line">      name: </span><br><span class="line">        - mariadb-server</span><br><span class="line">        - MySQL-python</span><br><span class="line">      state: present</span><br><span class="line"></span><br><span class="line">  - name: 推送maridb配置</span><br><span class="line">    copy:</span><br><span class="line">      src: /root/ansible_wordpress/maridb/my.cnf</span><br><span class="line">      dest: /etc</span><br><span class="line"></span><br><span class="line">  - name: 启动mariadb服务</span><br><span class="line">    service:</span><br><span class="line">      name: mariadb</span><br><span class="line">      state: started</span><br><span class="line">      enabled: True</span><br><span class="line"></span><br><span class="line">  <span class="comment"># - name: 创建管理用户密码</span></span><br><span class="line">  <span class="comment">#   shell: mysqladmin -uroot password &#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">  - name: 创建wordprss数据库</span><br><span class="line">    mysql_db:</span><br><span class="line">      login_user: root</span><br><span class="line">      login_password: 123</span><br><span class="line">      name: wordpress</span><br><span class="line">      state: present</span><br><span class="line"></span><br><span class="line">  - name: 推送wordprss数据</span><br><span class="line">    copy:</span><br><span class="line">      src: /root/ansible_wordpress/maridb/wordpress.sql</span><br><span class="line">      dest: /opt</span><br><span class="line"></span><br><span class="line">  - name: 导入wordprss数据</span><br><span class="line">    mysql_db:</span><br><span class="line">      login_user: root</span><br><span class="line">      login_password: 123</span><br><span class="line">      name: wordpress</span><br><span class="line">      target: /opt/wordpress.sql</span><br><span class="line">      state: import</span><br><span class="line"></span><br><span class="line">  - name: 创建wordpress用户</span><br><span class="line">    mysql_user:</span><br><span class="line">      login_user: root</span><br><span class="line">      login_password: 123</span><br><span class="line">      name: wp_user</span><br><span class="line">      password: 123</span><br><span class="line">      host: <span class="string">&#x27;%&#x27;</span></span><br><span class="line">      priv: <span class="string">&#x27;*.*:ALL&#x27;</span> </span><br><span class="line">      state: present</span><br><span class="line">      </span><br><span class="line">  - name: 启动mariadb服务</span><br><span class="line">    service:</span><br><span class="line">      name: mariadb</span><br><span class="line">      state: started</span><br><span class="line">      enabled: True</span><br></pre></td></tr></table></figure><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_sre/EN~XKDIPBVRK.png" alt="EN~XKDIPBVRK"></p>]]></content>
      
      
      <categories>
          
          <category> ansible自动化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ansible </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ansible常用模块(2)</title>
      <link href="/2023/01/07/ansible/02.Ansible%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97/"/>
      <url>/2023/01/07/ansible/02.Ansible%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Ad-hoc常用模块"><a href="#Ad-hoc常用模块" class="headerlink" title="Ad-hoc常用模块"></a>Ad-hoc常用模块</h1><h2 id="command模块、shell模块"><a href="#command模块、shell模块" class="headerlink" title="command模块、shell模块"></a>command模块、shell模块</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m shell -a &#x27;yum install -y httpd&#x27; </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m command -a &#x27;yum install -y httpd&#x27; </span></span><br><span class="line"></span><br><span class="line">注意：<span class="built_in">command</span>模块不支持特殊符号</span><br></pre></td></tr></table></figure><h2 id="script模块"><a href="#script模块" class="headerlink" title="script模块"></a>script模块</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#执行脚本 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-doc script</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行本机/root目录下的test.sh脚本 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m script -a &#x27;/root/test.sh&#x27; </span></span><br><span class="line"></span><br><span class="line">优势：无需将脚本放在其他的机器上</span><br></pre></td></tr></table></figure><h2 id="Ansible文件管理模块"><a href="#Ansible文件管理模块" class="headerlink" title="Ansible文件管理模块"></a>Ansible文件管理模块</h2><h3 id="file模块"><a href="#file模块" class="headerlink" title="file模块"></a>file模块</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#file模块动作 </span></span><br><span class="line">src：指定软链接的源文件 </span><br><span class="line">dest：指定软链接的目标文件 </span><br><span class="line">path：指定文件路径 </span><br><span class="line">owner：指定文件属主 </span><br><span class="line">group：指定文件属组 </span><br><span class="line">mode：指定文件权限 </span><br><span class="line">recurse：递归 </span><br><span class="line">state：</span><br><span class="line">- <span class="built_in">touch</span> 创建文件 </span><br><span class="line">- absent 删除 </span><br><span class="line">- directory 创建目录 </span><br><span class="line">- <span class="built_in">link</span> 软链接 </span><br><span class="line">- hard 硬链接</span><br><span class="line"></span><br><span class="line"><span class="comment">## 在/opt目录下创建test目录 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m file -a &#x27;path=/opt/test state=directory&#x27; </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 在/opt目录下创建efg目录 属主www 属组www 权限200 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m file -a &#x27;path=/opt/efg owner=www group=www mode=200 state=directory&#x27; </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 在/opt目录下创建文件abc 属主www 属组www 权限200 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m file -a &#x27;path=/opt/abc owner=www group=www mode=200 state=touch&#x27; </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除创建软链接文件 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m file -a &#x27;path=/usr/opt_test_link state=absent&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="copy模块"><a href="#copy模块" class="headerlink" title="copy模块"></a>copy模块</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#作用：统一配置管理 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#动作：</span></span><br><span class="line">src：指定源文件的路径 </span><br><span class="line">dest：指定目标路径 </span><br><span class="line">owner：指定属主 </span><br><span class="line">group：指定属组 </span><br><span class="line">mode：指定权限</span><br><span class="line">backup：备份 </span><br><span class="line">- <span class="built_in">yes</span> 备份 True </span><br><span class="line">- no 不备份 False 默认 </span><br><span class="line">remote_src：远端的源文件 </span><br><span class="line">- <span class="built_in">yes</span>/True </span><br><span class="line">- no/False </span><br><span class="line">content：指定内容写入文件</span><br><span class="line"></span><br><span class="line"><span class="comment">## 将管理端的配置文件下发到被管理端 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m copy -a &#x27;src=/root/www.zls.com.conf dest=/opt&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 使用backup做备份 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m copy -a &#x27;src=/root/www.zls.com.conf dest=/opt backup=true&#x27; </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 指定属主和属组 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m copy -a &#x27;src=/root/www.zls.com.conf dest=/opt owner=www group=www mode=644&#x27; </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## remote_src指定源文件在远端 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m copy -a &#x27;src=/opt/abc dest=/tmp remote_src=true&#x27; </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## content往指定文件中写入内容 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m copy -a &#x27;dest=/opt/rsync.passwd content=&quot;rsync_backup:123456&quot; mode=600&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="get-url"><a href="#get-url" class="headerlink" title="get_url"></a>get_url</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## wget 下载文件 </span></span><br><span class="line"><span class="comment">## 查看帮助 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-doc get_url </span></span><br><span class="line"><span class="comment">## 动作 </span></span><br><span class="line">url：下载的网址 dest：下载的路径 mode：指定权限 </span><br><span class="line"></span><br><span class="line"><span class="comment">## 下载wordpress </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m get_url -a &#x27;url=&quot;http://test.driverzeng.com/Nginx_Code/QQ2.8.zip&quot; dest=/opt mode=777&#x27; </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 下载阿里云的base源 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m get_url -a &#x27;url=&quot;https://mirrors.aliyun.com/repo/Centos-7.repo&quot; dest=/opt/CentOS-Base.repo&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Ansible软件管理模块"><a href="#Ansible软件管理模块" class="headerlink" title="Ansible软件管理模块"></a>Ansible软件管理模块</h2><h3 id="yum模块"><a href="#yum模块" class="headerlink" title="yum模块"></a>yum模块</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装rpm包 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-doc yum </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 动作： </span></span><br><span class="line">name：指定安装包的名字 </span><br><span class="line">- http:// 从指定的url下载 yum install -y http://网址 </span><br><span class="line">- file:// 从本地rpm包安装 yum localinstall </span><br><span class="line">- 包名 从yum仓库中下载 yum install -y 包名 </span><br><span class="line">state：</span><br><span class="line">- absent/removed：卸载 yum remove </span><br><span class="line">- present/installed：安装 yum install 默认 </span><br><span class="line">- latest：安装最新版本</span><br><span class="line">download_only：只下载不安装 </span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装nginx和mysql客户端 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m yum -a &#x27;name=nginx,mariadb&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="yum-repository"><a href="#yum-repository" class="headerlink" title="yum_repository"></a>yum_repository</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">## 管理yum源，yum仓库 </span></span><br><span class="line"> [root@m01 ~]<span class="comment"># ansible-doc yum_repository</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">## yum源配置文件 </span></span><br><span class="line"> [base] </span><br><span class="line"> name=xxxx </span><br><span class="line"> baseurl=http://xxx </span><br><span class="line"> gpgcheck=0 </span><br><span class="line"> gpgkey=file://xxx </span><br><span class="line"> <span class="built_in">enable</span>=1</span><br><span class="line"> </span><br><span class="line"> <span class="comment">## 动作： </span></span><br><span class="line"> name：仓库的名字[base] </span><br><span class="line"> description：仓库的描述信息 name=xxxx </span><br><span class="line"> baseurl：仓库的url地址 baseurl=http://xxx </span><br><span class="line"> file：如果没有指定file则文件名和name指定的一致，如果指定了file，文件名为file指定的内容，仓库名为 name指定的内容 </span><br><span class="line"> owner：指定属主 </span><br><span class="line"> group：指定属组 </span><br><span class="line"> mode：指定权限 </span><br><span class="line"> gpgcheck：秘钥对检测 </span><br><span class="line"> - <span class="built_in">yes</span>/True gpgcheck=1 </span><br><span class="line"> - no/False gpgcheck=0 </span><br><span class="line"> enabled：是否开启仓库 </span><br><span class="line"> - <span class="built_in">yes</span>/True <span class="built_in">enable</span>=1 </span><br><span class="line"> - no/False <span class="built_in">enable</span>=0</span><br><span class="line"> state：</span><br><span class="line"> - present：创建仓库 </span><br><span class="line"> - absent：删除仓库</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 创建nginx官方的yum源 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m yum_repository -a &#x27;name=nginx-stable description=&quot;nginx stable repo&quot; baseurl=http://nginx.org/packages/centos/$releasever/$basearch/ gpgcheck=false enabled=true&#x27;</span></span><br><span class="line"><span class="comment">## 结果 </span></span><br><span class="line">[root@web01 ~]<span class="comment"># vim /etc/yum.repos.d/nginx-stable.repo </span></span><br><span class="line">[nginx-stable]</span><br><span class="line">baseurl = http://nginx.org/packages/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/ </span><br><span class="line">enabled = 1 </span><br><span class="line">gpgcheck = 0 </span><br><span class="line">name = nginx stable repo</span><br><span class="line"></span><br><span class="line"><span class="comment">## 使用file指定yum源的文件名 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m yum_repository -a &#x27;name=nginx-stable description=&quot;nginx stable repo&quot; baseurl=http://nginx.org/packages/centos/$releasever/$basearch/ gpgcheck=false enabled=true file=nginx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除仓库 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m yum_repository -a &#x27;name=nginx-stable file=nginx state=absent&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 追加仓库到同一个文件中 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m yum_repository -a &#x27;name=nginx-mainline description=&quot;nginx mainline repo&quot; baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/ gpgcheck=false enabled=true file=nginx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除指定的仓库名 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m yum_repository -a &#x27;name=nginx-mainline file=nginx state=absent&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Ansible服务管理模块"><a href="#Ansible服务管理模块" class="headerlink" title="Ansible服务管理模块"></a>Ansible服务管理模块</h2><h3 id="service、systemd"><a href="#service、systemd" class="headerlink" title="service、systemd"></a>service、systemd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 管理服务启停 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-doc service </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 动作： </span></span><br><span class="line">name：指定服务名字 </span><br><span class="line">state：</span><br><span class="line">- started 开启服务 </span><br><span class="line">- reloaded 重新加载服务 </span><br><span class="line">- stopped 停止服务 </span><br><span class="line">- restarted 重启服务 </span><br><span class="line">enabled：开机自启 </span><br><span class="line">- <span class="built_in">yes</span>/True 加入开机自启 </span><br><span class="line">- no/False 不加入开机自启 默认 </span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动nginx并加入开机自启 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m service -a &#x27;name=nginx state=started enabled=true&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Ansible用户管理模块"><a href="#Ansible用户管理模块" class="headerlink" title="Ansible用户管理模块"></a>Ansible用户管理模块</h2><h3 id="user"><a href="#user" class="headerlink" title="user"></a>user</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 创建用户 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-doc user </span></span><br><span class="line">useradd www -u 666 -g 666 -s /sbin/nologin -M </span><br><span class="line">-c：描述信息</span><br><span class="line"></span><br><span class="line"><span class="comment">## 动作： </span></span><br><span class="line">name：用户名 </span><br><span class="line">comment：-c指定用户描述信息 </span><br><span class="line">uid：-u指定用户的uid </span><br><span class="line">group： -g指定用户的组 gid </span><br><span class="line">shell： -s指定用户登录的shell -s /sbin/nologin </span><br><span class="line">append：-a 指定附加组并追加附加组 </span><br><span class="line"><span class="built_in">groups</span>：-G指定用户附加组 </span><br><span class="line">state：</span><br><span class="line">- absent 删除用户 userdel </span><br><span class="line">- present 创建用户 useradd 默认 </span><br><span class="line">remove： </span><br><span class="line">- <span class="built_in">yes</span>/True userdel -r 删除用户和用户相关的文件 </span><br><span class="line">- no/False 默认 </span><br><span class="line">ssh_key_bits：创建用户时，创建私钥，私钥的位数 2048 </span><br><span class="line">ssh_key_file：指定私钥的位置 </span><br><span class="line">create_home： </span><br><span class="line">- <span class="built_in">yes</span>/True 创建用户同时创建家目录 默认 </span><br><span class="line">- no/False 创建用户不创建家目录</span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建www用户禁止登陆，不创建家目录 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m user -a &#x27;name=www uid=666 group=666 shell=/sbin/nologin create_home=false&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="group"><a href="#group" class="headerlink" title="group"></a>group</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 管理用户组 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-doc group </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 动作：</span></span><br><span class="line">name：指定组名字 </span><br><span class="line">gid：指定组<span class="built_in">id</span> </span><br><span class="line">state：</span><br><span class="line">- present 创建组 groupadd 默认 </span><br><span class="line">- absent 删除组 groupdel </span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建一个www组并且gid是666 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m group -a &#x27;name=www gid=666&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Ansible定时任务模块"><a href="#Ansible定时任务模块" class="headerlink" title="Ansible定时任务模块"></a>Ansible定时任务模块</h2><h3 id="cron"><a href="#cron" class="headerlink" title="cron"></a>cron</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 管理定时任务 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-doc cron </span></span><br><span class="line">00 04 * * * /usr/bin/ntpdate time1.aliyun.com &amp;&gt;/dev/null </span><br><span class="line"></span><br><span class="line"><span class="comment">## 动作: </span></span><br><span class="line">name：定时任务注释信息 </span><br><span class="line">minute：分 00 </span><br><span class="line">hour：时 04 day：日 </span><br><span class="line">month：月</span><br><span class="line">weekday：周 </span><br><span class="line">job：执行的任务 /bin/ls </span><br><span class="line">state：</span><br><span class="line">- present 创建定时任务 默认 </span><br><span class="line">- absent 删除定时任务 </span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建时间同步定时任务 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m cron -a &#x27;name=&quot;time sync&quot; minute=00 hour=04 job=&quot;/usr/bin/ntpdate time1.aliyun.com &amp;&gt;/dev/null&quot;&#x27; </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除定时任务 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m cron -a &#x27;name=&quot;time sync&quot; state=absent&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Ansible磁盘挂载模块"><a href="#Ansible磁盘挂载模块" class="headerlink" title="Ansible磁盘挂载模块"></a>Ansible磁盘挂载模块</h2><h3 id="mount"><a href="#mount" class="headerlink" title="mount"></a>mount</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 管理磁盘挂载 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-doc mount </span></span><br><span class="line">mount -t nfs 172.16.1.31:/data /code/wordpress/wp-content/uploads </span><br><span class="line"></span><br><span class="line"><span class="comment">## 动作：</span></span><br><span class="line">path：挂载路径 /code/wordpress/wp-content/uploads </span><br><span class="line">src：挂载源 172.16.1.31:/data </span><br><span class="line">fstype：文件类型 -t nfs </span><br><span class="line">state：</span><br><span class="line">- present：只将挂载信息记录在/etc/fstab中（开机挂载） </span><br><span class="line">- mounted：立刻挂载，并将配置写入/etc/fstab中 </span><br><span class="line">- unmounted：卸载设备，但是不会清除/etc/fstab中的内容 </span><br><span class="line">- absent：卸载设备，并清除/etc/fstab中的内容 </span><br><span class="line"></span><br><span class="line">挂载：mounted </span><br><span class="line">卸载：absent</span><br><span class="line"></span><br><span class="line">mount -o rw,remount / </span><br><span class="line">opts: 指定挂载路径是否可读可写 rw,remount</span><br><span class="line"></span><br><span class="line"><span class="comment">## 挂载nfs </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m mount -a &#x27;path=/code/wordpress/wp-content/uploads src=172.16.1.31:/data fstype=nfs state=mounted&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Ansible解压模块"><a href="#Ansible解压模块" class="headerlink" title="Ansible解压模块"></a>Ansible解压模块</h2><h3 id="unarchive"><a href="#unarchive" class="headerlink" title="unarchive"></a>unarchive</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压一切压缩包 </span></span><br><span class="line"><span class="comment">## 动作 </span></span><br><span class="line">src：指定压缩包路径 </span><br><span class="line">dest：指定解压的目标路径 </span><br><span class="line">owner：属主 </span><br><span class="line">group：数组 </span><br><span class="line">mode：权限 </span><br><span class="line">remote_src：告诉ansible压缩包在远端的服务器上 </span><br><span class="line">- <span class="built_in">yes</span>/True </span><br><span class="line">- no/False 默认</span><br></pre></td></tr></table></figure><h2 id="Ansible数据库模块"><a href="#Ansible数据库模块" class="headerlink" title="Ansible数据库模块"></a>Ansible数据库模块</h2><h3 id="mysql-user"><a href="#mysql-user" class="headerlink" title="mysql_user"></a>mysql_user</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 作用：管理mysql用户 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-doc mysql_user </span></span><br><span class="line">mysql -uroot -p123 grant all on *.* to wp_user@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 动作 </span></span><br><span class="line">name：指定用户名 wp_user </span><br><span class="line">host：指定允许连接的IP主机 % </span><br><span class="line">password：指定密码 123 </span><br><span class="line">priv：指定权限 <span class="string">&#x27;*.*:ALL&#x27;</span> </span><br><span class="line">login_user：MySQL登录的用户 root </span><br><span class="line">login_password：MySQL登录用户root的密码 123 </span><br><span class="line">state：</span><br><span class="line">- present 创建 </span><br><span class="line">- absent 删除</span><br><span class="line"></span><br><span class="line"><span class="comment">## MySQL 跳过反向解析，不让IP地址解析成主机名 </span></span><br><span class="line">vim /etc/my.cnf </span><br><span class="line">[mysqld] </span><br><span class="line">skip_name_resolve </span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># systemctl restart mariadb</span></span><br><span class="line">[root@db01 ~]<span class="comment"># mysql -utest -p123 -h172.16.1.51</span></span><br></pre></td></tr></table></figure><h3 id="mysql-db"><a href="#mysql-db" class="headerlink" title="mysql_db"></a>mysql_db</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 管理mysql库</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-doc mysql_db</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 创建数据库 </span></span><br><span class="line">create database wordpress; </span><br><span class="line"><span class="comment">### 导出wordpress库数据 </span></span><br><span class="line">mysqldump -uroot -p123 -B wordpress &gt; /tmp/wordpress.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">## 动作</span></span><br><span class="line">name：指定库名 </span><br><span class="line">wordpress target：导出数据指定存放sql文件的路径 </span><br><span class="line">login_user：指定登录的用户 </span><br><span class="line">login_password：指定登录的密码 </span><br><span class="line">state：</span><br><span class="line">- present 创建 </span><br><span class="line">- absent 删除 </span><br><span class="line">  - import 导入数据</span><br><span class="line">- dump 导出数据 </span><br></pre></td></tr></table></figure><h2 id="setup模块"><a href="#setup模块" class="headerlink" title="setup模块"></a>setup模块</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取主机信息</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web01 -m setup -i /root/wordpress_ansible/base/hosts</span></span><br><span class="line">ansible_all_ipv4_addresses：仅显示ipv4的信息</span><br><span class="line">ansible_devices：仅显示磁盘设备信息</span><br><span class="line">ansible_distribution：显示是什么系统，例：centos,suse等</span><br><span class="line">ansible_distribution_major_version：显示是系统主版本</span><br><span class="line">ansible_distribution_version：仅显示系统版本</span><br><span class="line">ansible_machine：显示系统类型，例：32位，还是64位</span><br><span class="line">ansible_eth0：仅显示eth0的信息</span><br><span class="line">ansible_hostname：仅显示主机名</span><br><span class="line">ansible_kernel：仅显示内核版本</span><br><span class="line">ansible_lvm：显示lvm相关信息</span><br><span class="line">ansible_memtotal_mb：显示系统总内存</span><br><span class="line">ansible_memfree_mb：显示可用系统内存</span><br><span class="line">ansible_memory_mb：详细显示内存情况</span><br><span class="line">ansible_swaptotal_mb：显示总的swap内存</span><br><span class="line">ansible_swapfree_mb：显示swap内存的可用内存</span><br><span class="line">ansible_mounts：显示系统磁盘挂载情况</span><br><span class="line">ansible_processor：显示cpu个数(具体显示每个cpu的型号)</span><br><span class="line">ansible_processor_vcpus：显示cpu个数(只显示总的个数)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 主机名 </span></span><br><span class="line">ansible_hostname // 显示第一个.之前的主机名 </span><br><span class="line">ansible_fqdn // 显示完整的主机名 </span><br><span class="line"></span><br><span class="line"><span class="comment">## 内存 </span></span><br><span class="line">ansible_memtotal_mb // 总内存 </span><br><span class="line">ansible_memfree_mb // 空闲内存 </span><br><span class="line">ansible_swaptotal_mb // 总虚拟内存 </span><br><span class="line">ansible_swapfree_mb // 空闲虚拟内存</span><br><span class="line"></span><br><span class="line"><span class="comment">## CPU </span></span><br><span class="line">ansible_processor_cores // cpu核心数 </span><br><span class="line"></span><br><span class="line"><span class="comment">## 系统 </span></span><br><span class="line">ansible_os_family // 系统类型 </span><br><span class="line">RedHat Debain ansible_distribution // 系统发行版 </span><br><span class="line">CentOS ansible_distribution_major_version // 版本号 7 </span><br><span class="line">ansible_distribution_version // 详细版本号 7.6 </span><br><span class="line"></span><br><span class="line"><span class="comment">## IP相关 </span></span><br><span class="line">ansible_dns.nameservers // DNS </span><br><span class="line">ansible_default_ipv4.address // eth0外网IP </span><br><span class="line">ansible_eth0.ipv4.address // eth0外网IP </span><br><span class="line">ansible_eth1.ipv4.address // eth1内网IP </span><br><span class="line"></span><br><span class="line"><span class="comment">## 磁盘 </span></span><br><span class="line">ansible_devices.sda.partitions.sda1.size // sda1分区的磁盘大小：/boot分区 </span><br><span class="line">ansible_devices.sda.partitions.sda3.size // sda3分区的磁盘大小: /分区</span><br></pre></td></tr></table></figure><h2 id="快速搭建rsync"><a href="#快速搭建rsync" class="headerlink" title="快速搭建rsync"></a>快速搭建rsync</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 准备rsync配置文件 </span></span><br><span class="line">uid = rsync </span><br><span class="line">gid = rsync </span><br><span class="line">port = 873 </span><br><span class="line">fake super = <span class="built_in">yes</span> </span><br><span class="line">use <span class="built_in">chroot</span> = no </span><br><span class="line">max connections = 200 </span><br><span class="line"><span class="built_in">timeout</span> = 600 </span><br><span class="line">ignore errors </span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span> </span><br><span class="line">list = <span class="literal">false</span> </span><br><span class="line">auth <span class="built_in">users</span> = rsync_backup </span><br><span class="line">secrets file = /etc/rsync.passwd </span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log </span><br><span class="line"><span class="comment">##################################### </span></span><br><span class="line">[backup] </span><br><span class="line">comment = welcome to oldboyedu backup! </span><br><span class="line">path = /backup</span><br><span class="line"></span><br><span class="line"><span class="comment">#1.安装rsync </span></span><br><span class="line">ansible web01 -m yum -a <span class="string">&#x27;name=rsync&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.修改配置文件 </span></span><br><span class="line">ansible web01 -m copy -a <span class="string">&#x27;src=/root/rsyncd.conf dest=/etc/&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#3.创建密码文件 </span></span><br><span class="line">ansible web01 -m copy -a <span class="string">&#x27;content=&quot;rsync_backup:123456&quot; dest=/etc/rsync.pass mode=600&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#4.创建 www用户 </span></span><br><span class="line">ansible web01 -m group -a <span class="string">&#x27;name=www gid=666&#x27;</span> ansible web01 -m user -a <span class="string">&#x27;name=www uid=666 group=666 shell=/sbin/nologin create_home=false&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#5.创建备份目录 </span></span><br><span class="line">ansible web01 -m file -a <span class="string">&#x27;path=/backup owner=www group=www state=directory&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#6.启动服务 </span></span><br><span class="line">ansible web01 -m service -a <span class="string">&#x27;name=rsyncd state=started enabled=true&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#7.客户端 </span></span><br><span class="line">ansible web02 -m yum -a <span class="string">&#x27;name=rsync&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#8.创建密码文件 </span></span><br><span class="line">ansible web02 -m copy -a <span class="string">&#x27;content=&quot;123456&quot; dest=/etc/rsync.pass mode=600&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><p>1.部署rsync</p><p>2.部署nfs</p><p>3.部署httpd，载上传作业的目录</p><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#zuoye代码压缩包 </span></span><br><span class="line"><span class="comment">#rsync配置文件 </span></span><br><span class="line">uid = www </span><br><span class="line">gid = www </span><br><span class="line">port = 873 </span><br><span class="line">fake super = <span class="built_in">yes</span> </span><br><span class="line">use <span class="built_in">chroot</span> = no </span><br><span class="line">max connections = 200 </span><br><span class="line"><span class="built_in">timeout</span> = 600 </span><br><span class="line">ignore errors </span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span> </span><br><span class="line">list = <span class="literal">false</span> </span><br><span class="line">auth <span class="built_in">users</span> = rsync_backup </span><br><span class="line">secrets file = /etc/rsync.passwd </span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log </span><br><span class="line"><span class="comment">##################################### </span></span><br><span class="line">[backup] </span><br><span class="line">comment = welcome to oldboyedu backup! </span><br><span class="line">path = /backup </span><br><span class="line"></span><br><span class="line"><span class="comment">#httpd配置文件 </span></span><br><span class="line">User www </span><br><span class="line">Group www</span><br><span class="line"></span><br><span class="line">[root@m01 web]<span class="comment"># ll</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#主机清单 </span></span><br><span class="line">[root@m01]<span class="comment"># vim /etc/ansible/hosts </span></span><br><span class="line">[web_group] </span><br><span class="line">web01 ansible_ssh_host=10.0.0.7 web02 ansible_ssh_host=10.0.0.8 </span><br><span class="line"></span><br><span class="line">[nfs_group] </span><br><span class="line">nfs ansible_ssh_host=10.0.0.31 </span><br><span class="line"></span><br><span class="line">[backup_group] </span><br><span class="line">backup ansible_ssh_host=10.0.0.41</span><br><span class="line"></span><br><span class="line">[rsyncd:children]</span><br><span class="line">nfs_group</span><br><span class="line">backup_group</span><br><span class="line"></span><br><span class="line"><span class="comment">#推送公钥</span></span><br><span class="line">[root@m01]<span class="comment"># yum install -y sshpass</span></span><br><span class="line">[root@m01]<span class="comment"># sh ssh_key.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">. /etc/init.d/functions</span><br><span class="line"><span class="built_in">ls</span> -l ~/.ssh/id_rsa &amp;&gt;/dev/null || ssh-keygen -t rsa -P <span class="string">&#x27;&#x27;</span> -f ~/.ssh/id_rsa &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> 7 8 31 41;<span class="keyword">do</span></span><br><span class="line">        sshpass -p 123 ssh-copy-id -o <span class="string">&#x27;StrictHostKeyChecking no&#x27;</span> -i ~/.ssh/id_rsa.pub root@10.0.0.<span class="variable">$n</span> &amp;&gt;/dev/null &amp;&amp; \</span><br><span class="line">        action <span class="string">&quot;10.0.0.<span class="variable">$n</span> send public key &quot;</span> /bin/true || \</span><br><span class="line">        action <span class="string">&quot;10.0.0.<span class="variable">$n</span> send public key &quot;</span> /bin/false</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><table><thead><tr><th align="center">主机名</th><th align="center">WanIP</th><th align="center">LanIP</th><th align="center">角色</th><th align="center">应用</th></tr></thead><tbody><tr><td align="center">m01</td><td align="center">10.0.0.61</td><td align="center">172.16.1.61</td><td align="center">ansible管理机</td><td align="center">ansible</td></tr><tr><td align="center">web01</td><td align="center">10.0.0.7</td><td align="center">172.16.1.7</td><td align="center">作业网站</td><td align="center">httpd、php、nfs</td></tr><tr><td align="center">web02</td><td align="center">10.0.0.8</td><td align="center">172.16.1.8</td><td align="center">作业网站</td><td align="center">httpd、php、nfs</td></tr><tr><td align="center">nfs</td><td align="center">10.0.0.31</td><td align="center">172.16.1.31</td><td align="center">共享存储</td><td align="center">nfs、rsync</td></tr><tr><td align="center">backup</td><td align="center">10.0.0.41</td><td align="center">172.16.1.41</td><td align="center">实时同步备份</td><td align="center">nfs、rsync</td></tr></tbody></table><h3 id="编写Ad-hoc"><a href="#编写Ad-hoc" class="headerlink" title="编写Ad-hoc"></a>编写Ad-hoc</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建www用户</span></span><br><span class="line">ansible all -m group -a <span class="string">&#x27;name=www gid=666&#x27;</span></span><br><span class="line">ansible all -m user -a <span class="string">&#x27;name=www uid=666 group=666 shell=/sbin/nologin create_home=false&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1.安装rsync,nfs </span></span><br><span class="line">ansible rsyncd -m yum -a <span class="string">&#x27;name=rsync,nfs-utils state=present&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.rsync服务端操作 </span></span><br><span class="line">ansible backup -m copy -a <span class="string">&#x27;src=/root/web/rsyncd.conf dest=/etc/&#x27;</span> </span><br><span class="line">ansible backup -m copy -a <span class="string">&#x27;content=rsync_backup:123 dest=/etc/rsync.passwd mode=600&#x27;</span></span><br><span class="line">ansible backup -m file -a <span class="string">&#x27;path=/backup owner=www group=www mode=755 state=directory&#x27;</span></span><br><span class="line">ansible backup -m service -a <span class="string">&#x27;name=rsyncd state=started&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.rsync客户端 </span></span><br><span class="line">ansible nfs -m copy -a <span class="string">&#x27;content=123 dest=/etc/rsync.passwd mode=600&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4.nfs服务端 </span></span><br><span class="line">ansible nfs -m copy -a <span class="string">&#x27;content=&quot;/data 172.16.1.0/24(rw,sync,anonuid=666,anongid=666,all_squash)&quot; dest=/etc/exports&#x27;</span> </span><br><span class="line">ansible nfs -m file -a <span class="string">&#x27;path=/data owner=www group=www mode=755 state=directory&#x27;</span> </span><br><span class="line">ansible nfs -m service -a <span class="string">&#x27;name=nfs state=started&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#5.web服务器操作 </span></span><br><span class="line">ansible web_group -m yum -a <span class="string">&#x27;name=httpd,php state=present&#x27;</span> </span><br><span class="line">ansible web_group -m copy -a <span class="string">&#x27;src=/root/web/httpd.conf dest=/etc/httpd/conf&#x27;</span> </span><br><span class="line">ansible web_group -m unarchive -a <span class="string">&#x27;src=/root/web/kaoshi_modify.zip dest=/var/www/html owner=www group=www&#x27;</span> </span><br><span class="line">ansible web_group -m file -a <span class="string">&#x27;path=/var/www/html/user_data owner=www group=www state=directory&#x27;</span> </span><br><span class="line">ansible web_group -m mount -a <span class="string">&#x27;src=172.16.1.31:/data fstype=nfs path=/var/www/html/user_data state=mounted&#x27;</span> </span><br><span class="line">ansible web_group -m service -a <span class="string">&#x27;name=httpd state=started&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ansible自动化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ansible </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ansible基础入门(1)</title>
      <link href="/2023/01/07/ansible/01.Ansible%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/"/>
      <url>/2023/01/07/ansible/01.Ansible%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Ansible基础入门"><a href="#Ansible基础入门" class="headerlink" title="Ansible基础入门"></a>Ansible基础入门</h1><h2 id="Ansible基础概述"><a href="#Ansible基础概述" class="headerlink" title="Ansible基础概述"></a>Ansible基础概述</h2><p>Ansible是一个自动化统一配置管理工具，自动化主要体现在Ansible集成了丰富模块以及功能组件，可以通过一个命令完成一系列的操作，进而能减少重复性的工作和维护成本，可以提高工作效率</p><h2 id="同类型软件对比"><a href="#同类型软件对比" class="headerlink" title="同类型软件对比"></a>同类型软件对比</h2><ul><li><p>Ansible</p></li><li><p>Saltstack</p></li><li><p>puppet</p></li></ul><table><thead><tr><th align="center">对比</th><th align="center">puppet</th><th align="center">Ansible</th><th align="center">Saltstack</th></tr></thead><tbody><tr><td align="center">开发语言</td><td align="center">ruby</td><td align="center">python</td><td align="center">Python</td></tr><tr><td align="center">远程执行功能</td><td align="center">没有</td><td align="center">有、串行</td><td align="center">有、并行</td></tr><tr><td align="center">客户端</td><td align="center">没有</td><td align="center">没有</td><td align="center">有</td></tr><tr><td align="center">架构</td><td align="center"></td><td align="center">SSH</td><td align="center">C&#x2F;S、也支持SSH</td></tr></tbody></table><h2 id="Ansible的功能"><a href="#Ansible的功能" class="headerlink" title="Ansible的功能"></a>Ansible的功能</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1.远程执行 批量执行远程命令，可以对多台主机进行远程操作 </span><br><span class="line">2.配置管理 批量配置软件服务，可以进行自动化方式配置，服务的统一配置管理，和启停 </span><br><span class="line">3.事件驱动 通过Ansible的模块，对服务进行不同的事件驱动 比如： </span><br><span class="line">1）修改配置后重启 </span><br><span class="line">2）只修改配置文件，不重启 </span><br><span class="line">3）修改配置文件后，重新加载 </span><br><span class="line">4）远程启停服务管理 </span><br><span class="line">4.管理公有云 通过API接口的方式管理公有云，不过这方面做的不如saltstack. saltstack本身可以通过saltcloud管理各大云厂商的云平台</span><br><span class="line">5.二次开发 因为语法是Python，所以便于运维进行二次开发</span><br><span class="line">6.任务编排 可以通过playbook的方式来统一管理服务，并且可以使用一条命令，实现一套架构的部署 123456789101112131415161718192021222324</span><br><span class="line">7.跨平台，跨系统 </span><br><span class="line">几乎不受到平台和系统的限制，比如安装apache和启动+服务 </span><br><span class="line">在Ubuntu上安装apache服务名字叫apache2 </span><br><span class="line">在CentOS上安装apache服务名字叫httpd </span><br><span class="line"></span><br><span class="line">在CentOS6上启动服务器使用命令：/etc/init.d/nginx start </span><br><span class="line">在CentOS7上启动服务器使用命令：systemctl start nginx</span><br></pre></td></tr></table></figure><h2 id="Ansible的架构"><a href="#Ansible的架构" class="headerlink" title="Ansible的架构"></a>Ansible的架构</h2><ol><li><p>连接插件connection plugins用于连接主机 用来连接被管理端 </p></li><li><p>核心模块core modules连接主机实现操作， 它依赖于具体的模块来做具体的事情 </p></li><li><p>自定义模块custom modules根据自己的需求编写具体的模块 </p></li><li><p>插件plugins完成模块功能的补充 </p></li><li><p>剧本playbookansible的配置文件,将多个任务定义在剧本中，由ansible自动执行 </p></li><li><p>主机清单inventor定义ansible需要操作主机的范围</p></li></ol><p>最重要的一点是 ansible是模块化的 它所有的操作都依赖于模块</p><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/ansible%E6%9E%B6%E6%9E%84.jpg" alt="ansible架构"></p><h2 id="Ansible的执行流程"><a href="#Ansible的执行流程" class="headerlink" title="Ansible的执行流程"></a>Ansible的执行流程</h2><ol><li><p>Ansible读取playbook剧本，剧本中会记录对哪些主机执行哪些任务</p></li><li><p>首先Ansible通过主机清单找到要执行的主机，然后调用具体的模块</p></li><li><p>其次Ansible会通过连接插件连接对应的主机并推送对应的任务列表</p></li><li><p>最后被管理的主机会将Ansible发送过来的任务解析为本地Shell命令执行</p></li></ol><h2 id="Ansible安装部署"><a href="#Ansible安装部署" class="headerlink" title="Ansible安装部署"></a>Ansible安装部署</h2><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><table><thead><tr><th align="center">主机名</th><th align="center">WanIP</th><th align="center">LanIP</th><th align="center">角色</th></tr></thead><tbody><tr><td align="center">m01</td><td align="center">10.0.0.61</td><td align="center">172.16.1.61</td><td align="center">Ansible控制端</td></tr><tr><td align="center">web01</td><td align="center">10.0.0.7</td><td align="center">172.16.1.7</td><td align="center">被控端</td></tr><tr><td align="center">web02</td><td align="center">10.0.0.8</td><td align="center">172.16.1.8</td><td align="center">被控端</td></tr></tbody></table><h3 id="安装Ansible"><a href="#安装Ansible" class="headerlink" title="安装Ansible"></a>安装Ansible</h3><table><thead><tr><th align="center">选项</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">–version</td><td align="center">ansible版本信息</td></tr><tr><td align="center">-v</td><td align="center">显示详细信息</td></tr><tr><td align="center">-i</td><td align="center">主机清单文件路径，默认是在&#x2F;etc&#x2F;ansible&#x2F;hosts</td></tr><tr><td align="center">-m</td><td align="center">使用的模块名称，默认使用command模块</td></tr><tr><td align="center">-a</td><td align="center">使用的模块参数，模块的具体动作</td></tr><tr><td align="center">-k</td><td align="center">提示输入ssh密码，而不使用基于ssh的密钥认证</td></tr><tr><td align="center">-C</td><td align="center">模拟执行测试，但不会真的执行</td></tr><tr><td align="center">-T</td><td align="center">执行命令的超时</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.安装ansible 有epel源 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># yum install -y ansible</span></span><br><span class="line"></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible --version </span></span><br><span class="line"><span class="comment">## ansible版本号 </span></span><br><span class="line">ansible 2.9.27 </span><br><span class="line"><span class="comment">## ansible默认配置文件 </span></span><br><span class="line">config file = ca</span><br><span class="line"><span class="comment">## 配置文件模块路径 </span></span><br><span class="line">configured module search path = [u<span class="string">&#x27;/root/.ansible/plugins/modules&#x27;</span>, u<span class="string">&#x27;/usr/share/ansible/plugins/modules&#x27;</span>] </span><br><span class="line"><span class="comment">## python模块路径 </span></span><br><span class="line">ansible python module location = /usr/lib/python2.7/site-packages/ansible </span><br><span class="line"><span class="comment">## ansible可执行命令的路径 </span></span><br><span class="line">executable location = /usr/bin/ansible</span><br><span class="line"><span class="comment">## Python版本 </span></span><br><span class="line">python version = 2.7.5 (default, Oct 30 2018, 23:45:53) [GCC 4.8.5 20150623 (Red Hat 4.8.5-36)]</span><br></pre></td></tr></table></figure><h3 id="Ansible配置文件读取顺序"><a href="#Ansible配置文件读取顺序" class="headerlink" title="Ansible配置文件读取顺序"></a>Ansible配置文件读取顺序</h3><ol><li><p>$ANSIBLE_CONFIG </p></li><li><p>.ansible.cfg </p></li><li><p>~&#x2F;.ansible.cfg </p></li><li><p>&#x2F;etc&#x2F;ansible&#x2F;ansible.cfg</p></li></ol><h3 id="Ansible配置文件详解"><a href="#Ansible配置文件详解" class="headerlink" title="Ansible配置文件详解"></a>Ansible配置文件详解</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># vim /etc/ansible/ansible.cfg </span></span><br><span class="line"><span class="comment">#inventory      = /etc/ansible/hosts      #主机列表配置文件</span></span><br><span class="line"><span class="comment">#library        = /usr/share/my_modules/  #库文件存放目录</span></span><br><span class="line"><span class="comment">#remote_tmp     = ~/.ansible/tmp          #临时py文件存放在远程主机目录</span></span><br><span class="line"><span class="comment">#local_tmp      = ~/.ansible/tmp          #本机的临时执行目录</span></span><br><span class="line"><span class="comment">#forks          = 5                       #默认并发数</span></span><br><span class="line"><span class="comment">#sudo_user      = root                    #默认sudo用户</span></span><br><span class="line"><span class="comment">#ask_sudo_pass = True                     #每次执行是否询问sudo的ssh密码</span></span><br><span class="line"><span class="comment">#ask_pass      = True                     #每次执行是否询问ssh密码</span></span><br><span class="line"><span class="comment">#remote_port    = 22                      #远程主机端口</span></span><br><span class="line">host_key_checking = False                 <span class="comment">#跳过检查主机指纹</span></span><br><span class="line">log_path = /var/log/ansible.log           <span class="comment">#ansible日志</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#普通用户提权操作</span></span><br><span class="line">[privilege_escalation]</span><br><span class="line"><span class="comment">#become=True</span></span><br><span class="line"><span class="comment">#become_method=sudo</span></span><br><span class="line"><span class="comment">#become_user=root</span></span><br><span class="line"><span class="comment">#become_ask_pass=False </span></span><br></pre></td></tr></table></figure><h3 id="Ansible-Inventory-主机清单"><a href="#Ansible-Inventory-主机清单" class="headerlink" title="Ansible Inventory(主机清单)"></a>Ansible Inventory(主机清单)</h3><p>&#x2F;etc&#x2F;ansible&#x2F;hosts是ansible默认主机资产清单文件，用于定义被管理主机的认证信息， 例如ssh登录用户名、密码以及key相关信息。Inventory文件中填写需要被管理的主机与主机组信息。还可以自定义Inventory主机清单的位置，使用-i指定文件位置即可</p><h4 id="使用IP-端口-用户-密码"><a href="#使用IP-端口-用户-密码" class="headerlink" title="使用IP+端口+用户+密码"></a>使用IP+端口+用户+密码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># vim /etc/ansible/hosts </span></span><br><span class="line">[web_group] </span><br><span class="line">10.0.0.7 ansible_ssh_port=22 ansible_ssh_user=root ansible_ssh_pass=<span class="string">&#x27;123&#x27;</span> </span><br><span class="line">10.0.0.8 ansible_ssh_port=22 ansible_ssh_user=root ansible_ssh_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 检测web_group主机是否通 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m ping</span></span><br><span class="line">10.0.0.7 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">10.0.0.8 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line"></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m shell -a &#x27;df -h&#x27;</span></span><br><span class="line">10.0.0.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3        19G  1.5G   18G   8% /</span><br><span class="line">devtmpfs        476M     0  476M   0% /dev</span><br><span class="line">tmpfs           487M     0  487M   0% /dev/shm</span><br><span class="line">tmpfs           487M  7.7M  479M   2% /run</span><br><span class="line">tmpfs           487M     0  487M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1       497M  120M  378M  25% /boot</span><br><span class="line">tmpfs            98M     0   98M   0% /run/user/0</span><br><span class="line"></span><br><span class="line">10.0.0.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3        19G  1.5G   18G   8% /</span><br><span class="line">devtmpfs        476M     0  476M   0% /dev</span><br><span class="line">tmpfs           487M     0  487M   0% /dev/shm</span><br><span class="line">tmpfs           487M  7.7M  479M   2% /run</span><br><span class="line">tmpfs           487M     0  487M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1       497M  120M  378M  25% /boot</span><br><span class="line">tmpfs            98M     0   98M   0% /run/user/0</span><br></pre></td></tr></table></figure><h4 id="主机名-密码"><a href="#主机名-密码" class="headerlink" title="主机名+密码"></a>主机名+密码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 注意：该方式，需要做域名解析，把主机名解析在IP上，否则ansible无法识别 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/ansible/hosts </span></span><br><span class="line">[web_group] </span><br><span class="line">web0[1:2] ansible_ssh_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/hosts </span></span><br><span class="line">127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 </span><br><span class="line">localhost localhost.localdomain localhost6 localhost6.localdomain6 </span><br><span class="line">10.0.0.7 web01 </span><br><span class="line">10.0.0.8 web02</span><br><span class="line"></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m ping</span></span><br><span class="line">web01 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">web02 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="变量方式，主机名-密码"><a href="#变量方式，主机名-密码" class="headerlink" title="变量方式，主机名+密码"></a>变量方式，主机名+密码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 使用变量的写法 </span></span><br><span class="line">[web_group] </span><br><span class="line">web0[1:2] </span><br><span class="line">[web_group:vars] </span><br><span class="line">ansible_ssh_pass=<span class="string">&#x27;1&#x27;</span> </span><br><span class="line"></span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/hosts </span></span><br><span class="line">127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 </span><br><span class="line">localhost localhost.localdomain localhost6 localhost6.localdomain6 </span><br><span class="line">10.0.0.7 web01 </span><br><span class="line">10.0.0.8 web02</span><br></pre></td></tr></table></figure><h4 id="使用秘钥连接"><a href="#使用秘钥连接" class="headerlink" title="使用秘钥连接"></a>使用秘钥连接</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.先在管理机上生成秘钥对 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ssh-keygen </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.推送公钥 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_rsa.pub 172.16.1.7 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_rsa.pub 172.16.1.8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3.修改主机清单 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/ansible/hosts </span></span><br><span class="line">[web_group] </span><br><span class="line">10.0.0.7:22</span><br><span class="line">10.0.0.8:22</span><br><span class="line"></span><br><span class="line">[root@manage01 ~]<span class="comment"># ansible web_group -m ping</span></span><br><span class="line">10.0.0.8 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">10.0.0.7 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong</span></span><br></pre></td></tr></table></figure><h4 id="企业使用究极进化版（☆☆☆☆☆）"><a href="#企业使用究极进化版（☆☆☆☆☆）" class="headerlink" title="企业使用究极进化版（☆☆☆☆☆）"></a>企业使用究极进化版（☆☆☆☆☆）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#前提是推送秘钥</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/ansible/hosts </span></span><br><span class="line">[web_group] </span><br><span class="line">web01 ansible_ssh_host=10.0.0.7 ansible_ssh_port=22</span><br><span class="line">web02 ansible_ssh_host=10.0.0.8 ansible_ssh_port=22</span><br></pre></td></tr></table></figure><h4 id="配置主机标签组"><a href="#配置主机标签组" class="headerlink" title="配置主机标签组"></a><strong>配置主机标签组</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 标签组配置语法 </span></span><br><span class="line">[标签组名字:children] </span><br><span class="line">主机标签名1 </span><br><span class="line">主机标签名2 </span><br><span class="line"></span><br><span class="line">[lnmp:children] </span><br><span class="line">db_group</span><br><span class="line">web_group</span><br><span class="line"></span><br><span class="line"><span class="comment">## ansible主机写法： </span></span><br><span class="line"><span class="comment">### 主机清单中的所有主机 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible all -m ping</span></span><br><span class="line"><span class="comment">### 只针对某一台主机 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web01 -m ping </span></span><br><span class="line"><span class="comment">### 针对某一个IP </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible 10.0.0.7 -m ping </span></span><br><span class="line"><span class="comment">### 指定某一个标签名中的所有主机 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible web_group -m ping </span></span><br><span class="line"><span class="comment">### 指定某一个标签组中的所有主机 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible lnmp -m ping</span></span><br></pre></td></tr></table></figure><h1 id="Ansible执行任务"><a href="#Ansible执行任务" class="headerlink" title="Ansible执行任务"></a>Ansible执行任务</h1><ul><li><p>Ad-hoc</p></li><li><p>playbook</p></li></ul><p><img src="https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/ad-hoc%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8.jpg" alt="ad-hoc模式的命令使用"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ad-hoc语法： </span><br><span class="line">ansible 主机 -m 模块 -a 动作</span><br></pre></td></tr></table></figure><h3 id="ad-hoc结果返回颜色"><a href="#ad-hoc结果返回颜色" class="headerlink" title="ad-hoc结果返回颜色"></a>ad-hoc结果返回颜色</h3><ul><li><p>绿色：命令执行成功且无变化的颜色 </p></li><li><p>黄色：命令执行成功，但是有变化（有更改）</p></li><li><p>红色：命令执行失败，报错msg</p></li><li><p>粉色|紫色：Warning，警告一般无需处理</p></li></ul><h2 id="ansible查看帮助"><a href="#ansible查看帮助" class="headerlink" title="ansible查看帮助"></a>ansible查看帮助</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ansible-doc 模块名 </span><br><span class="line">找到帮助信息中的：EXAMPLES</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ansible自动化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ansible </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ansible流程控制(5)</title>
      <link href="/2023/01/07/ansible/05.Ansible%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/"/>
      <url>/2023/01/07/ansible/05.Ansible%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Ansible流程控制"><a href="#Ansible流程控制" class="headerlink" title="Ansible流程控制"></a>Ansible流程控制</h1><h2 id="条件语句（判断）"><a href="#条件语句（判断）" class="headerlink" title="条件语句（判断）"></a>条件语句（判断）</h2><p>当满足什么条件时，就执行哪些tasks</p><p>when  当….时</p><h3 id="ansible获取主机名"><a href="#ansible获取主机名" class="headerlink" title="ansible获取主机名"></a>ansible获取主机名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 主机名中，不包含&#x27;.&#x27; 没有区别</span></span><br><span class="line">ansible_hostname  <span class="comment"># 包含&#x27;.&#x27; 只显示第一个&#x27;.&#x27;前面的名字</span></span><br><span class="line">ansible_fqdn      <span class="comment"># 包含&#x27;.&#x27; 显示完整的主机名</span></span><br></pre></td></tr></table></figure><p>不管是shell还是各大编程语言中，流程控制，条件判断这些都是必不可少的，在我们使用Ansible的过程中，条件判断的使用频率极其高。<br>例如：<br>1.我们使用不同的系统的时候，可以通过判断系统来对软件包进行安装。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">centos安装apache: yum install -y httpd</span><br><span class="line">unbuntu安装apache: apt-get install apache2</span><br><span class="line"></span><br><span class="line">tasks:</span><br><span class="line">  - name: <span class="string">&quot;shut down Debian flavored systems&quot;</span></span><br><span class="line">    <span class="built_in">command</span>: /sbin/shutdown -t now</span><br><span class="line">    when: ansible_facts[<span class="string">&#x27;os_family&#x27;</span>] == <span class="string">&quot;Debian&quot;</span></span><br><span class="line">    </span><br><span class="line">tasks:</span><br><span class="line">  - name: <span class="string">&quot;shut down Debian flavored systems&quot;</span></span><br><span class="line">    <span class="built_in">command</span>: apt-get install apache2</span><br><span class="line">    when: ansible_os_family == <span class="string">&quot;Ubuntu&quot;</span></span><br><span class="line">    </span><br><span class="line">- hosts: rsync_nfs</span><br><span class="line">  tasks:</span><br><span class="line">    - name: 创建目录</span><br><span class="line">      file:</span><br><span class="line">        <span class="comment"># path: /opt/&#123;&#123; ansible_default_ipv4.address &#125;&#125;  ## setup模块，看到什么名字就使用什么名字</span></span><br><span class="line">        path: /usr/local/&#123;&#123; ansible_facts[<span class="string">&#x27;default_ipv4&#x27;</span>][<span class="string">&#x27;address&#x27;</span>] &#125;&#125;  <span class="comment">## 官方写法</span></span><br><span class="line">        state: directory</span><br></pre></td></tr></table></figure><p>2.在nfs和rsync安装过程中，客户端服务器不需要推送配置文件，之前我们都是写多个play，会影响效率。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">- hosts: rsync_nfs</span><br><span class="line">  tasks:</span><br><span class="line">    - name: 安装rsync和nfs服务</span><br><span class="line">      yum:</span><br><span class="line">        name:</span><br><span class="line">          - rsync</span><br><span class="line">          - nfs-utils</span><br><span class="line">        state: present</span><br><span class="line"></span><br><span class="line">    - name: 推送rsync配置文件</span><br><span class="line">      template:</span><br><span class="line">        src: /root/wordpress_ansible/rsync/rsyncd.conf</span><br><span class="line">        dest: /etc</span><br><span class="line">      when: ansible_hostname == <span class="string">&#x27;backup&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 多条件判断</span></span><br><span class="line">- hosts: rsync_nfs</span><br><span class="line">  tasks:</span><br><span class="line">    - name: 安装rsync和nfs服务</span><br><span class="line">      yum:</span><br><span class="line">        name:</span><br><span class="line">          - rsync</span><br><span class="line">          - nfs-utils</span><br><span class="line">        state: present</span><br><span class="line">      when: ansible_hostname == <span class="string">&#x27;backup&#x27;</span> or ansible_hostname == <span class="string">&#x27;nfs&#x27;</span></span><br><span class="line"></span><br><span class="line">    - name: 推送rsync配置文件</span><br><span class="line">      template:</span><br><span class="line">        src: /root/wordpress_ansible/rsync/rsyncd.conf</span><br><span class="line">        dest: /etc</span><br><span class="line">      when: ansible_hostname == <span class="string">&#x27;backup&#x27;</span></span><br></pre></td></tr></table></figure><p>3.我们在源码安装nginx的时候，执行第二遍就无法执行了，此时我们就可以进行判断是否安装过。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">  - name: 查看nginx目录</span><br><span class="line">    shell: <span class="string">&quot;ls -l /etc/nginx&quot;</span></span><br><span class="line">    register: xxx</span><br><span class="line">    </span><br><span class="line">  - name: 判断是否安装nginx</span><br><span class="line">    shell: <span class="string">&#x27;cd /opt &amp;&amp; rpm -Uvh *.rpm&#x27;</span></span><br><span class="line">    when: xxx.rc != 0</span><br><span class="line"></span><br><span class="line"> <span class="comment"># - name: 获取注册的变量值 nginx目录返回记过</span></span><br><span class="line"> <span class="comment">#   debug:</span></span><br><span class="line"> <span class="comment">#     msg: &quot;&#123;&#123; xxx &#125;&#125;&quot;</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="comment">## 判断中的且或非</span></span><br><span class="line"> and</span><br><span class="line"> or</span><br><span class="line"> !</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 不使用and的多条件</span></span><br><span class="line">tasks:</span><br><span class="line">  - name: <span class="string">&quot;shut down CentOS 6 systems&quot;</span></span><br><span class="line">    <span class="built_in">command</span>: /sbin/shutdown -t now</span><br><span class="line">    when:</span><br><span class="line">      - ansible_facts[<span class="string">&#x27;distribution&#x27;</span>] == <span class="string">&quot;CentOS&quot;</span></span><br><span class="line">      - ansible_facts[<span class="string">&#x27;distribution_major_version&#x27;</span>]|int == 6</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 模糊匹配</span></span><br><span class="line">- hosts: all</span><br><span class="line">  tasks:</span><br><span class="line">  - name: 推送nginx虚拟主机配置文件</span><br><span class="line">    copy:</span><br><span class="line">      src: /root/wordpress_ansible/nginx_php/blog.zls.com.conf</span><br><span class="line">      dest: /etc/nginx/conf.d</span><br><span class="line">    <span class="comment"># when: ansible_hostname == &#x27;web01&#x27; or ansible_hostname == &#x27;web02&#x27;</span></span><br><span class="line">    when: ansible_hostname is match <span class="string">&#x27;web*&#x27;</span></span><br><span class="line"></span><br><span class="line">  - name: 推送php配置文件</span><br><span class="line">    copy:</span><br><span class="line">      src: /root/wordpress_ansible/nginx_php/www.conf</span><br><span class="line">      dest: /etc/php-fpm.d</span><br></pre></td></tr></table></figure><h2 id="playbook循环语句"><a href="#playbook循环语句" class="headerlink" title="playbook循环语句"></a>playbook循环语句</h2><p>在之前的学习过程中，我们经常会有传送文件，创建目录之类的操作，创建2个目录就要写两个file模块来创建，如果要创建100个目录，我们需要写100个file模块？？？妈耶~~~~ 当然不是，只要有循环即可，减少重复性代码</p><h3 id="列表循环"><a href="#列表循环" class="headerlink" title="列表循环"></a>列表循环</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 启动多个服务</span></span><br><span class="line">数据类型：列表</span><br><span class="line"><span class="keyword">for</span> 循环列表类型</span><br><span class="line"></span><br><span class="line">- hosts: all</span><br><span class="line">  tasks:</span><br><span class="line">  - name: 启动nginx 和 php</span><br><span class="line">    service:</span><br><span class="line">      name: <span class="string">&quot;&#123;&#123; item &#125;&#125;&quot;</span> </span><br><span class="line">      state: stopped</span><br><span class="line">    <span class="comment"># when: ansible_hostname == &#x27;web01&#x27; or ansible_hostname == &#x27;web02&#x27;</span></span><br><span class="line">    with_items:</span><br><span class="line">      - nginx</span><br><span class="line">      - php-fpm</span><br><span class="line">    when: ansible_hostname is match <span class="string">&#x27;web*&#x27;</span></span><br><span class="line">    </span><br><span class="line">注意：一般不用于循环配置文件</span><br></pre></td></tr></table></figure><h3 id="字典循环"><a href="#字典循环" class="headerlink" title="字典循环"></a>字典循环</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- hosts: all</span><br><span class="line">  tasks:</span><br><span class="line">  - name: 启动nginx 和 php</span><br><span class="line">    service:</span><br><span class="line">      name: <span class="string">&quot;&#123;&#123; item &#125;&#125;&quot;</span> </span><br><span class="line">      state: stopped</span><br><span class="line">    <span class="comment"># when: ansible_hostname == &#x27;web01&#x27; or ansible_hostname == &#x27;web02&#x27;</span></span><br><span class="line">    with_items:</span><br><span class="line">      - nginx</span><br><span class="line">      - php-fpm</span><br><span class="line">    when: ansible_hostname is match <span class="string">&#x27;web*&#x27;</span></span><br><span class="line"></span><br><span class="line">  - name: 推送nginx主配置文件、nginx虚拟主机配置文件和php配置文件</span><br><span class="line">    template:</span><br><span class="line">      src: <span class="string">&quot;&#123;&#123; item.src &#125;&#125;&quot;</span></span><br><span class="line">      dest: <span class="string">&quot;&#123;&#123; item.dest &#125;&#125;&quot;</span></span><br><span class="line">    with_items:</span><br><span class="line">      - &#123;src: <span class="string">&quot;/root/wordpress_ansible/nginx_php/blog.zls.com.conf&quot;</span>,dest: <span class="string">&quot;/etc/nginx/conf.d&quot;</span>&#125;</span><br><span class="line">      - &#123;src: <span class="string">&quot;/root/wordpress_ansible/nginx_php/nginx.conf&quot;</span>,dest: <span class="string">&quot;/etc/nginx&quot;</span>&#125;</span><br><span class="line">    when: ansible_hostname is match <span class="string">&#x27;web*&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="playbook-handlers（触发器）"><a href="#playbook-handlers（触发器）" class="headerlink" title="playbook handlers（触发器）"></a>playbook handlers（触发器）</h2><p>当修改完某个服务的配置文件时，应该重启该服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">- hosts: all</span><br><span class="line">  tasks:</span><br><span class="line">  - name: 推送nginx和php的配置文件</span><br><span class="line">    template:</span><br><span class="line">      src: <span class="string">&quot;&#123;&#123; item.src &#125;&#125;&quot;</span></span><br><span class="line">      dest: <span class="string">&quot;&#123;&#123; item.dest &#125;&#125;&quot;</span></span><br><span class="line">    with_items:</span><br><span class="line">      - &#123;src: <span class="string">&quot;/root/wordpress_ansible/nginx_php/blog.zls.com.conf&quot;</span>,dest: <span class="string">&#x27;/etc/nginx/conf.d&#x27;</span>&#125;</span><br><span class="line">      - &#123;src: <span class="string">&quot;/root/wordpress_ansible/nginx_php/nginx.conf&quot;</span>,dest: <span class="string">&#x27;/etc/nginx&#x27;</span>&#125;</span><br><span class="line">    notify: Restart Nginx xxx</span><br><span class="line">    when: ansible_hostname is match <span class="string">&#x27;web*&#x27;</span></span><br><span class="line"></span><br><span class="line">  - name: 启动nginx服务</span><br><span class="line">    service:</span><br><span class="line">      name: nginx</span><br><span class="line">      state: started</span><br><span class="line">      enabled: True</span><br><span class="line">    when: ansible_hostname is match <span class="string">&#x27;web*&#x27;</span></span><br><span class="line"></span><br><span class="line">  - name: 推送php配置文件</span><br><span class="line">    template:</span><br><span class="line">      src: /root/wordpress_ansible/nginx_php/www.conf</span><br><span class="line">      dest: /etc/php-fpm.d</span><br><span class="line">    notify: aaa</span><br><span class="line">    when: ansible_hostname is match <span class="string">&#x27;web*&#x27;</span></span><br><span class="line"></span><br><span class="line">  handlers:</span><br><span class="line">  - name: Restart Nginx xxx</span><br><span class="line">    service:</span><br><span class="line">      name: nginx</span><br><span class="line">      state: restarted</span><br><span class="line"></span><br><span class="line">  - name: aaa</span><br><span class="line">    service:</span><br><span class="line">      name: php-fpm</span><br><span class="line">      state: restarted</span><br></pre></td></tr></table></figure><h3 id="handler注意点"><a href="#handler注意点" class="headerlink" title="handler注意点"></a>handler注意点</h3><blockquote><p>1.无论多少个task调用相同handler，只会在所有tasks执行完成后，触发一次handlers</p><p>2.Handlers只有在其所在的任务被执行时，才会被运行；如果一个任务中定义了notify调用Handlers，但是由于条件判断等原因，该任务未被执行，那么Handlers同样不会被执行</p><p>3.Handlers只会在每一个play的末尾运行一次；如果想在一个playbook中间运行Handlers，则需要使用meta模块来实现。例如： -meta: flush_handlers。</p><p>4.如果一个play在运行到调用Handlers的语句之前失败了，那么这个Handlers将不会被执行。我们可以使用meta模块的–force-handlers选项来强制执行Handlers，即使Handlers所在的play中途运行失败也能执行。</p><p>5.不能使用handlers替代tasks</p></blockquote><h2 id="Ansible任务标签"><a href="#Ansible任务标签" class="headerlink" title="Ansible任务标签"></a>Ansible任务标签</h2><p>默认情况下，Ansible在执行一个playbook时，会执行playbook中定义的所有任务，Ansible的标签(tag)功能可以给单独任务甚至整个playbook打上标签，然后利用这些标签来指定要运行playbook中的个别任务，或不执行指定的任务</p><h3 id="打标签的方式"><a href="#打标签的方式" class="headerlink" title="打标签的方式"></a>打标签的方式</h3><ul><li>对一个task打一个tag</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- name: 安装rsync</span><br><span class="line">  yum:</span><br><span class="line">    name: rsync</span><br><span class="line">    state: present</span><br><span class="line">  when: ansible_hostname != <span class="string">&#x27;db01&#x27;</span></span><br><span class="line">  tags: install_rsync</span><br></pre></td></tr></table></figure><ul><li>对一个task打多个tag</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- name: 推送rsync配置文件</span><br><span class="line">  template:</span><br><span class="line">    src: /root/wordpress_ansible/rsync/rsyncd.conf</span><br><span class="line">    dest: /etc</span><br><span class="line">  when: ansible_hostname == <span class="string">&#x27;backup&#x27;</span></span><br><span class="line">  notify: Rrestart rsync</span><br><span class="line">  tags:</span><br><span class="line">    - install_rsync</span><br><span class="line">    - send_rsync_config</span><br></pre></td></tr></table></figure><ul><li>对多个task打一个tag</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">- name: 安装rsync</span><br><span class="line">  yum:</span><br><span class="line">    name: rsync</span><br><span class="line">    state: present</span><br><span class="line">  when: ansible_hostname != <span class="string">&#x27;db01&#x27;</span></span><br><span class="line">  tags: install_rsync</span><br><span class="line"></span><br><span class="line">- name: 推送rsync配置文件</span><br><span class="line">  template:</span><br><span class="line">    src: /root/wordpress_ansible/rsync/rsyncd.conf</span><br><span class="line">    dest: /etc</span><br><span class="line">  when: ansible_hostname == <span class="string">&#x27;backup&#x27;</span></span><br><span class="line">  tags: install_rsync</span><br><span class="line"></span><br><span class="line">- name: 创建密码文件</span><br><span class="line">  copy:</span><br><span class="line">    content: <span class="string">&quot;&#123;&#123; rsync_user &#125;&#125;:123&quot;</span></span><br><span class="line">    dest: <span class="string">&quot;&#123;&#123; rsync_pass_path &#125;&#125;&quot;</span></span><br><span class="line">    mode: 0600</span><br><span class="line">  when: ansible_hostname == <span class="string">&#x27;backup&#x27;</span></span><br><span class="line">  tags: install_rsync</span><br><span class="line"></span><br><span class="line">- name: 创建&#123;&#123; backup_dir &#125;&#125;目录</span><br><span class="line">  file:</span><br><span class="line">    path: /&#123;&#123; backup_dir &#125;&#125;</span><br><span class="line">    owner: <span class="string">&quot;&#123;&#123; user_group &#125;&#125;&quot;</span></span><br><span class="line">    group: <span class="string">&quot;&#123;&#123; user_group &#125;&#125;&quot;</span></span><br><span class="line">    state: directory</span><br><span class="line">  when: ansible_hostname == <span class="string">&#x27;backup&#x27;</span></span><br><span class="line">  tags: install_rsync</span><br><span class="line"></span><br><span class="line">- name: 启动rsync服务</span><br><span class="line">  service:</span><br><span class="line">    name: rsyncd</span><br><span class="line">    state: started</span><br><span class="line">    enabled: True</span><br><span class="line">  when: ansible_hostname == <span class="string">&#x27;backup&#x27;</span></span><br><span class="line">  tags: install_rsync</span><br></pre></td></tr></table></figure><h3 id="打完标签如何使用"><a href="#打完标签如何使用" class="headerlink" title="打完标签如何使用"></a>打完标签如何使用</h3><p>-t:执行指定的tag标签任务</p><p>–skip-tags:执行–skip-tags之外的标签任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook -i base/hosts lnmp_wp.yml -t <span class="string">&#x27;install_rsync&#x27;</span></span><br><span class="line">ansible-playbook -i base/hosts lnmp_wp.yml --skip-tags <span class="string">&#x27;install_rsync&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="playbook的复用"><a href="#playbook的复用" class="headerlink" title="playbook的复用"></a>playbook的复用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- hosts: all</span><br><span class="line">  tasks:</span><br><span class="line">  - include: nginx/install_nginx.yml</span><br><span class="line">  - include: nginx/start_nginx.yml</span><br><span class="line">  - include: php/install_php.yml</span><br><span class="line"></span><br><span class="line">  handlers:</span><br><span class="line">  - include: php/handler_php.yml</span><br><span class="line">  </span><br><span class="line">php/config_php.yml</span><br><span class="line">- name: xxx</span><br><span class="line">  template:</span><br><span class="line">    src: xxx</span><br><span class="line">    dest: xxx</span><br><span class="line">  when: ansible_hostname is match <span class="string">&#x27;web*&#x27;</span></span><br><span class="line">  notify: restart php</span><br><span class="line"></span><br><span class="line">php/handler_php.yml</span><br><span class="line">- name: restart php</span><br><span class="line">  service:</span><br><span class="line">    name: php-fpm</span><br><span class="line">    state: restarted</span><br></pre></td></tr></table></figure><h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#目录结构</span></span><br><span class="line">[root@manage01 ~]<span class="comment"># tree wordpress_ansibe</span></span><br><span class="line">wordpress_ansibe</span><br><span class="line">├── base</span><br><span class="line">│   └── base.yml</span><br><span class="line">├── create_sysuser</span><br><span class="line">│   └── create_user.yml</span><br><span class="line">├── group_vars</span><br><span class="line">│   └── all</span><br><span class="line">├── host_vars</span><br><span class="line">│   ├── db01</span><br><span class="line">│   ├── nfs</span><br><span class="line">│   ├── web01</span><br><span class="line">│   └── web02</span><br><span class="line">├── mairadb</span><br><span class="line">│   ├── config_mariadb.yml</span><br><span class="line">│   ├── install_mariadb.yml</span><br><span class="line">│   ├── my.j2</span><br><span class="line">│   └── start_mariadb.yml</span><br><span class="line">├── manager</span><br><span class="line">│   ├── hosts</span><br><span class="line">│   └── ssh_key.sh</span><br><span class="line">├── nfs_client</span><br><span class="line">│   └── install_nfs.yml</span><br><span class="line">├── nfs_server</span><br><span class="line">│   ├── config_nfs.yml</span><br><span class="line">│   ├── install_nfs.yml</span><br><span class="line">│   ├── server_nfs.yml</span><br><span class="line">│   └── start_nfs.yml</span><br><span class="line">├── nginx_php</span><br><span class="line">│   ├── config_nginx.yml</span><br><span class="line">│   ├── config_php.yml</span><br><span class="line">│   ├── install_nginx_php.yml</span><br><span class="line">│   ├── nginx.j2</span><br><span class="line">│   ├── nginx_php.tgz</span><br><span class="line">│   ├── start_nginx_php.yml</span><br><span class="line">│   └── www.j2</span><br><span class="line">├── rsync_client</span><br><span class="line">│   ├── config_rsync.yml</span><br><span class="line">│   └── install_rsync.yml</span><br><span class="line">├── rsync_server</span><br><span class="line">│   ├── config_rsync.yml</span><br><span class="line">│   ├── install_rsync.yml</span><br><span class="line">│   ├── rsync.j2</span><br><span class="line">│   ├── server_rsync.yml</span><br><span class="line">│   └── start_rsync.yml</span><br><span class="line">├── tasks.yml</span><br><span class="line">├── test.yml</span><br><span class="line">└── wordpress</span><br><span class="line">    ├── blog.zls.com.j2</span><br><span class="line">    ├── config_nginx.yml</span><br><span class="line">    ├── create_code_dir.yml</span><br><span class="line">    ├── create_db_user.yml</span><br><span class="line">    ├── create_db.yml</span><br><span class="line">    ├── deploy_code.yml</span><br><span class="line">    ├── mount_nfs.yml</span><br><span class="line">    ├── send_sql_file.yml</span><br><span class="line">    ├── send_user_data.yml</span><br><span class="line">    └── wordpress.tgz</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ansible自动化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ansible </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ansible变量(4)</title>
      <link href="/2023/01/07/ansible/04.Ansible%E5%8F%98%E9%87%8F/"/>
      <url>/2023/01/07/ansible/04.Ansible%E5%8F%98%E9%87%8F/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Ansible变量"><a href="#Ansible变量" class="headerlink" title="Ansible变量"></a>Ansible变量</h1><h2 id="变量的概述"><a href="#变量的概述" class="headerlink" title="变量的概述"></a>变量的概述</h2><p>避免重复代码，方便维护，减少维护成本</p><h3 id="Ansible变量定义"><a href="#Ansible变量定义" class="headerlink" title="Ansible变量定义"></a>Ansible变量定义</h3><ul><li><p>命令行</p></li><li><p>play中定义</p><ul><li>vars</li><li>vars_files</li></ul></li><li><p>Inventory中定义</p><ul><li>hosts文件</li><li>host_vars目录</li><li>group_vars目录</li></ul></li></ul><h3 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h3><p>命令行 &gt; play &gt; inventory</p><p>命令行 &gt; vars_files(play) &gt; vars(play) &gt; host_vars(inventory) &gt; group_vars(inventory) &gt; hosts文件(inventory)</p><h2 id="定义Ansible变量位置"><a href="#定义Ansible变量位置" class="headerlink" title="定义Ansible变量位置"></a>定义Ansible变量位置</h2><h3 id="在play中定义变量"><a href="#在play中定义变量" class="headerlink" title="在play中定义变量"></a>在play中定义变量</h3><ul><li>vars变量</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在play中用vars定义变量</span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  vars:</span><br><span class="line">  user_group: huanglong </span><br><span class="line">  <span class="built_in">id</span>: <span class="string">&#x27;438&#x27;</span> </span><br><span class="line">  pkg:</span><br><span class="line">  - nginx </span><br><span class="line">  - php </span><br><span class="line">  - mariadb-server </span><br><span class="line">  tasks: </span><br><span class="line">  - name: 创建&#123;&#123; user_group &#125;&#125;组 </span><br><span class="line">    group: </span><br><span class="line">      name: <span class="string">&quot;&#123;&#123; user_group &#125;&#125;&quot;</span> </span><br><span class="line">      gid: <span class="string">&quot;&#123;&#123; id &#125;&#125;&quot;</span> </span><br><span class="line">      </span><br><span class="line">  - name: 创建&#123;&#123; user_group &#125;&#125;用户 </span><br><span class="line">    user:</span><br><span class="line">      name: <span class="string">&quot;&#123;&#123; user_group &#125;&#125;&quot;</span> </span><br><span class="line">      uid: <span class="string">&quot;&#123;&#123; id &#125;&#125;&quot;</span> </span><br><span class="line">      group: <span class="string">&quot;&#123;&#123; id &#125;&#125;&quot;</span> </span><br><span class="line">      shell: /sbin/nologin </span><br><span class="line">      create_home: False</span><br><span class="line">      </span><br><span class="line">  - name: 安装nginx php mysql </span><br><span class="line">    yum:</span><br><span class="line">      name: <span class="string">&quot;&#123;&#123; pkg &#125;&#125;&quot;</span> </span><br><span class="line">      state: present</span><br></pre></td></tr></table></figure><ul><li>vars_files 变量</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">- hosts: web_group </span><br><span class="line">  vars: </span><br><span class="line">    user_group: huanglong </span><br><span class="line">    <span class="built_in">id</span>: <span class="string">&#x27;438&#x27;</span> </span><br><span class="line">    pkg:</span><br><span class="line">      - nginx </span><br><span class="line">      - php </span><br><span class="line">      - mariadb-server </span><br><span class="line">  vars_files: ./roger_var.yml</span><br><span class="line">  </span><br><span class="line">  tasks: </span><br><span class="line">  - name: 创建&#123;&#123; user_group &#125;&#125;组 </span><br><span class="line">    group: </span><br><span class="line">      name: <span class="string">&quot;&#123;&#123; user_group &#125;&#125;&quot;</span> </span><br><span class="line">      gid: <span class="string">&quot;&#123;&#123; id &#125;&#125;&quot;</span> </span><br><span class="line">      </span><br><span class="line">  - name: 创建&#123;&#123; user_group &#125;&#125;用户 </span><br><span class="line">    user: </span><br><span class="line">      name: <span class="string">&quot;&#123;&#123; user_group &#125;&#125;&quot;</span> </span><br><span class="line">      uid: <span class="string">&quot;&#123;&#123; id &#125;&#125;&quot;</span> </span><br><span class="line">      group: <span class="string">&quot;&#123;&#123; id &#125;&#125;&quot;</span> </span><br><span class="line">      shell: /sbin/nologin </span><br><span class="line">      create_home: False</span><br><span class="line">      </span><br><span class="line">roger_var.yml </span><br><span class="line">user_group: wuyangke </span><br><span class="line"><span class="built_in">id</span>: <span class="string">&#x27;250&#x27;</span> </span><br><span class="line">pkg:</span><br><span class="line">- nginx </span><br><span class="line">- php </span><br><span class="line">- mariadb-server</span><br></pre></td></tr></table></figure><ul><li>层级变量</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 层级变量定义阶段</span></span><br><span class="line">jiagou:</span><br><span class="line">  - lnmp:</span><br><span class="line">    pkg:</span><br><span class="line">      - nginx</span><br><span class="line">      - php</span><br><span class="line">      - mysql</span><br><span class="line">  - lamp:</span><br><span class="line">    pkg:</span><br><span class="line">      - httpd</span><br><span class="line">      - php</span><br><span class="line">      - mysql</span><br><span class="line">  - lamt:</span><br><span class="line">    pkg:</span><br><span class="line">      - httpd</span><br><span class="line">      - tomcat</span><br><span class="line">      - mysql</span><br><span class="line">      </span><br><span class="line"><span class="comment">## 层级变量调用阶段</span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">  - name: 安装lamt</span><br><span class="line">    yum:</span><br><span class="line">      name: <span class="string">&quot;&#123;&#123; jiagou.lamt.pkg &#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><h3 id="在inventory中定义变量"><a href="#在inventory中定义变量" class="headerlink" title="在inventory中定义变量"></a>在inventory中定义变量</h3><ul><li>在inventory文件中定义变量（几乎不用）</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># vim /etc/ansible/hosts </span></span><br><span class="line">[web_group] </span><br><span class="line">web01 ansible_ssh_host=10.0.0.7 </span><br><span class="line">web02 ansible_ssh_host=10.0.0.8 </span><br><span class="line"></span><br><span class="line">[web_group:vars] </span><br><span class="line">user_group=xxx </span><br><span class="line"><span class="built_in">id</span>=<span class="string">&#x27;666&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>host_vars</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 和yaml文件同级下创建目录 </span></span><br><span class="line"><span class="built_in">mkdir</span> host_vars</span><br><span class="line"></span><br><span class="line"><span class="comment">## 针对主机定义变量 </span></span><br><span class="line">vim host_vars/web01 </span><br><span class="line">user_group: user_host_vars_web01 </span><br><span class="line"><span class="built_in">id</span>: <span class="string">&#x27;444&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>group_vars</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 和yaml文件同级下创建目录 </span></span><br><span class="line"><span class="built_in">mkdir</span> group_vars </span><br><span class="line"></span><br><span class="line"><span class="comment">## 针对主机组定义变量 </span></span><br><span class="line">vim group_vars/web_group </span><br><span class="line">user_group: user_group_vars_web_group </span><br><span class="line"><span class="built_in">id</span>: <span class="string">&#x27;444&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="优先级测试"><a href="#优先级测试" class="headerlink" title="优先级测试"></a>优先级测试</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.play中定义变量</span></span><br><span class="line">vars：vars_user </span><br><span class="line">vars_files：user_vars_files </span><br><span class="line">- hosts: web_group </span><br><span class="line">  vars: </span><br><span class="line">    - user_group: vars_user </span><br><span class="line">    - <span class="built_in">id</span>: <span class="string">&#x27;444&#x27;</span> </span><br><span class="line">  vars_files: ./roger_var.yml </span><br><span class="line">  </span><br><span class="line">  tasks: </span><br><span class="line">    - name: 创建用户 </span><br><span class="line">    user: name: <span class="string">&quot;&#123;&#123; user_group &#125;&#125;&quot;</span> </span><br><span class="line">    uid: <span class="string">&quot;&#123;&#123; id &#125;&#125;&quot;</span> </span><br><span class="line">    state: present</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.主机清单定义变量</span></span><br><span class="line">hosts文件中：user_inventory </span><br><span class="line">[web_group:vars] </span><br><span class="line">user_group=user_inventory</span><br><span class="line"></span><br><span class="line">host_vars目录下</span><br><span class="line">- web01 user_group: </span><br><span class="line">  user_host_vars_web01 </span><br><span class="line">- web02 user_group: </span><br><span class="line">  user_host_vars_web02</span><br><span class="line"></span><br><span class="line">group_vars目录下 </span><br><span class="line">web_group user_group: </span><br><span class="line">  user_group_vars_web_group</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.命令行定义变量</span></span><br><span class="line">[root@m01 wordpress_ansible]<span class="comment"># ansible-playbook -e &#x27;user_group=command_user&#x27;</span></span><br><span class="line">[root@m01 wordpress_ansible]<span class="comment"># ansible-playbook test.yml -i base/hosts -e &#x27;user_group=command_user&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="变量注册"><a href="#变量注册" class="headerlink" title="变量注册"></a>变量注册</h2><p>当absible的模块在运行之后，其实都会返回一些result结果，就像是执行脚本，我们有的时候需要脚本给我们一些return返回值，我们才知道，上一步是否可以执行成功，但是…默认情况下，ansible的result并不会显示出来，所以，我们可以把这些返回值’存储’到变量中，这样我们就能通过’调用’对应的变量名，从而获取到这些result，这种将模块的返回值，写入到变量中的方法被称为变量注册</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">  - name: 查看nginx目录</span><br><span class="line">    shell: <span class="string">&quot;ls -l /etc/nginx&quot;</span></span><br><span class="line">    register: xxx</span><br><span class="line"></span><br><span class="line">  - name: 获取注册的变量值 nginx目录返回记过</span><br><span class="line">    debug:</span><br><span class="line">      msg: <span class="string">&quot;&#123;&#123; xxx &#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>只需要打印详细的结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">  - name: 查看nginx目录</span><br><span class="line">    shell: <span class="string">&quot;ls -l /etc/nginx&quot;</span></span><br><span class="line">    register: xxx</span><br><span class="line"></span><br><span class="line">  - name: 获取注册的变量值 nginx目录返回记过</span><br><span class="line">    debug:</span><br><span class="line">      msg: <span class="string">&quot;&#123;&#123; xxx.stdout_lines &#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>利用变量注册做判断</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">  - name: 查看nginx目录</span><br><span class="line">    shell: <span class="string">&quot;ls -l /etc/nginx&quot;</span></span><br><span class="line">    register: xxx</span><br><span class="line"></span><br><span class="line">  - name: 获取注册的变量值 nginx目录返回结果</span><br><span class="line">    debug:</span><br><span class="line">      msg: <span class="string">&quot;&#123;&#123; xxx.stdout_lines &#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">  - name: 安装nginx和php</span><br><span class="line">    shell: <span class="built_in">cd</span> /opt &amp;&amp; rpm -Uvh *.rpm</span><br><span class="line">    when: xxx.rc != 0</span><br></pre></td></tr></table></figure><h2 id="facts缓存"><a href="#facts缓存" class="headerlink" title="facts缓存"></a>facts缓存</h2><p>Ansible facts是在被管理追击上通过Ansible自动采集发现的变量。facts包含每台特定的主机信息。比如：被控端的主机名、IP地址、系统版本、CPU数量、内存状态、磁盘状态等等。</p><h3 id="facts缓存应用场景"><a href="#facts缓存应用场景" class="headerlink" title="facts缓存应用场景"></a>facts缓存应用场景</h3><ul><li><input disabled="" type="checkbox"> 根据主机CPU，设置nginx配置文件，cpu亲和</li><li><input checked="" disabled="" type="checkbox"> 根据内存，配置MySQL的配置文件</li><li><input checked="" disabled="" type="checkbox"> 根据IP地址，配置redis配置文件</li></ul><h3 id="关闭facts缓存"><a href="#关闭facts缓存" class="headerlink" title="关闭facts缓存"></a>关闭facts缓存</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- hosts: rsync_nfs</span><br><span class="line">  gather_facts: False  <span class="comment">## 关闭facts缓存</span></span><br><span class="line">  tasks:</span><br><span class="line">  - name: 安装rsync和nfs服务</span><br><span class="line">    yum:</span><br><span class="line">      name:</span><br><span class="line">        - rsync</span><br><span class="line">        - nfs-utils</span><br><span class="line">      state: present</span><br><span class="line"></span><br><span class="line">  - name: 创建目录</span><br><span class="line">    file:</span><br><span class="line">      path: /tmp/&#123;&#123; ansible_memtotal_mb &#125;&#125;</span><br><span class="line">      state: directory</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ansible自动化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ansible </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ansible使用Jinja2模版(6)</title>
      <link href="/2023/01/07/ansible/06.Ansible%E4%BD%BF%E7%94%A8Jinja2%E6%A8%A1%E6%9D%BF/"/>
      <url>/2023/01/07/ansible/06.Ansible%E4%BD%BF%E7%94%A8Jinja2%E6%A8%A1%E6%9D%BF/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Jinja2-模板"><a href="#Jinja2-模板" class="headerlink" title="Jinja2 模板"></a>Jinja2 模板</h1><blockquote><p><strong>Q：什么是Jinja2？</strong></p><p>jinja2是Python的全功能模板引擎</p></blockquote><h2 id="Jinja2模板和Ansible关系"><a href="#Jinja2模板和Ansible关系" class="headerlink" title="Jinja2模板和Ansible关系"></a>Jinja2模板和Ansible关系</h2><p>Ansible通常会使用jinja2模板来修改被管理主机的配置文件等…在saltstack中同样会使用到jinja2<br>如果在100台主机上安装nginx，每台nginx的端口都不一样，如何解决？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstram www.zls.com &#123;</span><br><span class="line">    server 172.16.1.7;</span><br><span class="line">    server 172.16.1.8;</span><br><span class="line">    server 172.16.1.9;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Jinja2模板基础语法"><a href="#Jinja2模板基础语法" class="headerlink" title="Jinja2模板基础语法"></a>Jinja2模板基础语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; 变量名 &#125;&#125;  ## 调用变量</span><br><span class="line">&#123;# 注释 #&#125;</span><br></pre></td></tr></table></figure><h3 id="Jinja2判断语法"><a href="#Jinja2判断语法" class="headerlink" title="Jinja2判断语法"></a>Jinja2判断语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">## shell判断</span><br><span class="line">if [ 条件 ];then</span><br><span class="line">xxx</span><br><span class="line">elif [ 条件 ];then</span><br><span class="line">aaa</span><br><span class="line">else</span><br><span class="line">bbb</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">## Python判断</span><br><span class="line">if 条件:</span><br><span class="line">  xxx</span><br><span class="line">elif 条件:</span><br><span class="line">  aaa</span><br><span class="line">else:</span><br><span class="line">  bbb</span><br><span class="line">xxxx</span><br><span class="line"></span><br><span class="line">## Jinja2判断</span><br><span class="line">&#123;% if 条件 %&#125;</span><br><span class="line">xxx</span><br><span class="line">&#123;% elif 条件 %&#125;</span><br><span class="line">aaa</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">bbb</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><h3 id="Jinja2循环"><a href="#Jinja2循环" class="headerlink" title="Jinja2循环"></a>Jinja2循环</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for n in 条件 %&#125;</span><br><span class="line">xxx</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><h2 id="Jinja2实战部署keepalived"><a href="#Jinja2实战部署keepalived" class="headerlink" title="Jinja2实战部署keepalived"></a>Jinja2实战部署keepalived</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#keep配置文件（Master）</span></span><br><span class="line">global_defs &#123;</span><br><span class="line">    router_id lb01</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script check_web_zls &#123;</span><br><span class="line">    script <span class="string">&quot;/root/check_web.sh&quot;</span></span><br><span class="line">    interval 5</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 50</span><br><span class="line">    priority 150</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;         </span><br><span class="line">        10.0.0.3</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    track_script &#123;</span><br><span class="line">      check_web_zls</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#keep配置文件（Backup）</span></span><br><span class="line">global_defs &#123;</span><br><span class="line">    router_id lb02</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    priority 100</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 50</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;         </span><br><span class="line">        10.0.0.3</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tasks.yml</span><br><span class="line">- hosts: all</span><br><span class="line">  tasks:</span><br><span class="line">  - include: /root/ansible/keepalived/config_keepalived.yml</span><br><span class="line">    when: ansible_hostname is match <span class="string">&#x27;web*&#x27;</span></span><br><span class="line"></span><br><span class="line">  handlers:</span><br><span class="line">  - name: Restart Keepalived</span><br><span class="line">    service:</span><br><span class="line">      name: keepalived</span><br><span class="line">      </span><br><span class="line">keepalived.j2</span><br><span class="line">global_defs &#123;</span><br><span class="line">    router_id &#123;&#123; ansible_hostname &#125;&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> ansible_hostname == <span class="string">&#x27;web01&#x27;</span> %&#125;</span><br><span class="line">vrrp_script check_web_zls &#123;</span><br><span class="line">    script <span class="string">&quot;/root/check_web.sh&quot;</span></span><br><span class="line">    interval 5</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    track_script &#123;</span><br><span class="line">      check_web_zls</span><br><span class="line">    &#125;</span><br><span class="line">    priority 150</span><br><span class="line">    state MASTER</span><br><span class="line">&#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    priority 100</span><br><span class="line">    state BACKUP</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 50</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;         </span><br><span class="line">        10.0.0.3</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Jinja2实战部署负载均衡"><a href="#Jinja2实战部署负载均衡" class="headerlink" title="Jinja2实战部署负载均衡"></a>Jinja2实战部署负载均衡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#nginx配置文件</span></span><br><span class="line">upstream &#123;&#123; wordpress_domain &#125;&#125; &#123;</span><br><span class="line">&#123;% <span class="keyword">for</span> num <span class="keyword">in</span> range(7,10) %&#125;</span><br><span class="line">    server 172.16.1.&#123;&#123; num &#125;&#125;;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name &#123;&#123; wordpress_domain &#125;&#125;;</span><br><span class="line"></span><br><span class="line">    location /&#123;</span><br><span class="line">        proxy_pass http://&#123;&#123; wordpress_domain &#125;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- hosts: all</span><br><span class="line">  tasks:</span><br><span class="line">  - include: /root/ansible/lb/config_lb.yml</span><br><span class="line">    when: ansible_hostname is match <span class="string">&#x27;web*&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><p>在目前的架构上加入</p><p>1.负载均衡</p><p>2.keepalived</p><p>3.sersync</p>]]></content>
      
      
      <categories>
          
          <category> ansible自动化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ansible </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ansible Roles(7)</title>
      <link href="/2023/01/07/ansible/07.Ansible%20Roles/"/>
      <url>/2023/01/07/ansible/07.Ansible%20Roles/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Ansible-Roles"><a href="#Ansible-Roles" class="headerlink" title="Ansible Roles"></a>Ansible Roles</h1><h2 id="roles目录结构"><a href="#roles目录结构" class="headerlink" title="roles目录结构"></a>roles目录结构</h2><p><img src="https://blog.driverzeng.com/wp-content/uploads/2021/08/15689649055718.jpg"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">production                <span class="comment"># inventory file for production servers</span></span><br><span class="line">staging                   <span class="comment"># inventory file for staging environment</span></span><br><span class="line"> </span><br><span class="line">group_vars/</span><br><span class="line">   group1.yml             <span class="comment"># here we assign variables to particular groups</span></span><br><span class="line">   group2.yml</span><br><span class="line">host_vars/</span><br><span class="line">   hostname1.yml          <span class="comment"># here we assign variables to particular systems</span></span><br><span class="line">   hostname2.yml</span><br><span class="line"> </span><br><span class="line">library/                  <span class="comment"># if any custom modules, put them here (optional)</span></span><br><span class="line">module_utils/             <span class="comment"># if any custom module_utils to support modules, put them here (optional)</span></span><br><span class="line">filter_plugins/           <span class="comment"># if any custom filter plugins, put them here (optional)</span></span><br><span class="line"> </span><br><span class="line">site.yml                  <span class="comment"># master playbook</span></span><br><span class="line">webservers.yml            <span class="comment"># playbook for webserver tier</span></span><br><span class="line">dbservers.yml             <span class="comment"># playbook for dbserver tier</span></span><br><span class="line"> </span><br><span class="line">roles/</span><br><span class="line">    common/               <span class="comment"># this hierarchy represents a &quot;role&quot;</span></span><br><span class="line">        tasks/            <span class="comment">#</span></span><br><span class="line">            main.yml      <span class="comment">#  &lt;-- tasks file can include smaller files if warranted</span></span><br><span class="line">        handlers/         <span class="comment">#</span></span><br><span class="line">            main.yml      <span class="comment">#  &lt;-- handlers file</span></span><br><span class="line">        templates/        <span class="comment">#  &lt;-- files for use with the template resource</span></span><br><span class="line">            ntp.conf.j2   <span class="comment">#  &lt;------- templates end in .j2</span></span><br><span class="line">        files/            <span class="comment">#</span></span><br><span class="line">            bar.txt       <span class="comment">#  &lt;-- files for use with the copy resource</span></span><br><span class="line">            foo.sh        <span class="comment">#  &lt;-- script files for use with the script resource</span></span><br><span class="line">        vars/             <span class="comment">#</span></span><br><span class="line">            main.yml      <span class="comment">#  &lt;-- variables associated with this role</span></span><br><span class="line">        defaults/         <span class="comment">#</span></span><br><span class="line">            main.yml      <span class="comment">#  &lt;-- default lower priority variables for this role</span></span><br><span class="line">        meta/             <span class="comment">#</span></span><br><span class="line">            main.yml      <span class="comment">#  &lt;-- role dependencies</span></span><br><span class="line">        library/          <span class="comment"># roles can also include custom modules</span></span><br><span class="line">        module_utils/     <span class="comment"># roles can also include custom module_utils</span></span><br><span class="line">        lookup_plugins/   <span class="comment"># or other types of plugins, like lookup in this case</span></span><br><span class="line"> </span><br><span class="line">    webtier/              <span class="comment"># same kind of structure as &quot;common&quot; was above, done for the webtier role</span></span><br><span class="line">    monitoring/           <span class="comment"># &quot;&quot;</span></span><br><span class="line">    fooapp/               <span class="comment"># &quot;&quot;</span></span><br></pre></td></tr></table></figure><h2 id="Ansible-Galaxy创建目录"><a href="#Ansible-Galaxy创建目录" class="headerlink" title="Ansible Galaxy创建目录"></a>Ansible Galaxy创建目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># mkdir roles</span></span><br><span class="line">[root@m01 ~]<span class="comment"># cd roles/</span></span><br><span class="line">[root@m01 roles]<span class="comment"># ansible-galaxy init nginx</span></span><br><span class="line">- Role nginx was created successfully</span><br><span class="line">[root@m01 roles]<span class="comment"># ll</span></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 10 root root 154 Jul  4 10:29 nginx</span><br><span class="line">[root@m01 roles]<span class="comment"># tree  nginx/</span></span><br><span class="line">nginx/</span><br><span class="line">├── defaults</span><br><span class="line">│   └── main.yml</span><br><span class="line">├── files</span><br><span class="line">├── handlers</span><br><span class="line">│   └── main.yml</span><br><span class="line">├── meta</span><br><span class="line">│   └── main.yml</span><br><span class="line">├── README.md</span><br><span class="line">├── tasks</span><br><span class="line">│   └── main.yml</span><br><span class="line">├── templates</span><br><span class="line">├── tests</span><br><span class="line">│   ├── inventory</span><br><span class="line">│   └── test.yml</span><br><span class="line">└── vars</span><br><span class="line">    └── main.yml</span><br></pre></td></tr></table></figure><h2 id="使用roles重构rsync"><a href="#使用roles重构rsync" class="headerlink" title="使用roles重构rsync"></a>使用roles重构rsync</h2><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 roles]<span class="comment"># ansible-galaxy init rsync-client</span></span><br><span class="line">- Role rsync-client was created successfully</span><br><span class="line">[root@m01 roles]<span class="comment"># ansible-galaxy init rsync-server</span></span><br><span class="line">- Role rsync-server was created successfully</span><br></pre></td></tr></table></figure><h3 id="rsync-server"><a href="#rsync-server" class="headerlink" title="rsync-server"></a>rsync-server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ansible]<span class="comment"># tree /root/roles/rsync-server/</span></span><br><span class="line">/root/roles/rsync-server/</span><br><span class="line">├── defaults</span><br><span class="line">│   └── main.yml</span><br><span class="line">├── files</span><br><span class="line">├── handlers</span><br><span class="line">│   └── main.yml</span><br><span class="line">├── meta</span><br><span class="line">│   └── main.yml</span><br><span class="line">├── README.md</span><br><span class="line">├── tasks</span><br><span class="line">│   ├── config_rsync.yml</span><br><span class="line">│   ├── main.yml</span><br><span class="line">│   ├── server_rsync.yml</span><br><span class="line">│   └── start_rsync.yml</span><br><span class="line">├── templates</span><br><span class="line">│   └── rsyncd.j2</span><br><span class="line">├── tests</span><br><span class="line">│   ├── inventory</span><br><span class="line">│   └── test.yml</span><br><span class="line">└── vars</span><br><span class="line">    └── main.yml</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置文件</span></span><br><span class="line">[root@m01 ansible]<span class="comment"># cat /root/roles/rsync-server/templates/rsyncd.j2 </span></span><br><span class="line">uid = &#123;&#123; user_group &#125;&#125;</span><br><span class="line">gid = &#123;&#123; user_group &#125;&#125;</span><br><span class="line">port = 873</span><br><span class="line">fake super = <span class="built_in">yes</span></span><br><span class="line">use <span class="built_in">chroot</span> = no</span><br><span class="line">max connections = 200</span><br><span class="line"><span class="built_in">timeout</span> = 600</span><br><span class="line">ignore errors</span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span></span><br><span class="line">list = <span class="literal">false</span></span><br><span class="line">auth <span class="built_in">users</span> = &#123;&#123; rsync_user &#125;&#125;</span><br><span class="line">secrets file = &#123;&#123; rsync_pass_file &#125;&#125;</span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log</span><br><span class="line"><span class="comment">#####################################</span></span><br><span class="line">[&#123;&#123; rsync_dir &#125;&#125;]</span><br><span class="line">comment = welcome to oldboyedu backup!</span><br><span class="line">path = /&#123;&#123; rsync_dir &#125;&#125;</span><br><span class="line"></span><br><span class="line">[&#123;&#123; nfs_dir &#125;&#125;]</span><br><span class="line">comment = welcome to oldboyedu backup!</span><br><span class="line">path = /&#123;&#123; nfs_dir &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## tasks</span></span><br><span class="line">[root@m01 ansible]<span class="comment"># cat /root/roles/rsync-server/tasks/config_rsync.yml </span></span><br><span class="line">- name: 推送rsync配置文件</span><br><span class="line">  template:</span><br><span class="line">    src: rsyncd.j2</span><br><span class="line">    dest: /etc/rsyncd.conf</span><br><span class="line">  notify: Restart Rsync</span><br><span class="line"></span><br><span class="line">[root@m01 ansible]<span class="comment"># cat /root/roles/rsync-server/tasks/server_rsync.yml </span></span><br><span class="line">- name: 创建密码文件</span><br><span class="line">  copy:</span><br><span class="line">    content: <span class="string">&quot;&#123;&#123; rsync_user &#125;&#125;:&#123;&#123; rsync_pass &#125;&#125;&quot;</span></span><br><span class="line">    dest: /&#123;&#123; rsync_pass_file &#125;&#125;</span><br><span class="line">    mode: 0600</span><br><span class="line"></span><br><span class="line">- name: 创建rsync目录</span><br><span class="line">  file:</span><br><span class="line">    path: <span class="string">&quot;&#123;&#123; item &#125;&#125;&quot;</span></span><br><span class="line">    owner: <span class="string">&quot;&#123;&#123; user_group &#125;&#125;&quot;</span></span><br><span class="line">    group: <span class="string">&quot;&#123;&#123; user_group &#125;&#125;&quot;</span></span><br><span class="line">    state: directory</span><br><span class="line">  with_items:</span><br><span class="line">    - /&#123;&#123; rsync_dir &#125;&#125;</span><br><span class="line">    - /&#123;&#123; nfs_dir &#125;&#125;</span><br><span class="line"></span><br><span class="line">  [root@m01 ansible]<span class="comment"># cat /root/roles/rsync-server/tasks/start_rsync.yml </span></span><br><span class="line">- name: 启动rsync</span><br><span class="line">  service:</span><br><span class="line">    name: rsyncd</span><br><span class="line">    state: started</span><br><span class="line">    enabled: True</span><br><span class="line">    </span><br><span class="line">[root@m01 ansible]<span class="comment"># cat /root/roles/rsync-server/tasks/main.yml </span></span><br><span class="line">---</span><br><span class="line"><span class="comment"># tasks file for rsync-server</span></span><br><span class="line">- include: config_rsync.yml</span><br><span class="line">- include: server_rsync.yml</span><br><span class="line">- include: start_rsync.yml</span><br><span class="line"></span><br><span class="line"><span class="comment">## meta</span></span><br><span class="line">[root@m01 ansible]<span class="comment"># cat /root/roles/rsync-server/meta/main.yml </span></span><br><span class="line">dependencies:</span><br><span class="line">  - &#123;role: create-user&#125;</span><br><span class="line">  - &#123;role: rsync-client&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">## handlers</span></span><br><span class="line">[root@m01 ansible]<span class="comment"># cat /root/roles/rsync-server/handlers/main.yml </span></span><br><span class="line">---</span><br><span class="line"><span class="comment"># handlers file for rsync-server</span></span><br><span class="line">- name: Restart Rsync</span><br><span class="line">  service:</span><br><span class="line">    name: rsyncd</span><br><span class="line">    state: restarted</span><br></pre></td></tr></table></figure><h2 id="wordpress目录规划"><a href="#wordpress目录规划" class="headerlink" title="wordpress目录规划"></a>wordpress目录规划</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">manager</span><br><span class="line">base</span><br><span class="line">create-user</span><br><span class="line">group_vars</span><br><span class="line">host_vars</span><br><span class="line">nginx</span><br><span class="line">tasks：</span><br><span class="line">install</span><br><span class="line">config  只推主配置文件</span><br><span class="line">start</span><br><span class="line">meta：</span><br><span class="line">create-user</span><br><span class="line">php</span><br><span class="line">rsync-server</span><br><span class="line">tasks：</span><br><span class="line">config</span><br><span class="line">start</span><br><span class="line">创建密码文件和目录</span><br><span class="line">meta：</span><br><span class="line">rsync-client</span><br><span class="line">rsync-client</span><br><span class="line">tasks：</span><br><span class="line">install</span><br><span class="line">nfs-server</span><br><span class="line">tasks：</span><br><span class="line">config</span><br><span class="line">start</span><br><span class="line">创建目录</span><br><span class="line">meta：</span><br><span class="line">nfs-client</span><br><span class="line">nfs-client</span><br><span class="line">tasks：</span><br><span class="line">install</span><br><span class="line">sersync</span><br><span class="line">meta</span><br><span class="line">  nfs-client</span><br><span class="line">  rsync-client</span><br><span class="line">     tasks：</span><br><span class="line">     install</span><br><span class="line">     config</span><br><span class="line">     start</span><br><span class="line">     推送rsync密码文件</span><br><span class="line">mysql</span><br><span class="line">tasks</span><br><span class="line">install</span><br><span class="line">maraidb-server</span><br><span class="line">MySQL-python</span><br><span class="line">config</span><br><span class="line">start</span><br><span class="line">keepalived</span><br><span class="line">loadbalance</span><br><span class="line">meta</span><br><span class="line">nginx</span><br><span class="line">tasks</span><br><span class="line">所有优化参数proxy_params</span><br><span class="line">wordpress_db</span><br><span class="line">tasks：</span><br><span class="line">创建wp数据库</span><br><span class="line">导入sql文件</span><br><span class="line">创建wp用户</span><br><span class="line">meta：</span><br><span class="line">mysql</span><br><span class="line">wordpress_lb</span><br><span class="line">meta：</span><br><span class="line">loadbalance</span><br><span class="line">tasks：</span><br><span class="line">推送负载均衡nginx配置文件</span><br><span class="line">wordpress_web</span><br><span class="line">meta:</span><br><span class="line">create-user</span><br><span class="line">nginx</span><br><span class="line">php</span><br><span class="line">nfs-client</span><br><span class="line">tasks:</span><br><span class="line">nginx配置文件</span><br><span class="line">创建站点目录</span><br><span class="line">部署wordpress代码</span><br><span class="line">挂载nfs</span><br></pre></td></tr></table></figure><h2 id="Ansible-galaxy"><a href="#Ansible-galaxy" class="headerlink" title="Ansible galaxy"></a>Ansible galaxy</h2><h3 id="Ansible查找roles"><a href="#Ansible查找roles" class="headerlink" title="Ansible查找roles"></a>Ansible查找roles</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># ansible-galaxy search openvpn</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-galaxy search nginx</span></span><br></pre></td></tr></table></figure><h3 id="查看详细信息"><a href="#查看详细信息" class="headerlink" title="查看详细信息"></a>查看详细信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># ansible-galaxy info kostyrevaa.openvpn</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-galaxy info acandid.nginx</span></span><br></pre></td></tr></table></figure><h3 id="安装项目"><a href="#安装项目" class="headerlink" title="安装项目"></a>安装项目</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># ansible-galaxy install acandid.nginx</span></span><br></pre></td></tr></table></figure><h2 id="Ansible-vault"><a href="#Ansible-vault" class="headerlink" title="Ansible vault"></a>Ansible vault</h2><p>给playbook加密</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 加密</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-vault encrypt test.yml </span></span><br><span class="line">New Vault password: </span><br><span class="line">Confirm New Vault password: </span><br><span class="line">Encryption successful</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看加密后的playbook</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-vault view test.yml </span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 编辑加密后的playbook</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-vault edit test.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 重置密码</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-vault rekey test.yml</span></span><br><span class="line">Vault password: </span><br><span class="line">New Vault password: </span><br><span class="line">Confirm New Vault password: </span><br><span class="line">Rekey successful</span><br><span class="line"></span><br><span class="line"><span class="comment">## 取消密码</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-vault decrypt test.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 执行带密码的ansible playbook</span></span><br><span class="line">[root@m01 ~]<span class="comment"># echo 111 &gt; /tmp/ansible.pass</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-playbook -i /root/ansible/manager/hosts test.yml --vault-password-file=/tmp/ansible.pass</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ansible自动化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ansible </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql介绍及安装(1)</title>
      <link href="/2022/10/17/MySQL/Day01MySQL%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AE%89%E8%A3%85/"/>
      <url>/2022/10/17/MySQL/Day01MySQL%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="MySQL介绍及安装"><a href="#MySQL介绍及安装" class="headerlink" title="MySQL介绍及安装"></a>MySQL介绍及安装</h1><h2 id="DBA工作内容及课程体系"><a href="#DBA工作内容及课程体系" class="headerlink" title="DBA工作内容及课程体系"></a>DBA工作内容及课程体系</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517132645751.png" alt="image-20230517132645751"></p><h2 id="MySQL课程体系介绍"><a href="#MySQL课程体系介绍" class="headerlink" title="MySQL课程体系介绍"></a>MySQL课程体系介绍</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517132712939.png" alt="image-20230517132712939"></p><h2 id="DBA的职业素养"><a href="#DBA的职业素养" class="headerlink" title="DBA的职业素养"></a>DBA的职业素养</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517132729374.png" alt="image-20230517132729374"></p><h2 id="MySQL简介及安装"><a href="#MySQL简介及安装" class="headerlink" title="MySQL简介及安装"></a>MySQL简介及安装</h2><h3 id="什么是数据"><a href="#什么是数据" class="headerlink" title="什么是数据"></a>什么是数据</h3><p>数据(data)是事实或观察的结果，是对客观事物的逻辑归纳，是用于表示客观事物的未经加工的的原始素材。 数据可以是连续的值，比如声音、图像，称为模拟数据。也可以是离散的，如符号、文字，称为数字数据。 在计算机系统中，数据以二进制信息单元0,1的形式表示。  </p><p>数据的定义: 数据是指对客观事件进行记录并可以鉴别的符号，是对客观事物的性质、状态以及相互关系等进行记载的物理符号或这些物理符号的组合。它是可识别的、抽象的符号。*</p><h3 id="什么是数据库管理系统"><a href="#什么是数据库管理系统" class="headerlink" title="什么是数据库管理系统"></a>什么是数据库管理系统</h3><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517132753091.png" alt="image-20230517132753091"></p><h3 id="数据库系统种类"><a href="#数据库系统种类" class="headerlink" title="数据库系统种类"></a>数据库系统种类</h3><p><strong>RDBMS</strong></p><p>以多张二维表的方式来存储，又给多张表建立了一定的关系（关系型数据库）</p><p>数据库管理系统</p><p>DBNS</p><ul><li>存数据</li><li>取数据</li></ul><p>数据库管理系统类型</p><ul><li>关系型数据库（RDBMS）</li><li>使用SOL语句管理数据库</li><li>互相关联的二维表组成</li><li>最大特点数据安全性方面强（ACID）</li></ul><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517132809846.png" alt="image-20230517132809846"></p><p><strong>NoSQL</strong></p><ul><li>非关系型数据库（NoSQL）</li><li>一般来说由Json格式</li><li>Key：Value 键值对</li></ul><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517132823383.png" alt="image-20230517132823383"></p><h3 id="RDBMS与NoSQL对比"><a href="#RDBMS与NoSQL对比" class="headerlink" title="RDBMS与NoSQL对比"></a>RDBMS与NoSQL对比</h3><p>关系型数据库和非关系型数据库对比</p><p>功能性能对比</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517132836271.png" alt="image-20230517132836271"></p><p>特点对比</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#关系型数据库（RDBMS）的特点:</span></span><br><span class="line"></span><br><span class="line">1.二维表</span><br><span class="line">2.典型产品Oracle传统企业，MySQL互联网企业</span><br><span class="line">3.数据存取是通过SQL（Structured Query Language结构化查询语言）</span><br><span class="line">4.最大特点数据安全性方面强（ACID）</span><br><span class="line"></span><br><span class="line"><span class="comment">#非关系型数据库（NoSQL: NotonlySQL）的特点</span></span><br><span class="line"></span><br><span class="line">1.不是否定关系型数据库，而是做关系型数据库的补充。</span><br><span class="line">2.想做老大，先学会做老二。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">####时代特点对比</span></span><br><span class="line"></span><br><span class="line">1. web1.0时代</span><br><span class="line">  1.1 企业提供内容，用户浏览，所以关系型数据库够用，并发并不高，所以不需要nosql。</span><br><span class="line"></span><br><span class="line">2. web2.0时代</span><br><span class="line">  2.1 核心是企业提供平台，用户参与提供内容，这个时代关系型数据库无法满足需求了。</span><br><span class="line">  </span><br><span class="line">3. 2003NoSQL出现</span><br><span class="line">  3.1 memcache的诞生，关注的点是性能，但是针对安全性能关注比较低，随着安全性能需求不断提升，所以有了redis。</span><br><span class="line"> </span><br><span class="line">4. redis的特点</span><br><span class="line">  4.1 依然高性能高并发</span><br><span class="line">  4.2 数据持久化功能</span><br><span class="line">  4.3 支持多数据类型，主从复制和集群</span><br><span class="line">  4.4 管理不再使用SQL了</span><br><span class="line">  </span><br><span class="line">关系型数据库典型产品</span><br><span class="line">MySQL</span><br><span class="line">Oracle</span><br><span class="line">MSSQL（SQLserver）</span><br><span class="line">PostgreSQL</span><br><span class="line">非关系型数据库典型产品</span><br><span class="line">Redis</span><br><span class="line">elasticsearch （ELK）</span><br><span class="line">MangoDB  </span><br></pre></td></tr></table></figure><h2 id="MySQL安装"><a href="#MySQL安装" class="headerlink" title="MySQL安装"></a>MySQL安装</h2><h3 id="MySQL安装方式"><a href="#MySQL安装方式" class="headerlink" title="MySQL安装方式"></a>MySQL安装方式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.rpm,yum安装</span></span><br><span class="line">安装方面</span><br><span class="line">安装速度快，无法定制</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.二进制</span></span><br><span class="line">不需要安装</span><br><span class="line">解压即可使用，不能定制功能</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.编译安装</span></span><br><span class="line">  3.1 可定制，安装慢</span><br><span class="line">  3.2 四个步骤：</span><br><span class="line">    3.2.1 解压（tar）</span><br><span class="line">    3.2.2 生成（./configure）cmake</span><br><span class="line">    3.2.3 编译（make）</span><br><span class="line">    3.2.4 安装（make install）</span><br><span class="line">  3.3  5.5版本之前：tar ./configure make make install</span><br><span class="line">  3.4  5.5版本之后：cmake gmake</span><br><span class="line"></span><br><span class="line">4. 先编译，然后定制rpm包，制作yum仓库，然后yum安装</span><br><span class="line">  4.1 简单，速度快，可定制，比较复杂，制作时间极长</span><br><span class="line"></span><br><span class="line">5. 企业中选择的安装方式</span><br><span class="line">  5.1 中小型企业：以上方式都可以，运维偏向编译，dba偏向二进制 运维也偏向二进制</span><br><span class="line">  5.2 大型企业：可以选择: 先编译然后定制rpm包，制作yum仓库，然后yum安装</span><br></pre></td></tr></table></figure><ul><li>yum安装</li><li>源码安装</li><li>二进制安装</li></ul><p>版本选择</p><p>官网：<a href="https://www.mysql.com/">https://www.mysql.com/</a></p><p>MySQL5.6：GA 6-12个月，小版本是偶数版<br>MySQL5.7：GA 6-12个月，小版本是偶数版，mysql5.7.20以上版本（MGR自带高可用）</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517132852351.png" alt="image-20230517132852351"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517132906825.png" alt="image-20230517132906825"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517132923806.png" alt="image-20230517132923806"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133002055.png" alt="image-20230517133002055"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517132934342.png" alt="image-20230517132934342"></p><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><table><thead><tr><th>主机名</th><th>IP</th><th>安装方式</th></tr></thead><tbody><tr><td>db01</td><td>10.0.0.51</td><td>yum</td></tr><tr><td>db02</td><td>10.0.0.52</td><td>5.6源码</td></tr><tr><td>db03</td><td>10.0.0.53</td><td>5.6二进制</td></tr><tr><td>db04</td><td>10.0.0.54</td><td>5.7二进制</td></tr></tbody></table><h3 id="yum安装"><a href="#yum安装" class="headerlink" title="yum安装"></a>yum安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.下载MySQL官方源</span></span><br><span class="line">wget https://dev.mysql.com/get/mysql80-community-release-el7-7.noarch.rpm</span><br><span class="line"></span><br><span class="line">rpm -ivh https://dev.mysql.com/get/mysql80-community-release-el7-7.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.查看仓库中支持哪些MySQL安装包</span></span><br><span class="line">yum list|grep mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.修改yum仓库配置文件  // 关闭mysql80仓库 开启mysql57仓库</span></span><br><span class="line">root@db01,172.16.1.51:/etc/yum.repos.d <span class="comment"># vim mysql-community.repo</span></span><br><span class="line">[mysql57-community]</span><br><span class="line">name=MySQL 5.7 Community Server baseurl=http://repo.mysql.com/yum/mysql-5.7- </span><br><span class="line">community/el/7/<span class="variable">$basearch</span></span><br><span class="line">enabled=1 gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql-2022</span><br><span class="line">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql</span><br><span class="line"></span><br><span class="line">[mysql80-community]</span><br><span class="line">name=MySQL 8.0 Community Server</span><br><span class="line">baseurl=http://repo.mysql.com/yum/mysql-8.0-</span><br><span class="line">community/el/7/<span class="variable">$basearch</span></span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql-2022</span><br><span class="line">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.安装MySQL Server</span></span><br><span class="line">root@db01,172.16.1.51:/etc/yum.repos.d <span class="comment"># yum install -y mysql-server</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ll /var/lib/mysql/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.启动MySQL（自动初始化）</span></span><br><span class="line">root@db01,172.16.1.51:~ <span class="comment"># systemctl start mysqld</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.MySQL5.7初始密码</span></span><br><span class="line">root@db01,172.16.1.51:~ <span class="comment"># cat /var/log/mysqld.log</span></span><br><span class="line">root@db01,172.16.1.51:~ <span class="comment"># grep &#x27;password&#x27; /var/log/mysqld.log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.连接MySQL</span></span><br><span class="line">root@db01,172.16.1.51:~ <span class="comment">#  mysql -uroot -pfWeohr*IR2hm</span></span><br><span class="line"><span class="comment"># 8.修改密码</span></span><br><span class="line">alter user root@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;123@qqdaincom&#x27;</span></span><br></pre></td></tr></table></figure><p>下载5.7.40二进制和源码包</p><p>下载5.6.50二进制和源码包</p><p>5.6.50源码</p><p><a href="https://downloads.mysql.com/archives/get/p/23/file/mysql-5.6.50.tar.gz">https://downloads.mysql.com/archives/get/p/23/file/mysql-5.6.50.tar.gz</a></p><p>5.6.50二进制</p><p><a href="https://downloads.mysql.com/archives/get/p/23/file/mysql-5.6.50-linux-glibc2.12-x86_64.tar.gz">https://downloads.mysql.com/archives/get/p/23/file/mysql-5.6.50-linux-glibc2.12-x86_64.tar.gz</a></p><p>5.7.40源码</p><p><a href="https://downloads.mysql.com/archives/get/p/23/file/mysql-boost-5.7.40.tar.gz">https://downloads.mysql.com/archives/get/p/23/file/mysql-boost-5.7.40.tar.gz</a></p><p>5.7.40二进制</p><p><a href="https://downloads.mysql.com/archives/get/p/23/file/mysql-5.7.40-linux-glibc2.12-x86_64.tar.gz">https://downloads.mysql.com/archives/get/p/23/file/mysql-5.7.40-linux-glibc2.12-x86_64.tar.gz</a></p>]]></content>
      
      
      <categories>
          
          <category> Mysql数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql源码和二进制安装(2)</title>
      <link href="/2022/10/17/MySQL/Day02MySQL%E6%BA%90%E7%A0%81%E5%92%8C%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85/"/>
      <url>/2022/10/17/MySQL/Day02MySQL%E6%BA%90%E7%A0%81%E5%92%8C%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="MySQL源码和二进制安装"><a href="#MySQL源码和二进制安装" class="headerlink" title="MySQL源码和二进制安装"></a>MySQL源码和二进制安装</h1><h2 id="mysql源码安装"><a href="#mysql源码安装" class="headerlink" title="mysql源码安装"></a>mysql源码安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装5.6.50源码</span></span><br><span class="line"><span class="comment">## 前提：安装MySQL需要C语言环境</span></span><br><span class="line">yum install -y gcc glibc gcc-c++ cmake openssl-devel ncurses-devel autoconf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.解压</span></span><br><span class="line">wget https://downloads.mysql.com/archives/get/p/23/file/mysql-5.6.50.tar.gz</span><br><span class="line">tar xf mysql-5.6.50.tar.gz</span><br><span class="line">ll mysql-5.6.50</span><br><span class="line"><span class="comment">### MySQL数据目录</span></span><br><span class="line">ll /var/lib/mysql</span><br><span class="line"><span class="comment"># 2.生成 // 自定义安装  nginx:./configure  mysql: cmake  || gmake</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定安装目录</span></span><br><span class="line">cmake . -DCMAKE_INSTALL_PREFIX=/app/mysql-5.6.50 \</span><br><span class="line"><span class="comment">#数据存放位置</span></span><br><span class="line">-DMYSQL_DATADIR=/app/mysql-5.6.50/data \</span><br><span class="line"><span class="comment">#socket文件存放位置</span></span><br><span class="line">-DMYSQL_UNIX_ADDR=/app/mysql-5.6.50/tmp/mysql.sock \</span><br><span class="line"><span class="comment">#使用utf8字符集</span></span><br><span class="line">-DDEFAULT_CHARSET=utf8 \</span><br><span class="line"><span class="comment">#校验规则</span></span><br><span class="line">-DDEFAULT_COLLATION=utf8_general_ci \</span><br><span class="line"><span class="comment">#使用其他额外的字符集</span></span><br><span class="line">-DWITH_EXTRA_CHARSETS=all \</span><br><span class="line"><span class="comment">#支持的存储引擎</span></span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_FEDERATED_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \</span><br><span class="line"><span class="comment">#禁用的存储引擎</span></span><br><span class="line">-DWITHOUT_EXAMPLE_STORAGE_ENGINE=1 \</span><br><span class="line"><span class="comment">#启用zlib库支持（zib、gzib相关）</span></span><br><span class="line">-DWITH_ZLIB=bundled \</span><br><span class="line"><span class="comment">#启用SSL库支持（安全套接层）</span></span><br><span class="line">-DWITH_SSL=bundled \</span><br><span class="line"><span class="comment">#启用本地数据导入支持</span></span><br><span class="line">-DENABLED_LOCAL_INFILE=1 \</span><br><span class="line"><span class="comment">#编译嵌入式服务器支持</span></span><br><span class="line">-DWITH_EMBEDDED_SERVER=1 \</span><br><span class="line"><span class="comment"># mysql5.6支持了google的c++mock框架了，允许下载，否则会安装报错。</span></span><br><span class="line">-DENABLE_DOWNLOADS=1 \</span><br><span class="line"><span class="comment">#禁用debug（默认为禁用）</span></span><br><span class="line">-DWITH_DEBUG=0</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> mysql-5.6.50</span><br><span class="line">cmake . -DCMAKE_INSTALL_PREFIX=/app/mysql-5.6.50 \</span><br><span class="line">-DMYSQL_DATADIR=/app/mysql-5.6.50/data \</span><br><span class="line">-DMYSQL_UNIX_ADDR=/app/mysql-5.6.50/tmp/mysql.sock \</span><br><span class="line">-DDEFAULT_CHARSET=utf8 \</span><br><span class="line">-DDEFAULT_COLLATION=utf8_general_ci \</span><br><span class="line">-DWITH_EXTRA_CHARSETS=all \</span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_FEDERATED_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITHOUT_EXAMPLE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_ZLIB=bundled \</span><br><span class="line">-DWITH_SSL=system \</span><br><span class="line">-DENABLED_LOCAL_INFILE=1 \</span><br><span class="line">-DWITH_EMBEDDED_SERVER=1 \</span><br><span class="line">-DENABLE_DOWNLOADS=1 \</span><br><span class="line">-DWITH_DEBUG=0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.编译</span></span><br><span class="line"><span class="comment"># 4.安装</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="comment">## 程序目录</span></span><br><span class="line">ll /app/mysql-5.6.50/</span><br><span class="line"><span class="comment"># 5.做软链接方便升级</span></span><br><span class="line"><span class="built_in">ln</span> -s /app/mysql-5.6.50 /app/mysql</span><br><span class="line"><span class="comment"># 6.进入supportfiles目录</span></span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line">/app/mysql/support-files</span><br><span class="line"><span class="comment"># 7.拷贝配置文件</span></span><br><span class="line"><span class="built_in">cp</span> /app/mysql/support-files/my-default.cnf /etc/my.cnf</span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line"><span class="comment"># 8.拷贝启动脚本</span></span><br><span class="line"><span class="built_in">cp</span> /app/mysql/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line"><span class="comment"># 9.创建socket文件存放目录</span></span><br><span class="line"><span class="built_in">mkdir</span> /app/mysql/tmp</span><br><span class="line"><span class="comment"># 10.创建MySQL程序用户</span></span><br><span class="line">useradd mysql -s /sbin/nologin -M</span><br><span class="line"><span class="comment"># 11.初始化</span></span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line">/app/mysql/scripts // 初始化程序存放目录</span><br><span class="line"></span><br><span class="line">/app/mysql/scripts <span class="comment"># ./mysql_install_db --user=mysql --basedir=/app/mysql-5.6.50 --datadir=/app/mysql-5.6.50/data</span></span><br><span class="line">ll /app/mysql/data</span><br><span class="line">/etc/init.d/mysqld start</span><br><span class="line"><span class="comment"># 12.授权</span></span><br><span class="line"><span class="built_in">chown</span> -R mysql.mysql</span><br><span class="line">/app/mysql*</span><br><span class="line"><span class="comment"># 13.添加环境变量</span></span><br><span class="line">vim /etc/profile.d/mysql.sh</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;/app/mysql/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133026807.png" alt="image-20230517133026807"></p><p>tail -100f &#x2F;app&#x2F;mysql-5.6.50&#x2F;data&#x2F;db02.</p><h2 id="mysql二进制安装"><a href="#mysql二进制安装" class="headerlink" title="mysql二进制安装"></a>mysql二进制安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#5.6.50二进制</span></span><br><span class="line"><span class="comment"># 0.安装依赖</span></span><br><span class="line">yum install -y autoconf libaio-devel</span><br><span class="line"></span><br><span class="line"><span class="comment">#下载</span></span><br><span class="line">wget https://downloads.mysql.com/archives/get/p/23/file/mysql-5.6.50-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.解压</span></span><br><span class="line">tar xf mysql-5.6.50-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line"><span class="comment"># 2.创建安装目录</span></span><br><span class="line"><span class="built_in">mkdir</span> /app</span><br><span class="line"><span class="comment"># 3.移动MySQL到安装目录</span></span><br><span class="line"><span class="built_in">mv</span> mysql-5.6.50-linux-glibc2.12-x86_64 /app/mysql-5.6.50</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.做软链接</span></span><br><span class="line"><span class="built_in">ln</span> -s /app/mysql-5.6.50 /app/mysql</span><br><span class="line"><span class="comment"># 5.编辑配置文件</span></span><br><span class="line">root@db03,172.16.1.53:/app/mysql/support-files <span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.拷贝启动脚本</span></span><br><span class="line">root@db03,172.16.1.53:/app/mysql/support-files <span class="comment"># cp /app/mysql/support-files/mysql.server /etc/init.d/mysqld</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.创建mysql用户</span></span><br><span class="line">root@db03,172.16.1.53:/app/mysql/scripts <span class="comment"># useradd mysql -s /sbin/nologin -M</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.初始化</span></span><br><span class="line">root@db03,172.16.1.53:/app/mysql/scripts <span class="comment"># ./mysql_install_db --user=mysql --basedir=/app/mysql --datadir=/app/mysql/data</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.启动mysql</span></span><br><span class="line">root@db03,172.16.1.53:/app/mysql/scripts <span class="comment"># /etc/init.d/mysqld start</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.修改启动脚本</span></span><br><span class="line">root@db03,172.16.1.53:/app/mysql/scripts <span class="comment"># sed -i &#x27;s#/usr/local#/app#g&#x27; /etc/init.d/mysqld</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.修改配置文件参数</span></span><br><span class="line">root@db03,172.16.1.53:/app/mysql/scripts <span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql // 指定程序安装的目录</span><br><span class="line">datadir=/app/mysql/data // 指定程序的数据存放目录</span><br><span class="line"></span><br><span class="line"><span class="comment"># 11.启动mysql</span></span><br><span class="line">etc/init.d/mysqld start</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加环境变量</span></span><br><span class="line">vim /etc/profile.d/mysql.sh</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;/app/mysql/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="comment">#使环境变量生效</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment">#查看环境变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line"><span class="comment">#设置密码</span></span><br><span class="line">mysqladmin -uroot -p password <span class="string">&#x27;123&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="使用systemctld管理mysql"><a href="#使用systemctld管理mysql" class="headerlink" title="使用systemctld管理mysql"></a>使用systemctld管理mysql</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">/app/mysql-5.6.50/bin/mysqld --basedir=/app/mysql-5.6.50 --</span><br><span class="line">datadir=/app/mysql-5.6.50/data --plugin-dir=/app/mysql-</span><br><span class="line">5.6.50/lib/plugin --user=mysql --log-error=db02.err --pidfile=/</span><br><span class="line">app/mysql-5.6.50/data/db02.pid</span><br><span class="line"><span class="comment">#systemctl启动命令</span></span><br><span class="line">/app/mysql/bin/mysqld --defaults-file=/etc/my.cnf --user=mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加mysql启动命令</span></span><br><span class="line"><span class="built_in">cd</span> /usr/lib/systemd/system</span><br><span class="line">vim mysqld.service </span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=MySQL Server</span><br><span class="line">After=network.target,syslog.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/app/mysql/bin/mysqld --defaults-file=/etc/my.cnf --user=mysql</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">killall mysqld</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start mysqld</span><br><span class="line">systemctl <span class="built_in">enable</span> mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment">#二进制包装的mysql</span></span><br><span class="line">vim /usr/lib/systemd/system/mysqld.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=MySQL Server</span><br><span class="line">After=network.target,syslog.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/app/mysql/bin/mysqld --defaults-file=/etc/my.cnf --user=mysql</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定配置文件</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql</span><br><span class="line">datadir=/app/mysql/data</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure><h2 id="密码相关操作"><a href="#密码相关操作" class="headerlink" title="密码相关操作"></a>密码相关操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##mysql 5.7 yum安装</span></span><br><span class="line">mysql&gt; alter user root@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;xxxxx&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置密码</span></span><br><span class="line"><span class="comment">## mysql 5.6源码和二进制安装 </span></span><br><span class="line"> <span class="comment"># mysqladmin -uroot -p password &#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#更改密码</span></span><br><span class="line">mysqladmin -uroot -p password <span class="string">&#x27;456&#x27;</span></span><br><span class="line"></span><br><span class="line">mysqladmin -uroot -p456 password <span class="string">&#x27;789&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="mysql5-6和5-7安装区别"><a href="#mysql5-6和5-7安装区别" class="headerlink" title="mysql5.6和5.7安装区别"></a>mysql5.6和5.7安装区别</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">cmake . -DCMAKE_INSTALL_PREFIX=/application/mysql-5.7.20 \</span><br><span class="line">-DMYSQL_DATADIR=/application/mysql-5.7.20/data \</span><br><span class="line">-DMYSQL_UNIX_ADDR=/application/mysql-5.7.20/tmp/mysql.sock \</span><br><span class="line">-DDOWNLOAD_BOOST=1 \</span><br><span class="line">-DWITH_BOOST=/usr/local/boost_1_59_0 \</span><br><span class="line">-DDEFAULT_CHARSET=utf8 \</span><br><span class="line">-DDEFAULT_COLLATION=utf8_general_ci \</span><br><span class="line">-DWITH_EXTRA_CHARSETS=all \</span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_FEDERATED_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITHOUT_EXAMPLE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_ZLIB=bundled \</span><br><span class="line">-DWITH_SSL=bundled \</span><br><span class="line">-DENABLED_LOCAL_INFILE=1 \</span><br><span class="line">-DWITH_EMBEDDED_SERVER=1 \</span><br><span class="line">-DENABLE_DOWNLOA</span><br><span class="line"></span><br><span class="line"><span class="comment">#5.7.40二进制</span></span><br><span class="line">wget https://downloads.mysql.com/archives/get/p/23/file/mysql-5.7.40-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line"></span><br><span class="line">tar xf mysql-5.7.40-linux-glibc2.12-</span><br><span class="line">x86_64.tar.gz</span><br><span class="line"><span class="built_in">mkdir</span> /app</span><br><span class="line"><span class="built_in">mv</span> mysql-5.7.40-linux-glibc2.12-x86_64</span><br><span class="line">/app/mysql-5.7.40</span><br><span class="line"><span class="comment">#做软链接方便升级</span></span><br><span class="line"><span class="built_in">ln</span> -s /app/mysql-5.7.40 /app/mysql</span><br><span class="line"><span class="comment">#安装依赖</span></span><br><span class="line">yum install -y autoconf libaio-devel</span><br><span class="line"><span class="comment">#初始化在bin目录下</span></span><br><span class="line"><span class="built_in">cd</span> /app/mysql-5.7.40/bin</span><br><span class="line">useradd mysql -s /sbin/nologin -M</span><br><span class="line"></span><br><span class="line">./mysqld --initialize-insecure --user=mysql --basedir=/app/mysql-5.7.40 --datadir=/app/mysql-5.7.40/data</span><br><span class="line"></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[myqsld]</span><br><span class="line">basedir=/app/mysql</span><br><span class="line">datadir=/app/mysql/data</span><br><span class="line">skip_name_resolve</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /app/mysql/support-files</span><br><span class="line"><span class="built_in">cp</span> mysql.server /etc/init.d/mysqld</span><br><span class="line"><span class="comment"># 修改启动脚本</span></span><br><span class="line">root@db03,172.16.1.53:/app/mysql/scripts <span class="comment"># sed -i &#x27;s#/usr/local#/app#g&#x27; /etc/init.d/mysqld</span></span><br><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">/etc/init.d/mysqld57 start</span><br><span class="line"><span class="comment">#添加环境变量</span></span><br><span class="line">vim /etc/profile.d/mysql.sh</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;/app/mysql/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="comment">#使环境变量生效</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="comment">#查看环境变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line"><span class="comment">#设置密码</span></span><br><span class="line">mysqladmin -uroot -p password <span class="string">&#x27;123&#x27;</span></span><br><span class="line"><span class="comment">#查看库</span></span><br><span class="line">show databases;</span><br><span class="line"><span class="comment">#查看用户</span></span><br><span class="line"><span class="keyword">select</span> user,host from mysql.user;</span><br><span class="line"><span class="comment">#查看用户密码</span></span><br><span class="line"><span class="keyword">select</span> user,host,password from mysql.user;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133045506.png" alt="image-20230517133045506"></p>]]></content>
      
      
      <categories>
          
          <category> Mysql数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql用户权限及配置管理(4)</title>
      <link href="/2022/10/17/MySQL/Day04MySQL%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E5%8F%8A%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/"/>
      <url>/2022/10/17/MySQL/Day04MySQL%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E5%8F%8A%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="MySQl用户权限及配置管理"><a href="#MySQl用户权限及配置管理" class="headerlink" title="MySQl用户权限及配置管理"></a>MySQl用户权限及配置管理</h1><h2 id="msyql忘记root密码或误删root用户"><a href="#msyql忘记root密码或误删root用户" class="headerlink" title="msyql忘记root密码或误删root用户"></a>msyql忘记root密码或误删root用户</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####方法一</span></span><br><span class="line"><span class="comment"># 1.停止数据库</span></span><br><span class="line">root@db02,172.16.1.52:~ <span class="comment"># /etc/init.d/mysqld stop</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.跳过授权表启动数据库</span></span><br><span class="line">root@db02,172.16.1.52:~ <span class="comment"># mysqld_safe --skip-grant-tables &amp;</span></span><br><span class="line"></span><br><span class="line">skip-grant-tables // 不做任何权限限制，所有用户都可以连接数据库</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.跳过网络启动数据库</span></span><br><span class="line">root@db02,172.16.1.52:~ <span class="comment"># mysqld_safe --skip-grant-tables --skip-networking &amp;</span></span><br><span class="line"></span><br><span class="line">skip-networking // 跳过任何网段，不允许远程连接，只能本地连接</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.无法直接创建用户</span></span><br><span class="line">mysql&gt; create user root@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">ERROR 1290 (HY000): The MySQL server is running with the --skip-grant-tables option so it cannot execute this statement</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all on *.* to root@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">ERROR 1290 (HY000): The MySQL server is running with the --skip-grant-tables option so it cannot execute this statement</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.查看user表的表结构（知道表中的字段有哪些）</span></span><br><span class="line">mysql&gt; desc mysql.user;</span><br><span class="line"></span><br><span class="line"><span class="comment">#进入MySQl库里面</span></span><br><span class="line">use mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.插入数据</span></span><br><span class="line">mysql&gt; insert into</span><br><span class="line">user(user,host,password,ssl_cipher,x509_issuer,x509_subject)</span><br><span class="line">value(<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;localhost&#x27;</span>,PASSWORD(<span class="string">&#x27;123&#x27;</span>),<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> user,host,password from mysql.user;</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| user | host | password |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line">| root | localhost | *23AE809DDACAF96AF0FD78ED04B6A265E05AA257 |</span><br><span class="line">+------+-----------+-------------------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看用户表数据</span></span><br><span class="line"><span class="keyword">select</span> * from mysql.user\G</span><br><span class="line"></span><br><span class="line"><span class="comment">#给权限</span></span><br><span class="line">mysql&gt; insert into mysql.user values (‘localhost’,’root’,PASSWORD(‘123’),</span><br><span class="line">‘Y’,</span><br><span class="line">‘Y’,</span><br><span class="line">‘Y’,</span><br><span class="line">‘Y’,</span><br><span class="line">‘Y’,</span><br><span class="line">‘Y’,</span><br><span class="line">‘Y’,</span><br><span class="line">‘Y’,</span><br><span class="line">‘Y’,</span><br><span class="line">‘Y’,</span><br><span class="line">‘Y’,</span><br><span class="line">‘Y’,</span><br><span class="line">‘Y’,</span><br><span class="line">‘Y’,</span><br><span class="line">‘Y’,</span><br><span class="line">‘Y’,</span><br><span class="line">‘Y’,</span><br><span class="line">’Y’,</span><br><span class="line">’Y’,</span><br><span class="line">’Y’,</span><br><span class="line">’Y’,</span><br><span class="line">’Y’,</span><br><span class="line">’Y’,</span><br><span class="line">’Y’,</span><br><span class="line">’Y’,</span><br><span class="line">’Y’,</span><br><span class="line">’Y’,</span><br><span class="line">’Y’,</span><br><span class="line">’Y’,</span><br><span class="line">’’,</span><br><span class="line">’’,</span><br><span class="line">’’,</span><br><span class="line">’’,0,0,0,0,’mysql_native_password’,’’,’N’);</span><br><span class="line"></span><br><span class="line"><span class="comment">## MySQL5.7 密码字段</span></span><br><span class="line">authentication_string: *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.重启数据库</span></span><br><span class="line">root@db02,172.16.1.52:~ <span class="comment"># /etc/init.d/mysqld restart</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####方法二</span></span><br><span class="line"><span class="comment">#跳过网络启动数据库</span></span><br><span class="line">root@db02,172.16.1.52:~ <span class="comment"># mysqld_safe --skip-grant-tables --skip-networking &amp;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 刷新授权表没有创建用户的权限</span></span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"><span class="comment">#改完之后执行一下flush privileges;退出重启才能创建用户</span></span><br><span class="line">mysql&gt; update mysql.user <span class="built_in">set</span> grant_priv=<span class="string">&#x27;Y&#x27;</span> <span class="built_in">where</span> user=<span class="string">&#x27;root&#x27;</span> and</span><br><span class="line">host=<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看用户表数据</span></span><br><span class="line"><span class="keyword">select</span> * from mysql.user\G</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启数据库</span></span><br><span class="line">root@db02,172.16.1.52:~ <span class="comment"># /etc/init.d/mysqld restart</span></span><br><span class="line"></span><br><span class="line">mysql -uroot -p123</span><br><span class="line">mysql&gt; grant all on *.* to root@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#第三种方法</span></span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">mysql&gt; grant all on *.* to root@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span> with grant option;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###重新初始化</span></span><br><span class="line"><span class="built_in">cd</span> /app/mysql/data</span><br><span class="line"><span class="built_in">rm</span> -fr ./*</span><br><span class="line"><span class="built_in">cd</span> /app/mysql/scripts/</span><br><span class="line">./mysql_install_db --user=mysql --basedir=/app/mysql --datadir=/app/mysql/data</span><br></pre></td></tr></table></figure><h2 id="MySQl用户管理"><a href="#MySQl用户管理" class="headerlink" title="MySQl用户管理"></a>MySQl用户管理</h2><p>用户作用：</p><ul><li>登录数据库</li><li>对库表的增删改查</li></ul><p>MySQl用户定义</p><p>用户@’主机域’</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="string">&#x27;10.0.0.%&#x27;</span> 10.0.0.1-0.0.0.255</span><br><span class="line">root@<span class="string">&#x27;10.0.0.5%&#x27;</span> 10.0.0.50-10.0.0.59 + 10.0.0.5</span><br><span class="line">root@<span class="string">&#x27;10.0.%.%&#x27;</span></span><br><span class="line">root@<span class="string">&#x27;10.%.%.%&#x27;</span></span><br><span class="line">root@<span class="string">&#x27;%&#x27;</span></span><br><span class="line">root@<span class="string">&#x27;10.0.0.0/255.255.255.0&#x27;</span></span><br><span class="line">root@<span class="string">&#x27;10.0.0.0/24&#x27;</span> // 错误写法</span><br><span class="line"></span><br><span class="line">主机域作用：开启白名单，设置允许连接的网段</span><br></pre></td></tr></table></figure><h2 id="mysql用户的增删改查"><a href="#mysql用户的增删改查" class="headerlink" title="mysql用户的增删改查"></a>mysql用户的增删改查</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###增  创建用户</span></span><br><span class="line">mysql&gt; create user test_aaa@<span class="string">&#x27;%&#x27;</span>; // 不带密码的用户</span><br><span class="line">mysql&gt; create user test_aaa@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;111&#x27;</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all on *.* to test_bbb@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;222&#x27;</span>;</span><br><span class="line"></span><br><span class="line">insert 物理增加用户</span><br><span class="line"></span><br><span class="line">grant：</span><br><span class="line">- 创建用户</span><br><span class="line">- 设置密码</span><br><span class="line">- 修改密码</span><br><span class="line">- 设置权限</span><br><span class="line">- 修改权限</span><br><span class="line"></span><br><span class="line"><span class="comment">###删  逻辑删除</span></span><br><span class="line">mysql&gt; drop user test1@<span class="string">&#x27;10.0.0.0/24&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#物理删除</span></span><br><span class="line">mysql&gt; delete from mysql.user <span class="built_in">where</span> user=<span class="string">&#x27;test&#x27;</span> and host=<span class="string">&#x27;10.0.0.0/255.255.255.0&#x27;</span>;   </span><br><span class="line"></span><br><span class="line"><span class="comment">### 改 </span></span><br><span class="line">改表 alter table</span><br><span class="line">改库 alter database</span><br><span class="line">改用户 alter user    //mysql5.6不支持这样改用户</span><br><span class="line"></span><br><span class="line">mysql&gt; alter user root@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line">insert delete update 物理上改数据</span><br><span class="line">create drop alter 逻辑上改数据</span><br><span class="line"></span><br><span class="line"><span class="comment">#update可以直接改表数据并生效，但是涉及到修改用户表数据时，无法直接生效，改完用户要刷新一下授权</span></span><br><span class="line"></span><br><span class="line">mysql&gt; update mysql.user <span class="built_in">set</span> password=PASSWORD(<span class="string">&#x27;qqq&#x27;</span>) <span class="built_in">where</span> user=<span class="string">&#x27;root&#x27;</span> and host=<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges; <span class="comment">#全局</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 查</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> user ,host from mysql.user;</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from mysql.user\G</span><br><span class="line"></span><br><span class="line">mysql&gt; show grants <span class="keyword">for</span> test_ccc@<span class="string">&#x27;%&#x27;</span>;     // 查看用户权限</span><br></pre></td></tr></table></figure><h2 id="mysql修改密码的方式"><a href="#mysql修改密码的方式" class="headerlink" title="mysql修改密码的方式"></a>mysql修改密码的方式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方法一</span></span><br><span class="line">root@db02,172.16.1.52:~ <span class="comment"># mysqladmin -uroot -pqqq password &#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法二</span></span><br><span class="line">mysql&gt; grant all on *.* to root@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;222&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法三 只能修改当前登录的用户</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> password=PASSWORD(<span class="string">&#x27;456&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法四 MySQL5.7有初始密码并且是初次登录</span></span><br><span class="line">mysql&gt; alter user root@<span class="string">&#x27;localhost&#x27;</span> identifide by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法五</span></span><br><span class="line">mysql&gt; update mysql.user <span class="built_in">set</span> password=PASSWORD(<span class="string">&#x27;789&#x27;</span>) <span class="built_in">where</span> user=<span class="string">&#x27;root&#x27;</span> and host=<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt; update mysql.user <span class="built_in">set</span> authentication_string=PASSWORD(<span class="string">&#x27;789&#x27;</span>) <span class="built_in">where</span> user=<span class="string">&#x27;root&#x27;</span> and host=<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure><h2 id="用户权限管理"><a href="#用户权限管理" class="headerlink" title="用户权限管理"></a>用户权限管理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">grant</span><br><span class="line"></span><br><span class="line">INSERT,SELECT, UPDATE, DELETE, CREATE, DROP, RELOAD, SHUTDOWN,</span><br><span class="line">PROCESS, FILE, REFERENCES, INDEX, ALTER, SHOW DATABASES, SUPER,</span><br><span class="line">CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE,</span><br><span class="line">REPLICATION CLIENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER</span><br><span class="line">ROUTINE, CREATE USER, EVENT, TRIGGER, CREATE TABLESPACE</span><br><span class="line"></span><br><span class="line"><span class="comment">## 一般给发开开用户</span></span><br><span class="line">grant insert,<span class="keyword">select</span>,update,delete on 库.表 to 用户@<span class="string">&#x27;主机域&#x27;</span> identified by <span class="string">&#x27;密码&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 规范给开发开用户</span></span><br><span class="line">grant insert,<span class="keyword">select</span>,update on 库.表 to 用户@<span class="string">&#x27;主机域&#x27;</span> identified by <span class="string">&#x27;密码&#x27;</span>;</span><br><span class="line">权限 库.表 用户 密码</span><br><span class="line"></span><br><span class="line">grant insert,<span class="keyword">select</span>,update on mysql.user to zls@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 脱敏：脱离敏感信息</span></span><br><span class="line">mysql&gt; create table <span class="built_in">test</span>(<span class="built_in">id</span> int,name varchar(10),cardid int,phone</span><br><span class="line">bigint);</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into <span class="built_in">test</span> values(1,<span class="string">&#x27;heqingwen&#x27;</span>,123456789,1383838438);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into <span class="built_in">test</span> values(2,<span class="string">&#x27;zls&#x27;</span>,456123789,13012345678);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant insert,<span class="keyword">select</span>,update on zls.* to zls_test2@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt; grant insert,<span class="keyword">select</span>(<span class="built_in">id</span>,name,phone),update on zls.test to zls_test3@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line">授权的作用域：</span><br><span class="line">*.* 所有库，所有表</span><br><span class="line">库.* 指定库，所有表 // 单库级别</span><br><span class="line">库.表 指定库，指定表 // 单表级别</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Mysql数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql体系结构管理(3)</title>
      <link href="/2022/10/17/MySQL/Day03MySQL%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E7%AE%A1%E7%90%86/"/>
      <url>/2022/10/17/MySQL/Day03MySQL%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="MySQL体系结构管理"><a href="#MySQL体系结构管理" class="headerlink" title="MySQL体系结构管理"></a>MySQL体系结构管理</h1><h2 id="客服端与服务端模型"><a href="#客服端与服务端模型" class="headerlink" title="客服端与服务端模型"></a>客服端与服务端模型</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133100396.png" alt="image-20230517133100396"></p><p>1.mysql是一个典型的C&#x2F;S服务结构  1.1 mysql自带的客户端程序（&#x2F;application&#x2F;mysql&#x2F;bin）   </p><p> mysql   mysqladmin   mysqldump</p><p>第三方客户端：</p><ul><li><p>SOLyog</p></li><li><p>Navicat</p><p>mysqld是mysql服务端的守护进程</p></li></ul><p>1.2 mysqld一个二进制程序，后台的守护进程  </p><p>单进程  多线程</p><p>2.应用程连接MySQL方式</p><p>TCP&#x2F;IP的连接方式</p><p>mysql -uroot -p123 -h10.0.0.51</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133112653.png" alt="image-20230517133112653"></p><p>套接字链接方式(Socket)</p><p>mysql -uroot -p123 -s &#x2F;tmp&#x2F;mysql.sock</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133203626.png" alt="image-20230517133203626"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p123 使用的是哪种连接方式？？？？？ socket连接</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p123 -h127.0.0.1 // TCP/IP</span><br><span class="line">mysql -uroot -p123 -hlocalhost // socket</span><br><span class="line">mysql -uroot -p123 -h127.0.0.1 -S /tmp/mysql.sock // TCP/IP</span><br><span class="line">mysql -uroot -p123 -S /tmp/mysql.sock -h127.0.0.1 // TCP/IP</span><br><span class="line"></span><br><span class="line"><span class="comment">##status查看mysql连接方式</span></span><br></pre></td></tr></table></figure><p>总结：MySQL默认连接方式：Socket，Socket连接性能高，不需要建立TCP&#x2F;IP三次握手<br>不是 -h一定就是TCP连接<br>当-h和-S同时指定时，优先执行-h</p><h2 id="MySQl服务器构成"><a href="#MySQl服务器构成" class="headerlink" title="MySQl服务器构成"></a>MySQl服务器构成</h2><h3 id="什么是实例"><a href="#什么是实例" class="headerlink" title="什么是实例"></a>什么是实例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.MySQL的后台进程+线程+预分配的内存结构。</span><br><span class="line">2.MySQL在启动的过程中会启动后台守护进程，并生成工作线程，预分配内存结构供MySQL处理数据使用。</span><br><span class="line"><span class="comment">#相当于启动mysql，一个mysql就是一个实例.</span></span><br><span class="line"><span class="comment">#多实例是一个机器上起多个同样的服务。</span></span><br></pre></td></tr></table></figure><p>word的打开方式</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133218979.png" alt="image-20230517133218979"></p><p>mysql的打开方式</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133232717.png" alt="image-20230517133232717"></p><h3 id="mysqld服务器程序构成"><a href="#mysqld服务器程序构成" class="headerlink" title="mysqld服务器程序构成"></a>mysqld服务器程序构成</h3><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133250923.png" alt="image-20230517133250923"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mysqld是一个守护进程但是本身不能自主启动</span></span><br><span class="line">mysql -uroot -poldboy123</span><br><span class="line">mysql -S /opt/zls.sock</span><br><span class="line"><span class="keyword">select</span> user,host,password from mysql.user;</span><br></pre></td></tr></table></figure><h4 id="连接层"><a href="#连接层" class="headerlink" title="连接层"></a>连接层</h4><p>1、提供连接协议（socket、tcp&#x2F;ip） 2、验证用户的合法性（用户名、密码、白名单） 3、提供一个专用连接线程（接收SQL、返回结果），将SQL语句交给SQL层继续处理</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133304762.png" alt="image-20230517133304762"></p><h4 id="SQL层"><a href="#SQL层" class="headerlink" title="SQL层"></a>SQL层</h4><p>1、接收到SQL语句，语法判断。 2、判断语义（判断语句类型：DML、DDL、DCL、DQL） 3、解析SQL语句，生成多种执行计划 4、优化器，选择他认为成本最低的执行计划。 5、执行器根据优化器的选择，按照优化器建议执行SQL语句，得到去哪儿找SQL语句需要访问的数据 5.1 具体：在哪个数据文件上的哪个数据页中？ 5.2 将以上结果充送给下层继续处理 6、接收存储引擎层的数据，结构化成表的形式，通过连接层提供的专用线程，将表数据返回给用户。 7、提供查询缓存 7.1 query_cache, 使用memcache 或者redis 替代 8、日志记录（binlog）</p><h4 id="存储引擎层"><a href="#存储引擎层" class="headerlink" title="存储引擎层"></a>存储引擎层</h4><p>1、接收上层的执行结果 2、取出磁盘文件和相应数据 3、返回给SQL层，结构化之后生成表格，由专用线程返回给客户端</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133318365.png" alt="image-20230517133318365"></p><h2 id="mysql的结构"><a href="#mysql的结构" class="headerlink" title="mysql的结构"></a>mysql的结构</h2><p>mysql的逻辑对象：作为管理人员或者开发人员操作的对象</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133331522.png" alt="image-20230517133331522"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133342701.png" alt="image-20230517133342701"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133357072.png" alt="image-20230517133357072"></p><h3 id="mysql单位概念"><a href="#mysql单位概念" class="headerlink" title="mysql单位概念"></a>mysql单位概念</h3><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133408477.png" alt="image-20230517133408477"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133423315.png" alt="image-20230517133423315"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建一个zls的库，就创建了一张表,又往这张表里插入三条数据</span></span><br><span class="line">create database zls;</span><br><span class="line">use zls</span><br><span class="line">create table zls_tb(<span class="built_in">id</span> int);</span><br><span class="line">insert into zls_tb values(1),(2),(3);</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看表</span></span><br><span class="line">show tables;</span><br><span class="line"><span class="comment">#查看表数据</span></span><br><span class="line"><span class="keyword">select</span> * from zls_tb;</span><br><span class="line"></span><br><span class="line"><span class="comment">#这些数据存放位置</span></span><br><span class="line"><span class="built_in">cd</span> /app/mysql-5.7.40/data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">####基础优化mysql</span></span><br><span class="line"><span class="comment">#清理没有用的用户</span></span><br><span class="line">drop user root@<span class="string">&#x27; ::1 &#x27;</span>;</span><br><span class="line"><span class="comment">#危险命令直接把mysql表删掉</span></span><br><span class="line"><span class="built_in">truncate</span> mysql.user;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Mysql数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL客户端命令及SQL语句(6)</title>
      <link href="/2022/10/17/MySQL/Day06MySQL%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%91%BD%E4%BB%A4%E5%8F%8ASOL%E8%AF%AD%E5%8F%A5/"/>
      <url>/2022/10/17/MySQL/Day06MySQL%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%91%BD%E4%BB%A4%E5%8F%8ASOL%E8%AF%AD%E5%8F%A5/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="MySQL客户端命令及SQL语句"><a href="#MySQL客户端命令及SQL语句" class="headerlink" title="MySQL客户端命令及SQL语句"></a>MySQL客户端命令及SQL语句</h1><h2 id="客户端命令"><a href="#客户端命令" class="headerlink" title="客户端命令"></a>客户端命令</h2><h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##连接命令选项</span></span><br><span class="line">-u：指定用户</span><br><span class="line">-p：指定密码</span><br><span class="line">-S：指定socket</span><br><span class="line">-h：指定主机域</span><br><span class="line"></span><br><span class="line">-e：免交互执行SQL语句</span><br><span class="line">-P：指定端口</span><br><span class="line"></span><br><span class="line"><span class="comment">## 连接到数据库后（命令）</span></span><br><span class="line">status || \s 查看数据库基本状态</span><br><span class="line"><span class="built_in">help</span> || \h || ? 查看客户端命令的帮助</span><br><span class="line">clear || \c 终止当前的命令</span><br><span class="line">ego || \G 格式化输出结果</span><br><span class="line">quit || <span class="built_in">exit</span> || \q 退出MySQL命令行</span><br><span class="line"><span class="built_in">source</span> || \.导入数据</span><br><span class="line">system || \! 执行系统命令</span><br><span class="line"><span class="built_in">tee</span> || \T 记录日志</span><br><span class="line">use                  切换数据库</span><br><span class="line"><span class="keyword">select</span> database();   查看当前所在库</span><br><span class="line"></span><br><span class="line">Ctrl +c // MySQL5.6中会退出数据库，MySQL5.7中会终止当前的SQL</span><br><span class="line"></span><br><span class="line">mysql&gt; system <span class="built_in">ls</span> -l /</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改MySQL命令提示符，显示当前所在库</span></span><br><span class="line">prompt=MySQL5.7[\d]&gt;</span><br></pre></td></tr></table></figure><h3 id="mysqladmin"><a href="#mysqladmin" class="headerlink" title="mysqladmin"></a>mysqladmin</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检测MySQL是否存活</span></span><br><span class="line">mysqladmin -uroot -p789 ping</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止数据库服务</span></span><br><span class="line">mysqladmin -uroot -p789 shutdown</span><br><span class="line"></span><br><span class="line"><span class="comment"># 免交互建库</span></span><br><span class="line">mysqladmin -uroot -p789 create zls</span><br><span class="line"></span><br><span class="line"><span class="comment"># 免交互删库</span></span><br><span class="line">mysqladmin -uroot -p789 drop zls</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置或更改密码</span></span><br><span class="line">mysqladmin -uroot -p789 password <span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 库外执行刷新日志（binlog）</span></span><br><span class="line">mysqladmin -uroot -p123 flush-log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看MySQL的默认配置参数</span></span><br><span class="line">mysqladmin -uroot -p123 variables</span><br><span class="line"><span class="comment">#查看mysql内存</span></span><br><span class="line">mysqladmin -uroot -p123 variables |grep buffer_pool_size</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新加载缓存</span></span><br><span class="line">mysqladmin -uroot -p123 reload</span><br><span class="line"></span><br><span class="line"><span class="comment">####mysqldump做备份、导出数据</span></span><br></pre></td></tr></table></figure><h2 id="SOL语句"><a href="#SOL语句" class="headerlink" title="SOL语句"></a>SOL语句</h2><h3 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h3><p>数据定义语言</p><p>库和表的定义：对库表的增删改</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增</span></span><br><span class="line">create database</span><br><span class="line">create table</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删</span></span><br><span class="line">drop database</span><br><span class="line">drop table</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改</span></span><br><span class="line">alter database</span><br><span class="line">alter table</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查（DQL）</span></span><br></pre></td></tr></table></figure><p>库定义语言</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 建库语法</span></span><br><span class="line">mysql&gt; <span class="built_in">help</span> create database;</span><br><span class="line">Name: <span class="string">&#x27;CREATE DATABASE&#x27;</span></span><br><span class="line">Description:</span><br><span class="line">Syntax:</span><br><span class="line">CREATE &#123;DATABASE | SCHEMA&#125; [IF NOT EXISTS] db_name</span><br><span class="line">    [create_option] ...</span><br><span class="line"></span><br><span class="line">create_option: [DEFAULT] &#123;</span><br><span class="line">    CHARACTER SET [=] charset_name</span><br><span class="line">  | COLLATE [=] collation_name</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#建库</span></span><br><span class="line">create database 库名;</span><br><span class="line">MySQL5.7[(none)]&gt;create database zls;</span><br><span class="line">MySQL5.7[(none)]&gt;create schema zls1;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 判断数据库是否存在，如果存在则不报错，如果不存在则创建</span></span><br><span class="line">MySQL5.7[(none)]&gt;create schema <span class="keyword">if</span> not exists zls1;</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看字符集，mysql默认用latinl字符集</span></span><br><span class="line">show variables like <span class="string">&#x27;%char%&#x27;</span>;</span><br><span class="line">show create database liqi;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建数据库时，指定字符集</span></span><br><span class="line">mysql&gt; create database <span class="keyword">if</span> not exists test_db1 character <span class="built_in">set</span> = utf8;</span><br><span class="line">mysql&gt; create database <span class="keyword">if</span> not exists test_db2 charset utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改配置文件指定字符集</span></span><br><span class="line">[mysqld]</span><br><span class="line">character_set_server=utf8</span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建数据库时，指定校验规则</span></span><br><span class="line">show collation;</span><br><span class="line">mysql&gt; create database <span class="keyword">if</span> not exists test_db3 charset utf8 collate utf8_bin;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删</span></span><br><span class="line">mysql&gt; drop database 库名;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改</span></span><br><span class="line"><span class="comment">## 修改字符集，校验规则</span></span><br><span class="line">mysql&gt; alter database 库名 charset utf8 collate utf8_bin;</span><br></pre></td></tr></table></figure><p>表定义语言</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 数据类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数字类型</span></span><br><span class="line">int：整型      -2^31 ~ (2^31)-1     -2147483648 - 2147483647</span><br><span class="line">tinyint：最小整型   -128 ~ 127   年龄</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串类型</span></span><br><span class="line">varchar：可变长的字符串    不固定长度</span><br><span class="line">char：定长字符串    固定长度</span><br><span class="line"></span><br><span class="line">varchar(5) name 张3 李4 何庆文     一个字节占一个字符</span><br><span class="line">char(5) name 张3 李4 何庆文     2个3个字节都占5个字符</span><br><span class="line">char(11)     <span class="string">&#x27;13045648545&#x27;</span>   手机号</span><br><span class="line">char(18)      身份证号</span><br><span class="line"></span><br><span class="line"><span class="comment"># 枚举类型</span></span><br><span class="line">enum(<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">enum(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>)    性别</span><br><span class="line"></span><br><span class="line"><span class="comment"># 时间类型</span></span><br><span class="line">timestamp 1970-01-01 00:00:00 - 2038-01-19 03:14:07</span><br><span class="line">datetime 1000-01-01 00:00:00 - 9999-12-31 23:59:59</span><br><span class="line"></span><br><span class="line"><span class="comment"># 浮点型</span></span><br><span class="line"><span class="built_in">float</span>：单精度浮点型</span><br><span class="line">dubble：双精度浮点型    小数点后面保留的位数</span><br><span class="line"></span><br><span class="line">student表</span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span> name age gender phone doa</span><br><span class="line">学号 名字 年龄 性别 手机号  入学日期</span><br><span class="line"></span><br><span class="line">create database anta;</span><br><span class="line">use anta</span><br><span class="line"><span class="comment">## 创建学生表</span></span><br><span class="line">mysql&gt; create table 表名(字段名1 数据类型,字段名2 数据类型,字段名3 数据类型);</span><br><span class="line"></span><br><span class="line">mysql&gt; create table 库名.表名(字段名1 数据类型,字段名2 数据类型,字段名3 数据类型);</span><br><span class="line"></span><br><span class="line">create table student(<span class="built_in">id</span> int,name varchar(10),age tinyint,gender enum(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>),phone char(11),doa datetime)charset utf8;</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into student(<span class="built_in">id</span>,name,age,gender,phone,doa) value(1,<span class="string">&#x27;zhang3&#x27;</span>,20,<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;11223344556&#x27;</span>,NOW());</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from student;</span><br><span class="line">+------+--------+------+--------+-------------+--------------------</span><br><span class="line">-+</span><br><span class="line">| <span class="built_in">id</span> | name | age | gender | phone | doa</span><br><span class="line">|</span><br><span class="line">+------+--------+------+--------+-------------+--------------------</span><br><span class="line">-+</span><br><span class="line">| 1 | zhang3 | 20 | m | 11223344556 | 2023-04-04 10:34:27</span><br><span class="line">|</span><br><span class="line">| 1 | wzk | -3 | f | 11223344538 | 2023-04-04 10:35:27</span><br><span class="line">|</span><br><span class="line">| 1 | wzk | -3 | f | 11223344538 | 2023-04-04 10:36:01</span><br><span class="line">|</span><br><span class="line"><span class="comment">## 字段属性</span></span><br><span class="line">null：可以为空</span><br><span class="line">not null：非空</span><br><span class="line"></span><br><span class="line">primary key：主键索引 唯一 且 非空 （一张表中，只能设置一个主键）</span><br><span class="line">unique key：唯一键索引 唯一 可以为空 + not null</span><br><span class="line">auto_increment：自增</span><br><span class="line">unsigned：一般配合整型使用，非负数（无符号）</span><br><span class="line">default：设置默认值</span><br><span class="line">zerofill：使用0自动补全</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------最重要-----------</span></span><br><span class="line">comment：注释、备注</span><br><span class="line"></span><br><span class="line"><span class="comment">## 优化建表语句</span></span><br><span class="line">create table student2(</span><br><span class="line"><span class="built_in">id</span> int primary key auto_increment comment <span class="string">&#x27;学生学号&#x27;</span>,</span><br><span class="line">name varchar(10) not null comment <span class="string">&#x27;学生姓名&#x27;</span>,</span><br><span class="line">age tinyint unsigned not null comment <span class="string">&#x27;学生年龄&#x27;</span>,</span><br><span class="line">gender enum(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>) not null default <span class="string">&#x27;m&#x27;</span> comment <span class="string">&#x27;学生性别&#x27;</span>,</span><br><span class="line">phone char(11) not null unique key comment <span class="string">&#x27;联系方式&#x27;</span>,</span><br><span class="line">doa datetime not null default NOW() comment <span class="string">&#x27;入学时间&#x27;</span></span><br><span class="line">) charset utf8;</span><br><span class="line"></span><br><span class="line">desc student2;</span><br><span class="line">insert into student2(name,age,phone) value(<span class="string">&#x27;li4&#x27;</span>,130,<span class="string">&#x27;11111111111&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * from student2;</span><br><span class="line"></span><br><span class="line">create table student4(</span><br><span class="line"><span class="built_in">id</span> int(3) zerofill primary key auto_increment comment <span class="string">&#x27;学生学号&#x27;</span>,</span><br><span class="line">name varchar(10) not null comment <span class="string">&#x27;学生姓名&#x27;</span>,</span><br><span class="line">age tinyint unsigned not null comment <span class="string">&#x27;学生年龄&#x27;</span>,</span><br><span class="line">gender enum(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>) not null default <span class="string">&#x27;m&#x27;</span> comment <span class="string">&#x27;学生性别&#x27;</span>,</span><br><span class="line">phone char(11) not null unique key comment <span class="string">&#x27;联系方式&#x27;</span>,</span><br><span class="line">doa datetime not null default NOW() comment <span class="string">&#x27;入学时间&#x27;</span></span><br><span class="line">) charset utf8;</span><br><span class="line"></span><br><span class="line">create table student6(</span><br><span class="line"><span class="built_in">id</span> int(3) zerofill primary key auto_increment comment <span class="string">&#x27;学生学号&#x27;</span>,</span><br><span class="line">name varchar(10) not null comment <span class="string">&#x27;学生姓名&#x27;</span>,</span><br><span class="line">age tinyint unsigned not null comment <span class="string">&#x27;学生年龄&#x27;</span>,</span><br><span class="line">gender enum(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>) not null default <span class="string">&#x27;m&#x27;</span> comment <span class="string">&#x27;学生性别&#x27;</span>,</span><br><span class="line">phone char(11) not null primary key comment <span class="string">&#x27;联系方式&#x27;</span>,</span><br><span class="line">doa datetime not null default NOW() comment <span class="string">&#x27;入学时间&#x27;</span></span><br><span class="line">) charset utf8;</span><br><span class="line"></span><br><span class="line">create table student6(</span><br><span class="line"><span class="built_in">id</span> int(3) zerofill auto_increment comment <span class="string">&#x27;学生学号&#x27;</span>,</span><br><span class="line">name varchar(10) not null comment <span class="string">&#x27;学生姓名&#x27;</span>,</span><br><span class="line">age tinyint unsigned not null comment <span class="string">&#x27;学生年龄&#x27;</span>,</span><br><span class="line">gender enum(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>) not null default <span class="string">&#x27;m&#x27;</span> comment <span class="string">&#x27;学生性别&#x27;</span>,</span><br><span class="line">phone char(11) comment <span class="string">&#x27;联系方式&#x27;</span>,</span><br><span class="line">doa datetime not null default NOW() comment <span class="string">&#x27;入学时间&#x27;</span></span><br><span class="line">primary key(<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;phone&#x27;</span>)</span><br><span class="line">) charset utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删表</span></span><br><span class="line">mysql&gt; drop table 库名.表名;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改表（改表结构）</span></span><br><span class="line"><span class="comment">### 改表名</span></span><br><span class="line">mysql&gt; alter table student2 rename zls_student2;</span><br><span class="line"></span><br><span class="line"><span class="comment">### 改字段</span></span><br><span class="line"><span class="comment"># 增</span></span><br><span class="line">mysql&gt; alter table zls_student2 add heqingwen char(3) not null;</span><br><span class="line">mysql&gt; alter table zls_student2 add wzk char(3) not null;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 将字段放在指定字段的后面</span></span><br><span class="line">mysql&gt; alter table zls_student2 add kangkang varchar(5) not null after doa;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 将字段放在最前面</span></span><br><span class="line">mysql&gt; alter table zls_student2 add tangxu varchar(5) not null first;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删</span></span><br><span class="line">mysql&gt; alter table zls_student2 drop heqingwen;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改</span></span><br><span class="line">change 可以修改字段名、数据类型、属性</span><br><span class="line"></span><br><span class="line">modify 只能修改数据类型和属性</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改字段数据类型</span></span><br><span class="line">mysql&gt; alter table zls_student2 change kangkang kangkang varchar(10);</span><br><span class="line"></span><br><span class="line">mysql&gt; alter table zls_student2 modify kangkang char(10);</span><br><span class="line"></span><br><span class="line">mysql&gt; alter table zls_student2 modify kangkang char(10) not null;</span><br><span class="line">mysql&gt; alter table zls_student2 change kangkang kangkang char(10) null default <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改字段名字</span></span><br><span class="line">mysql&gt; alter table zls_student2 change kangkang syh varchar(1);</span><br></pre></td></tr></table></figure><h3 id="DDL总结"><a href="#DDL总结" class="headerlink" title="DDL总结"></a>DDL总结</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">DDL:数据定义语言</span><br><span class="line">针对库和表的定义 操作的都是元数据</span><br><span class="line">元数据: 描述数据的数据</span><br><span class="line"></span><br><span class="line"><span class="comment">##########库</span></span><br><span class="line"><span class="comment"># 增</span></span><br><span class="line">create database</span><br><span class="line"><span class="comment"># 删</span></span><br><span class="line">drop database</span><br><span class="line"><span class="comment"># 改</span></span><br><span class="line">alter database</span><br><span class="line"></span><br><span class="line"><span class="comment">######### 表</span></span><br><span class="line"><span class="comment"># 增</span></span><br><span class="line">create table</span><br><span class="line"><span class="comment"># 删</span></span><br><span class="line">drop table</span><br><span class="line"><span class="comment"># 改</span></span><br><span class="line">alter table</span><br></pre></td></tr></table></figure><h3 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">DML:数据操作语言</span><br><span class="line">针对表中的数据进行操作 操作的都是真实数据</span><br><span class="line"><span class="comment">## 插入数据之前，需要知道表的表结构（了解有哪些字段）</span></span><br><span class="line"><span class="keyword">select</span> * from student2;<span class="comment">#查看表中数据</span></span><br><span class="line">mysql&gt; desc student2;<span class="comment">#查看表中有那些字段</span></span><br><span class="line">show create table student2;<span class="comment">#查看建表语句</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增</span></span><br><span class="line"><span class="comment">#insert语法</span></span><br><span class="line">mysql&gt; insert into 库.表(字段1,字段2,字段3,字段4...) values(<span class="string">&#x27;值1&#x27;</span>,<span class="string">&#x27;值2&#x27;</span>,值3,<span class="string">&#x27;值4&#x27;</span>...);</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into student3(<span class="built_in">id</span>,age,gender,name,phone,doa) values(2,80,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;abc&#x27;</span>,<span class="string">&#x27;12345678901&#x27;</span>,NOW());</span><br><span class="line"></span><br><span class="line">mysql&gt; insert student3(<span class="built_in">id</span>,age,gender,name,phone,doa) values(3,80,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;abd&#x27;</span>,<span class="string">&#x27;12345678902&#x27;</span>,NOW());;</span><br><span class="line"></span><br><span class="line">mysql&gt; insert student3 values(4,<span class="string">&#x27;abe&#x27;</span>,80,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;12345678903&#x27;</span>,NOW());</span><br><span class="line"></span><br><span class="line">mysql&gt; insert student3(age,gender,name,phone) values(30,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;abf&#x27;</span>,<span class="string">&#x27;12345678905&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">## 插入多条数据</span></span><br><span class="line">mysql&gt; insert student3(age,gender,name,phone) values(32,<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;abx&#x27;</span>,<span class="string">&#x27;12345678908&#x27;</span>), (31,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;abz&#x27;</span>,<span class="string">&#x27;12345678909&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删</span></span><br><span class="line">delete</span><br><span class="line">mysql&gt; delete from 表名;</span><br><span class="line">mysql&gt; delete from student3 <span class="built_in">where</span> 条件;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 规范删除方法</span></span><br><span class="line">mysql&gt; delete from student3 <span class="built_in">where</span> <span class="built_in">id</span>=4;</span><br><span class="line">mysql&gt; delete from student3 <span class="built_in">where</span> name=<span class="string">&#x27;abx&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 多条件删除</span></span><br><span class="line"><span class="comment">#and：两个条件都满足是才会删除(唯一)</span></span><br><span class="line"><span class="comment">#or:满足任何一个都删除</span></span><br><span class="line">mysql&gt; delete from student3 <span class="built_in">where</span> name=<span class="string">&#x27;abz&#x27;</span> and doa=<span class="string">&#x27;2023-04-0509:00:01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; delete from student3 <span class="built_in">where</span> name=<span class="string">&#x27;abz&#x27;</span> or name=<span class="string">&#x27;abx&#x27;</span>;</span><br><span class="line">mysql&gt; delete from student3 <span class="built_in">where</span> <span class="built_in">id</span>=14-3;</span><br><span class="line"></span><br><span class="line">mysql&gt; delete from student3 <span class="built_in">where</span> <span class="built_in">id</span>&gt;=9 and <span class="built_in">id</span>&lt;14;</span><br><span class="line"></span><br><span class="line">delete from student3 <span class="built_in">where</span> <span class="built_in">id</span>=14 or <span class="built_in">id</span>=21 or <span class="built_in">id</span>=18;</span><br><span class="line">delete from student3 <span class="built_in">where</span> <span class="built_in">id</span>=21;</span><br><span class="line">delete from student3 <span class="built_in">where</span> <span class="built_in">id</span>=18;</span><br><span class="line"></span><br><span class="line">mysql&gt; delete from student3 <span class="built_in">where</span> name <span class="keyword">in</span> (<span class="string">&#x27;abz&#x27;</span>,<span class="string">&#x27;abe&#x27;</span>);</span><br><span class="line">mysql&gt; delete from student3 <span class="built_in">where</span> <span class="built_in">where</span> name=<span class="string">&#x27;abz&#x27;</span> or name=<span class="string">&#x27;abe&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#改</span></span><br><span class="line">update</span><br><span class="line">mysql&gt; update 库.表 <span class="built_in">set</span> 被修改的字段=被修改的值 <span class="built_in">where</span> 条件;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 注意：只有在修改mysql.user表中的用户信息时，才需要执行flush privileges;</span></span><br><span class="line"></span><br><span class="line">mysql&gt; update student3 <span class="built_in">set</span> name=<span class="string">&#x27;zls&#x27;</span> <span class="built_in">where</span> <span class="built_in">id</span>=17;</span><br><span class="line">mysql&gt; update student3 <span class="built_in">set</span> name=<span class="string">&#x27;tls&#x27;</span> <span class="built_in">where</span> 1=1;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查（DQL）</span></span><br><span class="line"><span class="keyword">select</span></span><br></pre></td></tr></table></figure><p>如何使用update代替delete作伪删除</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.给表中添加状态列（添加一个字段）</span></span><br><span class="line">mysql&gt; alter table student3 add status enum(<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>) not null default <span class="string">&#x27;1&#x27;</span> comment <span class="string">&#x27;物品状态&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.使用update删除数据（变更状态信息）</span></span><br><span class="line">mysql&gt; update student3 <span class="built_in">set</span> status=<span class="string">&#x27;0&#x27;</span> <span class="built_in">where</span> <span class="built_in">id</span>=31;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.查询数据时，接状态条件进行查询</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from student3 <span class="built_in">where</span> status=<span class="string">&#x27;1&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="DCL"><a href="#DCL" class="headerlink" title="DCL"></a>DCL</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">DCL:数据控制语言</span><br><span class="line">针对用户权限的控制</span><br><span class="line"></span><br><span class="line"><span class="comment">## 授权</span></span><br><span class="line">grant</span><br><span class="line">mysql&gt; grant all on *.* to wp@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all on *.* to wp@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span> with grant option;</span><br><span class="line"><span class="comment">#查看用户权限</span></span><br><span class="line">show grants <span class="keyword">for</span> root@<span class="string">&#x27;location&#x27;</span>;</span><br><span class="line">show grants <span class="keyword">for</span> wp@<span class="string">&#x27;%&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 安全限制</span></span><br><span class="line"><span class="comment"># max_queries_per_hour：一个用户每小时可发出的查询数量</span></span><br><span class="line">mysql&gt; grant all on *.* to test_grant2@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123@qqdianCOM&#x27;</span> with max_queries_per_hour 2;</span><br><span class="line"><span class="comment"># max_updates_per_hour：一个用户每小时可发出的更新数量</span></span><br><span class="line">grant all on *.* to test_grant3@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123@qqdianCOM&#x27;</span></span><br><span class="line">with max_queries_per_hour 2 max_updates_per_hour 1;</span><br><span class="line"></span><br><span class="line">grant all on *.* to test_grant4@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123@qqdianCOM&#x27;</span></span><br><span class="line">with max_queries_per_hour 3 max_updates_per_hour 1;</span><br><span class="line"></span><br><span class="line"><span class="comment"># max_connections_per_hour：一个用户每小时可连接到服务器的次数</span></span><br><span class="line">grant all on *.* to test_grant5@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123@qqdianCOM&#x27;</span></span><br><span class="line">with max_queries_per_hour 3 max_updates_per_hour 1</span><br><span class="line">max_connections_per_hour 1;</span><br><span class="line"></span><br><span class="line"><span class="comment"># max_user_connections：允许同时连接数量</span></span><br><span class="line">grant all on *.* to test_grant6@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123@qqdianCOM&#x27;</span></span><br><span class="line">with max_user_connections 2;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 回收权限</span></span><br><span class="line">revoke</span><br><span class="line"></span><br><span class="line">mysql&gt; revoke <span class="keyword">select</span> on *.* from wp@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">show grants <span class="keyword">for</span> wp@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#给开发开权限</span></span><br><span class="line">grant <span class="keyword">select</span>,insert,update,delete on *.* to dev@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#收回delete权限</span></span><br><span class="line">revoke delete on *.* from dev@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="DQL"><a href="#DQL" class="headerlink" title="DQL"></a>DQL</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 针对库的DQL</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有数据库</span></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看数据库的属性</span></span><br><span class="line">mysql&gt; show create database test_db;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前所在数据库</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> database();</span><br><span class="line"></span><br><span class="line"><span class="comment">## 针对表的DQL</span></span><br><span class="line"><span class="comment"># 查看当前库中的所有表 ls -l</span></span><br><span class="line">mysql&gt; show tables;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定库中的所有表 ls -l /opt</span></span><br><span class="line">mysql&gt; show tables from test_db;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看表结构</span></span><br><span class="line">mysql&gt; desc student;</span><br><span class="line">mysql&gt; desc test_db.student;</span><br><span class="line">+--------+---------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type | Null | Key | Default | Extra |</span><br><span class="line">+--------+---------------+------+-----+---------+-------+</span><br><span class="line">| <span class="built_in">id</span> | int(11) | YES | | NULL | |</span><br><span class="line">| name | varchar(10) | YES | | NULL | |</span><br><span class="line">| age | tinyint(4) | YES | | NULL | |</span><br><span class="line">| gender | enum(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>) | YES | | NULL | |</span><br><span class="line">| phone | char(11) | YES | | NULL | |</span><br><span class="line">| doa | datetime | YES | | NULL | |</span><br><span class="line">+--------+---------------+------+-----+---------+-------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建表语句</span></span><br><span class="line">mysql&gt; show create table student;</span><br><span class="line"></span><br><span class="line">student | CREATE TABLE `student` (</span><br><span class="line">`<span class="built_in">id</span>` int(11) DEFAULT NULL,</span><br><span class="line">`name` varchar(10) DEFAULT NULL,</span><br><span class="line">`age` tinyint(4) DEFAULT NULL,</span><br><span class="line">`gender` enum(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>) DEFAULT NULL,</span><br><span class="line">`phone` char(11) DEFAULT NULL,</span><br><span class="line">`doa` datetime DEFAULT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=latin1</span><br><span class="line"></span><br><span class="line"><span class="comment">## 基础查询</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 危险</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from test_db.student3;</span><br><span class="line"></span><br><span class="line">mysql&gt; show tables from world;</span><br><span class="line">+-----------------+</span><br><span class="line">| Tables_in_world |</span><br><span class="line">+-----------------+</span><br><span class="line">| city |                 <span class="comment"># 城市表</span></span><br><span class="line">| country |              <span class="comment"># 国家表</span></span><br><span class="line">| countrylanguage |      <span class="comment"># 国家语言表</span></span><br><span class="line">+-----------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; desc world.city;</span><br><span class="line">+-------------+----------+------+-----+---------+----------------+</span><br><span class="line">| Field | Type | Null | Key | Default | Extra |</span><br><span class="line">+-------------+----------+------+-----+---------+----------------+</span><br><span class="line">| ID | int(11) | NO | PRI | NULL | auto_increment |</span><br><span class="line"><span class="comment"># 序号</span></span><br><span class="line">| Name | char(35) | NO | | | |</span><br><span class="line"><span class="comment"># 城市名</span></span><br><span class="line">| CountryCode | char(3) | NO | MUL | | |</span><br><span class="line"><span class="comment"># 国家代码</span></span><br><span class="line">| District | char(20) | NO | | | |</span><br><span class="line"><span class="comment"># 省</span></span><br><span class="line">| Population | int(11) | NO | | 0 | |</span><br><span class="line"><span class="comment"># 人口数量</span></span><br><span class="line">+-------------+----------+------+-----+---------+----------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查询所有数据</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from world.city;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 单条件查询</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from world.city <span class="built_in">where</span> countrycode=<span class="string">&#x27;CHN&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 多条件查询</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from world.city <span class="built_in">where</span> countrycode=<span class="string">&#x27;CHN&#x27;</span> or</span><br><span class="line">countrycode=<span class="string">&#x27;USA&#x27;</span>;</span><br><span class="line"><span class="comment">### 国家代码是CHN的并且省市heillongjiang的城市名有哪些？</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> name from world.city <span class="built_in">where</span> countrycode=<span class="string">&#x27;CHN&#x27;</span> and</span><br><span class="line">district=<span class="string">&#x27;heilongjiang&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 范围查询 &lt; 、&gt; 、&lt;= 、&gt;= 、 &lt;&gt; 、!=</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from world.city <span class="built_in">where</span> <span class="built_in">id</span> &gt; 10 and <span class="built_in">id</span> &lt; 30;</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from world.city <span class="built_in">where</span> population &lt; 1000;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 模糊查询 like</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from world.city <span class="built_in">where</span> countrycode like <span class="string">&#x27;%B%&#x27;</span>;</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from world.city <span class="built_in">where</span> countrycode like <span class="string">&#x27;%B&#x27;</span>;</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from world.city <span class="built_in">where</span> countrycode like <span class="string">&#x27;B%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 分页查询 limit</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from world.city <span class="built_in">limit</span> 0,65;</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from world.city <span class="built_in">limit</span> 65,65;</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from world.city <span class="built_in">limit</span> 130,65;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 统计一张表有多少条数据</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> count(*) from world.city;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 排序查询 order by</span></span><br><span class="line"><span class="comment"># 顺序</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from world.city order by population;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 倒序</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from world.city order by population desc;</span><br><span class="line"><span class="comment">#添加别名</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="built_in">id</span> as <span class="string">&#x27;序号&#x27;</span>,name as <span class="string">&#x27;城市名&#x27;</span>,countrycode as <span class="string">&#x27;国家代</span></span><br><span class="line"><span class="string">码&#x27;</span>,district as <span class="string">&#x27;省&#x27;</span>,population as <span class="string">&#x27;人口数量&#x27;</span> from world.city order</span><br><span class="line">by population desc <span class="built_in">limit</span> 10;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 分组查询 group by</span></span><br><span class="line"><span class="comment"># 使用过的函数</span></span><br><span class="line">password()</span><br><span class="line">now()</span><br><span class="line">database()</span><br><span class="line"></span><br><span class="line"><span class="comment"># MySQL中常用的聚合函数</span></span><br><span class="line">max() <span class="comment"># 求最大值函数</span></span><br><span class="line">min() <span class="comment"># 求最小值函数</span></span><br><span class="line">avg() <span class="comment"># 求平均值函数</span></span><br><span class="line"><span class="built_in">sum</span>() <span class="comment"># 求和函数</span></span><br><span class="line">count() <span class="comment"># 统计函数</span></span><br><span class="line"></span><br><span class="line">1.遇到统计想函数</span><br><span class="line">2.形容词前groupby</span><br><span class="line">3.函数中央是名词</span><br><span class="line">4.列名<span class="keyword">select</span>后添加</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计世界上每个国家的总人口数</span></span><br><span class="line">1.<span class="built_in">sum</span>()</span><br><span class="line">2.group by contrycode</span><br><span class="line">3.<span class="built_in">sum</span>(population)</span><br><span class="line">4.<span class="keyword">select</span> 国家代码 总人口数量</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> countrycode,<span class="built_in">sum</span>(population) from world.city group by</span><br><span class="line">countrycode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> countrycode,<span class="built_in">sum</span>(population) from world.city group by</span><br><span class="line">countrycode order by <span class="built_in">sum</span>(population);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计中国各个省的人口数量(练习)</span></span><br><span class="line">1.<span class="built_in">sum</span>()</span><br><span class="line">2.group by district</span><br><span class="line">3.<span class="built_in">sum</span>(population)</span><br><span class="line">4.<span class="keyword">select</span> 国家代码 省 总人口数量</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> countrycode,district,<span class="built_in">sum</span>(population)</span><br><span class="line">from world.city</span><br><span class="line"><span class="built_in">where</span> countrycode=<span class="string">&#x27;CHN&#x27;</span></span><br><span class="line">group by district;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计每个国家的城市数量(练习)</span></span><br><span class="line">1.count()</span><br><span class="line">2.group by countrycode</span><br><span class="line">3.count(name)</span><br><span class="line">4.<span class="keyword">select</span> 国家代码 城市数量</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> countrycode,count(name) from world.city group by</span><br><span class="line">countrycode;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计中国每个省的城市数量（练习）</span></span><br><span class="line">1.count()</span><br><span class="line">2.group by district</span><br><span class="line">3.count(name)</span><br><span class="line">4.<span class="keyword">select</span> 国家代码 省 城市数量</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> countrycode,district,count(name) from world.city <span class="built_in">where</span></span><br><span class="line">countrycode=<span class="string">&#x27;CHN&#x27;</span> group by district order by count(name);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Mysql数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql用户权限及配置管理(5)</title>
      <link href="/2022/10/17/MySQL/Day05MySQL%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E5%8F%8A%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%862/"/>
      <url>/2022/10/17/MySQL/Day05MySQL%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E5%8F%8A%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%862/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="MySQL用户权限及配置管理2"><a href="#MySQL用户权限及配置管理2" class="headerlink" title="MySQL用户权限及配置管理2"></a>MySQL用户权限及配置管理2</h1><h2 id="MySQl的连接"><a href="#MySQl的连接" class="headerlink" title="MySQl的连接"></a>MySQl的连接</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-u：指定用户</span><br><span class="line">-p：指定密码</span><br><span class="line">-S：指定socket</span><br><span class="line">-h：指定主机域</span><br><span class="line">-e：免交互执行SQL语句</span><br><span class="line">-P：指定端口</span><br><span class="line"></span><br><span class="line">--protocol=[协议名]// TCP/IP、Socket</span><br><span class="line"></span><br><span class="line"><span class="comment">#举例</span></span><br><span class="line">mysql -uroot -p123 -e <span class="string">&#x27;show databases;&#x27;</span></span><br><span class="line">mysql -uroot -p123 -h10.0.0.53</span><br><span class="line">mysql -uroot -p123 -h10.0.0.53 -P3307</span><br><span class="line"><span class="comment">#socket连接</span></span><br><span class="line">mysql -uroot -p123 -s/app/mysql/tmp/mysql.sock</span><br><span class="line"><span class="comment">#TCP/IP连接</span></span><br><span class="line">mysql -uroot -p123 -h10.0.0.53 -p3306</span><br></pre></td></tr></table></figure><h2 id="MySQL启动关闭流程"><a href="#MySQL启动关闭流程" class="headerlink" title="MySQL启动关闭流程"></a>MySQL启动关闭流程</h2><p>CentOS6</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133451744.png" alt="image-20230517133451744"></p><p>CentOS7</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133504777.png" alt="image-20230517133504777"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 启动</span></span><br><span class="line">C6、C7：</span><br><span class="line">/etc/init.d/mysqld start</span><br><span class="line">service mysqld start</span><br><span class="line"></span><br><span class="line">C7:</span><br><span class="line">systemctl start mysqld</span><br><span class="line"></span><br><span class="line">/app/mysql/bin/mysqld --defaults-file=/etc/my.cnf --user=mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">## 停止</span></span><br><span class="line">C6、C7：</span><br><span class="line">/etc/init.d/mysqld stop</span><br><span class="line">service mysqld stop</span><br><span class="line"></span><br><span class="line">C7:</span><br><span class="line">systemctl stop mysqld</span><br><span class="line">mysqladmin -uroot -p123 shutdown</span><br><span class="line"></span><br><span class="line"><span class="comment">#危险强杀</span></span><br><span class="line"><span class="built_in">kill</span> -9 PID</span><br><span class="line">killall mysqld</span><br><span class="line">pkill mysqld</span><br></pre></td></tr></table></figure><h2 id="MySQL实例初始化配置"><a href="#MySQL实例初始化配置" class="headerlink" title="MySQL实例初始化配置"></a>MySQL实例初始化配置</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133517023.png" alt="image-20230517133517023"></p><ul><li>预编译</li><li>配置文件（读取顺序）<br>- &#x2F;etc&#x2F;my.cnf                       server_id&#x3D;1<br>- &#x2F;etc&#x2F;mysql&#x2F;my.cnf                     server_id&#x3D;2<br>- &#x2F;$BASEDIR&#x2F;my.cnf                   server_id&#x3D;3</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/app/mysql-5.6.50</span><br></pre></td></tr></table></figure><ul><li><p>defaults-extra-file&#x3D;&#x2F;tmp&#x2F;my.cnf       server_id&#x3D;5</p></li><li><p>~&#x2F;.my.cnf                                         server_id&#x3D;4</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p123 -e <span class="string">&#x27;show variables like &quot;server_id&quot;&#x27;</span></span><br></pre></td></tr></table></figure><p>注意：当MySQL启动时指定了该参数 –defaults-file&#x3D;&#x2F;etc&#x2F;my.cnf<br>MySQL配置文件，当出现相同配置时，最后读取的则覆盖，不同配置则叠加</p><ul><li>命令行</li></ul><h2 id="MySQL配置文件"><a href="#MySQL配置文件" class="headerlink" title="MySQL配置文件"></a>MySQL配置文件</h2><p>作用:</p><ul><li>影响服务端的启动</li><li>影响客户端的连接</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置socket文件写完之后重启连接myqsl</span></span><br><span class="line">[mysqld]    //影响服务端的启动    [server]</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">/etc/init.d/mysqld restart</span><br><span class="line">mysql -uroot -p123 -S /tmp/mysql.sock</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置文件这么写直接可以mysql连接，不冲突</span></span><br><span class="line">[mysql]     //影响客户端的连接    [client]</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">user=root</span><br><span class="line">password=789</span><br><span class="line"></span><br><span class="line"><span class="comment">#直接这样写,所有客户端命令直接可以用</span></span><br><span class="line">[mysqld]</span><br><span class="line">skip_name_resolve</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">user=root</span><br><span class="line">password=123</span><br></pre></td></tr></table></figure><h2 id="MySQL多实例"><a href="#MySQL多实例" class="headerlink" title="MySQL多实例"></a>MySQL多实例</h2><p>实例：一个进程 + 多个线程 + 预分配的内存结构</p><p>多实例：多个进程 + 多个线程 + 多个预分配的内存结构</p><h3 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">多个data目录(datadir)</span><br><span class="line"></span><br><span class="line">多个配置文件</span><br><span class="line">- 多个端口</span><br><span class="line">- 多个socket文件</span><br><span class="line">- 多个日志文件</span><br><span class="line">- 多个PID文件</span><br><span class="line">PId：记入进程号</span><br><span class="line"><span class="comment">#大部分pid存放位置，pid可以停止运行的服务</span></span><br><span class="line">ll /var/run</span><br><span class="line"><span class="built_in">cat</span> /var/run/sshd.pid</span><br><span class="line"><span class="built_in">kill</span> -3 <span class="string">&#x27;cat /var/run/sshd.pid&#x27;</span></span><br><span class="line"><span class="comment">#查找特殊mysql的pid</span></span><br><span class="line">mysqladmin -uroot -p123 variables|grep pid</span><br></pre></td></tr></table></figure><h3 id="多实例部署"><a href="#多实例部署" class="headerlink" title="多实例部署"></a>多实例部署</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###查看mysql默认的配置</span></span><br><span class="line">mysqladmin -uroot -p123 variables</span><br><span class="line">mysqladmin -uroot -p123 variables|grep socket</span><br><span class="line"></span><br><span class="line"><span class="comment">####多实例部署</span></span><br><span class="line"><span class="comment"># 1.创建多个datadir</span></span><br><span class="line">root@db02,172.16.1.52:~ <span class="comment"># mkdir /data/330&#123;7,8,9&#125; -p</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.准备多个配置文件</span></span><br><span class="line">root@db02,172.16.1.52:~ <span class="comment"># vim /data/3307/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">port=3307                        //端口</span><br><span class="line">basedir=/app/mysql               //程序目录</span><br><span class="line">datadir=/data/3307/data          //数据目录</span><br><span class="line">socket=/data/3307/mysql.sock     //socket文件</span><br><span class="line">pid_file=/data/3307/mysql.pid    //PID</span><br><span class="line">log_error=/data/3307/mysql.log   //日志目录</span><br><span class="line"></span><br><span class="line">root@db02,172.16.1.52:~ <span class="comment"># vim /data/3308/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">port=3308</span><br><span class="line">basedir=/app/mysql</span><br><span class="line">datadir=/data/3308/data</span><br><span class="line">socket=/data/3308/mysql.sock</span><br><span class="line">pid_file=/data/3308/mysql.pid</span><br><span class="line">log_error=/data/3308/mysql.log</span><br><span class="line"></span><br><span class="line">root@db02,172.16.1.52:~ <span class="comment"># vim /data/3309/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">port=3309</span><br><span class="line">basedir=/app/mysql</span><br><span class="line">datadir=/data/3309/data</span><br><span class="line">socket=/data/3309/mysql.sock</span><br><span class="line">pid_file=/data/3309/mysql.pid</span><br><span class="line">log_error=/data/3309/mysql.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.初始化</span></span><br><span class="line"><span class="built_in">cd</span> /app/mysql/scripts/</span><br><span class="line"></span><br><span class="line">./mysql_install_db --defaults-file=/data/3307/my.cnf --basedir=/app/mysql --datadir=/data/3307/data</span><br><span class="line"></span><br><span class="line">./mysql_install_db --defaults-file=/data/3308/my.cnf --basedir=/app/mysql --datadir=/data/3308/data</span><br><span class="line"></span><br><span class="line">./mysql_install_db --defaults-file=/data/3309/my.cnf --basedir=/app/mysql --datadir=/data/3309/data</span><br><span class="line"></span><br><span class="line">ll /data/3307/</span><br><span class="line">drwx------ 5 root root 110 Apr 3 10:40 data</span><br><span class="line">-rw-r--r-- 1 root root 152 Apr 3 10:32 my.cnf</span><br><span class="line">-rw-rw---- 1 root root 4023 Apr 3 10:40 mysql.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.授权</span></span><br><span class="line">root@db02,172.16.1.52:/app/mysql/scripts <span class="comment"># chown -R mysql.mysql/data/330*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.启动多实例.配置systemctld管理</span></span><br><span class="line">vim /usr/lib/systemd/system/mysql3307.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=MySQL Server</span><br><span class="line">After=network.target,syslog.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/app/mysql/bin/mysqld --defaults-file=/data/3307/my.cnf --user=mysql</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start mysql3307</span><br><span class="line">netstat -lntup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.多实例设置密码</span></span><br><span class="line">mysqladmin -uroot -p -S /data/3307/mysql.sock password <span class="string">&#x27;123&#x27;</span></span><br><span class="line">mysqladmin -uroot -p -S /data/3308/mysql.sock password <span class="string">&#x27;123&#x27;</span></span><br><span class="line">mysqladmin -uroot -p -S /data/3309/mysql.sock password <span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.连接多实例</span></span><br><span class="line">mysql -uroot -p123 -S /data/3307/mysql.sock</span><br><span class="line">mysql -uroot -p123 -S /data/3308/mysql.sock</span><br><span class="line">mysql -uroot -p123 -S /data/3309/mysql.sock</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.连接数据库多实例小技巧</span></span><br><span class="line">vim /usr/local/bin/mysql3307</span><br><span class="line">mysql -uroot -p123 -S /data/3307/mysql.sock</span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/mysql3307</span><br><span class="line"></span><br><span class="line">vim /usr/local/bin/mysql3308</span><br><span class="line">mysql -uroot -p123 -S /data/3308/mysql.sock</span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/mysql3308</span><br><span class="line"></span><br><span class="line">vim /usr/local/bin/mysql3309</span><br><span class="line">mysql -uroot -p123 -S /data/3309/mysql.sock</span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/mysql3309</span><br><span class="line"><span class="comment">#连接</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">mysql3307</span><br><span class="line">mysql3308</span><br><span class="line">mysql3309</span><br><span class="line"></span><br><span class="line"><span class="comment">#9.停止多实例</span></span><br><span class="line"><span class="comment">##没有systemctld脚本时只能这样停止mysql</span></span><br><span class="line">mysqladmin -uroot -p123 -S /data/3307/mysql.sock shutdown</span><br><span class="line"><span class="comment">#用systemctld管理停止mysql</span></span><br><span class="line">systemctl stop mysql3307</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Mysql数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQl索引管理及执行计划(8)</title>
      <link href="/2022/10/17/MySQL/Day08MySQL%E7%B4%A2%E5%BC%95%E7%AE%A1%E7%90%86%E5%8F%8A%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92/"/>
      <url>/2022/10/17/MySQL/Day08MySQL%E7%B4%A2%E5%BC%95%E7%AE%A1%E7%90%86%E5%8F%8A%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="MySQl索引管理及执行计划"><a href="#MySQl索引管理及执行计划" class="headerlink" title="MySQl索引管理及执行计划"></a>MySQl索引管理及执行计划</h1><h2 id="索引介绍"><a href="#索引介绍" class="headerlink" title="索引介绍"></a>索引介绍</h2><p>什么是索引</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133611953.png" alt="image-20230517133611953"></p><p>1.索引就好比一本书的目录，他能让你更快的找到自己想要的内容。</p><p>2.让获取的数据更有目的性，从而提高数据库检索数据的性能。</p><h2 id="索引类型"><a href="#索引类型" class="headerlink" title="索引类型"></a>索引类型</h2><p><strong>索引的算法类型</strong></p><ul><li><p>BTree索引（Innodb存储引擎）</p><ul><li>Btree</li><li>B+tree  （ 现在MySQl用的算法）</li><li>B*tree</li></ul></li><li><p>HASH索引</p></li><li><p>FULLTEXT索引</p></li><li><p>RTree索引</p></li></ul><p>Btree算法</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133624405.png" alt="image-20230517133624405"></p><p>三路Btree</p><p>只要使用到该算法，则证明该字段被创建索引了</p><ul><li>根节点</li><li>枝节点</li><li>叶子节点</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * from tb1 <span class="built_in">where</span> <span class="built_in">id</span>=30; // 精确查询，产生3次IO</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * from tb1 <span class="built_in">where</span> <span class="built_in">id</span>&gt;15 and <span class="built_in">id</span>&lt;30; // 范围查询，产生9次IO</span><br></pre></td></tr></table></figure><p>B+tree算法</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133640765.png" alt="image-20230517133640765"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * from tb1 <span class="built_in">where</span> <span class="built_in">id</span>=30; // 精确查询，产生3次IO</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * from tb1 <span class="built_in">where</span> <span class="built_in">id</span>&gt;15 and <span class="built_in">id</span>&lt;30; // 同样的范围查询，产生5次IO</span><br></pre></td></tr></table></figure><p>总结:</p><p>1.在叶子节点上，添加了相邻节点的指针</p><p>2.优化了范围查询</p><p>B*tree算法</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133654669.png" alt="image-20230517133654669"></p><h2 id="索引管理"><a href="#索引管理" class="headerlink" title="索引管理"></a>索引管理</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133709649.png" alt="image-20230517133709649"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#key</span></span><br><span class="line">MUL 普通索引</span><br><span class="line">UNI 唯一键索引</span><br><span class="line">PRI 主键索引</span><br><span class="line"></span><br><span class="line">主键索引(PRIMARY KEY)</span><br><span class="line">建立在主键上的索引被称为主键索引，一张数据表只能有一个主键索引，索引列值不允许有空值，通常在创建表时一起创建。</span><br><span class="line"></span><br><span class="line">唯一索引(UNIQUE)</span><br><span class="line">建立在UNIQUE字段上的索引被称为唯一索引，一张表可以有多个唯一索引，索引列值允许为空，列值中出现多个空值不会发生重复冲突。</span><br><span class="line"></span><br><span class="line">普通索引(INDEX)</span><br><span class="line">建立在普通字段上的索引被称为普通索引。</span><br><span class="line"></span><br><span class="line"><span class="comment">#主键的索引效率最高，一张表只能有一个主键，其次效率高的是唯一键索引。最后是普通索引</span></span><br></pre></td></tr></table></figure><h3 id="索引的增删查"><a href="#索引的增删查" class="headerlink" title="索引的增删查"></a>索引的增删查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 增 mysql&gt; alter table city add 字段名 数据类型 属性; 添加字段</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建普通索引</span></span><br><span class="line">mysql&gt; alter table city add index 索引名(字段名);</span><br><span class="line">mysql&gt; alter table city add index idx_population(population);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建主键索引</span></span><br><span class="line">mysql&gt; alter table student add primary key(<span class="built_in">id</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建唯一键索引（如何判断，该列能否创建唯一键索引）</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> count(doa) from student3;</span><br><span class="line">+------------+</span><br><span class="line">| count(doa) |</span><br><span class="line">+------------+</span><br><span class="line">| 7 |</span><br><span class="line">+------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> count(distinct(doa)) from student3;</span><br><span class="line">+----------------------+</span><br><span class="line">| count(distinct(doa)) |</span><br><span class="line">+----------------------+</span><br><span class="line">| 5 |</span><br><span class="line">+----------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; alter table student3 add unique key 索引名(字段名);</span><br><span class="line">mysql&gt; alter table student3 add unique key uni_doa(doa);</span><br><span class="line"></span><br><span class="line"><span class="comment">## 删</span></span><br><span class="line"><span class="comment"># 删除普通索引和唯一键索引</span></span><br><span class="line">mysql&gt; alter table student3 drop index uni_doa;</span><br><span class="line">mysql&gt; alter table student3 drop index 索引名;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除主键索引</span></span><br><span class="line">mysql&gt; alter table student drop primary key;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查</span></span><br><span class="line">mysql&gt; desc student3;</span><br><span class="line"></span><br><span class="line">mysql&gt; show index from student3;</span><br></pre></td></tr></table></figure><h4 id="前缀索引"><a href="#前缀索引" class="headerlink" title="前缀索引"></a>前缀索引</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">id</span> text       <span class="built_in">date</span> xxx aaa bbb</span><br><span class="line">1 Shallabcxc</span><br><span class="line">2 Shxllasdasd</span><br><span class="line">3 xxxxxxzxczxc</span><br><span class="line"></span><br><span class="line">作用：给内容比较多或比较长的字段创建索引，提升创建索引的排序效率</span><br><span class="line"></span><br><span class="line"><span class="comment">## 普通索引创建前缀索引</span></span><br><span class="line">mysql&gt; alter table student4 add index idx_name(name(3));</span><br><span class="line"></span><br><span class="line"><span class="comment">## 唯一键索引创建前缀索引</span></span><br><span class="line">mysql&gt; alter table student4 add unique key uni_name(name(2));</span><br></pre></td></tr></table></figure><h4 id="联合索引"><a href="#联合索引" class="headerlink" title="联合索引"></a>联合索引</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#原则: 把最常用的来作为条件查询的列放在最前面</span></span><br><span class="line"><span class="comment">#创建一张表</span></span><br><span class="line">create table people (<span class="built_in">id</span> int,name varchar(20),age tinyint,money int,gender enum(<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;f&#x27;</span>));</span><br><span class="line"><span class="comment">#查看people这张表的字段</span></span><br><span class="line">desc people;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建普通索引的联合索引</span></span><br><span class="line">mysql&gt; alter table people add index idx_all(gender,age,money);</span><br><span class="line"></span><br><span class="line">mysql&gt; desc people;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建主键联合索引</span></span><br><span class="line">mysql&gt; alter table people add primary key(<span class="built_in">id</span>,name);</span><br><span class="line"></span><br><span class="line"><span class="comment">## 唯一键联合索引</span></span><br><span class="line">mysql&gt; alter table people add unique key uni_all(gender,age,money);</span><br><span class="line"></span><br><span class="line"><span class="comment">## 注意：联合索引在查询时，也必须按照创建索引的顺序进行查询，否则，不走索引</span></span><br><span class="line"></span><br><span class="line">gender,age,money</span><br><span class="line">a b c</span><br><span class="line"></span><br><span class="line"><span class="built_in">where</span> a= b= c=</span><br><span class="line"><span class="built_in">where</span> a= b=</span><br><span class="line"><span class="built_in">where</span> a= c=</span><br><span class="line"><span class="built_in">where</span> b= c=</span><br><span class="line"><span class="built_in">where</span> b= a= c=</span><br></pre></td></tr></table></figure><h2 id="索引的建立原则和规范"><a href="#索引的建立原则和规范" class="headerlink" title="索引的建立原则和规范"></a>索引的建立原则和规范</h2><ul><li><p>优先选择唯一键索引</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> count(字段名) from 表;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> count(distinct(字段名)) from 表;</span><br><span class="line"></span><br><span class="line"><span class="comment">#唯一性索引的值是唯一的,可以更快的通过该索引来确定某条记录。</span></span><br></pre></td></tr></table></figure></li><li><p>重复值较多的情况下，优先选择使用联合索引</p><ul><li>为经常需要排序、分组和联合操作的字段建立索引</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">经常需要ORDER BY、GROUP BY、DISTINCT和UNION等操作的字段，排序操作会浪费很多时间。</span><br><span class="line">如果为其建立索引，可以有效地避免排序操作</span><br></pre></td></tr></table></figure><pre><code>        - 经常查询</code></pre><ul><li><p>列值的重复值少</p></li><li><p>尽量使用前缀索引(在唯一键或联合索引基础之上创建前缀)</p></li></ul><p><strong>注意</strong></p><p>1.一定要限制索引的数目</p><p>索引的数目不是越多越好。每个索引都需要占用磁盘空间，索引越多需要的磁盘空间就越大。</p><p>修改表时，对索引的重构和更新很麻烦。越多的索引，会使更新表变得很浪费时间。</p><p>2.删除不在使用或者很少使用的索引</p><p>表中的数据被大量更新，或者数据的使用方式被改变后，原有的一些索引可能不在需要。数据库管理员应当定期找出这些索引，将他们删除，从而减少索引对更新操作的影响。</p><p>企业问题：<br>我们网站响应速度很慢？如何排查？如何处理？<br>1）网站的服务器，负载高</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">stress是Linux系统压力测试工具，这里我们用作异常进程模拟平均负载升高的场景。</span><br><span class="line"></span><br><span class="line">mpstat是多核CPU性能分析工具，用来实时检查每个CPU的性能指标，以及所有CPU的平均</span><br><span class="line">指标。</span><br><span class="line">pidstat是一个常用的进程性能分析工具，用来实时查看进程的CPU，内存，IO，以及上下</span><br><span class="line">文切换等性能指标。</span><br><span class="line"></span><br><span class="line">查找出哪个进程占用CPU 内存 磁盘比较多，就看对应进程的日志</span><br></pre></td></tr></table></figure><p>2）代码逻辑问题，代码有bug</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看程序日志</span><br><span class="line">日志内容交给开发</span><br></pre></td></tr></table></figure><p>3）网络带宽、网络波动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">升级带宽</span><br><span class="line"></span><br><span class="line">指定地区放一台服务器，打通内网，做缓存(CDN)</span><br></pre></td></tr></table></figure><p>4）缓存失效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">错峰设置缓存失效周期</span><br></pre></td></tr></table></figure><p>5）数据库查询速度慢（慢查询）</p><p>1.找出哪一条SQL语句执行的慢（开启慢查询日志）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="comment">#指定是否开启慢查询日志</span></span><br><span class="line">slow_query_log = 1     |ON 0|OFF</span><br><span class="line"><span class="comment">#指定慢日志文件存放位置（默认在data）</span></span><br><span class="line">slow_query_log_file=/application/mysql/data/slow.log</span><br><span class="line"><span class="comment">#设定慢查询的阀值(默认10s)</span></span><br><span class="line">long_query_time=0.05</span><br><span class="line"><span class="comment">#不使用索引的慢查询是否记录到日志</span></span><br><span class="line">log_queries_not_using_indexes</span><br><span class="line"><span class="comment">#查询检查返回少于该参数指定行的SQL不被记录到慢查询日志</span></span><br><span class="line">min_examined_row_limit=100（鸡肋）</span><br><span class="line"></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">slow_query_log = 1</span><br><span class="line">slow_query_log_file=/application/mysql/data/slow.log</span><br><span class="line">long_query_time=0.05</span><br><span class="line">log_queries_not_using_indexes</span><br><span class="line"></span><br><span class="line">systemctl restart mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看sql语句的后台进程</span></span><br><span class="line">show processlist;</span><br><span class="line"><span class="comment">#可以杀掉卡住的sql语句</span></span><br><span class="line"><span class="built_in">kill</span> 2</span><br></pre></td></tr></table></figure><p>2.分析SQL语句为什么慢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看慢查询日志</span></span><br><span class="line"><span class="built_in">cat</span> /ver/lib/mysql/da01-slow.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># Time: 2023-04-11T01:03:33.279720Z</span></span><br><span class="line"><span class="comment"># User@Host: root[root] @ localhost [] Id: 9</span></span><br><span class="line"><span class="comment"># Query_time: 17.607624 Lock_time: 0.000351 Rows_sent: 4096</span></span><br><span class="line">Rows_examined: 16707584</span><br><span class="line"><span class="comment"># SET timestamp=1681175013;</span></span><br><span class="line"><span class="keyword">select</span> * from city2 <span class="built_in">where</span> population&lt;100;</span><br><span class="line"></span><br><span class="line"><span class="comment">#分析sql语句</span></span><br><span class="line">mysql&gt; desc <span class="keyword">select</span> * from city2 <span class="built_in">where</span> population&lt;100;</span><br><span class="line">+----+-------------+-------+------------+------+---------------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | partitions | <span class="built_in">type</span> | possible_keys |</span><br><span class="line">+----+-------------+-------+------------+------+---------------+</span><br><span class="line">| 1 | SIMPLE | city2 | NULL | ALL | NULL |</span><br><span class="line">+----+-------------+-------+------------+------+---------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city2 <span class="built_in">where</span> population&lt;100;</span><br><span class="line">+----+-------------+-------+------------+------+---------------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | partitions | <span class="built_in">type</span> | possible_keys |</span><br><span class="line">+----+-------------+-------+------------+------+---------------+</span><br><span class="line">| 1 | SIMPLE | city2 | NULL | ALL | NULL |</span><br><span class="line">+----+-------------+-------+------------+------+---------------+</span><br></pre></td></tr></table></figure><p>1)全表扫描  type：ALL<br>2)该字段没有创建索引<br>3)有索引但是没走索引</p><h2 id="SQL语句执行效率级别"><a href="#SQL语句执行效率级别" class="headerlink" title="SQL语句执行效率级别"></a>SQL语句执行效率级别</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">0)ALL:如果有索引那就是没走索引，全表扫描</span><br><span class="line"></span><br><span class="line">1）index    // 全索引扫描</span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> population from city;</span><br><span class="line">+----+-------------+-------+------------+-------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | partitions | <span class="built_in">type</span> |</span><br><span class="line">+----+-------------+-------+------------+-------+</span><br><span class="line">| 1 | SIMPLE | city | NULL | index |</span><br><span class="line">+----+-------------+-------+------------+-------+</span><br><span class="line"></span><br><span class="line">2）range     // 通常我们认为只要一条SQL语句能达到range级别</span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> population&lt;1000;</span><br><span class="line">+----+-------------+-------+------------+-------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | partitions | <span class="built_in">type</span> |</span><br><span class="line">+----+-------------+-------+------------+-------+</span><br><span class="line">| 1 | SIMPLE | city | NULL | range |</span><br><span class="line">+----+-------------+-------+------------+-------+</span><br><span class="line"></span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode <span class="keyword">in</span> (<span class="string">&#x27;CHN&#x27;</span>,<span class="string">&#x27;USA&#x27;</span>);</span><br><span class="line"></span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode=<span class="string">&#x27;CHN&#x27;</span> or countrycode=<span class="string">&#x27;USA&#x27;</span>;</span><br><span class="line"></span><br><span class="line">3）ref // 使用联合查询时，才会出现的级别</span><br><span class="line"></span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode=<span class="string">&#x27;CHN&#x27;</span> union all <span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode=<span class="string">&#x27;USA&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode=<span class="string">&#x27;CHN&#x27;</span> union all <span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode=<span class="string">&#x27;USA&#x27;</span>;</span><br><span class="line"></span><br><span class="line">4）eq_ref</span><br><span class="line">只有在连表查询时，并且使用 <span class="built_in">join</span> on语句才能达到</span><br><span class="line">A <span class="built_in">join</span> B on 条件</span><br><span class="line"></span><br><span class="line">5）const // 主键索引使用精确查询</span><br><span class="line">6）system // 主键索引使用精确查询</span><br><span class="line"></span><br><span class="line">explain <span class="keyword">select</span> * from city <span class="built_in">where</span> <span class="built_in">id</span>=1;</span><br><span class="line"></span><br><span class="line">7）null // 整个表中没有该数据</span><br><span class="line"></span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> population&gt;1000000000000000000000;</span><br></pre></td></tr></table></figure><p><strong>key_len</strong><em>:</em> 越小越好</p><p>前缀索引去控制</p><p><strong>rows</strong><em>:</em> 越小越好</p><h3 id="不走索引的情况"><a href="#不走索引的情况" class="headerlink" title="不走索引的情况"></a>不走索引的情况</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.全表扫描</span></span><br><span class="line"><span class="keyword">select</span> * from city; // 不接条件，请在后面加上<span class="built_in">where</span>条件</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.没有创建索引</span></span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> district=<span class="string">&#x27;shanghai&#x27;</span>; // 给</span><br><span class="line">需要经常查询的字段创建索引</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.有索引，不走索引</span></span><br><span class="line">1） 查询的结果集大于原表的数据25%以上</span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> population&gt;100;</span><br><span class="line"></span><br><span class="line">优化：翻页方式解决 </span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> population&gt;100 <span class="built_in">limit</span> 120,60;</span><br><span class="line"></span><br><span class="line">2）使用字段进行计算</span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> id-1=10;</span><br><span class="line"></span><br><span class="line">优化：程序员，杀了祭天</span><br><span class="line"></span><br><span class="line">3）隐式转换导致不走索引</span><br><span class="line">mysql&gt; create table test_index(<span class="built_in">id</span> int,name varchar(10),phone</span><br><span class="line">char(11));</span><br><span class="line">mysql&gt; alter table test_index add index idx_phone(phone);</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_index value(1,<span class="string">&#x27;aaa&#x27;</span>,<span class="string">&#x27;12345678911&#x27;</span>);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_index value(2,<span class="string">&#x27;bbb&#x27;</span>,<span class="string">&#x27;12341678911&#x27;</span>);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_index value(3,<span class="string">&#x27;ccc&#x27;</span>,<span class="string">&#x27;12341578911&#x27;</span>);</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from test_index;</span><br><span class="line">+------+------+-------------+</span><br><span class="line">| <span class="built_in">id</span> | name | phone |</span><br><span class="line">+------+------+-------------+</span><br><span class="line">| 1 | aaa | 12345678911 |</span><br><span class="line">| 2 | bbb | 12341678911 |</span><br><span class="line">| 3 | ccc | 12341578911 |</span><br><span class="line">+------+------+-------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from test_index <span class="built_in">where</span> phone=12341578911;</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from test_index <span class="built_in">where</span> phone=<span class="string">&#x27;12341578911&#x27;</span>;</span><br><span class="line">+------+------+-------------+</span><br><span class="line">| <span class="built_in">id</span> | name | phone |</span><br><span class="line">+------+------+-------------+</span><br><span class="line">| 3 | ccc | 12341578911 |</span><br><span class="line">+------+------+-------------+</span><br><span class="line"></span><br><span class="line">优化：查看建表语句，查看该字段的数据类型，查询时，根据数据类型选择是否加引号</span><br><span class="line"></span><br><span class="line">4）不等于、not <span class="keyword">in</span></span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> population &lt;&gt; 100;</span><br><span class="line"></span><br><span class="line">优化：</span><br><span class="line"><span class="comment"># 1.加limit优化结果集</span></span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> population &lt;&gt; 100 <span class="built_in">limit</span> 10;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.使用联合查询</span></span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> population&gt;100 union all</span><br><span class="line"><span class="keyword">select</span> * from city <span class="built_in">where</span> population &lt;100;</span><br><span class="line"></span><br><span class="line">5）使用like模糊查询，%在前面的</span><br><span class="line"></span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode like <span class="string">&#x27;%HN&#x27;</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode like <span class="string">&#x27;C%N&#x27;</span>;</span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode like <span class="string">&#x27;CH%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">优化：不要使用MySQL，使用elasticsearch（倒排索引）</span><br><span class="line"></span><br><span class="line">6）使用联合索引时，不按创建索引的顺序查询</span><br><span class="line"></span><br><span class="line">优化：</span><br><span class="line"><span class="comment"># 1.首先要对数据进行分析，了解用户喜好</span></span><br><span class="line"><span class="comment"># 2.按照顺序创建索引</span></span><br><span class="line"></span><br><span class="line">7）索引本身失效</span><br><span class="line"></span><br><span class="line">优化：删了重建</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Mysql数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql字符集和select的高级用法(7)</title>
      <link href="/2022/10/17/MySQL/Day07MySQL%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8Cselect%E7%9A%84%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"/>
      <url>/2022/10/17/MySQL/Day07MySQL%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8Cselect%E7%9A%84%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="mysql字符集和select的高级用法"><a href="#mysql字符集和select的高级用法" class="headerlink" title="mysql字符集和select的高级用法"></a>mysql字符集和select的高级用法</h1><h2 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h2><p>字符集：是一个系统支持的所有抽象字符的集合。字符是各种文字和符号的总称，包括各国家文字、标点符号、图形符号、数字等。</p><p>Linux:</p><ul><li>utf-8：一个中文占3个字节</li><li>utf-8mb4：一个中文占4个字节</li></ul><p>Windows：GBK（国标扩） GB2312</p><p>万国编码：unicode：相当于桥梁</p><p>Mysql:</p><p>1）UTF8<br>2）LATIN1<br>3）GBK</p><h3 id="校验规则"><a href="#校验规则" class="headerlink" title="校验规则"></a>校验规则</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看MySQL中所有的校验规则</span></span><br><span class="line">mysql&gt; show collation;</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看所有与utf-8相关的</span></span><br><span class="line">show collation like <span class="string">&#x27;utf8%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">1）ci：大小写不敏感</span><br><span class="line">2）cs或bin：大小写敏感</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看MySQL中所有的字符集</span></span><br><span class="line">mysql&gt; show charset;</span><br></pre></td></tr></table></figure><h3 id="统一字符集"><a href="#统一字符集" class="headerlink" title="统一字符集"></a>统一字符集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">作用:防止乱码的出现</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.操作系统</span></span><br><span class="line"><span class="comment">## CentOS6</span></span><br><span class="line">root@db01,172.16.1.51:~ <span class="comment"># vim /etc/sysconfig/i18n</span></span><br><span class="line">LANG=<span class="string">&quot;en_US.UTF-8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## CentOS7</span></span><br><span class="line">root@db01,172.16.1.51:~ <span class="comment"># vim /etc/locale.conf</span></span><br><span class="line">LANG=<span class="string">&quot;en_US.UTF-8</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#查看当前字符集</span></span><br><span class="line"><span class="string">echo <span class="variable">$LANG</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#改成中文的字符集</span></span><br><span class="line"><span class="string">export LANG=zh_CN.UTF-8</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 2.远程连接工具</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 3.数据库</span></span><br><span class="line"><span class="string">create database 库名 charset utf8;</span></span><br><span class="line"><span class="string"># 4.表</span></span><br><span class="line"><span class="string">create table 表名(id int) charset utf8;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 修改配置文件</span></span><br><span class="line"><span class="string">vim /etc/my.cnf</span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string">character_set_server=utf8</span></span><br></pre></td></tr></table></figure><h2 id="Select-高级用法-连表查询"><a href="#Select-高级用法-连表查询" class="headerlink" title="Select 高级用法(连表查询)"></a>Select 高级用法(连表查询)</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230517133549212.png" alt="image-20230517133549212"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建表并进入这个表</span></span><br><span class="line">create database stu;</span><br><span class="line">use stu;</span><br><span class="line"></span><br><span class="line">mysql&gt; create table stu_name(<span class="built_in">id</span> int,name varchar(10));</span><br><span class="line"></span><br><span class="line">mysql&gt; create table stu_score(<span class="built_in">id</span> int,mark tinyint);</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into stu_name values(1,<span class="string">&#x27;zhang3&#x27;</span>),(2,<span class="string">&#x27;li4&#x27;</span>),(3,<span class="string">&#x27;wang5&#x27;</span>);</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into stu_score values(1,80),(2,50),(3,70);</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from stu_name;</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from stu_score;</span><br></pre></td></tr></table></figure><h2 id="连表查询分类"><a href="#连表查询分类" class="headerlink" title="连表查询分类"></a>连表查询分类</h2><ul><li>传统连接</li><li>自连接</li><li>内连接</li><li>外连接<ul><li>左外连接</li><li>右外连接</li></ul></li></ul><h3 id="连表查询-传统连接"><a href="#连表查询-传统连接" class="headerlink" title="连表查询-传统连接"></a>连表查询-传统连接</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 找等价条件 + 需求条件</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> stu_name.name,stu_score.mark from stu_name,stu_score <span class="built_in">where</span> stu_name.id=stu_score.id and name=<span class="string">&#x27;zhang3&#x27;</span>;</span><br><span class="line"></span><br><span class="line">+--------+------+</span><br><span class="line">| name | mark |</span><br><span class="line">+--------+------+</span><br><span class="line">| zhang3 | 80 |</span><br><span class="line">+--------+------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 世界上小于100人的人口城市是哪个国家的？</span></span><br><span class="line"></span><br><span class="line">国家名           城市名       人口数量</span><br><span class="line">country.name city.name city.population</span><br><span class="line"><span class="comment">#查看两张表的字段</span></span><br><span class="line">desc world.city;</span><br><span class="line">desc world.country;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> country.name,city.name,city.population</span><br><span class="line">from city,country</span><br><span class="line"><span class="built_in">where</span> city.countrycode=country.code</span><br><span class="line">and city.population&lt;100;</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加别名</span></span><br><span class="line"><span class="keyword">select</span> country.name as <span class="string">&#x27;国家名&#x27;</span>,city.name as <span class="string">&#x27;城市名&#x27;</span>,city.population</span><br><span class="line">as <span class="string">&#x27;城市人口&#x27;</span></span><br><span class="line">from city,country</span><br><span class="line"><span class="built_in">where</span> city.countrycode=country.code</span><br><span class="line">and city.population&lt;100;</span><br><span class="line"></span><br><span class="line"><span class="comment">#排序验证一下</span></span><br><span class="line"><span class="keyword">select</span> * from city order by population;</span><br><span class="line"><span class="keyword">select</span> * from city order by population <span class="built_in">limit</span> 10;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 世界上小于100人的人口城市是哪个国家的他们说的语言是什么？</span></span><br><span class="line"></span><br><span class="line">国家名           城市名       人口数量语言</span><br><span class="line">country.name city.name city.populationcountrylanguage.language</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span></span><br><span class="line">country.name,city.name,city.population,countrylanguage.language</span><br><span class="line">-&gt; from city,country,countrylanguage</span><br><span class="line">-&gt; <span class="built_in">where</span> city.countrycode=country.code</span><br><span class="line">-&gt; and countrylanguage.countrycode=country.code</span><br><span class="line">-&gt; and city.population&lt;100;</span><br><span class="line"></span><br><span class="line">+----------+-----------+------------+-------------+</span><br><span class="line">| name | name | population | language |</span><br><span class="line">+----------+-----------+------------+-------------+</span><br><span class="line">| Pitcairn | Adamstown | 42 | Pitcairnese |</span><br><span class="line">+----------+-----------+------------+-------------+</span><br></pre></td></tr></table></figure><h3 id="连表查询-内连接"><a href="#连表查询-内连接" class="headerlink" title="连表查询-内连接"></a>连表查询-内连接</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">join</span> on</span><br><span class="line"></span><br><span class="line">A表 <span class="built_in">join</span> B表 on 等价条件</span><br><span class="line">A表 <span class="built_in">join</span> B表 <span class="built_in">join</span> C表 on 等价条件1 and 等价条件2</span><br><span class="line">A表 <span class="built_in">join</span> B表 on 等价条件1 <span class="built_in">join</span> C表 on 等价条件2 SQL-92标准</span><br><span class="line"></span><br><span class="line"><span class="comment"># 世界上小于100人的人口城市是哪个国家的？</span></span><br><span class="line">国家名 城市名 人口数量</span><br><span class="line">country.name city.name city.population</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> country.name,city.name,city.population</span><br><span class="line">from city <span class="built_in">join</span> country</span><br><span class="line">on city.countrycode=country.code</span><br><span class="line"><span class="built_in">where</span> city.population&lt;100;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 世界上小于100人的人口城市是哪个国家的他们说的语言是什么？</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">country.name,city.name,city.population,countrylanguage.language</span><br><span class="line">from city <span class="built_in">join</span> country</span><br><span class="line">on city.countrycode=country.code</span><br><span class="line"><span class="built_in">join</span> countrylanguage</span><br><span class="line">on countrylanguage.countrycode=country.code</span><br><span class="line"><span class="built_in">where</span> city.population&lt;100;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 处理文件：</span></span><br><span class="line"><span class="built_in">tail</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from world.city order by <span class="built_in">id</span> desc <span class="built_in">limit</span> 10;</span><br><span class="line"><span class="built_in">head</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from world.city <span class="built_in">limit</span> 10;</span><br><span class="line"></span><br><span class="line"><span class="built_in">sort</span></span><br><span class="line">order by</span><br><span class="line"></span><br><span class="line">awk</span><br><span class="line">mysql&gt; <span class="keyword">select</span> name,population from world.city <span class="built_in">limit</span> 10;mysql&gt;</span><br><span class="line"><span class="keyword">select</span> name,population from world.city <span class="built_in">limit</span> 10;</span><br><span class="line"></span><br><span class="line">grep</span><br><span class="line">like <span class="string">&#x27;%xxx%&#x27;</span></span><br><span class="line">注意：小表在前大表在后</span><br><span class="line"></span><br><span class="line">inter <span class="built_in">join</span> on</span><br></pre></td></tr></table></figure><h3 id="连表查询-外连接"><a href="#连表查询-外连接" class="headerlink" title="连表查询-外连接"></a>连表查询-外连接</h3><p>左外连接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> city.name,city.countrycode,country.name</span><br><span class="line">from city left <span class="built_in">join</span> country</span><br><span class="line">on city.countrycode=country.code</span><br><span class="line">and city.population&lt;100 <span class="built_in">limit</span> 10;</span><br><span class="line"></span><br><span class="line">outer <span class="built_in">join</span></span><br><span class="line"></span><br><span class="line">left outer <span class="built_in">join</span></span><br></pre></td></tr></table></figure><p>右外连接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> city.name,city.countrycode,country.name</span><br><span class="line">from city right <span class="built_in">join</span> country</span><br><span class="line">on city.countrycode=country.code</span><br><span class="line">and city.population&lt;100 <span class="built_in">limit</span> 10;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> city.name,country.code,country.name</span><br><span class="line">from city right <span class="built_in">join</span> country</span><br><span class="line">on city.countrycode=country.code</span><br><span class="line">and city.population&lt;100 <span class="built_in">limit</span> 10;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">right outer <span class="built_in">join</span> on</span><br></pre></td></tr></table></figure><h3 id="合并查询"><a href="#合并查询" class="headerlink" title="合并查询"></a>合并查询</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提升效率的高级用法</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode=<span class="string">&#x27;CHN&#x27;</span> or</span><br><span class="line">countrycode=<span class="string">&#x27;USA&#x27;</span>;</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode <span class="keyword">in</span> (<span class="string">&#x27;CHN&#x27;</span>,<span class="string">&#x27;USA&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">### 联合查询，效率高于上面两种</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode=<span class="string">&#x27;CHN&#x27;</span> union all <span class="keyword">select</span></span><br><span class="line">* from city <span class="built_in">where</span> countrycode=<span class="string">&#x27;USA&#x27;</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode=<span class="string">&#x27;CHN&#x27;</span> union all</span><br><span class="line"><span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode=<span class="string">&#x27;USA&#x27;</span>;</span><br><span class="line">+----+-------------+-------+------------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | partitions | <span class="built_in">type</span> |</span><br><span class="line">+----+-------------+-------+------------+------+</span><br><span class="line">| 1 | PRIMARY | city | NULL | ref |</span><br><span class="line">| 2 | UNION | city | NULL | ref |</span><br><span class="line">+----+-------------+-------+------------+------+</span><br><span class="line"></span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode=<span class="string">&#x27;CHN&#x27;</span> or</span><br><span class="line">countrycode=<span class="string">&#x27;USA&#x27;</span>;</span><br><span class="line">+----+-------------+-------+------------+-------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | partitions | <span class="built_in">type</span> |</span><br><span class="line">+----+-------------+-------+------------+-------+</span><br><span class="line">| 1 | SIMPLE | city | NULL | range |</span><br><span class="line">+----+-------------+-------+------------+-------+</span><br><span class="line"></span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode <span class="keyword">in</span></span><br><span class="line">(<span class="string">&#x27;CHN&#x27;</span>,<span class="string">&#x27;USA&#x27;</span>);</span><br><span class="line">+----+-------------+-------+------------+-------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | partitions | <span class="built_in">type</span> |</span><br><span class="line">+----+-------------+-------+------------+-------+</span><br><span class="line">| 1 | SIMPLE | city | NULL | range |</span><br><span class="line">+----+-------------+-------+------------+-------+</span><br><span class="line"></span><br><span class="line"><span class="comment">### 效率最低，全表扫描</span></span><br><span class="line">mysql&gt; explain <span class="keyword">select</span> * from city;</span><br><span class="line">+----+-------------+-------+------------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | partitions | <span class="built_in">type</span> |</span><br><span class="line">+----+-------------+-------+------------+------+</span><br><span class="line">| 1 | SIMPLE | city | NULL | ALL |</span><br><span class="line">+----+-------------+-------+------------+------+</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Mysql数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL的存储引擎(9)</title>
      <link href="/2022/10/17/MySQL/Day09MySQL%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/"/>
      <url>/2022/10/17/MySQL/Day09MySQL%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="MySQL的存储引擎"><a href="#MySQL的存储引擎" class="headerlink" title="MySQL的存储引擎"></a>MySQL的存储引擎</h1><h2 id="存储引擎简介"><a href="#存储引擎简介" class="headerlink" title="存储引擎简介"></a>存储引擎简介</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112126741.png" alt="image-20230518112126741"></p><p>1、文件系统： 1.1 操作系统组织和存取数据的一种机制。 1.2 文件系统是一种软件。 </p><p>2、文件系统类型：ext2 3 4 ，xfs 数据 2.1 不管使用什么文件系统，数据内容不会变化 2.2 不同的是，存储空间、大小、速度。 </p><p>3、MySQL引擎： 3.1 可以理解为MySQL的“文件系统”，只不过功能更加强大。 </p><p>4、MySQL引擎功能： 4.1 除了可以提供基本的存取功能，还有更多功能事务功能、锁定、备份和恢复、优化以及特殊功能</p><p>总之，存储引擎的各项特性就是为了保障数据库的安全和性能设计结构。</p><h2 id="mysql自带的存储引擎类型"><a href="#mysql自带的存储引擎类型" class="headerlink" title="mysql自带的存储引擎类型"></a>mysql自带的存储引擎类型</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112146974.png" alt="image-20230518112146974"></p><p>还可以使用第三方存储引擎: 01）MySQL当中插件式的存储引擎类型 02）MySQL的两个分支 03）perconaDB 04）mariaDB</p><p>MySQL存储引擎介绍</p><p>Linux的文件系统：<br>CentOS6文件系统：ext4<br>CentOS7文件系统：xfs</p><p>MySQL的存储引擎:</p><p>MySQL5.5版本之前：MyIsam<br>MySQL5.5版本之后：Innodb</p><p>可以理解为，MySQL的“文件系统”，只不过功能更加强大。</p><h3 id="mysql中的存储引擎"><a href="#mysql中的存储引擎" class="headerlink" title="mysql中的存储引擎"></a>mysql中的存储引擎</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看当前MySQL支持的存储引擎类型</span></span><br><span class="line">mysql&gt; show engines</span><br><span class="line"><span class="comment">#查看innodb的表有哪些</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> table_schema,table_name,engine from information_schema.tables <span class="built_in">where</span> engine=<span class="string">&#x27;innodb&#x27;</span>;</span><br><span class="line"><span class="comment">#查看myisam的表有哪些</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> table_schema,table_name,engine from information_schema.tables <span class="built_in">where</span> engine=<span class="string">&#x27;myisam&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看元数据</span></span><br><span class="line">show tables from information_schema</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * from information_schema.tables\G</span><br><span class="line"></span><br><span class="line"><span class="comment">## 建表指定存储引擎</span></span><br><span class="line">mysql&gt; create table test_engine(<span class="built_in">id</span> int) charset latin1 engine myisam;</span><br><span class="line"> </span><br><span class="line"><span class="comment">#查看表信息</span></span><br><span class="line">show create table test_engine;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改表的存储引擎</span></span><br><span class="line">mysql&gt; alter table test_engine engine innodb;</span><br></pre></td></tr></table></figure><p>企业案例  项目背景：</p><p>公司原有的架构：一个展示型的网站，LAMT，MySQL5.1.77版本（MYISAM），50M数据量。</p><p>小问题不断：1、表级锁：对表中任意一行数据修改类操作时，整个表都会锁定，对其他行的操作都不能同时进行。</p><p>2、不支持故障自动恢复（CSR）：当断电时有可能会出现数据损坏或丢失的问题。</p><p>如何解决：</p><p>1、提建议将现有的MYISAM引擎替换为Innodb，将版本替换为5.6.38</p><p>1）如果使用MYISAM会产生”小问题”，性能安全不能得到保证，使用innodb可以解决这个问题。</p><p>2）5.1.77版本对于innodb引擎支持不够完善，5.6.38版本对innodb支持非常完善了。</p><p>2、实施过程和注意要素</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##￥##大概操作步骤</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.准备新环境</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.安装MySQL5.6或5.7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.mysqldump备份出旧库的所有表 5000</span></span><br><span class="line">mysqldump -uroot -p123@qqdianCOM -B world &gt; /tmp/world.sql 5000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.替换</span></span><br><span class="line">:%s<span class="comment">#ENGINE=MyISAM#ENGINE=InnoDB#g</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.数据恢复到新环境 5001 5002 5003</span></span><br><span class="line">MySQL5.7 5000</span><br><span class="line">mysql -uroot -p123 &lt; /tmp/world.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">#停库截取新数据，给到新环境</span></span><br></pre></td></tr></table></figure><h3 id="innodb和myisam的区别"><a href="#innodb和myisam的区别" class="headerlink" title="innodb和myisam的区别"></a>innodb和myisam的区别</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###物理区别</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#进入mysql目录</span></span><br><span class="line">[root@db01~l]<span class="comment"># cd /application/mysql/data/mysql</span></span><br><span class="line"><span class="comment">#查看所有user的文件</span></span><br><span class="line">[root@db01 mysql]<span class="comment"># ll user.*</span></span><br><span class="line">-rw-rw---- 1 mysql mysql 10684 Mar  6  2017 user.frm</span><br><span class="line">-rw-rw---- 1 mysql mysql   960 Aug 14 01:15 user.MYD</span><br><span class="line">-rw-rw---- 1 mysql mysql  2048 Aug 14 01:15 user.MYI</span><br><span class="line"><span class="comment">#进入word目录</span></span><br><span class="line">[root@db01 world]<span class="comment"># cd /application/mysql/data/world/</span></span><br><span class="line"><span class="comment">#查看所有city的文件</span></span><br><span class="line">[root@db01 world]<span class="comment"># ll city.*</span></span><br><span class="line">-rw-rw---- 1 mysql mysql   8710 Aug 14 16:23 city.frm</span><br><span class="line">-rw-rw---- 1 mysql mysql 688128 Aug 14 16:23 city.ibd</span><br><span class="line"></span><br><span class="line"><span class="comment">###区别：myisam 表级锁，innodb行级锁</span></span><br></pre></td></tr></table></figure><p>innodb存储引擎的简介</p><p>在MySQL5.5版本之后默认的存储引擎，提供高可靠性和高性能。</p><p>优点: 01）事务安全（遵从 ACID） 02）MVCC（Multi-Versioning Concurrency Control，多版本并发控制） 03）InnoDB 行级别锁定 04）Oracle 样式一致非锁定读取 05）表数据进行整理来优化基于主键的查询 06）支持外键引用完整性约束 07）大型数据卷上的最大性能 08）将对表的查询与不同存储引擎混合 09）出现故障后快速自动恢复 10）用于在内存中缓存数据和索引的缓冲区池</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112206030.png" alt="image-20230518112206030"></p><p>innodb核心特性重点: </p><p>MVCC （多版本并发控制）</p><p>事务 </p><p>行级锁 </p><p>热备份</p><p> Crash Safe Recovery（自动故障恢复）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#外键</span></span><br><span class="line"><span class="comment">#查看建表语句</span></span><br><span class="line">show create table city;</span><br><span class="line">show create table country;</span><br><span class="line"></span><br><span class="line"> CREATE TABLE `city` (</span><br><span class="line">  `ID` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `Name` char(35) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `CountryCode` char(3) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `District` char(20) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `Population` int(11) NOT NULL DEFAULT <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  KEY `CountryCode` (`CountryCode`),</span><br><span class="line">  KEY `index_population` (`Population`),</span><br><span class="line">  KEY `index_name` (`Name`),</span><br><span class="line">  CONSTRAINT `city_ibfk_1` FOREIGN KEY (`CountryCode`) REFERENCES `country` (`Code`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=4080 DEFAULT CHARSET=latin1</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建city表</span></span><br><span class="line"></span><br><span class="line"> CREATE TABLE `city` (</span><br><span class="line">  `ID` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `Name` char(35) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `CountryCode` char(3) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `District` char(20) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `Population` int(11) NOT NULL DEFAULT <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  KEY `CountryCode` (`CountryCode`),</span><br><span class="line">  KEY `index_population` (`Population`),</span><br><span class="line">  KEY `index_name` (`Name`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=4080 DEFAULT CHARSET=latin1;</span><br></pre></td></tr></table></figure><p>查看存储引擎</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看当前默认使用的存储引擎</span></span><br><span class="line"><span class="keyword">select</span> @@default_storage_engine;</span><br><span class="line">+--------------------------+</span><br><span class="line">| @@default_storage_engine |</span><br><span class="line">+--------------------------+</span><br><span class="line">| InnoDB                   |</span><br><span class="line">+--------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改默认存储引擎（永久生效需要重启数据库）</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">default-storage-engine=innodb</span><br><span class="line"></span><br><span class="line">systemctl restart mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改默认存储引擎（临时生效不需要重启数据库）</span></span><br><span class="line"><span class="built_in">set</span> @@default_storage_engine=innodb;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建表指定存储引擎</span></span><br><span class="line">mysql&gt; create table tb(<span class="built_in">id</span> int) engine innodb;</span><br></pre></td></tr></table></figure><h2 id="Innodb存储引擎—表空间介绍"><a href="#Innodb存储引擎—表空间介绍" class="headerlink" title="Innodb存储引擎—表空间介绍"></a>Innodb存储引擎—表空间介绍</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112228055.png" alt="image-20230518112228055"></p><ul><li><p>共享表空间</p><ul><li>系统数据</li><li>undo</li><li>临时表</li></ul></li><li><p>独立表空间</p><ul><li>用户真实数据</li></ul></li></ul><p>5.5版本以后出现共享表空间概念 ：表空间的管理模式的出现是为了数据库的存储更容易扩展 </p><p>5.6版本中默认的是独立表空间</p><p>5.6版本中默认存储: 1.系统数据 2.undo 3.临时表</p><p>5.7版本中默认会将undo和临时表独立出来，5.6版本也可以独立，只不过需要在初始化的时候进行配置</p><h3 id="表空间位置"><a href="#表空间位置" class="headerlink" title="表空间位置"></a>表空间位置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#共享表空间在数据目录data下</span></span><br><span class="line">ll /app/mysql/data</span><br><span class="line"></span><br><span class="line">rw-rw---- 1 mysql mysql 79691776 Apr 12 16:07 ibdata1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据目录下（独立表空间）在每个库里面点idb文件</span></span><br><span class="line"></span><br><span class="line">-rw-r----- 1 mysql mysql 8584 Apr 6 11:13 stu_age.frm //表结构文件</span><br><span class="line"></span><br><span class="line">-rw-r----- 1 mysql mysql 98304 Apr 6 11:14 stu_age.ibd //独立表空间 （用户真实数据）</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看所有默认配置（库外）</span></span><br><span class="line">mysqladmin -uroot -p123@qqdianCOM variables</span><br><span class="line"></span><br><span class="line">mysqladmin -uroot -p123@qqdianCOM variables |grep socket</span><br><span class="line"><span class="comment">## 查看所有默认配置（库内）</span></span><br><span class="line">mysql&gt; show variables;</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看共享表空间的配置</span></span><br><span class="line">mysql&gt; show variables like <span class="string">&#x27;%path%&#x27;</span>;</span><br><span class="line">+----------------------------------+------------------------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+----------------------------------+------------------------+</span><br><span class="line">| innodb_data_file_path | ibdata1:12M:autoextend |</span><br><span class="line">+----------------------------------+------------------------+</span><br><span class="line">ibdata1:12M:autoextend：名字 默认大小12M 可以自增</span><br><span class="line">ibdata1:这个文件可以看作可以自动扩容的磁盘</span><br><span class="line"><span class="comment">#查看共享表空间大小</span></span><br><span class="line"><span class="built_in">du</span> -sh ibdata1</span><br><span class="line">76Mibdata1</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改配置文件做共享表空间切割</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">innodb_data_file_path=ibdata1:76M;ibdata2:50M:autoextend</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启服务出现报错</span></span><br><span class="line">InnoDB: The innodb_system data file <span class="string">&#x27;./ibdata1&#x27;</span> is of a different</span><br><span class="line">size 13056 pages (rounded down to MB) than the 3200 pages specified</span><br><span class="line"><span class="keyword">in</span> the .cnf file!</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看日志解决问题</span></span><br><span class="line"><span class="built_in">tail</span> -100f /var/log/mysqld.log</span><br><span class="line"></span><br><span class="line">204M ibdata1</span><br><span class="line">13056 pages = 204MB</span><br><span class="line">3200 pages = 50M</span><br><span class="line"></span><br><span class="line"><span class="comment">###查看独立表空间</span></span><br><span class="line"><span class="comment">#物理查看</span></span><br><span class="line">[root@db01 ~]<span class="comment"># ll /application/mysql/data/world/</span></span><br><span class="line">-rw-rw---- 1 mysql mysql 688128 Aug 14 16:23 city.ibd</span><br><span class="line"><span class="comment">#命令行查看</span></span><br><span class="line">mysql&gt; show variables like <span class="string">&#x27;%per_table%&#x27;</span>;</span><br><span class="line">+-----------------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+-----------------------+-------+</span><br><span class="line">| innodb_file_per_table | ON |</span><br><span class="line">+-----------------------+-------+</span><br></pre></td></tr></table></figure><h3 id="企业案列"><a href="#企业案列" class="headerlink" title="企业案列"></a>企业案列</h3><p>在没有备份数据的情况下，突然断电导致表损坏，打不开数据库。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#恢复步骤</span></span><br><span class="line"><span class="comment"># 1.准备新环境</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.知道建表语句（管开发要）</span></span><br><span class="line">CREATE TABLE `city_new` (</span><br><span class="line">`ID` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">`Name` char(35) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">`CountryCode` char(3) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">`District` char(20) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">`Population` int(11) NOT NULL DEFAULT <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">PRIMARY KEY (`ID`),</span><br><span class="line">KEY `CountryCode` (`CountryCode`),</span><br><span class="line">KEY `idx_population` (`Population`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=4080 DEFAULT CHARSET=latin1;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.在新环境中创建出该表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.删除新表的独立表空间</span></span><br><span class="line">MySQL5.7[world]&gt;alter table city_new discard tablespace;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.将旧表的表空间拷贝成新表的表空间</span></span><br><span class="line"><span class="built_in">cp</span> -a city.ibd city_new.ibd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.导入新表的独立表空间</span></span><br><span class="line">mysql&gt; alter table city_new import tablespace;</span><br></pre></td></tr></table></figure><h2 id="Innodb核心特性-事务"><a href="#Innodb核心特性-事务" class="headerlink" title="Innodb核心特性-事务"></a>Innodb核心特性-事务</h2><p>什么是事务</p><p>主要针对DML语句(update, delece, insert)</p><p>一组数据操作执行步骤，这些步骤被视为一个工作单元: 1）用于对多个语句进行分组 2）可以在多个客户机并发访问同一个表中的数据时使用</p><p>所有步骤都成功或都失败 1）如果所有步骤正常，则执行 2）如果步骤出现错误或不完整，则取消</p><h3 id="事务的特性"><a href="#事务的特性" class="headerlink" title="事务的特性"></a>事务的特性</h3><h4 id="事物的ACID特性"><a href="#事物的ACID特性" class="headerlink" title="事物的ACID特性"></a>事物的ACID特性</h4><p>Atomic（原子性） 所有语句作为一个单元全部成功执行或全部取消。</p><p>Consistent（一致性） 如果数据库在事务开始时处于一致状态，则在执行该 事务期间将保留一致状态。</p><p>Isolated（隔离性）<br>事务之间不相互影响。</p><p>Durable（持久性） 事务成功完成后，所做的所有更改都会准确地记录在 数据库中。所做的更改不会丢失。</p><h4 id="事务交易流程"><a href="#事务交易流程" class="headerlink" title="事务交易流程"></a>事务交易流程</h4><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112250647.png" alt="image-20230518112250647"></p><h4 id="事务的控制语句SQL语句类别DTL"><a href="#事务的控制语句SQL语句类别DTL" class="headerlink" title="事务的控制语句SQL语句类别DTL"></a>事务的控制语句SQL语句类别DTL</h4><p>Database Trasatiom Language：数据事务语言</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 开启一个事务</span></span><br><span class="line">begin;</span><br><span class="line">start transaction;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 提交一个事务</span></span><br><span class="line">commit;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 回滚一个事务</span></span><br><span class="line">rollback;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 记录事务的点</span></span><br><span class="line">savepoint</span><br><span class="line">mysql&gt; savepoint test1;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 将事务回滚到记录的点位</span></span><br><span class="line">rollback to savepoint</span><br><span class="line">mysql&gt; rollback to savepoint test1;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除事务点位</span></span><br><span class="line">release savepoint</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意：只要执行一条DML开始，就已经开启了一个事务，无需执行begin</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#DML语句</span></span><br><span class="line">insert</span><br><span class="line">update</span><br><span class="line">delete</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看自动提交功能</span></span><br><span class="line">show variables like <span class="string">&#x27;autocommit&#x27;</span>;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| autocommit    | ON    |</span><br><span class="line">+---------------+-------+</span><br><span class="line"></span><br><span class="line"><span class="comment">## 关闭自动提交(永久关闭)</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">autocommit=0</span><br><span class="line"></span><br><span class="line"><span class="comment">## 临时关闭</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> autocommit=0;</span><br><span class="line"></span><br><span class="line"><span class="comment">#在事务交易的时候需要关闭自动提交，临时关闭</span></span><br></pre></td></tr></table></figure><h3 id="事务的生命周期"><a href="#事务的生命周期" class="headerlink" title="事务的生命周期"></a>事务的生命周期</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##成功事务的生命周期</span></span><br><span class="line">begin;</span><br><span class="line"></span><br><span class="line">DML1</span><br><span class="line">DML2</span><br><span class="line">DML3</span><br><span class="line"></span><br><span class="line">commit;</span><br><span class="line"></span><br><span class="line"><span class="comment">##失败事务的生命周期</span></span><br><span class="line">begin;</span><br><span class="line"></span><br><span class="line">DML1</span><br><span class="line">DML2</span><br><span class="line">DML3</span><br><span class="line"></span><br><span class="line">rollback;</span><br></pre></td></tr></table></figure><h3 id="事务的隐士提交"><a href="#事务的隐士提交" class="headerlink" title="事务的隐士提交"></a>事务的隐士提交</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.在事务执行期间，如果执行了DDL或者DCL语句，则自动提交上一个事务</span><br><span class="line">2.在事务执行期间，如果执行了begin或者start transaction会自动提交上一个事务</span><br><span class="line">3.在事务执行期间，如果执行了lock或unlock锁表语句，则会自动提交上一个事务</span><br><span class="line">4.在事务执行期间，如果执行load data infile导出数据，则会提交上一个事务</span><br><span class="line">5.在事务执行期间，如果执行<span class="keyword">select</span> <span class="keyword">for</span> update语句，则会提交上一个事务</span><br><span class="line">6.在事务执行期间，如果设置了autocommit=1，则会提交上一个事务</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行update 会自动在之前执行begin，在之后执行commit，开启自动提交的情况下DML语句都会在之前之后自动执行</span></span><br></pre></td></tr></table></figure><h3 id="事务日志redo、undo，MySQl自动故障恢复过程-CSR"><a href="#事务日志redo、undo，MySQl自动故障恢复过程-CSR" class="headerlink" title="事务日志redo、undo，MySQl自动故障恢复过程(CSR)"></a>事务日志redo、undo，MySQl自动故障恢复过程(CSR)</h3><p>1）Redo是什么？ redo,顾名思义“重做日志”，是事务日志的一种。 </p><p>2）作用是什么？ 在事务ACID过程中，实现的是“D”持久化的作用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">事务有4种特性：原子性、一致性、隔离性和持久性。那么事务的四种特性到底是基于什么机制实现呢？</span><br><span class="line"></span><br><span class="line">事务的隔离性由锁机制执行。</span><br><span class="line">事务的原子性、一致性和持久性由事务的redo日志和undo日志来保证。</span><br><span class="line">redo <span class="built_in">log</span>称为重做日志，提供再写入操作，恢复提交事务修改的页操作，用来保证事务的持久性。</span><br><span class="line"></span><br><span class="line">undo <span class="built_in">log</span>称为回滚日志，回滚行记录到某个特定版本，用来保证事务的原子性、一致性。</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112307668.png" alt="image-20230518112307668"></p><p>redo log恢复数据过程</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112321401.png" alt="image-20230518112321401"></p><p>什么时候redo buffer page中的数据会写入到redo log中？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.当我们执行commit之后，会将数据写入redo <span class="built_in">log</span></span><br><span class="line">2.在一段时间内，redo buffer page中的数据会自动写入redo <span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 存在问题？</span></span><br><span class="line">1.数据执行了commit;后断电，表空间数据还未写入，如何自动恢复？</span><br><span class="line">2.数据没有执行commit;变化过程到指定时间后，也被写入redo <span class="built_in">log</span>中，如何恢复数据？</span><br></pre></td></tr></table></figure><p>undo</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112335327.png" alt="image-20230518112335327"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#redo和undo的存储位置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#redo位置</span></span><br><span class="line">[root@db01 data]<span class="comment"># ll /application/mysql/data/</span></span><br><span class="line">-rw-rw---- 1 mysql mysql 50331648 Aug 15 06:34 ib_logfile0</span><br><span class="line">-rw-rw---- 1 mysql mysql 50331648 Mar  6  2017 ib_logfile1</span><br><span class="line"><span class="comment">#undo位置</span></span><br><span class="line">[root@db01 data]<span class="comment"># ll /application/mysql/data/</span></span><br><span class="line">-rw-rw---- 1 mysql mysql 79691776 Aug 15 06:34 ibdata1</span><br><span class="line">-rw-rw---- 1 mysql mysql 79691776 Aug 15 06:34 ibdata2</span><br><span class="line"></span><br><span class="line"><span class="comment">#在MySQL5.6版本undo是在iddata文件中，在MysQL5.7版本会独立出来。</span></span><br></pre></td></tr></table></figure><h3 id="事务中的锁"><a href="#事务中的锁" class="headerlink" title="事务中的锁"></a>事务中的锁</h3><p>1）什么是“锁”？<br>“锁”顾名思义就是锁定的意思。</p><p>2）“锁”的作用是什么？</p><p>在事务ACID特性过程中，“锁”和“隔离级别”一起来实现“I”隔离性的作用。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112348299.png" alt="image-20230518112348299"></p><p>Innodb：行级锁 前提：该表中，必须有主键索引</p><p>myisam：表级锁</p><p>锁分类</p><ul><li>排它锁：事务执行期间，阻塞其他事务的修改操作</li><li>共享锁：事务执行期间，不阻塞其他事务的查询操作</li><li>乐观锁：事务执行期间，谁先提交以谁为准</li><li>悲观锁：事务执行期间，其他事务无法查看该数据的变化</li></ul><h3 id="innodb核心特性-多版本并发控制-MVCC"><a href="#innodb核心特性-多版本并发控制-MVCC" class="headerlink" title="innodb核心特性-多版本并发控制(MVCC)"></a>innodb核心特性-多版本并发控制(MVCC)</h3><p>多版本并发控制是由三个锁构成：</p><ul><li>排他锁</li><li>共享锁</li><li>乐观锁</li></ul><p>1.只阻塞修改类操作，不阻塞查询类操作</p><p>2.乐观锁的机制 (谁先提交谁为准)</p><h3 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 当前MySQL默认级别 RR级别 可重复读</span></span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like <span class="string">&#x27;%iso%&#x27;</span>;</span><br><span class="line">+-----------------------+-----------------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+-----------------------+-----------------+</span><br><span class="line">| transaction_isolation | REPEATABLE-READ |</span><br><span class="line">| tx_isolation | REPEATABLE-READ |</span><br><span class="line">+-----------------------+-----------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">## 脏读</span></span><br><span class="line">脏读是指事务读取到其他事务正在处理的未提交数据</span><br><span class="line"><span class="comment">## 幻读</span></span><br><span class="line">幻读指并发插入、删除时，另一个事务前后执行相同条件的查询得到的数据不一致</span><br><span class="line"><span class="comment">## 不可重复读      解决RR</span></span><br><span class="line">不可重复读指在并发更新时，另一个事务前后执行相同条件的查询得到的数据不一致</span><br><span class="line"></span><br><span class="line"><span class="comment">#解决方法</span></span><br><span class="line">禁止写时读，避免了“脏读”，对应隔离级别<span class="built_in">read</span> committed。</span><br><span class="line"></span><br><span class="line">禁止读时写，避免了“不可重复读”，对应隔离级别repeatable <span class="built_in">read</span>。</span><br><span class="line"></span><br><span class="line">而为了避免“幻读”，干脆把整个表给锁住了，只能是serialize了。</span><br><span class="line"></span><br><span class="line">隔离级别越高，并行度越低，付出的代价越大。</span><br><span class="line"></span><br><span class="line">MySQL默认事务隔离级别为：可重复读（repeatable-read），因此当我们使用MySQL进行实际开发时一般不会发生“脏读”和“不可重复读”。现在可能遇到的问题就是“幻读”，不过MySQL通过多版本并发控制（MVCC）机制解决了该问题。</span><br><span class="line"><span class="comment"># 1.RU Read Uncommit 未提交读</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">transaction_isolation=read-uncommit</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.RC Read Commit 已提交读</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">transaction_isolation=read-commit</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.RR REPEATABLE-READ 可重复读 MySQL默认隔离级别</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.SERIALIZABLE 串行化</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Mysql数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL日志管理(10)</title>
      <link href="/2022/10/17/MySQL/Day10MySQL%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/"/>
      <url>/2022/10/17/MySQL/Day10MySQL%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="MySQL日志管理"><a href="#MySQL日志管理" class="headerlink" title="MySQL日志管理"></a>MySQL日志管理</h1><h2 id="MySQL日志简介"><a href="#MySQL日志简介" class="headerlink" title="MySQL日志简介"></a>MySQL日志简介</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112407414.png" alt="image-20230518112407414"></p><h2 id="MySQL错误日志"><a href="#MySQL错误日志" class="headerlink" title="MySQL错误日志"></a>MySQL错误日志</h2><p>作用: 查看MySQl启动时的报错信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#报错解决</span></span><br><span class="line">ERROR 2002 (HY000): Can<span class="string">&#x27;t connect to local MySQL server through</span></span><br><span class="line"><span class="string">socket &#x27;</span>/var/lib/mysql/mysql.sock<span class="string">&#x27; (2)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 1.服务没有启动</span></span><br><span class="line"><span class="string">ps -ef|grep mysql</span></span><br><span class="line"><span class="string">netstat -lntup</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 2.启动并生成了socket但是位置不对</span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string">socket=/xxx</span></span><br><span class="line"><span class="string">[mysql]</span></span><br><span class="line"><span class="string">socket=/xxx</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#报错找ERROR</span></span><br><span class="line"><span class="string">[ERROR] unknown option &#x27;</span>--skip-name-resolv<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###错误日志位置、文件名</span></span><br><span class="line"><span class="comment"># 源码安装 二进制安装</span></span><br><span class="line"><span class="variable">$DATADIR</span><span class="variable">$hostname</span>.err</span><br><span class="line">举例:ll /app/mysql/data</span><br><span class="line">db02.err</span><br><span class="line"></span><br><span class="line"><span class="comment"># yum安装</span></span><br><span class="line">/var/log/</span><br><span class="line"></span><br><span class="line">mysqld.log</span><br></pre></td></tr></table></figure><p>默认是否开启：开启</p><p>是否可以修改：可以</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改</span></span><br><span class="line"><span class="comment">## 命令行启动：</span></span><br><span class="line">mysqld --log-error=/tmp/a.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看默认位置</span></span><br><span class="line">show variables like <span class="string">&#x27;%error%&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置文件：</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">log_error=/tmp/b.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#mysql日志放其他位置需要把文件创建出来，tmp是setuid的权限不需要手动创建</span></span><br><span class="line"><span class="comment">## 注意：只要不将放在带有setuid权限的目录下，那就需要先创建再授权，然后才能启动</span></span><br><span class="line"><span class="built_in">touch</span> /opt/a.log</span><br><span class="line"><span class="built_in">chown</span> mysql.mysql /opt/a.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看错误日志</span></span><br><span class="line">mysql 5.7版本  yum安装</span><br><span class="line">journalctl -xe</span><br><span class="line"><span class="built_in">tail</span> -100f /var/log/mysqld.log</span><br></pre></td></tr></table></figure><h2 id="MySQL常规日志"><a href="#MySQL常规日志" class="headerlink" title="MySQL常规日志"></a>MySQL常规日志</h2><p>作用：记录MySQL日常操作</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###常规日志位置、文件名</span></span><br><span class="line"><span class="comment"># 源码安装 二进制安装</span></span><br><span class="line"><span class="variable">$DATADIR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># yum安装</span></span><br><span class="line">/var/lib/mysql/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 源码安装 二进制安装 yum安装</span></span><br><span class="line"><span class="variable">$hostname</span>.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看默认位置</span></span><br><span class="line"></span><br><span class="line">show variables like <span class="string">&#x27;%general%&#x27;</span>;</span><br><span class="line">+------------------+--------------------------+</span><br><span class="line">| Variable_name    | Value                    |</span><br><span class="line">+------------------+--------------------------+</span><br><span class="line">| general_log      | OFF                      |</span><br><span class="line">| general_log_file | /app/mysql/data/db03.<span class="built_in">log</span> |</span><br><span class="line">+------------------+--------------------------+</span><br></pre></td></tr></table></figure><p>默认是否开启：否</p><p>是否可以修改：可以</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">general_log=1</span><br><span class="line">general_log_file=/tmp/db02.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line"><span class="built_in">tail</span> -f /var/lib/mysql/db01.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#磁盘空间大小</span></span><br><span class="line">KB MB GB TB PB EB</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="MySQL的慢查询日志"><a href="#MySQL的慢查询日志" class="headerlink" title="MySQL的慢查询日志"></a>MySQL的慢查询日志</h2><p>作用：记录执行较慢（规定SQL语句执行时间阈值）的SQL语句</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###慢查询日志位置、文件名</span></span><br><span class="line"><span class="comment"># 源码安装 二进制安装 yum安装</span></span><br><span class="line"><span class="variable">$DATADIR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 源码安装 二进制安装 yum安装</span></span><br><span class="line"><span class="variable">$hostname</span>-slow.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看默认位置</span></span><br><span class="line">show variables like <span class="string">&#x27;%slow%&#x27;</span></span><br><span class="line"></span><br><span class="line">+---------------------------+-------------------------------+</span><br><span class="line">| Variable_name             | Value                         |</span><br><span class="line">+---------------------------+-------------------------------+</span><br><span class="line">| log_slow_admin_statements | OFF                           |</span><br><span class="line">| log_slow_slave_statements | OFF                           |</span><br><span class="line">| slow_launch_time          | 2                             |</span><br><span class="line">| slow_query_log            | OFF                           |</span><br><span class="line">| slow_query_log_file       | /app/mysql/data/db03-slow.log |</span><br><span class="line">+---------------------------+-------------------------------+</span><br></pre></td></tr></table></figure><p>默认是否开启：不开启</p><p>是否可以修改：可以</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">slow_query_log=1</span><br><span class="line">long_query_time=0.05 <span class="comment"># 设置SQL语句查询时间阈值</span></span><br><span class="line">log_queries_not_using_indexes</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定慢日志文件存放位置（默认在data）</span></span><br><span class="line">slow_query_log_file=/application/mysql/data/slow.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不使用索引的慢查询语句是否记录到日志</span></span><br><span class="line">log_queries_not_using_indexes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询检查返回少于该参数指定行的SQL不被记录到慢查询日志</span></span><br><span class="line">min_examined_row_limit=100（鸡肋）</span><br></pre></td></tr></table></figure><h3 id="慢查询日志查看工具"><a href="#慢查询日志查看工具" class="headerlink" title="慢查询日志查看工具"></a>慢查询日志查看工具</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mysqldumpslow</span></span><br><span class="line">参数说明:</span><br><span class="line">-s:</span><br><span class="line">是表示按照何种方式排序，c、t、l、r分别是按照记录次数、时间、查询时间、返回的记录</span><br><span class="line">数来排序，ac、at、al、ar，表示相应的倒叙；</span><br><span class="line">-t:</span><br><span class="line">是top n的意思，即为返回前面多少条的数据；</span><br><span class="line">-g:</span><br><span class="line">后边可以写一个正则匹配模式，大小写不敏感的；</span><br><span class="line"></span><br><span class="line">mysqldumpslow -s t -t 3 db01-slow.log</span><br><span class="line">mysqldumpslow -s c -t 3 db01-slow.log</span><br><span class="line">mysqldumpslow -s r -t 3 db01-slow.log</span><br><span class="line">mysqldumpslow -s l -t 3 db01-slow.log</span><br><span class="line"></span><br><span class="line">mysqldumpslow -s at -t 3 db01-slow.log</span><br><span class="line">mysqldumpslow -s ac -t 3 db01-slow.log</span><br><span class="line">mysqldumpslow -s ar -t 3 db01-slow.log</span><br><span class="line">mysqldumpslow -s al -t 3 db01-slow.log</span><br></pre></td></tr></table></figure><p>第三方工具查询</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget http://test.driverzeng.com/MySQL_Package/percona-toolkit-3.0.11-1.el6.x86_64.rpm</span><br><span class="line"></span><br><span class="line">yum localinstall -y percona-toolkit-3.0.11-1.el6.x86_64.rpm </span><br><span class="line"></span><br><span class="line"><span class="comment">#查询</span></span><br><span class="line">pt-query-digest /var/lib/mysql/db01-slow.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#官网</span></span><br><span class="line">https://downloads.percona.com/downloads/percona-toolkit/3.5.2/binary/redhat/7/x86_64/percona-toolkit-3.5.2-2.el7.x86_64.rpm</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112426363.png" alt="image-20230518112426363"></p><h2 id="MySQL的二进制日志"><a href="#MySQL的二进制日志" class="headerlink" title="MySQL的二进制日志"></a>MySQL的二进制日志</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看master状态信息</span></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">Empty <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><p>作用:</p><ul><li>记录DDL、DCL以及DML（对表有修改的语句）</li><li>只记录已提交(commit)的事务，将一个事务拆分成多个事件（event）</li><li>总之，二进制日志会记录所有对数据库发生修改的操作</li></ul><p>位置:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看默认是否开启</span></span><br><span class="line">show variables like <span class="string">&#x27;log_bin&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$DATADIR</span></span><br></pre></td></tr></table></figure><p>文件名：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql-bin.000001</span><br><span class="line">mysql-bin.000002</span><br><span class="line">....</span><br></pre></td></tr></table></figure><p>默认是否开启：不开启</p><p>是否可以修改：可以</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql5.6</span></span><br><span class="line"><span class="comment">#log-bin=/app/mysql/data/zls-bin</span></span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"></span><br><span class="line">show master status;</span><br><span class="line">+------------------+----------+</span><br><span class="line">| File             | Position | </span><br><span class="line">+------------------+----------+</span><br><span class="line">| mysql-bin.000004 |      120 |</span><br><span class="line">+------------------+----------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># mysql5.7</span></span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">server_id=1</span><br><span class="line"></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+------------------+----------+</span><br><span class="line">| File             | Position |</span><br><span class="line">+------------------+----------+</span><br><span class="line">| mysql-bin.000007 |      154 |</span><br><span class="line">+------------------+----------+</span><br></pre></td></tr></table></figure><h3 id="binlog的工作模式"><a href="#binlog的工作模式" class="headerlink" title="binlog的工作模式"></a>binlog的工作模式</h3><ul><li>statement：语句模式（MySQL5.6）</li><li>row：行级模式</li><li>mixed：混合模式</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Mysql5.6默认语句模式，5.7默认行级模式</span></span><br><span class="line"></span><br><span class="line">MySQL5.6[(none)]&gt;show variables like <span class="string">&#x27;binlog_format&#x27;</span>;</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| binlog_format | STATEMENT |</span><br><span class="line">+---------------+-----------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#mysql5.7</span></span><br><span class="line">mysql&gt; show variables like <span class="string">&#x27;binlog_format&#x27;</span>;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| binlog_format | ROW |</span><br><span class="line">+---------------+-------+</span><br></pre></td></tr></table></figure><h3 id="statement模式和row模式的区别"><a href="#statement模式和row模式的区别" class="headerlink" title="statement模式和row模式的区别"></a>statement模式和row模式的区别</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## mysql5.6</span></span><br><span class="line">MySQL5.6[(none)]&gt;create database test_binlog;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MySQL5.6[(none)]&gt;use test_binlog</span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line">MySQL5.6[test_binlog]&gt;show tables;</span><br><span class="line">Empty <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">MySQL5.6[test_binlog]&gt;create table test_bin(<span class="built_in">id</span> int);</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">MySQL5.6[test_binlog]&gt;insert into test_bin values(1);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MySQL5.6[test_binlog]&gt;commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#查找位置</span></span><br><span class="line"><span class="built_in">cd</span> /app/mysql/data</span><br><span class="line">mysql-bin.000001</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看二进制日志的工具--mysqlbinlog</span></span><br><span class="line">mysqlbinlog mysql-bin.000001</span><br><span class="line"></span><br><span class="line"><span class="comment">## mysql5.7</span></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 区别：</span></span><br><span class="line">语句模式：只记录执行的SQL语句</span><br><span class="line">- 优点：</span><br><span class="line">- 通俗易懂</span><br><span class="line">- 占用磁盘空间小</span><br><span class="line">- 缺点：</span><br><span class="line">- 不严谨</span><br><span class="line">行级模式：记录执行的SQL语句，并且还要记录变化过程</span><br><span class="line">- 缺点：</span><br><span class="line">- 不易读</span><br><span class="line">- 占用磁盘空间大</span><br><span class="line">- 优点：</span><br><span class="line">- 严谨</span><br><span class="line"></span><br><span class="line"><span class="comment">#行级模式查看</span></span><br><span class="line">mysqlbinlog --base64-output=decode-rows -vvv /var/lib/mysql/mysql-bin.000001</span><br><span class="line"></span><br><span class="line"><span class="comment">#decode-rows：二进制解码</span></span><br><span class="line"><span class="comment">#-vvv显示详细过程</span></span><br></pre></td></tr></table></figure><h3 id="二进制日志的操作"><a href="#二进制日志的操作" class="headerlink" title="二进制日志的操作"></a>二进制日志的操作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看当前二进制日志</span></span><br><span class="line">mysql&gt; show binary logs;</span><br><span class="line">+------------------+-----------+</span><br><span class="line">| Log_name | File_size |</span><br><span class="line">+------------------+-----------+</span><br><span class="line">| mysql-bin.000001 | 789 |</span><br><span class="line">+------------------+-----------+</span><br><span class="line"><span class="comment">#查看二进制日志的位置点</span></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看指定binlog的事件</span></span><br><span class="line">mysql&gt; show binlog events <span class="keyword">in</span> <span class="string">&#x27;mysql-bin.000001&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="事件介绍"><a href="#事件介绍" class="headerlink" title="事件介绍"></a>事件介绍</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#概念</span></span><br><span class="line">1）在binlog中最小的记录单元为event</span><br><span class="line">2）一个事务会被拆分成多个事件（event）</span><br><span class="line"></span><br><span class="line"><span class="comment">#事件特性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## mysql5.6</span></span><br><span class="line">1）每个event都有一个开始位置（start position）和结束位置（stop</span><br><span class="line">position）。</span><br><span class="line">2）所谓的位置就是event对整个二进制的文件的相对位置。</span><br><span class="line">3）对于一个二进制日志中，前120个position是文件格式信息预留空间。</span><br><span class="line">4）MySQL第一个记录的事件，都是从120开始的。</span><br><span class="line"></span><br><span class="line"><span class="comment">## mysql5.7</span></span><br><span class="line">1）每个event都有一个开始位置（start position）和结束位置（stop</span><br><span class="line">position）。</span><br><span class="line">2）所谓的位置就是event对整个二进制的文件的相对位置。</span><br><span class="line">3）对于一个二进制日志中，前154个position是文件格式信息预留空间。</span><br><span class="line">4）MySQL第一个记录的事件，都是从154开始的。</span><br></pre></td></tr></table></figure><h3 id="使用二进制日志恢复数据"><a href="#使用二进制日志恢复数据" class="headerlink" title="使用二进制日志恢复数据"></a>使用二进制日志恢复数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.查看binlog内容</span></span><br><span class="line">mysqlbinlog --base64-output=decode-rows -vvv /var/lib/mysql/mysql-bin.000002</span><br><span class="line"></span><br><span class="line"><span class="comment"># at 1569</span></span><br><span class="line"><span class="comment">#230414 10:00:23 server id 1 end_log_pos 1614 CRC32 0xa634b644</span></span><br><span class="line">Delete_rows: table <span class="built_in">id</span> 111 flags: STMT_END_F</span><br><span class="line"><span class="comment">### DELETE FROM `binlog`.`binlog`</span></span><br><span class="line"><span class="comment">### WHERE</span></span><br><span class="line"><span class="comment">### @1=3 /* INT meta=0 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">### DELETE FROM `binlog`.`binlog`</span></span><br><span class="line"><span class="comment">### WHERE</span></span><br><span class="line"><span class="comment">### @1=3 /* INT meta=0 nullable=1 is_null=0 */</span></span><br><span class="line"></span><br><span class="line">起始位置点：154</span><br><span class="line">结束位置点：1444</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.截取binlog</span></span><br><span class="line">mysqlbinlog --start-position=154 --stop-position=1444 /var/lib/mysql/mysql-bin.000002 &gt; /tmp/binlog.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.先临时关闭记录binlog</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> sql_log_bin=0;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.恢复数据</span></span><br><span class="line">mysql&gt; <span class="built_in">source</span> /tmp/binlog.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.开启记录binlog</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> sql_log_bin=1;</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看恢复数据</span></span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from binlog;</span><br></pre></td></tr></table></figure><h3 id="binlog存在问题"><a href="#binlog存在问题" class="headerlink" title="binlog存在问题"></a>binlog存在问题</h3><p>1.恢复成本很高</p><p>数据库或表被误删除的是很久之前创建的（一年前）</p><p>解决方案：配合全备</p><p>binlog只当成是增量备份</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找binlog中的内容两种方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## statement语句模式</span></span><br><span class="line">mysqlbinlog /var/lib/mysql/xxx.000001</span><br><span class="line"></span><br><span class="line"><span class="comment">## row行级模式</span></span><br><span class="line">mysqlbinlog --base64-output=decode-rows -vvv /var/lib/mysql/xxx.000001</span><br><span class="line"></span><br><span class="line"><span class="comment">## 进入数据库查看binlog事件找Query</span></span><br><span class="line">mysql&gt; show binlog events <span class="keyword">in</span> <span class="string">&#x27;mysql-bin.000002&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#模糊查找，查找上下5行</span></span><br><span class="line">mysql&gt; show binlog events <span class="keyword">in</span> <span class="string">&#x27;mysql-bin.000002&#x27;</span>|grep -i delect -C 5</span><br><span class="line"></span><br><span class="line"><span class="comment">#刷新binlog，结束上一个位置点从新的位置点开始</span></span><br><span class="line">mysql&gt; flush logs;</span><br></pre></td></tr></table></figure><p>2.如果只想恢复某一个库的数据</p><p>过滤数据，不能使用’grep’</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-d <span class="string">&#x27;库名&#x27;</span></span><br><span class="line"></span><br><span class="line">mysqlbinlog --start-position=154 --stop-position=1779 -d <span class="string">&#x27;db1&#x27;</span> /var/lib/mysql/mysql-bin.000003 &gt;/tmp/db1.sql</span><br><span class="line"></span><br><span class="line">起始位置点：154</span><br><span class="line">结束位置点：1779</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="built_in">set</span> sql_log_bin=0;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="built_in">source</span> /tmp/db1.sql</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="built_in">set</span> sql_log_bin=1;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#全备把所有数据库备份出来</span></span><br><span class="line">mysqldump -A /tmp/full.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">#全备完之后用户还会往之前的库写入数据,新增数据</span></span><br><span class="line">insert into db2.tb2 values(6)</span><br><span class="line">insert into db1.tb1 values(7)</span><br><span class="line"></span><br><span class="line"><span class="comment">#准备的新环境恢复数据</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> sql_log_bin=0;</span><br><span class="line"><span class="built_in">source</span> /tmp/full.sql</span><br><span class="line"><span class="built_in">set</span> sql_log_bin=1;</span><br><span class="line"><span class="comment">#先把全备数据恢复再加上binlog日志里的增量备份，恢复增量的时候要停数据库</span></span><br></pre></td></tr></table></figure><h3 id="binlog刷新机制"><a href="#binlog刷新机制" class="headerlink" title="binlog刷新机制"></a>binlog刷新机制</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 自动刷新</span></span><br><span class="line"><span class="comment"># 1.重启MySQL之后会刷新</span></span><br><span class="line"><span class="comment"># 2.当binlog大小达到1G的时候，会自动刷新，binlog最大是一个G</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 手动刷新</span></span><br><span class="line"><span class="comment"># 1.mysqladmin -uroot -p123@qqdianCOM flush-log</span></span><br><span class="line"><span class="comment"># 2.mysql&gt; flush logs;</span></span><br><span class="line"><span class="comment"># 3.做备份时，可以加刷新binlog的参数</span></span><br><span class="line">mysqldump -F</span><br><span class="line">mysqldump -A -F &gt; /tmp/full2.spl</span><br><span class="line"></span><br><span class="line"><span class="comment">#-F存在问题</span></span><br><span class="line">备份了几个库就会多刷新出几个库出来</span><br><span class="line"></span><br><span class="line"><span class="comment">#-B指定备份库,备份出两个库</span></span><br><span class="line">mysqladmin -uroot -p123@qqdianCOM -B jiaoyi binlog &gt; /tmp/4.sql</span><br></pre></td></tr></table></figure><h3 id="binlog删除"><a href="#binlog删除" class="headerlink" title="binlog删除"></a>binlog删除</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.根据时间删除（删除7天之前的binlog日志）</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global expire_logs_days = 7;</span><br><span class="line"></span><br><span class="line"><span class="comment">#永久删除</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">expire_logs_days = 7</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.使用purge命令按时间删除</span></span><br><span class="line"><span class="comment">#删除7天之前的binlog日志</span></span><br><span class="line">purge binary logs before now() - interval 7 day;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.使用purge命令根据文件名删除（推荐）</span></span><br><span class="line"><span class="comment">#把名字是10之前的binlog全部删除</span></span><br><span class="line">purge binary logs to <span class="string">&#x27;mysql-bin.000010&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.重置binlog(全部删除)</span></span><br><span class="line">mysql&gt; reset master;</span><br></pre></td></tr></table></figure><p>注意：因为binlog存在问题，所以需要结合mysqldump全备恢复数据，binlog对于我们来说，只能当增量数据</p><p>脚本模拟用户往数据库写入数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">mysql -uroot -p123 -e <span class="string">&#x27;drop database zls;&#x27;</span></span><br><span class="line">mysql -uroot -p123 -e <span class="string">&#x27;create database if not exists zls;&#x27;</span></span><br><span class="line">mysql -uroot -p123 -e <span class="string">&#x27;use zls;create table if not exists zls1(id int);&#x27;</span></span><br><span class="line">num=0</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">  ((num ++))</span><br><span class="line">  mysql -uroot -p123 -e <span class="string">&quot;insert into zls.zls1 values(<span class="variable">$num</span>);&quot;</span></span><br><span class="line">  <span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>模拟mysql备份和恢复数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">select</span> * from qqq.abc;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span> |</span><br><span class="line">+------+</span><br><span class="line">| 1 |</span><br><span class="line">| 2 |</span><br><span class="line">| 3 |</span><br><span class="line">| 4 |</span><br><span class="line">| 5 |</span><br><span class="line">+------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from zls.a1;;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span> |</span><br><span class="line">+------+</span><br><span class="line">| 1 |</span><br><span class="line">| 2 |</span><br><span class="line">| 3 |</span><br><span class="line">| 4 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">DML</span><br><span class="line">DML</span><br><span class="line">DML</span><br><span class="line">drop table</span><br><span class="line">DML</span><br><span class="line">DML</span><br><span class="line">DML</span><br><span class="line">drop table</span><br><span class="line">DML</span><br><span class="line">DML</span><br><span class="line"></span><br><span class="line">mysqlbinlog --base64-output=decode-rows -vvv mysql-bin.000008 |grep create -C 10</span><br><span class="line"><span class="comment">#起始位置点：52937</span></span><br><span class="line">mysqlbinlog --base64-output=decode-rows -vvv mysql-bin.000008 |grep DROP -C 10</span><br><span class="line"><span class="comment">#结束位置点：94765</span></span><br><span class="line"></span><br><span class="line">mysqlbinlog --base64-output=decode-rows -vvv mysql-bin.000008 |grep DROP -C 10</span><br><span class="line"><span class="comment">#起始位置点：94882</span></span><br><span class="line">mysqlbinlog --base64-output=decode-rows -vvv mysql-bin.000008 |grep DROP -C 10</span><br><span class="line"><span class="comment">#结束位置点：98697</span></span><br><span class="line"></span><br><span class="line">mysqlbinlog --base64-output=decode-rows -vvv mysql-bin.000008 |grep DROP -C 10</span><br><span class="line"><span class="comment">#起始位置点：98813</span></span><br><span class="line">mysqlbinlog --base64-output=decode-rows -vvv mysql-bin.000008 |<span class="built_in">tail</span></span><br><span class="line"><span class="comment">#结束位置点：136313</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 截取binlog</span></span><br><span class="line">mysqlbinlog --start-position=52937 --stop-position=94765 mysql-bin.000001 &gt; /tmp/1.sql</span><br><span class="line">mysqlbinlog --start-position=94882 --stop-position=98697 mysql-bin.000001 &gt; /tmp/2.sql</span><br><span class="line">mysqlbinlog --start-position=98813 --stop-position=136313 mysql-bin.000001 &gt; /tmp/3.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">## 恢复数据之前，关闭binlog记录</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> sql_log_bin=0;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 恢复数据</span></span><br><span class="line">mysql&gt; <span class="built_in">source</span> /tmp/1.sql</span><br><span class="line">mysql&gt; <span class="built_in">source</span> /tmp/2.sql</span><br><span class="line">mysql&gt; <span class="built_in">source</span> /tmp/3.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">#注意：因为binlog存在问题，结合mysqldump全备恢复数据，binlog对于我们来说，只能当增量数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#解决方案：MySQL全备 + binlog增量备份</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Mysql数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL的主从复制(13)</title>
      <link href="/2022/10/17/MySQL/Day13MySQL%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/"/>
      <url>/2022/10/17/MySQL/Day13MySQL%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="MySQL主从复制"><a href="#MySQL主从复制" class="headerlink" title="MySQL主从复制"></a>MySQL主从复制</h1><h2 id="企业级增量恢复实战"><a href="#企业级增量恢复实战" class="headerlink" title="企业级增量恢复实战"></a>企业级增量恢复实战</h2><p>背景：</p><p>某大型网站，mysql数据库，数据量500G，每日更新量100M-200M</p><p>备份策略：</p><p>xtrabackup，每周六0:00进行全备，周一到周五及周日00:00进行增量备份。</p><p>故障场景：</p><p>周三下午2点出现数据库意外删除表操作。</p><p>周三晚上00点-下午14点增量数据在binlog里</p><p>模拟数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先把写入用户脚本执行</span></span><br><span class="line">mysql&gt; create database xtra;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use xtra</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; create table xtra(<span class="built_in">id</span> int);</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into xtra values(1);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">mysql&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 周六00点全备</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --no-timestamp /data/full</span></span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /data/full/xtrabackup_checkpoints</span></span><br><span class="line">backup_type = full-backuped</span><br><span class="line">from_lsn = 0</span><br><span class="line">to_lsn = 3525838629</span><br><span class="line">last_lsn = 3525840746</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into xtra.xtra values(2),(3);</span><br><span class="line">Query OK, 2 rows affected (0.00 sec)</span><br><span class="line">mysql&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; update xtra.xtra <span class="built_in">set</span> <span class="built_in">id</span>=10 <span class="built_in">where</span> <span class="built_in">id</span>=3;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1 Changed: 1 Warnings: 0</span><br><span class="line">mysql&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from xtra.xtra;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span> |</span><br><span class="line">+------+</span><br><span class="line">| 1 |</span><br><span class="line">| 2 |</span><br><span class="line">| 10 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 周日00点第一次增备</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --no-timestamp --incremental --incremental-basedir=/data/full /data/inc1</span></span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /data/inc1/xtrabackup_checkpoints</span></span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3525838629</span><br><span class="line">to_lsn = 3525903354</span><br><span class="line">last_lsn = 3525909277</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into xtra.xtra values(4),(5),(6);</span><br><span class="line">Query OK, 3 rows affected (0.01 sec)</span><br><span class="line">Records: 3 Duplicates: 0 Warnings: 0</span><br><span class="line">mysql&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from xtra.xtra;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span> |</span><br><span class="line">+------+</span><br><span class="line">| 1 |</span><br><span class="line">| 2 |</span><br><span class="line">| 10 |</span><br><span class="line">| 4 |</span><br><span class="line">| 5 |</span><br><span class="line">| 6 |</span><br><span class="line"></span><br><span class="line"><span class="comment"># 周一00点第二次增备</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --no-timestamp --incremental --incremental-basedir=/data/inc1 /data/inc2</span></span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /data/inc2/xtrabackup_checkpoints</span></span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3525903354</span><br><span class="line">to_lsn = 3525940864</span><br><span class="line">last_lsn = 3525942674</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line">mysql&gt; delete from xtra.xtra <span class="built_in">where</span> <span class="built_in">id</span>=10;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">mysql&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from xtra.xtra;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span> |</span><br><span class="line">+------+</span><br><span class="line">| 1 |</span><br><span class="line">| 2 |</span><br><span class="line">| 4 |</span><br><span class="line">| 5 |</span><br><span class="line">| 6 |</span><br><span class="line">+------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 周二00点第三次增备</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --no-timestamp --incremental --incremental-basedir=/data/inc2 /data/inc3</span></span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /data/inc3/xtrabackup_checkpoints</span></span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3525940864</span><br><span class="line">to_lsn = 3525954082</span><br><span class="line">last_lsn = 3525967554</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into xtra.xtra values(7);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">mysql&gt; commit;</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from xtra.xtra;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span> |</span><br><span class="line">+------+</span><br><span class="line">| 1 |</span><br><span class="line">| 2 |</span><br><span class="line">| 4 |</span><br><span class="line">| 5 |</span><br><span class="line">| 6 |</span><br><span class="line">| 7 |</span><br><span class="line">+------+</span><br><span class="line">6 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 周三00点第四次增备</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --no-timestamp --incremental --incremental-basedir=/data/inc3 /data/inc4</span></span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /data/inc4/xtrabackup_checkpoints</span></span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3525954082</span><br><span class="line">to_lsn = 3526033079</span><br><span class="line">last_lsn = 3526035781</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 周三下午14点删除表</span></span><br><span class="line">mysql&gt; drop table xtra.xtra;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure><p>恢复步骤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.准备新环境（配置文件一定要统一）</span></span><br><span class="line">[root@db03 ~]<span class="comment"># /etc/init.d/mysqld57 stop</span></span><br><span class="line">[root@db03 ~]<span class="comment"># rm -fr /app/mysql/data</span></span><br><span class="line">[root@db03 bin]<span class="comment"># ./mysqld --initialize-insecure --user=mysql --basedir=/app/mysql --datadir=/app/mysql/data</span></span><br><span class="line"></span><br><span class="line">[root@db03 bin]<span class="comment"># /etc/init.d/mysqld57 start</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.将旧库的增量备份合并到全备中</span></span><br><span class="line">1）将全备模拟CSR，只做redo不做undo</span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log --redo-only /data/full</span></span><br><span class="line"></span><br><span class="line">2）将inc1合并到full中，只做redo不做undo</span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log --redo-only --incremental-dir=/data/inc1 /data/full</span></span><br><span class="line"></span><br><span class="line">3）将inc2合并到full中，只做redo不做undo</span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log --redo-only --incremental-dir=/data/inc2 /data/full</span></span><br><span class="line"></span><br><span class="line">4）将inc3合并到full中，只做redo不做undo</span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log --redo-only --incremental-dir=/data/inc3 /data/full</span></span><br><span class="line"></span><br><span class="line">5）将inc4合并到full中，redo和undo都做</span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log --incremental-dir=/data/inc4 /data/full</span></span><br><span class="line"></span><br><span class="line">6）将全备整体模拟一遍CSR，redo和undo都做</span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log /data/full</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.将合并好的全备目录，发送到新环境</span></span><br><span class="line">[root@db01 ~]<span class="comment"># scp -r /data/full/ 172.16.1.53:/opt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.新环境停库并清空data目录</span></span><br><span class="line">[root@db03 bin]<span class="comment"># /etc/init.d/mysqld57 stop</span></span><br><span class="line">[root@db03 bin]<span class="comment"># rm -fr /app/mysql/data</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.新环境恢复全备数据</span></span><br><span class="line">[root@db03 bin]<span class="comment"># innobackupex --copy-back /opt/full</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.授权</span></span><br><span class="line">[root@db03 bin]<span class="comment"># chown -R mysql.mysql /app/mysql*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.启动新环境数据库</span></span><br><span class="line">[root@db03 data]<span class="comment"># /etc/init.d/mysqld57 start</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.找binlog的起始位置点</span></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /data/full/xtrabackup_binlog_info</span></span><br><span class="line">mysql-bin.000001 193508</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.停止所有连接数据库的程序</span></span><br><span class="line">systemctl stop nginx php-fpm tomcat ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.停止数据库</span></span><br><span class="line">[root@db01 ~]<span class="comment"># systemctl stop mysqld</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 11.找binlog的结束位置点</span></span><br><span class="line">[root@db01 ~]<span class="comment"># mysqlbinlog --base64-output=decode-rows -vvv /var/lib/mysql/mysql-bin.000001 |grep DROP -C 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 12.找binlog起始位置点</span></span><br><span class="line">[root@db01 ~]<span class="comment"># mysqlbinlog --base64-output=decode-rows -vvv /var/lib/mysql/mysql-bin.000001 |grep DROP -C 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 13.找binlog的结束位置点</span></span><br><span class="line">[root@db01 ~]<span class="comment"># mysqlbinlog --base64-output=decode-rows -vvv /var/lib/mysql/mysql-bin.000001 |tail</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 第一段binlog的起始位置点和结束位置点</span></span><br><span class="line">起始位置点：193508</span><br><span class="line">结束位置点：208073</span><br><span class="line"></span><br><span class="line"><span class="comment">### 第二段binlog的起始位置点和结束位置点</span></span><br><span class="line">起始位置点：208193</span><br><span class="line">结束位置点：444966</span><br><span class="line"></span><br><span class="line"><span class="comment"># 14.截取binlog</span></span><br><span class="line">[root@db01 ~]<span class="comment"># mysqlbinlog --start-position=193508 --stop-position=208073 /var/lib/mysql/mysql-bin.000001 &gt; /tmp/new1.sql</span></span><br><span class="line">[root@db01 ~]<span class="comment"># mysqlbinlog --start-position=208193 --stop-position=444966 /var/lib/mysql/mysql-bin.000001 &gt; /tmp/new2.sql</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 15.发送到新环境</span></span><br><span class="line">[root@db01 ~]<span class="comment"># scp /tmp/new* 172.16.1.53:/tmp</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 16.将新增数据恢复到新环境</span></span><br><span class="line">[root@db03 data]<span class="comment"># mysql &lt; /tmp/new1.sql</span></span><br><span class="line">[root@db03 data]<span class="comment"># mysql &lt; /tmp/new2.sql</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 业务恢复：</span></span><br><span class="line">- 应用割接</span><br><span class="line">1）开发改代码</span><br><span class="line">2）运维代码上线</span><br><span class="line">- 全备导出</span><br><span class="line">[root@db03 data]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM /zls/full</span></span><br><span class="line"></span><br><span class="line">[root@db03 data]<span class="comment"># scp -r /zls/full/2023-04-19_09-08-58 172.16.1.51:/tmp</span></span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># rm -fr /var/lib/mysql</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log /tmp/2023-04-19_09-08-58</span></span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --copy-back /tmp/2023-04-19_09-08-58</span></span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># chown -R mysql.mysql /var/lib/mysql</span></span><br><span class="line">[root@db01 ~]<span class="comment"># systemctl start mysqld</span></span><br></pre></td></tr></table></figure><h2 id="主从复制简介"><a href="#主从复制简介" class="headerlink" title="主从复制简介"></a>主从复制简介</h2><p>1)高可用</p><p>2）辅助备份</p><p>3）分担负载</p><p>复制是MysQL的一项功能，允许服务器将更改从一个实例复制到另一个实例.</p><p>1）主服务器将所有数据和结构更改记录到二进制日志中。</p><p>2）从属服务器从主服务器请求该二进制日志并在本地应用其内容。 </p><p>3）IO：请求主库，获取上一次执行过的新的事件，并存放到relaylog </p><p>4）SQL：从relaylog中将sql语句翻译给从库执行</p><h2 id="主从复制原理"><a href="#主从复制原理" class="headerlink" title="主从复制原理"></a>主从复制原理</h2><p>主从复制的前提</p><p>1）两台或两台以上的数据库实例 </p><p>2）主库要开启二进制日志 </p><p>3）主库要有复制用户 </p><p>4）主库的server_id和从库不同 </p><p>5）从库需要在开启复制功能前，要获取到主库之前的数据（主库备份，并且记录binlog当时位置） </p><p>6）从库在第一次开启主从复制时，时必须获知主库：ip，port，user，password，logfile，pos</p><p>IP：10.0.0.51 </p><p>Port：3306 </p><p>User：rep </p><p>Password：123 </p><p>logFile：mysql-bin.000002 </p><p>Pos：120</p><p>7）从库要开启相关线程：IO、SQL </p><p>8）从库需要记录复制相关用户信息，还应该记录到上次已经从主库请求到哪个二进制日志 </p><p>9）从库请求过来的binlog，首先要存下来，并且执行binlog，执行过的信息保存下来</p><h2 id="主从复制的工作原理"><a href="#主从复制的工作原理" class="headerlink" title="主从复制的工作原理"></a>主从复制的工作原理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#############简单搭建主从复制</span></span><br><span class="line"><span class="comment">## 主库配置文件</span></span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">server_id=1 // 标识符，区分主库和从库的角色</span><br><span class="line"></span><br><span class="line"><span class="comment">## 主库创建主从复制用户</span></span><br><span class="line"></span><br><span class="line">mysql&gt; grant replication slave on *.* to rep@<span class="string">&#x27;172.16.1.%&#x27;</span> identified by <span class="string">&#x27;123@qqdianCOM&#x27;</span>;</span><br><span class="line"><span class="comment">## 从库配置文件</span></span><br><span class="line">server_id=2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 总结：</span></span><br><span class="line">1.主库要开启binlog，从库不需要开启binlog</span><br><span class="line">2.主库要创建主从复制用户，从库不需要创建主从复制用户</span><br><span class="line">3.主库要设置server_id，从库也要设置server_id，从库的server_id要跟主库不同，从库之间是可以相同的</span><br><span class="line"></span><br><span class="line"><span class="comment">## 记录主库上的binlog名字和位置点</span></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+------------------+----------+</span><br><span class="line">| File | Position |</span><br><span class="line">+------------------+----------+</span><br><span class="line">| mysql-bin.000001 | 445 |</span><br><span class="line">+------------------+----------+</span><br><span class="line"></span><br><span class="line"><span class="comment">## 从库执行change master</span></span><br><span class="line">mysql&gt; change master to master_user=<span class="string">&#x27;rep&#x27;</span>,master_password=<span class="string">&#x27;123@qqdianCOM&#x27;</span>,master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,master_log_file=<span class="string">&#x27;mysql-bin.000001&#x27;</span>,master_log_pos=445;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 开启主从复制</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看状态</span></span><br><span class="line">show slave status\G</span><br></pre></td></tr></table></figure><h3 id="主从复制涉及3线程4文件"><a href="#主从复制涉及3线程4文件" class="headerlink" title="主从复制涉及3线程4文件"></a>主从复制涉及3线程4文件</h3><p>从库:</p><ul><li>IO线程</li><li>SQL线程</li><li>master.info</li><li>relay-log.info</li><li>db03-relay-bin.000004</li></ul><p>主库:</p><ul><li>dump线程</li><li>mysql-bin.000001</li></ul><p>![img](file:&#x2F;&#x2F;&#x2F;C:\Users\李琪\Documents\Tencent Files\3262466967\Image\Group2\IV\B0\IVB01M}V82W2OR3AL3~V{CO.png)</p><p>注意：做主从复制之前，一定要保证两台数据库的数据是一致的</p><p>1）通过change master to语句告诉从库主库的ip，port，user，password，file，pos</p><p>2）从库通过start slave命令开启复制必要的IO线程和SQL线程</p><p>3）从库通过IO线程拿着change master to用户密码相关信息，连接主库，验证合法性</p><p>4）从库连接成功后，会根据binlog的pos问主库，有没有比这个更新的</p><p>5）主库接收到从库请求后，比较一下binlog信息，如果有就将最新数据通过dump线程给从</p><p>库IO线程</p><p>6）从库通过IO线程接收到主库发来的binlog事件，存储到TCP&#x2F;IP缓存中，并返回ACK更新</p><p>master.info</p><p>7）将TCP&#x2F;IP缓存中的内容存到relay-log中</p><p>8）SQL线程读取relay-log.info，读取到上次已经执行过的relay-log位置点，继续执行后续</p><p>的relay-log日志，执行完成后，更新relay-log.info</p><h2 id="生产环境搭建主从复制"><a href="#生产环境搭建主从复制" class="headerlink" title="生产环境搭建主从复制"></a>生产环境搭建主从复制</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ######################两个新的数据库搭建主从</span></span><br><span class="line"><span class="comment">## 主库操作</span></span><br><span class="line"><span class="comment"># 2.主库开启binlog和server_id</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">server_id=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.主库上创建主从复制用户</span></span><br><span class="line">grant replication slave on *.* to slave@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.主库查看binlog名字和位置点</span></span><br><span class="line">show master status;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 从库操作</span></span><br><span class="line"><span class="comment"># 1.开启server_id 和 主库不同</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id=2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.执行和主库建立连接的语句（change master to）</span></span><br><span class="line">change master to</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line">master_log_pos=154;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.开启主从复制</span></span><br><span class="line">start slave;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.查看从库状态</span></span><br><span class="line">show slave status\G</span><br><span class="line"></span><br><span class="line"><span class="comment">########################################### 生产环境搭建主从，数据库一直有用户写入，不能停止数据库</span></span><br><span class="line"><span class="comment">#从库准备个新环境</span></span><br><span class="line"><span class="comment">## 主库操作</span></span><br><span class="line"><span class="comment"># 2.主库开启binlog和server_id</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">server_id=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.主库上创建主从复制用户</span></span><br><span class="line">grant replication slave on *.* to rep@<span class="string">&#x27;172.16.1.%&#x27;</span> identified by</span><br><span class="line"><span class="string">&#x27;123@qqdianCOM&#x27;</span>;</span><br><span class="line"><span class="comment"># 4.做打点全备</span></span><br><span class="line">mysqldump -uroot -p123@qqdianCOM -A -R --triggers --master-data=1 --single-transaction &gt; /tmp/master.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.发送到新从库</span></span><br><span class="line">scp /tmp/master.sql 172.16.1.53:/tmp/</span><br><span class="line"></span><br><span class="line"><span class="comment">## 从库操作</span></span><br><span class="line"><span class="comment"># 1.开启server_id 和 主库不同</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id=2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.恢复全备到新从库</span></span><br><span class="line">[root@db03 bin]<span class="comment"># mysql -uroot -p &lt; /tmp/master.sql</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.查看打点位置和binlog</span></span><br><span class="line">[root@db03 bin]<span class="comment"># head -25 /tmp/master.sql</span></span><br><span class="line"></span><br><span class="line">CHANGE MASTER TO MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line">MASTER_LOG_POS=125337;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.执行和主库建立连接的语句（change master to）</span></span><br><span class="line">change master to</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123@qqdianCOM&#x27;</span>,</span><br><span class="line"></span><br><span class="line">master_port=3306,      //端口</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line">master_log_pos=125337;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.开启主从复制</span></span><br><span class="line">start slave;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.查看从库状态</span></span><br><span class="line">show slave status\G</span><br></pre></td></tr></table></figure><h2 id="MySQL主从复制基本故障"><a href="#MySQL主从复制基本故障" class="headerlink" title="MySQL主从复制基本故障"></a>MySQL主从复制基本故障</h2><h3 id="从库IO线程故障"><a href="#从库IO线程故障" class="headerlink" title="从库IO线程故障"></a>从库IO线程故障</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#手动关闭sql线程</span></span><br><span class="line">stop slave sql_thread;</span><br><span class="line">查看存放位置中继日志，停掉sql线程不影响io线程去拿数据</span><br><span class="line">mysqlbinlog --base64-output=decode-rows -vvv db04-relay-bin.000008</span><br><span class="line"></span><br><span class="line">1.IP不通</span><br><span class="line">ping</span><br><span class="line"></span><br><span class="line">2.端口不通</span><br><span class="line">telnet</span><br><span class="line"></span><br><span class="line">3.用户名密码问题</span><br><span class="line">在从库上使用主从复制用户连接一下</span><br><span class="line">mysql -urep -p123@qqdianCOM -h172.16.1.51</span><br><span class="line"></span><br><span class="line">4.server_id相同</span><br><span class="line"></span><br><span class="line">5.uuid相同（克隆,拷贝mysql）</span><br><span class="line"><span class="built_in">cat</span> /app/mysql/data/auto.cnf</span><br><span class="line"></span><br><span class="line">6.binlog不对也不行</span><br><span class="line">mysql-bin.000002</span><br></pre></td></tr></table></figure><h3 id="从库SQL线程故障"><a href="#从库SQL线程故障" class="headerlink" title="从库SQL线程故障"></a>从库SQL线程故障</h3><ul><li>主库有从库没有的数据</li><li>主库没有从库有的数据</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#做完主从复制，从库不能往里面写入数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法一：</span></span><br><span class="line"><span class="comment">#临时停止同步</span></span><br><span class="line">mysql&gt; stop slave;</span><br><span class="line"><span class="comment">#将同步指针向下移动一个（可重复操作）</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global sql_slave_skip_counter=1;</span><br><span class="line"><span class="comment">#开启同步</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 方法二：</span></span><br><span class="line"><span class="comment">#编辑配置文件</span></span><br><span class="line">[root@db01 ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line"><span class="comment">#在[mysqld]标签下添加以下参数</span></span><br><span class="line">slave-skip-errors=1032,1062,1007</span><br></pre></td></tr></table></figure><p>但是以上操作都是有风险存在的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">1）重新备份数据库，恢复到从库</span><br><span class="line">2）给从库设置为只读</span><br><span class="line"></span><br><span class="line"><span class="comment">#在命令行临时设置</span></span><br><span class="line"><span class="built_in">set</span> global read_only=1;</span><br><span class="line"><span class="comment">#在配置文件中永久生效</span></span><br><span class="line">read_only=1</span><br><span class="line"></span><br><span class="line"><span class="comment">#1.保证两个数据库的数据完全一致</span></span><br><span class="line"><span class="comment">#2.从库无法写入数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#从库设置只读权限，不能是root用户，只能是普通用户</span></span><br><span class="line">查看是否开启</span><br><span class="line">show variables like <span class="string">&#x27;read_only&#x27;</span>;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| read_only     | ON    |</span><br><span class="line">+---------------+-------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建普通用户</span></span><br><span class="line">grant <span class="keyword">select</span>,insert,update,delete on *.* to dev@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="comment">#没有写的权限</span></span><br><span class="line">mysql -udev -p123</span><br><span class="line">create database qwer;</span><br><span class="line">ERROR 1290 (HY000): The MySQL server is running with the --read-only option so it cannot execute this statement</span><br></pre></td></tr></table></figure><h2 id="延迟从库"><a href="#延迟从库" class="headerlink" title="延迟从库"></a>延迟从库</h2><p>优点：</p><ul><li>可以备份，恢复数据</li><li>安全性高</li></ul><p>缺点：</p><ul><li>延时从库不能对外提供服务</li><li>浪费资源</li></ul><h3 id="部署延时从库"><a href="#部署延时从库" class="headerlink" title="部署延时从库"></a>部署延时从库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">############# 没有做过主从复制的从库</span></span><br><span class="line"><span class="comment">## 查看主库的binlog名字和位置点</span></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+------------------+----------+</span><br><span class="line">| File | Position |</span><br><span class="line">+------------------+----------+</span><br><span class="line">| mysql-bin.000002 | 310 |</span><br><span class="line">+------------------+----------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#从库操作</span></span><br><span class="line">change master to</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123@qqdianCOM&#x27;</span>,</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000002&#x27;</span>,</span><br><span class="line">master_log_pos=310,</span><br><span class="line">master_delay=180;       <span class="comment">#延时180秒</span></span><br><span class="line"></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line">show slave status;</span><br><span class="line">SQL_Delay:180</span><br><span class="line"></span><br><span class="line"><span class="comment">############# 做过主从复制的从库</span></span><br><span class="line"><span class="comment">## 取消数据库的从库身份</span></span><br><span class="line">mysql&gt; stop slave;</span><br><span class="line"></span><br><span class="line">mysql&gt; reset slave;</span><br><span class="line"></span><br><span class="line">mysql&gt; change master to master_delay=180;</span><br><span class="line"></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"></span><br><span class="line"><span class="comment">### 取消延时从库身份</span></span><br><span class="line">mysql&gt; stop slave;</span><br><span class="line"></span><br><span class="line">mysql&gt; change master to master_delay=0;</span><br><span class="line"></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"></span><br><span class="line"><span class="comment">### 取消从库身份的两种方式</span></span><br><span class="line">mysql&gt; reset slave all; <span class="comment">#重置信息</span></span><br><span class="line">mysql&gt; reset slave;</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看IO线程文件存放数据</span></span><br><span class="line">mysqlbinlog --base64-output=decode-rows -vvv db04-relay-bin.000008</span><br><span class="line"><span class="comment">#查看SQL线程文件</span></span><br><span class="line"><span class="built_in">cat</span> relay_log.info</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112509167.png" alt="image-20230518112509167"></p><h2 id="MySQl半同步复制"><a href="#MySQl半同步复制" class="headerlink" title="MySQl半同步复制"></a>MySQl半同步复制</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112525184.png" alt="image-20230518112525184"></p><p>从MYSQL5.5开始，支持半自动复制。之前版本的MySQL Replication都是异步<br>（asynchronous）的，主库在执行完一些事务后，是不会管备库的进度的。如果备库不幸<br>落后，而更不幸的是主库此时又出现Crash（例如宕机），这时备库中的数据就是不完整<br>的。简而言之，在主库发生故障的时候，我们无法使用备库来继续提供数据一致的服务了。</p><p>半同步复制（Semi synchronous Replication）则一定程度上保证提交的事务已经传给了至<br>少一个备库。<br>出发点是保证主从数据一致性问题，安全的考虑。</p><p>5.5 出现概念，但是不建议使用，性能太差<br>5.6出现group commit 组提交功能，来提升开启半同步复制的性能<br>5.7更加完善了，在group commit基础上出现了MGR<br>5.7的增强半同步复制的新特性：after commit； after sync；</p><h3 id="开启半同步复制"><a href="#开启半同步复制" class="headerlink" title="开启半同步复制"></a>开启半同步复制</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.先查看是否动态支持半同步复制</span></span><br><span class="line">mysql&gt; show global variables like <span class="string">&#x27;have_dynamic_loading&#x27;</span>;</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| have_dynamic_loading | YES |</span><br><span class="line">+----------------------+-------+</span><br><span class="line"></span><br><span class="line"><span class="comment">## 主库安装半同步插件</span></span><br><span class="line">[root@db01 ~]<span class="comment"># ll /usr/lib64/mysql/plugin/</span></span><br><span class="line">-rwxr-xr-x 1 root root 937952 Dec 8 02:37 semisync_master.so</span><br><span class="line">-rwxr-xr-x 1 root root 160888 Dec 8 02:37 semisync_slave.so</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装插件</span></span><br><span class="line">mysql&gt; install plugin rpl_semi_sync_master</span><br><span class="line">soname<span class="string">&#x27;semisync_master.so&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动插件</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global rpl_semi_sync_master_enabled = 1;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置超时时间</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global rpl_semi_sync_master_timeout = 1000;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 永久开启和设置超时时间</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">rpl_semi_sync_master_enabled = 1</span><br><span class="line">rpl_semi_sync_master_timeout = 1000</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like<span class="string">&#x27;rpl%&#x27;</span>;</span><br><span class="line">+-------------------------------------------+------------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+-------------------------------------------+------------+</span><br><span class="line">| rpl_semi_sync_master_enabled | ON |</span><br><span class="line">| rpl_semi_sync_master_timeout | 1000 |</span><br><span class="line">| rpl_semi_sync_master_trace_level | 32 |</span><br><span class="line">| rpl_semi_sync_master_wait_for_slave_count | 1 |</span><br><span class="line">| rpl_semi_sync_master_wait_no_slave | ON |</span><br><span class="line">| rpl_semi_sync_master_wait_point | AFTER_SYNC |</span><br><span class="line">| rpl_stop_slave_timeout | 31536000 |</span><br><span class="line">+-------------------------------------------+------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; show global status like <span class="string">&#x27;rpl_semi%&#x27;</span>;</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Rpl_semi_sync_master_clients | 0 |</span><br><span class="line">| Rpl_semi_sync_master_net_avg_wait_time | 0 |</span><br><span class="line">| Rpl_semi_sync_master_net_wait_time | 0 |</span><br><span class="line">| Rpl_semi_sync_master_net_waits | 0 |</span><br><span class="line">| Rpl_semi_sync_master_no_times | 0 |</span><br><span class="line">| Rpl_semi_sync_master_no_tx | 0 |</span><br><span class="line">| Rpl_semi_sync_master_status | ON |</span><br><span class="line">| Rpl_semi_sync_master_timefunc_failures | 0 |</span><br><span class="line">| Rpl_semi_sync_master_tx_avg_wait_time | 0 |</span><br><span class="line">| Rpl_semi_sync_master_tx_wait_time | 0 |</span><br><span class="line">| Rpl_semi_sync_master_tx_waits | 0 |</span><br><span class="line">| Rpl_semi_sync_master_wait_pos_backtraverse | 0 |</span><br><span class="line">| Rpl_semi_sync_master_wait_sessions | 0 |</span><br><span class="line">| Rpl_semi_sync_master_yes_tx | 0 |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line"></span><br><span class="line"><span class="comment">## 半同步从库操作</span></span><br><span class="line"><span class="comment"># 安装从库插件</span></span><br><span class="line">mysql&gt; install plugin rpl_semi_sync_slave</span><br><span class="line">soname<span class="string">&#x27;semisync_slave.so&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启插件</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global rpl_semi_sync_slave_enabled = 1;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 永久开启插件</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">rpl_semi_sync_slave_enabled = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启IO线程，使其生效</span></span><br><span class="line">mysql&gt; stop slave io_thread;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; start slave io_thread;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show global status like <span class="string">&#x27;rpl_semi%&#x27;</span>;</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Rpl_semi_sync_master_clients | 1 |</span><br><span class="line">| Rpl_semi_sync_master_net_avg_wait_time | 0 |</span><br><span class="line">| Rpl_semi_sync_master_net_wait_time | 0 |</span><br><span class="line">| Rpl_semi_sync_master_net_waits | 0 |</span><br><span class="line">| Rpl_semi_sync_master_no_times | 0 |</span><br><span class="line">| Rpl_semi_sync_master_no_tx | 0 |</span><br><span class="line">| Rpl_semi_sync_master_status | ON |</span><br><span class="line">| Rpl_semi_sync_master_timefunc_failures | 0 |</span><br><span class="line">| Rpl_semi_sync_master_tx_avg_wait_time | 0 |</span><br><span class="line">| Rpl_semi_sync_master_tx_wait_time | 0 |</span><br><span class="line">| Rpl_semi_sync_master_tx_waits | 0 |</span><br><span class="line">| Rpl_semi_sync_master_wait_pos_backtraverse | 0 |</span><br><span class="line">| Rpl_semi_sync_master_wait_sessions | 0 |</span><br><span class="line">| Rpl_semi_sync_master_yes_tx | 0 |</span><br><span class="line">+--------------------------------------------+-------+</span><br></pre></td></tr></table></figure><p>rpl_semi_sync_master_timeout&#x3D;milliseconds<br>设置此参数值（ms）,为了防止半同步复制在没有收到确认的情况下发生堵塞，如果Master<br>在超时之前没有收到任何确认，将恢复到正常的异步复制，并继续执行没有半同步的复制操<br>作。</p><p>rpl_semi_sync_master_wait_no_slave&#x3D;{ON|OFF}<br>如果一个事务被提交,但Master没有任何Slave的连接，这时不可能将事务发送到其它地方保<br>护起来。默认情况下，Master会在时间限制范围内继续等待Slave的连接，并确认该事务已<br>经被正确的写到磁盘上。<br>可以使用此参数选项关闭这种行为，在这种情况下，如果没有Slave连接，Master就会恢复<br>到异步复制。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database zls1212;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show global status like <span class="string">&#x27;rpl_semi%&#x27;</span>;</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Rpl_semi_sync_master_clients | 1 |</span><br><span class="line">| Rpl_semi_sync_master_net_avg_wait_time | 0 |</span><br><span class="line">| Rpl_semi_sync_master_net_wait_time | 0 |</span><br><span class="line">| Rpl_semi_sync_master_net_waits | 1 |</span><br><span class="line">| Rpl_semi_sync_master_no_times | 0 |</span><br><span class="line">| Rpl_semi_sync_master_no_tx | 0 |</span><br><span class="line">| Rpl_semi_sync_master_status | ON |</span><br><span class="line">| Rpl_semi_sync_master_timefunc_failures | 0 |</span><br><span class="line">| Rpl_semi_sync_master_tx_avg_wait_time | 440 |</span><br><span class="line">| Rpl_semi_sync_master_tx_wait_time | 440 |</span><br><span class="line">| Rpl_semi_sync_master_tx_waits | 1 |</span><br><span class="line">| Rpl_semi_sync_master_wait_pos_backtraverse | 0 |</span><br><span class="line">| Rpl_semi_sync_master_wait_sessions | 0 |</span><br><span class="line">| Rpl_semi_sync_master_yes_tx | 1 |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line"></span><br><span class="line"><span class="comment">## 关闭半同步复制</span></span><br><span class="line"><span class="comment"># 主库执行</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global rpl_semi_sync_master_enabled =0;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从库执行</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global rpl_semi_sync_slave_enabled = 0;</span><br><span class="line"><span class="comment"># 重启IO线程</span></span><br><span class="line">mysql&gt; stop slave io_thread;</span><br></pre></td></tr></table></figure><h2 id="过滤复制"><a href="#过滤复制" class="headerlink" title="过滤复制"></a>过滤复制</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112544340.png" alt="image-20230518112544340"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant replication slave on dnf.* to rep1@<span class="string">&#x27;%&#x27;</span> identified by</span><br><span class="line"><span class="string">&#x27;123@qqdianCOM&#x27;</span>;</span><br><span class="line">ERROR 1221 (HY000): Incorrect usage of DB GRANT and GLOBAL</span><br><span class="line">PRIVILEGES</span><br><span class="line"></span><br><span class="line"><span class="comment">## 注意：replication slave主从复制权限是全局的权限</span></span><br></pre></td></tr></table></figure><h3 id="设置过滤复制"><a href="#设置过滤复制" class="headerlink" title="设置过滤复制"></a>设置过滤复制</h3><p>主库：从binlog做的手脚</p><ul><li>黑名单<ul><li>binlog-ignore-db</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主库设置黑名单</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">binlog-ignore-db=mysql</span><br><span class="line">binlog-ignore-db=wzry</span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># systemctl restart mysqld</span></span><br><span class="line"></span><br><span class="line">如果设置了黑名单，那就黑名单指定的数据库数据都不记录到binlog中，其他库都记录</span><br><span class="line"></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+------------------+----------+--------------+------------------+--</span><br><span class="line">-----------------+</span><br><span class="line">| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">Executed_Gtid_Set |</span><br><span class="line">+------------------+----------+--------------+------------------+--</span><br><span class="line">-----------------+</span><br><span class="line">| mysql-bin.000008 | 154 | | mysql,wzry |</span><br><span class="line">|</span><br><span class="line">+------------------+----------+--------------+------------------+--</span><br><span class="line">-----------------+</span><br></pre></td></tr></table></figure><ul><li>白名单<ul><li>binlog-do-db</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主库设置白名单</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">binlog-do-db=lol</span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># systemctl restart mysqld</span></span><br><span class="line"></span><br><span class="line">如果设置了白名单，那就只记录白名单中库的所有binlog，其他库一律不记录</span><br><span class="line">binlog-do-db=lol</span><br><span class="line">binlog-do-db=dnf</span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+------------------+----------+--------------+------------------+--</span><br><span class="line">-----------------+</span><br><span class="line">| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">Executed_Gtid_Set |</span><br><span class="line">+------------------+----------+--------------+------------------+--</span><br><span class="line">-----------------+</span><br><span class="line">| mysql-bin.000006 | 154 | lol,dnf | |</span><br><span class="line">|</span><br><span class="line">+------------------+----------+--------------+------------------+--</span><br><span class="line">-----------------+</span><br></pre></td></tr></table></figure><p>从库：：从relay-log做的手脚，SQL线程黑名单不执行或白名单只执行</p><ul><li>黑名单<ul><li>replicate-ignore-db：设置不读取哪个库的数据</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replicate-ignore-db=lol</span><br></pre></td></tr></table></figure><ul><li>replicate-ignore-table：设置只读取哪个库中的哪个表的数据</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replicate-ignore-table=lol.t1</span><br></pre></td></tr></table></figure><ul><li>replicate-wild-ignore-table：设置只读取哪个库中的通配符指定的表</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replicate-wild-ignore-table=lol.t*</span><br></pre></td></tr></table></figure><ul><li>白名单<ul><li>replicate-do-db：设置只读取哪个库的数据</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replicate-do-db=lol</span><br></pre></td></tr></table></figure><ul><li><p>replicate-do-table</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replicate-do-table=lol.t1</span><br></pre></td></tr></table></figure><ul><li><p>replicate-wild-do-table</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replicate-wild-do-table=lol.t*</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="满足上面的需求设置"><a href="#满足上面的需求设置" class="headerlink" title="满足上面的需求设置"></a>满足上面的需求设置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">db01：172.16.1.51</span><br><span class="line">王者荣耀</span><br><span class="line">和平精英</span><br><span class="line">英雄联盟</span><br><span class="line">地下城与勇士</span><br><span class="line"></span><br><span class="line">db02：172.16.1.52</span><br><span class="line">王者荣耀</span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">replicate-do-db=wzry</span><br><span class="line"></span><br><span class="line">db03：172.16.1.53</span><br><span class="line">和平精英</span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">replicate-do-db=hpjy</span><br><span class="line"></span><br><span class="line">db04：172.16.1.54</span><br><span class="line">英雄联盟</span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">replicate-do-db=lol</span><br><span class="line"></span><br><span class="line">db05：172.16.1.55</span><br><span class="line">地下城与勇士</span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">replicate-do-db=dnf</span><br><span class="line"></span><br><span class="line"><span class="comment">## 设置多个白名单</span></span><br><span class="line">replicate-do-db=wzry</span><br><span class="line">replicate-do-db=dnf</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#5.7.41yum安装mysql</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line">socket=/var/lib/mysql/mysql.sock</span><br><span class="line">skip_name_resolve</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">server_id=1</span><br><span class="line">log_error=/tmp/b.log</span><br><span class="line">character_set_server=utf8</span><br><span class="line"></span><br><span class="line">binlog-do-db=lol</span><br><span class="line"></span><br><span class="line"><span class="comment">#slow_query_log=1</span></span><br><span class="line"><span class="comment">#long_query_time=0.05</span></span><br><span class="line"><span class="comment">#log_queries_not_using_indexes</span></span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">prompt=MysQL5.7[\d]&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#5.7.40二进制安装mysql</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql</span><br><span class="line">datadir=/app/mysql/data</span><br><span class="line"></span><br><span class="line">skip_name_resolve</span><br><span class="line"></span><br><span class="line">character_set_server=utf8</span><br><span class="line"></span><br><span class="line"><span class="comment">#log-bin=mysql-bin</span></span><br><span class="line">server_id=2</span><br><span class="line">read_only=1</span><br><span class="line">log_error=/tmp/error.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#general_log=1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#slow_query_log=1</span></span><br><span class="line"><span class="comment">#long_query_time=0.05</span></span><br><span class="line"><span class="comment">#log_queries_not_using_indexes</span></span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">prompt=MysQL5.7[\d]&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Mysql数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL的物理备份和恢复(12)</title>
      <link href="/2022/10/17/MySQL/Day12MySQL%E7%9A%84%E7%89%A9%E7%90%86%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D/"/>
      <url>/2022/10/17/MySQL/Day12MySQL%E7%9A%84%E7%89%A9%E7%90%86%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h2 id="企业故障恢复案例"><a href="#企业故障恢复案例" class="headerlink" title="企业故障恢复案例"></a>企业故障恢复案例</h2><p>背景：</p><p>正在运行的网站系统，MySQL数据库，数据量25G，日业务增量10-15M。</p><p>备份策略：</p><p>每天23：00，计划任务调用mysqldump执行全备脚本</p><p>故障时间点：</p><p>上午10点开发人员误删除一个核心业务表，如何恢复？</p><p>模拟用户往数据库里写入数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">mysql -uroot -p123 -e <span class="string">&#x27;drop database zls;&#x27;</span></span><br><span class="line">mysql -uroot -p123 -e <span class="string">&#x27;create database if not exists zls;&#x27;</span></span><br><span class="line">mysql -uroot -p123 -e <span class="string">&#x27;use zls;create table if not exists zls1(id int);&#x27;</span></span><br><span class="line">num=0</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">  ((num ++))</span><br><span class="line">  mysql -uroot -p123 -e <span class="string">&quot;insert into zls.zls1 values(<span class="variable">$num</span>);&quot;</span></span><br><span class="line">  <span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>模拟数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#写入数据</span></span><br><span class="line">mysql&gt; create database test_mysqldump;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use test_mysqldump</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; create table test_mysqldump(<span class="built_in">id</span> int);</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_mysqldump values(1),(2),(3);</span><br><span class="line">Query OK, 3 rows affected (0.01 sec)</span><br><span class="line">Records: 3 Duplicates: 0 Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#做一次全备，但是还一直有用户数据往里面写入</span></span><br><span class="line">mysqldump -uroot -p123 -A -R --triggers --master-data=2 --single-transaction|gzip &gt; /tmp/full_$(<span class="built_in">date</span> +%F).sql.gz</span><br><span class="line"><span class="comment">#在新增点数据</span></span><br><span class="line">mysql&gt; insert into test_mysqldump.test_mysqldump values(4),(5),(6);</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">Records: 3 Duplicates: 0 Warning</span><br><span class="line">mysql&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#模拟误删除核心业务表</span></span><br><span class="line">mysql&gt; drop table test_mysqldump.test_mysqldump;</span><br></pre></td></tr></table></figure><p>恢复步骤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.准备新环境</span></span><br><span class="line"><span class="comment">##5.7从新初始化，先把以前的data目录删掉初始化，初始化前先停掉数据库</span></span><br><span class="line">./mysqld --initialize-insecure --user=mysql --basedir=/app/mysql --datadir=/app/mysql/data</span><br><span class="line"><span class="comment">#启动</span></span><br><span class="line">/etc/init.d/mysqld57 start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.将旧库的全备恢复到新环境</span></span><br><span class="line">scp /tmp/full_2023-04-18.sql.gz 172.16.1.53:/tmp</span><br><span class="line">zcat /tmp/full_2023-04-18.sql.gz |mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.回到旧库截取第一段binlog</span></span><br><span class="line">zcat /tmp/full_2023-04-18.sql.gz |<span class="built_in">head</span> -25</span><br><span class="line">起始位置点：1959243</span><br><span class="line"><span class="comment">#找drop删表的结束位置点</span></span><br><span class="line">mysqlbinlog --base64-output=decode-rows -vvv /var/lib/mysql/mysql-bin.000052 |grep DROP -C 5</span><br><span class="line">结束位置点：1984339</span><br><span class="line"></span><br><span class="line"><span class="comment">#第一次增量导出数据</span></span><br><span class="line">mysqlbinlog --start-position=1959243 --stop-position=1984339 /var/lib/mysql/mysql-bin.000052 &gt; /tmp/inc1.sql </span><br><span class="line"></span><br><span class="line"><span class="comment">#查看一下</span></span><br><span class="line"><span class="built_in">cat</span> /tmp/inc1.sql</span><br><span class="line"><span class="comment"># 4.发送到新环境</span></span><br><span class="line">scp /tmp/inc1.sql 172.16.1.53:/tmp/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.将第一段binlog恢复到新环境</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> sql_log_bin=0;</span><br><span class="line">mysql&gt; <span class="built_in">source</span> /tmp/inc1.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.截取第二段binlog，先找起始位置点</span></span><br><span class="line">mysqlbinlog --base64-output=decode-rows -vvv /var/lib/mysql/mysql-bin.000052 |grep DROP -C 5</span><br><span class="line">起始位置点：1984489</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.先停 所有连接数据库的服务 服务</span></span><br><span class="line">systemctl stop tomcat</span><br><span class="line">systemctl stop php-fpm</span><br><span class="line">systemctl stop nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.停止数据库</span></span><br><span class="line">systemctl stop mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.截取第二段binlog</span></span><br><span class="line">mysqlbinlog --base64-output=decode-rows -vvv /var/lib/mysql/mysql-bin.000052 |<span class="built_in">tail</span></span><br><span class="line">结束位置点：2178262</span><br><span class="line"></span><br><span class="line"><span class="comment">#第二次增量导出数据</span></span><br><span class="line">mysqlbinlog --start-position=1984489 --stop-position=2178262</span><br><span class="line">/var/lib/mysql/mysql-bin.000052 &gt; /tmp/inc2.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.将第二段binlog发送到新环境</span></span><br><span class="line">scp /tmp/inc2.sql 172.16.1.53:/tmp/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 11.恢复数据</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> sql_log_bin=0;</span><br><span class="line">mysql&gt; <span class="built_in">source</span> /tmp/inc2.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">## 恢复业务两种方式：</span></span><br><span class="line"><span class="comment">#- 应用割接</span></span><br><span class="line">- 开发修改连接数据的库代码</span><br><span class="line">- 运维要做一次代码上线</span><br><span class="line"></span><br><span class="line"><span class="comment">#- 导出数据（新环境做全备，将备份的数据恢复到旧库中）</span></span><br><span class="line">mysqldump -uroot -p123@qqdianCOM -A -R --triggers --master-data=2 -</span><br><span class="line">-single-transaction|gzip &gt; /tmp/full_$(<span class="built_in">date</span> +%F).sql.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#两种方法取决于那个速度快，如果数据特别大就不能全备了，就用第一种方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#应用割接,将用户写的数据往53的机器上输出</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">mysql -uroot -p123 -h172.16.1.53 -e <span class="string">&#x27;drop database zls;&#x27;</span></span><br><span class="line">mysql -uroot -p123 -h172.16.1.53 -e <span class="string">&#x27;create database if not exists zls;&#x27;</span></span><br><span class="line">mysql -uroot -p123 -h172.16.1.53 -e <span class="string">&#x27;use zls;create table if not exists zls1(id int);&#x27;</span></span><br><span class="line">num=0</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">  ((num ++))</span><br><span class="line">  mysql -uroot -p123 -e <span class="string">&quot;insert into zls.zls1 values(<span class="variable">$num</span>);&quot;</span></span><br><span class="line">  <span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动数据库</span></span><br><span class="line"><span class="comment">## 启动连接数据库的服务</span></span><br><span class="line">systemctl start tomcat</span><br><span class="line">systemctl start php-fpm</span><br><span class="line">systemctl start nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">###简单挂个维护页</span></span><br><span class="line">yum install -y nginx</span><br><span class="line"><span class="built_in">cd</span> /etc/nginx/conf.d/</span><br><span class="line">vim www.conf</span><br><span class="line">server &#123;</span><br><span class="line">        listen 80 default_server;</span><br><span class="line">        server_name www.zls.com;</span><br><span class="line">        charset utf-8;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                root /code/www;</span><br><span class="line">                index index.html;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /code/www</span><br><span class="line">vim /code/www/index.html</span><br><span class="line">这里是官网</span><br><span class="line">systemctl start nginx</span><br><span class="line"><span class="comment">#做本地域名解析</span></span><br><span class="line"><span class="comment">#访问浏览器</span></span><br><span class="line"><span class="comment">#准备一个维护页</span></span><br><span class="line">vim weihuye.com</span><br><span class="line">server &#123;</span><br><span class="line">        <span class="comment">#listen 80 default_server;</span></span><br><span class="line">        listen 80;</span><br><span class="line">        server_name www.zls.com;</span><br><span class="line">        charset utf-8;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                root /code/weihu;</span><br><span class="line">                index index.html;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> /code/weihu</span><br><span class="line">vim /code/weihu/index.html</span><br><span class="line">数据库正在升级中...</span><br><span class="line"></span><br><span class="line"><span class="comment">#做个软链接</span></span><br><span class="line"><span class="built_in">cd</span> /etc/nginx/conf.d</span><br><span class="line"><span class="built_in">mv</span> weihuye.com weihu</span><br><span class="line"><span class="built_in">mv</span> www.conf www</span><br><span class="line"><span class="built_in">ln</span> -s /etc/nginx/conf.d/www /etc/nginx/conf.d/www.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#停掉其他服务，停掉数据库，挂上维护页面</span></span><br><span class="line"><span class="built_in">rm</span> -f /etc/nginx/conf.d/www.conf &amp;&amp; <span class="built_in">ln</span> -s /etc/nginx/conf.d/weihu /etc/nginx/conf.d/www.conf </span><br><span class="line"></span><br><span class="line">/etc/nginx/conf.d <span class="comment"># ll</span></span><br><span class="line">total 8</span><br><span class="line">-rw-r--r-- 1 root root 221 Apr 18 16:52 weihu</span><br><span class="line">-rw-r--r-- 1 root root 136 Apr 18 16:55 www</span><br><span class="line">lrwxrwxrwx 1 root root  23 Apr 18 17:00 www.conf -&gt; /etc/nginx/conf.d/weihu</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启</span></span><br><span class="line">systemctl restart nginx</span><br></pre></td></tr></table></figure><h2 id="MySQL物理备份"><a href="#MySQL物理备份" class="headerlink" title="MySQL物理备份"></a>MySQL物理备份</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.下载Xtrabackup</span></span><br><span class="line">wget http://test.driverzeng.com/MySQL_Package/percona-xtrabackup-24-2.4.4-1.el6.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.安装Xtrabackup</span></span><br><span class="line"> yum localinstall -y percona-xtrabackup-24-2.4.4-1.el6.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.备份命令</span></span><br><span class="line">老版本</span><br><span class="line">[root@db01 ~]<span class="comment"># xtrabackup</span></span><br><span class="line"></span><br><span class="line">新版本</span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex</span></span><br></pre></td></tr></table></figure><p>1）对于非innodb表（比如myisam）是直接锁表cp数据文件，属于一种温备。</p><p>2）对于innodb的表（支持事务），不锁表，cp数据页最终以数据文件方式保存下来，并且把redo和undo一并备走，属于热备方式</p><p>3）备份恢复时读取配置文件&#x2F;etc&#x2F;my.cnf</p><h3 id="物理备份选项"><a href="#物理备份选项" class="headerlink" title="物理备份选项"></a>物理备份选项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">--user：指定用户</span><br><span class="line">--password：指定密码</span><br><span class="line">--socket：指定socket文件</span><br><span class="line"></span><br><span class="line">--apply-log：重做redo 回滚undo （手动模拟CSR）</span><br><span class="line">--copy-back：将全备恢复到datadir中</span><br><span class="line"></span><br><span class="line">--incremental：开启增量备份</span><br><span class="line">--incremental-basedir：上一次备份的目录</span><br><span class="line"></span><br><span class="line">--no-timestamp：不使用时间戳</span><br><span class="line"></span><br><span class="line">--incremental-dir：合并增备时，指定增备的目录</span><br></pre></td></tr></table></figure><h3 id="物理全备备份"><a href="#物理全备备份" class="headerlink" title="物理全备备份"></a>物理全备备份</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#全备，前提是数据库启动时  物理备份速度快</span></span><br><span class="line">innobackupex --user=root --password=123@qqdianCOM /backup</span><br><span class="line"> </span><br><span class="line">ll /backup</span><br><span class="line"><span class="comment">#分析多出来的4个文件</span></span><br><span class="line">xtrabackup_binlog_info</span><br><span class="line">xtrabackup_checkpoints</span><br><span class="line">xtrabackup_info</span><br><span class="line">xtrabackup_logfile</span><br><span class="line"></span><br><span class="line"><span class="comment">## 打点备份</span></span><br><span class="line">[root@db01 2023-04-18_09-48-44]<span class="comment"># cat xtrabackup_binlog_info</span></span><br><span class="line">mysql-bin.000053 154</span><br><span class="line"></span><br><span class="line"><span class="comment">## 日志版本号文件</span></span><br><span class="line">[root@db01 2023-04-18_09-58-29]<span class="comment"># cat xtrabackup_checkpoints</span></span><br><span class="line">backup_type = full-backuped</span><br><span class="line">from_lsn = 0</span><br><span class="line">to_lsn = 3525364299</span><br><span class="line">last_lsn = 3525365827</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line"><span class="comment">## 备份详细信息</span></span><br><span class="line">[root@db01 2023-04-18_09-58-29]<span class="comment"># cat xtrabackup_info</span></span><br><span class="line">uuid = 86de8ebe-dd8c-11ed-9b1a-000c290a5f4e</span><br><span class="line">name =</span><br><span class="line">tool_name = innobackupex</span><br><span class="line">tool_command = --user=root --password=... /backup</span><br><span class="line">tool_version = 2.4.4</span><br><span class="line">ibbackup_version = 2.4.4</span><br><span class="line">server_version = 5.7.41-<span class="built_in">log</span></span><br><span class="line">start_time = 2023-04-18 09:58:29</span><br><span class="line">end_time = 2023-04-18 09:58:34</span><br><span class="line">lock_time = 0</span><br><span class="line">binlog_pos = filename <span class="string">&#x27;mysql-bin.000053&#x27;</span>, position <span class="string">&#x27;6654&#x27;</span></span><br><span class="line">innodb_from_lsn = 0</span><br><span class="line">innodb_to_lsn = 3525364299</span><br><span class="line">partial = N</span><br><span class="line">incremental = N</span><br><span class="line">format = file</span><br><span class="line">compact = N</span><br><span class="line">compressed = N</span><br><span class="line">encrypted = N</span><br><span class="line"></span><br><span class="line"><span class="comment">### redo log二进制文件</span></span><br><span class="line">xtrabackup_logfile</span><br></pre></td></tr></table></figure><h3 id="物理备份恢复"><a href="#物理备份恢复" class="headerlink" title="物理备份恢复"></a>物理备份恢复</h3><p>前提1：被恢复的目录是空的</p><p>前提2：被恢复的数据库的实例是关闭的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.手动模拟CSR，重做redo，回滚undo</span></span><br><span class="line">将redo进行重做，已提交的写到数据文件，未提交的使用undo回滚，模拟CSR的过程</span><br><span class="line">[root@db01 lib]<span class="comment"># innobackupex --apply-log /backup/2023-04-18_09-58-29/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.先把data数据目录移走或删除data目录</span></span><br><span class="line"><span class="built_in">mv</span> mysql /tmp/data</span><br><span class="line"><span class="built_in">rm</span> -fr data/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.停库</span></span><br><span class="line">[root@db01 lib]<span class="comment"># systemctl stop mysqld</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.恢复数据.两种方法</span></span><br><span class="line"><span class="comment">#4.1</span></span><br><span class="line">innobackupex --copy-back /backup/2023-04-18_09-58-29/</span><br><span class="line"><span class="comment">#授权</span></span><br><span class="line">[root@db01 ~]<span class="comment"># chown -R mysql.mysql /var/lib/mysql</span></span><br><span class="line"><span class="comment">#4.2</span></span><br><span class="line">[root@db01 lib]<span class="comment"># cp -r /backup/2023-04-18_09-58-29/ /var/lib/mysql</span></span><br><span class="line">[root@db01 lib]<span class="comment"># chown -R mysql.mysql /var/lib/mysql</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="物理增量备份"><a href="#物理增量备份" class="headerlink" title="物理增量备份"></a>物理增量备份</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 精确到秒</span></span><br><span class="line">[root@db03 ~]<span class="comment"># date +%F-%H-%M-%S</span></span><br><span class="line">2023-04-18-11-09-45</span><br><span class="line">[root@db03 ~]<span class="comment"># date +%F-%T</span></span><br><span class="line">2023-04-18-11:10:13</span><br><span class="line"></span><br><span class="line"><span class="comment">## 精确到分</span></span><br><span class="line">[root@db03 ~]<span class="comment"># date +%F-%H-%M</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 精确到小时</span></span><br><span class="line">[root@db03 ~]<span class="comment"># date +%F-%H</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 精确到天</span></span><br><span class="line">[root@db03 ~]<span class="comment"># date +%F</span></span><br><span class="line"></span><br><span class="line">[root@db03 ~]<span class="comment"># date +%Y-%m-%d</span></span><br><span class="line">2023-04-18</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.全备</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM /backup</span></span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /backup/2023-04-18_10-57-</span></span><br><span class="line">44/xtrabackup_checkpoints</span><br><span class="line">backup_type = full-backuped</span><br><span class="line">from_lsn = 0</span><br><span class="line">to_lsn = 3525366331</span><br><span class="line">last_lsn = 3525366340</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.第一次增量备份</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --incremental --incremental-basedir=/backup/2023-04-18_10-57-44 /backup/inc1</span></span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /backup/inc1/2023-04-18_10-59-40/xtrabackup_checkpoints</span></span><br><span class="line"></span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3525366331</span><br><span class="line">to_lsn = 3525380111</span><br><span class="line">last_lsn = 3525407646</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.第二次增量备份</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --incremental --incremental-basedir=/backup/inc1/2023-04-18_10-59-40 /backup/inc2</span></span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /backup/inc2/2023-04-18_11-00-50/xtrabackup_checkpoints</span></span><br><span class="line"></span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3525380111</span><br><span class="line">to_lsn = 3525428237</span><br><span class="line">last_lsn = 3525435260</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#每一次增量的日志版本号都要衔接上才算备份成功</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 优化备份目录，不使用时间戳</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --no-timestamp /backup/full</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#写脚本备份每天</span></span><br><span class="line">innobackupex --user=root --password=123@qqdianCOM --no-timestamp /backup/full_$(<span class="built_in">date</span> +%F)</span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /backup/full_2023-04-18/xtrabackup_checkpoints</span></span><br><span class="line">backup_type = full-backuped</span><br><span class="line">from_lsn = 0</span><br><span class="line">to_lsn = 3525438478</span><br><span class="line">last_lsn = 3525438487</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line"><span class="comment">## 第一次增备</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --</span></span><br><span class="line">no-timestamp --incremental --incremental-basedir=/backup/full_2023-</span><br><span class="line">04-18 /backup/inc1</span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /backup/inc1/xtrabackup_checkpoints</span></span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3525438478</span><br><span class="line">to_lsn = 3525505776</span><br><span class="line">last_lsn = 3525546165</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line"><span class="comment">## 第二次增备</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --</span></span><br><span class="line">no-timestamp --incremental --incremental-basedir=/backup/inc1</span><br><span class="line">/backup/inc2</span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /backup/inc2/xtrabackup_checkpoints</span></span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3525505776</span><br><span class="line">to_lsn = 3525505776</span><br><span class="line">last_lsn = 3525556441</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line"><span class="comment">## 第三次增备</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --</span></span><br><span class="line">no-timestamp --incremental --incremental-basedir=/backup/inc2</span><br><span class="line">/backup/inc3</span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /backup/inc3/xtrabackup_checkpoints</span></span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3525505776</span><br><span class="line">to_lsn = 3525562429</span><br><span class="line">last_lsn = 3525563124</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line"><span class="comment">## 第四次增备</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --</span></span><br><span class="line">no-timestamp --incremental --incremental-basedir=/backup/inc3</span><br><span class="line">/backup/inc4</span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /backup/inc4/xtrabackup_checkpoints</span></span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3525562429</span><br><span class="line">to_lsn = 3525604776</span><br><span class="line">last_lsn = 3525621189</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line"><span class="comment">## 第五次增备</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --</span></span><br><span class="line">no-timestamp --incremental --incremental-basedir=/backup/inc4</span><br><span class="line">/backup/inc5</span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /backup/inc5/xtrabackup_checkpoints</span></span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3525604776</span><br><span class="line">to_lsn = 3525644812</span><br><span class="line">last_lsn = 3525644821</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br></pre></td></tr></table></figure><h3 id="物理增量备份恢复"><a href="#物理增量备份恢复" class="headerlink" title="物理增量备份恢复"></a>物理增量备份恢复</h3><p>1）基于上一次备份进行增量</p><p>2）增量备份无法单独恢复，必须基于全备进行恢复</p><p>3）所有增量必须要按顺序合并到全备当中</p><p>合并步骤：</p><p>1）全备模拟CSR，只做redo 不做undo</p><p>2）第一次增量备份模拟CSR，只做redo，不做undo</p><p>3）只有最后一次增量合并到全备中时，模拟CSR redo和undo都做</p><p>4）把所有合并完的全备目录整体做一遍redo和undo</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.先停库</span></span><br><span class="line">[root@db01 ~]<span class="comment"># systemctl stop mysqld</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.清空data目录</span></span><br><span class="line">[root@db01 ~]<span class="comment"># mv /var/lib/mysql /opt/data</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.全备只做redo不做undo</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log --redo-only</span></span><br><span class="line">/backup/full_2023-04-18/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.第一次增备合并到全备中，只做redo不做undo</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log --redo-only --incremental-dir=/backup/inc1 /backup/full_2023-04-18/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.第二次增备合并到全备中，只做redo不做undo</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log --redo-only --incremental-dir=/backup/inc2 /backup/full_2023-04-18/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.第三次增备合并到全备中，只做redo不做undo</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log --redo-only --incremental-dir=/backup/inc3 /backup/full_2023-04-18/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.第四次增备合并到全备中，只做redo不做undo</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log --redo-only --incremental-dir=/backup/inc4 /backup/full_2023-04-18/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.最后一次增备合并到全备中，redo和undo都做</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log --incremental-dir=/backup/inc5 /backup/full_2023-04-18/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.将全备的目录整体做一遍redo和undo</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log /backup/full_2023-04-18/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.恢复数据</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --copy-back /backup/full_2023-04-18/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 11.授权</span></span><br><span class="line">[root@db01 ~]<span class="comment"># chown -R mysql.mysql /var/lib/mysql</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 12.启动mysql</span></span><br><span class="line">[root@db01 ~]<span class="comment"># systemctl start mysqld</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#恢复binlog日志（新增的数据）</span></span><br><span class="line"><span class="built_in">cat</span> /var/lib/mysql/xtrabackup_binlog_pos_innodb</span><br><span class="line"><span class="comment">#找到起始位置点</span></span><br><span class="line"><span class="comment">#结束位置点在最初停库移走的opt/data下</span></span><br><span class="line">mysqlbinlog --base64-output=decode-rows -vvv /opt/data/mysql-bin.000001</span><br></pre></td></tr></table></figure><h3 id="物理差异备份"><a href="#物理差异备份" class="headerlink" title="物理差异备份"></a>物理差异备份</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.全备</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --</span></span><br><span class="line">no-timestamp /backup/full</span><br><span class="line">[root@db01 ~]<span class="comment"># cat /backup/full/xtrabackup_checkpoints</span></span><br><span class="line">backup_type = full-backuped</span><br><span class="line">from_lsn = 0</span><br><span class="line">to_lsn = 3525661870</span><br><span class="line">last_lsn = 3525680016</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.第一次差异备份</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --</span></span><br><span class="line">no-timestamp --incremental --incremental-basedir=/backup/full</span><br><span class="line">/backup/chayi1</span><br><span class="line">[root@db01 ~]<span class="comment"># cat /backup/chayi1/xtrabackup_checkpoints</span></span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3525661870</span><br><span class="line">to_lsn = 3525682062</span><br><span class="line">last_lsn = 3525714194</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.第二次差异备份</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --</span></span><br><span class="line">no-timestamp --incremental --incremental-basedir=/backup/full</span><br><span class="line">/backup/chayi2</span><br><span class="line">[root@db01 ~]<span class="comment"># cat /backup/chayi2/xtrabackup_checkpoints</span></span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3525661870</span><br><span class="line">to_lsn = 3525728200</span><br><span class="line">last_lsn = 3525730885</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.第三次差异备份</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --user=root --password=123@qqdianCOM --</span></span><br><span class="line">no-timestamp --incremental --incremental-basedir=/backup/full</span><br><span class="line">/backup/chayi3</span><br><span class="line">[root@db01 ~]<span class="comment"># cat /backup/chayi3/xtrabackup_checkpoints</span></span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3525661870</span><br><span class="line">to_lsn = 3525728200</span><br><span class="line">last_lsn = 3525744086</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br></pre></td></tr></table></figure><h3 id="物理差异备份恢复"><a href="#物理差异备份恢复" class="headerlink" title="物理差异备份恢复"></a>物理差异备份恢复</h3><p>恢复步骤</p><p>1）全备模拟CSR，只做redo不做undo</p><p>2）最后一次差异备份合并到全备中，模拟CSR，redo和undo都做</p><p>3）整体全备目录做一次redo和undo</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.停库</span></span><br><span class="line">[root@db01 ~]<span class="comment"># systemctl stop mysqld</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.清空data目录</span></span><br><span class="line">[root@db01 ~]<span class="comment"># mv /var/lib/mysql /tmp/new_data</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.全备模拟CSR，只做redo不做undo</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log --redo-only /backup/full/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.最后一次差异备份合并到全备中，模拟CSR，redo和undo都做</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log --incremental-dir=/backup/chayi3 /backup/full/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.整体全备目录做一次redo和undo</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --apply-log /backup/full/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.恢复数据</span></span><br><span class="line">[root@db01 ~]<span class="comment"># innobackupex --copy-back /backup/full/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.授权 &amp;&amp; 启动</span></span><br><span class="line">[root@db01 ~]<span class="comment"># chown -R mysql.mysql /var/lib/mysql</span></span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /var/lib/mysql/xtrabackup_binlog_pos_innodb</span></span><br><span class="line">mysql-bin.000001 58904</span><br><span class="line"></span><br><span class="line">起始位置点：58904</span><br><span class="line">结束位置点：87177</span><br><span class="line">[root@db01 ~]<span class="comment"># mysqlbinlog --base64-output=decode-rows -vvv /tmp/new_data/mysql-bin.000001 |tail</span></span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># mysqlbinlog --start-position=58904 --stop-position=87177 /tmp/new_data/mysql-bin.000001 &gt; /tmp/a.sql</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Mysql数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL备份和恢复(11)</title>
      <link href="/2022/10/17/MySQL/Day11MySQL%E7%9A%84%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D/"/>
      <url>/2022/10/17/MySQL/Day11MySQL%E7%9A%84%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="MySQL备份和恢复"><a href="#MySQL备份和恢复" class="headerlink" title="MySQL备份和恢复"></a>MySQL备份和恢复</h1><h2 id="备份的原因"><a href="#备份的原因" class="headerlink" title="备份的原因"></a>备份的原因</h2><p>运维工作的核心简单概括就两件事: </p><p>1）第一个是保护公司的数据. </p><p>2）第二个是让网站能7*24小时提供服务(用户体验)。</p><p>备份就是为了恢复，尽量减少数据的丢失(公司的损失)</p><h2 id="mysqldump做备份的原理"><a href="#mysqldump做备份的原理" class="headerlink" title="mysqldump做备份的原理"></a>mysqldump做备份的原理</h2><p>逻辑备份，备份所有的SQL语句</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p123 -B stu &gt; /tmp/stu.sql</span><br><span class="line">vim /tmp/stu.sql</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS `binlog`;</span><br><span class="line">/*!40101 SET @saved_cs_client     = @@character_set_client */;</span><br><span class="line">/*!40101 SET character_set_client = utf8 */;</span><br><span class="line">CREATE TABLE `binlog` (</span><br><span class="line">  `<span class="built_in">id</span>` int(11) DEFAULT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line">/*!40101 SET character_set_client = @saved_cs_client */;</span><br><span class="line"></span><br><span class="line">--</span><br><span class="line">-- Dumping data <span class="keyword">for</span> table `binlog`</span><br><span class="line">--</span><br><span class="line"></span><br><span class="line">LOCK TABLES `binlog` WRITE;  <span class="comment">#锁表</span></span><br><span class="line">/*!40000 ALTER TABLE `binlog` DISABLE KEYS */;</span><br><span class="line">INSERT INTO `binlog` VALUES (1),(1);</span><br><span class="line">/*!40000 ALTER TABLE `binlog` ENABLE KEYS */;</span><br><span class="line">UNLOCK TABLES <span class="comment">#解锁</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.如果表存在，则先删表</span></span><br><span class="line"><span class="comment"># 2.根据原有的表结构重新创建一张新表</span></span><br><span class="line"><span class="comment"># 3.锁表</span></span><br><span class="line"><span class="comment"># 4.所有数据会以INSERT的形式插入到表中</span></span><br><span class="line"><span class="comment"># 5.解锁</span></span><br></pre></td></tr></table></figure><h2 id="备份类型"><a href="#备份类型" class="headerlink" title="备份类型"></a>备份类型</h2><ul><li><p>冷备份</p></li><li><p>需要停机停库停服务，不对外提供任何服务，备份</p></li><li><p>温备份</p></li><li><p>不需要停机停库停服务，正常做备份（需要锁表），用户无法写入数据</p></li><li><p>热备份</p><ul><li><p>不需要停机停库停服务，也不锁表，一边备份，用户也可以正常写入</p><p>数据</p></li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">冷备份:</span><br><span class="line">这些备份在用户不能访问数据时进行，因此无法读取或修改数据。这些脱机备份会阻止执行任何使用数据的活动。这些类型的备份不会干扰正常运行的系统的性能。但是，对于某些应用程序，会无法接受必须在一段较长的时间里锁定或完全阻止用户访问数据。</span><br><span class="line"></span><br><span class="line">温备份:</span><br><span class="line">这些备份在读取数据时进行，但在多数情况下，在进行备份时不能修改数据本身。这种中途备份类型的优点是不必完全锁定最终用户。但是，其不足之处在于无法在进行备份时修改数据集，这可能使这种类型的备份不适用于某些应用程序。在备份过程中无法修改数据可能产生性能问题。</span><br><span class="line"></span><br><span class="line">热备份:</span><br><span class="line">这些动态备份在读取或修改数据的过程中进行，很少中断或者不中断传输或处理数据的功能。使用热备份时，系统仍可供读取和修改数据的操作访问。</span><br></pre></td></tr></table></figure><h2 id="备份方式"><a href="#备份方式" class="headerlink" title="备份方式"></a>备份方式</h2><ul><li><p>逻辑备份</p><ul><li><p>mysqldump（只能做全备）</p></li><li><p>binlog</p></li><li><p>into outfile</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br><span class="line">secure-file-priv=/tmp</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * from jiaoyi.money into outfile</span><br><span class="line"><span class="string">&#x27;/tmp/jiaoyi.data&#x27;</span>;</span><br></pre></td></tr></table></figure><ul><li>replication（主从复制）</li></ul></li></ul></li><li><p>物理备份</p><ul><li>备份最底层的物理文件（scp mv cp rsync）</li><li>Xtrabackup（percona）【全备，增备，差异备】</li></ul></li></ul><h3 id="备份策略"><a href="#备份策略" class="headerlink" title="备份策略"></a>备份策略</h3><ul><li><p>全量备份</p><ul><li>将所有数据都备份下来</li></ul></li><li><p>增量备份</p><ul><li>基于上一次备份的新增数据，做备份</li></ul></li><li><p>差异备份</p><ul><li>基于全量备份新增的数据，做备份</li></ul></li></ul><h3 id="不同的备份方案"><a href="#不同的备份方案" class="headerlink" title="不同的备份方案"></a>不同的备份方案</h3><ul><li>每天一次全备，每小时一次增备</li><li>每周一次全备，每天一次增备</li><li>每个月一次全备，每天一次增备</li><li>每小时一次全备，每分钟一次增备</li></ul><h2 id="MySQL逻辑备份工具-mysqldump"><a href="#MySQL逻辑备份工具-mysqldump" class="headerlink" title="MySQL逻辑备份工具-mysqldump"></a>MySQL逻辑备份工具-mysqldump</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 常用选项：</span></span><br><span class="line">-u： 指定用户</span><br><span class="line">-p： 指定密码</span><br><span class="line">-S： 指定socket</span><br><span class="line">-h： 指定主机域</span><br></pre></td></tr></table></figure><h3 id="备份选项-全备-A"><a href="#备份选项-全备-A" class="headerlink" title="备份选项: 全备 -A"></a>备份选项: 全备 -A</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-A --all-database</span><br><span class="line"></span><br><span class="line">mysqldump -uroot -p123@qqdianCOM -A &gt; /tmp/abc.sql</span><br></pre></td></tr></table></figure><h3 id="备份选项：指定库备份-B"><a href="#备份选项：指定库备份-B" class="headerlink" title="备份选项：指定库备份 -B"></a>备份选项：指定库备份 -B</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p123@qqdianCOM -B jiaoyi &gt; /tmp/jiaoyi.sql</span><br><span class="line"><span class="comment">#有建库语句</span></span><br><span class="line">CREATE DATABASE /*!32312 IF NOT EXISTS*/ `jiaoyi` /*!40100 DEFAULT CHARACTER SET utf8 */;</span><br><span class="line"></span><br><span class="line">mysqldump -uroot -p123@qqdianCOM -B 库名 库名 库名 &gt; /tmp/jiaoyi.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">## 不加任何选项（表级别备份）</span></span><br><span class="line">mysqldump -uroot -p123@qqdianCOM jiaoyi &gt; /tmp/jiaoyi2.sql</span><br><span class="line"><span class="comment">#没有建库语句</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 区别：</span></span><br><span class="line">- 加-B选项：备份数据库和库内的所有表以及数据，只能把数据恢复到原来的jiaoyi库中</span><br><span class="line">- 不加选项： 备份数据库库内的所有表，但不备数据库，恢复时需要指定一个数据库</span><br><span class="line"></span><br><span class="line"><span class="comment">#不加选项时，恢复数据要指定数据库</span></span><br><span class="line">mysql -uroot -p123@qqdianCOM qqq &lt; /tmp/jiaoyi2.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">## 单表备份</span></span><br><span class="line">mysqldump -uroot -p123@qqdianCOM qqq abc &gt; /tmp/qqq_abc.sql</span><br><span class="line">mysqldump -uroot -p123@qqdianCOM 库名 表名 表名 &gt; /tmp/qqq_abc.sql</span><br></pre></td></tr></table></figure><h3 id="备份选项：刷新binlog-F"><a href="#备份选项：刷新binlog-F" class="headerlink" title="备份选项：刷新binlog  -F"></a>备份选项：刷新binlog  -F</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#全备时会刷新出多个binlog出来</span></span><br><span class="line">mysqldump -uroot -p123@qqdianCOM -A -F &gt; /tmp/test.sql</span><br></pre></td></tr></table></figure><h3 id="备份选项：打点备份-–master-data"><a href="#备份选项：打点备份-–master-data" class="headerlink" title="备份选项：打点备份 –master-data"></a>备份选项：打点备份 –master-data</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">--master-data=[0|1|2]</span><br><span class="line">mysqldump -uroot -p123@qqdianCOM -A --master-data=2 &gt; /tmp/full_new.sql</span><br><span class="line"></span><br><span class="line">mysqldump -uroot -p123@qqdianCOM -A --master-data=1 &gt; /tmp/full1_new.sql</span><br><span class="line"></span><br><span class="line">mysqldump -uroot -p123@qqdianCOM -A --master-data=0 &gt; /tmp/full2_new.sql</span><br><span class="line">/tmp/full2_new.sql</span><br><span class="line"></span><br><span class="line">0：不开启打点备份</span><br><span class="line">1：change master语句不注释</span><br><span class="line">2：change master语句注释  可以记点位</span><br><span class="line"></span><br><span class="line">注意：如果使用--master-data选项则会打开`--lock-all-tables`选项,会锁表（温备）</span><br></pre></td></tr></table></figure><h3 id="备份选项：快照备份-–single-transaction"><a href="#备份选项：快照备份-–single-transaction" class="headerlink" title="备份选项：快照备份 –single-transaction"></a>备份选项：快照备份 –single-transaction</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">创建一个快照备份，把备份内容定格在某一时刻，不影响用户写入</span><br><span class="line"></span><br><span class="line"><span class="comment">#热备</span></span><br><span class="line">mysqldump -uroot -p123@qqdianCOM -A --master-data=2 --single-transaction &gt; /tmp/full_new.sql</span><br></pre></td></tr></table></figure><h3 id="备份选项：扩展"><a href="#备份选项：扩展" class="headerlink" title="备份选项：扩展"></a>备份选项：扩展</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-R：备份MySQL的存储过程和函数</span><br><span class="line">--triggers：备份MySQL的触发器</span><br><span class="line"></span><br><span class="line">mysqldump -uroot -p123@qqdianCOM -A -R --triggers --master-data=2 --single-transaction &gt; /tmp/full.sql</span><br></pre></td></tr></table></figure><h3 id="压缩备份"><a href="#压缩备份" class="headerlink" title="压缩备份"></a>压缩备份</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 备份数据</span></span><br><span class="line">mysqldump -uroot -p123@qqdianCOM -A -R --triggers --master-data=2 --single-transaction|gzip &gt; /tmp/full_$(<span class="built_in">date</span> +%F).sql.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">## 恢复数据</span></span><br><span class="line">zcat /tmp/full_2023-04-17.sql.gz |mysql -uroot -p123@qqdianCOM</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-t：仅备份数据</span><br><span class="line">-d：仅备份表结构</span><br><span class="line">-x：锁表备份</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Mysql数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL MHA高可用(14)</title>
      <link href="/2022/10/17/MySQL/Day14MySQLMHA%E9%AB%98%E5%8F%AF%E7%94%A8/"/>
      <url>/2022/10/17/MySQL/Day14MySQLMHA%E9%AB%98%E5%8F%AF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="MlSQL-MHA高可用"><a href="#MlSQL-MHA高可用" class="headerlink" title="MlSQL MHA高可用"></a>MlSQL MHA高可用</h1><h2 id="MHA介绍"><a href="#MHA介绍" class="headerlink" title="MHA介绍"></a>MHA介绍</h2><p>MHA能够在较短的时间内实现自动故障检测和故障转移，通常在10-30秒以内;在复制框架中，MHA能够很好地解决复制过程中的数据一致性问题，由于不需要在现有的replication中添加额外的服务器，仅需要一个manager节点，而一个Manager能管理多套复制，所以能大大地节约服务器的数量;另外，安装简单，无性能损耗，以及不需要修改现有的复制部署也是它的优势之处。</p><p> MHA还提供在线主库切换的功能，能够安全地切换当前运行的主库到一个新的主库中(通过将从库提升为主库),大概0.5-2秒内即可完成。 </p><p>MHA由两部分组成：MHA Manager（管理节点）和MHA Node（数据节点）。MHA Manager可以独立部署在一台独立的机器上管理多个Master-Slave集群，也可以部署在一台Slave上。当Master出现故障时，它可以自动将最新数据的Slave提升为新的Master,然后将所有其他的Slave重新指向新的Master。整个故障转移过程对应用程序是完全透明的。</p><h2 id="MHA工作原理流程"><a href="#MHA工作原理流程" class="headerlink" title="MHA工作原理流程"></a>MHA工作原理流程</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112639284.png" alt="image-20230518112639284"></p><h3 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h3><p>1)把宕机的master二进制日志保存下来。</p><p> 2)找到binlog位置点最新的slave。</p><p> 3)在binlog位置点最新的slave上用relay log（差异日志）修复其它slave。 </p><p>4)将宕机的master上保存下来的二进制日志恢复到含有最新位置点的slave上。</p><p> 5)将含有最新位置点binlog所在的slave提升为master。 </p><p>6)将其它slave重新指向新提升的master，并开启主从复制。</p><h2 id="MHA架构图"><a href="#MHA架构图" class="headerlink" title="MHA架构图"></a>MHA架构图</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112654625.png" alt="image-20230518112654625"></p><h2 id="MHA工具介绍"><a href="#MHA工具介绍" class="headerlink" title="MHA工具介绍"></a>MHA工具介绍</h2><p>MHA软件由两部分组成，Manager工具包合和Node工具包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Manager管理节点工具</span></span><br><span class="line">[root@db01 ~]<span class="comment"># tar xf mha4mysql-manager-0.56.tar.gz</span></span><br><span class="line">[root@db01 ~]<span class="comment"># ls -1 /root/mha4mysql-manager-0.56/bin/</span></span><br><span class="line">masterha_check_repl // 检测主从复制</span><br><span class="line">masterha_check_ssh // 检测ssh免密状态</span><br><span class="line">masterha_check_status // 检测MHA启动状态 systemctl status mha</span><br><span class="line">masterha_conf_host // MHA切换之后，将宕机主库的配置从MHA配置文件中摘除</span><br><span class="line">masterha_manager // MHA启动工具 systemctl start mha</span><br><span class="line">masterha_master_monitor // MHA心跳检测工具</span><br><span class="line">masterha_master_switch // MHA故障切换工具</span><br><span class="line">masterha_secondary_check // MHA建立TCP连接</span><br><span class="line">masterha_stop // MHA的停止工具 systemctl stop mha</span><br><span class="line"></span><br><span class="line"><span class="comment">## Node数据节点工具</span></span><br><span class="line">[root@db01 ~]<span class="comment"># ls -1 /root/mha4mysql-node-0.56/bin/</span></span><br><span class="line">apply_diff_relay_logs // 对比从库上的relay-log</span><br><span class="line">filter_mysqlbinlog // 截取binlog、relay-log</span><br><span class="line">purge_relay_logs // 删除relay-log的工具</span><br><span class="line">save_binary_logs // 保存所有binlog事件</span><br></pre></td></tr></table></figure><h3 id="MHA优点总结"><a href="#MHA优点总结" class="headerlink" title="MHA优点总结"></a>MHA优点总结</h3><p>1）Masterfailover and slave promotion can be done very quickly<br>自动故障转移快</p><p>2）Mastercrash does not result in data inconsistency<br>主库崩溃不存在数据一致性问题</p><p>3）Noneed to modify current MySQL settings (MHA works with regular MySQL)<br>不需要对当前mysql环境做重大修改</p><p>4）Noneed to increase lots of servers<br>不需要添加额外的服务器(仅一台manager就可管理上百个replication)</p><p>5）Noperformance penalty<br>性能优秀，可工作在半同步复制和异步复制，当监控mysql状态时，仅需要每隔N秒向<br>master发送ping包(默认3秒)，所以对性能无影响。你可以理解为MHA的性能和简单的主从<br>复制框架性能一样。</p><p>6）Works with any storage engine<br>只要replication支持的存储引擎，MHA都支持，不会局限于innodb</p><h2 id="部署MHA"><a href="#部署MHA" class="headerlink" title="部署MHA"></a>部署MHA</h2><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112708560.png" alt="image-20230518112708560"></p><h3 id="回顾做mysql主从复制"><a href="#回顾做mysql主从复制" class="headerlink" title="回顾做mysql主从复制"></a>回顾做mysql主从复制</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 主库操作</span></span><br><span class="line"><span class="comment"># 1.修改配置文件</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">server_id=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.创建主从复制用户</span></span><br><span class="line">grant replication slave on *.* to slave@<span class="string">&#x27;172.16.1.%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.记录binlog的名字和位置点</span></span><br><span class="line">show master status;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 从库操作</span></span><br><span class="line"><span class="comment"># 1.修改配置文件</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">server_id=2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.执行和主库建立连接的语句（change master to）</span></span><br><span class="line">change master to</span><br><span class="line">master_user=<span class="string">&#x27;slave&#x27;</span>,</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line">master_log_pos=154;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.开启主从复制</span></span><br><span class="line">start slave;</span><br><span class="line"><span class="comment">#4.查看主从复制</span></span><br><span class="line">show master status;</span><br><span class="line"><span class="comment">#总结</span></span><br><span class="line">1.主库要开启binlog，从库不需要开启binlog</span><br><span class="line">2.主库要创建主从复制用户，从库不需要创建主从复制用户</span><br><span class="line">3.主库要设置server_id，从库也要设置server_id，从库的server_id要跟主库不同，从库之间是可以相同的</span><br></pre></td></tr></table></figure><h3 id="MHA主从复制前提条件"><a href="#MHA主从复制前提条件" class="headerlink" title="MHA主从复制前提条件"></a>MHA主从复制前提条件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## MHA前提条件</span></span><br><span class="line">1）主库要开启binlog，从库也要开启binlog</span><br><span class="line">2）主库要创建主从复制用户，从库也要创建主从复制用户</span><br><span class="line">3）主库的server_id要跟从库之间不同，从库之间也不可以相同</span><br><span class="line"></span><br><span class="line"><span class="comment">############## 做一主三从操作步骤</span></span><br><span class="line"><span class="comment">## 1.修改配置文件</span></span><br><span class="line">[root@db01 ~]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql</span><br><span class="line">datadir=/app/mysql/data</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">server_id=1</span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># cat /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql</span><br><span class="line">datadir=/app/mysql/data</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">server_id=2</span><br><span class="line"></span><br><span class="line">[root@db03 ~]<span class="comment"># cat /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql</span><br><span class="line">datadir=/app/mysql/data</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">server_id=3</span><br><span class="line"></span><br><span class="line">[root@db04 ~]<span class="comment"># cat /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql</span><br><span class="line">datadir=/app/mysql/data</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">server_id=4</span><br><span class="line"></span><br><span class="line"><span class="comment">## 2.重启数据库</span></span><br><span class="line">[root@db01 ~]<span class="comment"># /etc/init.d/mysqld restart</span></span><br><span class="line">[root@db02 ~]<span class="comment"># /etc/init.d/mysqld restart</span></span><br><span class="line">[root@db03 ~]<span class="comment"># /etc/init.d/mysqld restart</span></span><br><span class="line">[root@db04 ~]<span class="comment"># /etc/init.d/mysqld restart</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 3.主库创建主从复制用户</span></span><br><span class="line">grant replication slave on *.* to slave@<span class="string">&#x27;172.16.1.%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">##4.记录binlog名字和位置点</span></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 5. 3个从库执行change master</span></span><br><span class="line">change master to</span><br><span class="line">master_user=<span class="string">&#x27;slave&#x27;</span>,</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line">master_log_pos=447;</span><br><span class="line"></span><br><span class="line"><span class="comment">##6. 从库上创建主从复制用户</span></span><br><span class="line">grant replication slave on *.* to slave@<span class="string">&#x27;172.16.1.%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 7.开启主从复制</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"></span><br><span class="line"><span class="comment">##8. 查看状态</span></span><br><span class="line">show slave status\G</span><br><span class="line"></span><br><span class="line"><span class="comment">#注：尽量不在从库上面写，从库只读，主库写</span></span><br><span class="line">从库不会更新binlog，从库拿到数据都放到relay-log里面，从库开启binlog只是因为会被随时提供为主库，主库就是要开启binlog</span><br></pre></td></tr></table></figure><h3 id="部署MHA主从前戏"><a href="#部署MHA主从前戏" class="headerlink" title="部署MHA主从前戏"></a>部署MHA主从前戏</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.关闭自动删除relay-log的功能（临时关闭）</span></span><br><span class="line"><span class="built_in">set</span> global relay_log_purge = 0;</span><br><span class="line"><span class="built_in">set</span> global relay_log_purge = 0;</span><br><span class="line"><span class="built_in">set</span> global relay_log_purge = 0;</span><br><span class="line"><span class="built_in">set</span> global relay_log_purge = 0;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.关闭自动删除relay-log的功能（永久关闭）</span></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql</span><br><span class="line">datadir=/app/mysql/data</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">server_id=1</span><br><span class="line">relay_log_purge = 0 <span class="comment"># 禁用relay-log自动删除功能</span></span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># cat /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql</span><br><span class="line">datadir=/app/mysql/data</span><br><span class="line">server_id=2</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">relay_log_purge = 0 <span class="comment"># 禁用relay-log自动删除功能</span></span><br><span class="line"></span><br><span class="line">[root@db03 ~]<span class="comment"># cat /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql</span><br><span class="line">datadir=/app/mysql/data</span><br><span class="line">server_id=3</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">relay_log_purge = 0 <span class="comment"># 禁用relay-log自动删除功能</span></span><br><span class="line"></span><br><span class="line">[root@db04 ~]<span class="comment"># cat /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql</span><br><span class="line">datadir=/app/mysql/data</span><br><span class="line">server_id=4</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">relay_log_purge = 0 <span class="comment"># 禁用relay-log自动删除功能</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.将从库设置为只读（所有从库，临时设置为只读）</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global read_only=1;</span><br><span class="line">mysql&gt; <span class="built_in">set</span> global read_only=1;</span><br><span class="line">mysql&gt; <span class="built_in">set</span> global read_only=1;</span><br></pre></td></tr></table></figure><h3 id="正式部署MHA"><a href="#正式部署MHA" class="headerlink" title="正式部署MHA"></a>正式部署MHA</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#MHA官网</span></span><br><span class="line">https://github.com/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.下载安装包</span></span><br><span class="line"><span class="comment">## manager管理节点安装包下载</span></span><br><span class="line">[root@db03 ~]<span class="comment"># wget http://test.driverzeng.com/MySQL_plugins/mha4mysql-manager-0.56-0.el6.noarch.rpm</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## node数据节点安装包下载</span></span><br><span class="line">[root@db01 ~]<span class="comment"># wget http://test.driverzeng.com/MySQL_plugins/mha4mysql-node-0.56-0.el6.noarch.rpm</span></span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># wget http://test.driverzeng.com/MySQL_plugins/mha4mysql-node-0.56-0.el6.noarch.rpm</span></span><br><span class="line"></span><br><span class="line">[root@db03 ~]<span class="comment"># wget http://test.driverzeng.com/MySQL_plugins/mha4mysql-node-0.56-0.el6.noarch.rpm</span></span><br><span class="line"></span><br><span class="line">[root@db04 ~]<span class="comment"># wget http://test.driverzeng.com/MySQL_plugins/mha4mysql-node-0.56-0.el6.noarch.rpm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.所有的服务器先安装node节点，不然db03manager管理节点装不上</span></span><br><span class="line">[root@db01 ~]<span class="comment"># yum localinstall -y mha4mysql-node-0.56-0.el6.noarch.rpm</span></span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># yum localinstall -y mha4mysql-node-0.56-0.el6.noarch.rpm</span></span><br><span class="line"></span><br><span class="line">[root@db03 ~]<span class="comment"># yum localinstall -y mha4mysql-node-0.56-0.el6.noarch.rpm</span></span><br><span class="line"></span><br><span class="line">[root@db04 ~]<span class="comment"># yum localinstall -y mha4mysql-node-0.56-0.el6.noarch.rpm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.在db03上安装manager管理节点</span></span><br><span class="line">[root@db03 ~]<span class="comment"># yum localinstall -y mha4mysql-manager-0.56-0.el6.noarch.rpm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.创建MHA管理用户（MySQL中 四台都要创建）（如果开启了主从复制，就只在主库上操作）</span></span><br><span class="line">mysql&gt; grant all on *.* to mha@<span class="string">&#x27;172.16.1.%&#x27;</span> identified by <span class="string">&#x27;mha&#x27;</span>;</span><br><span class="line">mysql&gt; <span class="keyword">select</span> user,host from mysql.user;</span><br><span class="line">+---------------+------------+</span><br><span class="line">| user | host |</span><br><span class="line">+---------------+------------+</span><br><span class="line">| mha | 172.16.1.% |</span><br><span class="line">| slave | 172.16.1.% |</span><br><span class="line">| mysql.session | localhost |</span><br><span class="line">| mysql.sys | localhost |</span><br><span class="line">| root | localhost |</span><br><span class="line">+---------------+------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.做命令软链接（MHA心跳检测会用到mysql命令，截取binlog会用到mysqlbinlog命令）（软链接到/usr/bin下让MHA能找到这两个命令。/usr/sbin下是超级用户）</span></span><br><span class="line">[root@db01 ~]<span class="comment"># ln -s /app/mysql/bin/mysql /usr/bin/mysql</span></span><br><span class="line">[root@db01 ~]<span class="comment"># ln -s /app/mysql/bin/mysqlbinlog /usr/bin/mysqlbinlog</span></span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># ln -s /app/mysql/bin/mysql /usr/bin/mysql</span></span><br><span class="line">[root@db02 ~]<span class="comment"># ln -s /app/mysql/bin/mysqlbinlog /usr/bin/mysqlbinlog</span></span><br><span class="line"></span><br><span class="line">[root@db03 ~]<span class="comment"># ln -s /app/mysql/bin/mysql /usr/bin/mysql</span></span><br><span class="line">[root@db03 ~]<span class="comment"># ln -s /app/mysql/bin/mysqlbinlog /usr/bin/mysqlbinlog</span></span><br><span class="line"></span><br><span class="line">[root@db04 ~]<span class="comment"># ln -s /app/mysql/bin/mysql /usr/bin/mysql</span></span><br><span class="line">[root@db04 ~]<span class="comment"># ln -s /app/mysql/bin/mysqlbinlog /usr/bin/mysqlbinlog</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.创建密钥对（配置ssh信任所有节点）</span></span><br><span class="line">[root@db01 ~]<span class="comment"># ssh-keygen -t dsa -P &#x27;&#x27; -f ~/.ssh/id_dsa &gt;/dev/null 2&gt;&amp;1</span></span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># ssh-keygen -t dsa -P &#x27;&#x27; -f ~/.ssh/id_dsa &gt;/dev/null 2&gt;&amp;1</span></span><br><span class="line"></span><br><span class="line">[root@db03 ~]<span class="comment"># ssh-keygen -t dsa -P &#x27;&#x27; -f ~/.ssh/id_dsa &gt;/dev/null 2&gt;&amp;1</span></span><br><span class="line"></span><br><span class="line">[root@db04 ~]<span class="comment"># ssh-keygen -t dsa -P &#x27;&#x27; -f ~/.ssh/id_dsa &gt;/dev/null 2&gt;&amp;1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.发送公钥（包括本机也发送）</span></span><br><span class="line">[root@db01 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_dsa.pub 172.16.1.51</span></span><br><span class="line">[root@db01 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_dsa.pub 172.16.1.52</span></span><br><span class="line">[root@db01 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_dsa.pub 172.16.1.53</span></span><br><span class="line">[root@db01 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_dsa.pub 172.16.1.54</span></span><br><span class="line"></span><br><span class="line">[root@db02 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_dsa.pub 172.16.1.51</span></span><br><span class="line">[root@db02 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_dsa.pub 172.16.1.52</span></span><br><span class="line">[root@db02 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_dsa.pub 172.16.1.53</span></span><br><span class="line">[root@db02 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_dsa.pub 172.16.1.54</span></span><br><span class="line"></span><br><span class="line">[root@db03 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_dsa.pub 172.16.1.51</span></span><br><span class="line">[root@db03 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_dsa.pub 172.16.1.52</span></span><br><span class="line">[root@db03 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_dsa.pub 172.16.1.53</span></span><br><span class="line">[root@db03 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_dsa.pub 172.16.1.54</span></span><br><span class="line"></span><br><span class="line">[root@db04 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_dsa.pub 172.16.1.51</span></span><br><span class="line">[root@db04 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_dsa.pub 172.16.1.52</span></span><br><span class="line">[root@db04 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_dsa.pub 172.16.1.53</span></span><br><span class="line">[root@db04 ~]<span class="comment"># ssh-copy-id -i ~/.ssh/id_dsa.pub 172.16.1.54</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.配置MHA配置文件</span></span><br><span class="line">[root@db03 ~]<span class="comment"># mkdir /etc/mha</span></span><br><span class="line">[root@db03 ~]<span class="comment"># vim /etc/mha/app1.cnf</span></span><br><span class="line"></span><br><span class="line">[server default]</span><br><span class="line">manager_log=/etc/mha/app1/log/manager.log</span><br><span class="line">manager_workdir=/etc/mha/app1</span><br><span class="line">master_binlog_dir=/app/mysql/data</span><br><span class="line">user=mha</span><br><span class="line">password=mha</span><br><span class="line">ping_interval=2</span><br><span class="line">repl_password=123</span><br><span class="line">repl_user=slave</span><br><span class="line">ssh_user=root</span><br><span class="line">ssh_port=22</span><br><span class="line"></span><br><span class="line">[server1]                        </span><br><span class="line">hostname=172.16.1.51</span><br><span class="line">port=3306                                  </span><br><span class="line"></span><br><span class="line">[server2]</span><br><span class="line"><span class="comment">#candidate_master=1</span></span><br><span class="line"><span class="comment">#check_repl_delay=0</span></span><br><span class="line">hostname=172.16.1.52</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">[server3]</span><br><span class="line">hostname=172.16.1.53</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">[server4]</span><br><span class="line">hostname=172.16.1.54</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.创建MHA的工作目录和日志目录</span></span><br><span class="line">[root@db03 ~]<span class="comment"># mkdir /etc/mha/app1/log -p</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.手动测试</span></span><br><span class="line">1）先测试ssh免密</span><br><span class="line">[root@db03 ~]<span class="comment"># masterha_check_ssh --conf=/etc/mha/app1.cnf</span></span><br><span class="line">All SSH connection tests passed successfully.</span><br><span class="line"></span><br><span class="line">2）测试主从复制情况</span><br><span class="line">[root@db03 ~]<span class="comment"># masterha_check_repl --conf=/etc/mha/app1.cnf</span></span><br><span class="line">MySQL Replication Health is OK.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 11.启动MHA</span></span><br><span class="line">[root@db03 ~]<span class="comment"># nohup masterha_manager --conf=/etc/mha/app1.cnf --remove_dead_master_conf --ignore_last_failover &lt; /dev/null &gt; /etc/mha/app1/log/manager.log 2&gt;&amp;1 &amp;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">nohup</span></span><br><span class="line">masterha_manager</span><br><span class="line">--conf=/etc/mha/app1.cnf</span><br><span class="line">--remove_dead_master_conf <span class="comment">## 从mha配置文件中删除宕机主库的配置</span></span><br><span class="line">--ignore_last_failover <span class="comment">## 忽略上一次，最新一次故障转移</span></span><br><span class="line">&lt; /dev/null</span><br><span class="line">&gt; /var/log/mha/app1/manager.log</span><br><span class="line">2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line">MHA工作机制：做完一次切换后，会在工作目录下生成一个锁文件，锁文件会存在8小时</span><br><span class="line">总结：MHA做完一次切换后，8小时之内，不会做第二次切换</span><br><span class="line"></span><br><span class="line"><span class="comment"># 12.检查mha状态</span></span><br><span class="line">[root@db03 ~]<span class="comment"># masterha_check_status --conf=/etc/mha/app1.cnf</span></span><br><span class="line">app1 (pid:20045) is running(0:PING_OK), master:172.16.1.51</span><br></pre></td></tr></table></figure><h3 id="做一次主从切换"><a href="#做一次主从切换" class="headerlink" title="做一次主从切换"></a>做一次主从切换</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先停掉主库mysql</span></span><br><span class="line">/etc/init.d/mysqld stop</span><br><span class="line"></span><br><span class="line"><span class="comment">#去管理节点从库查看切换日志</span></span><br><span class="line"><span class="built_in">tail</span> -f /etc/mha/app1/log/manager.log</span><br><span class="line"></span><br><span class="line"><span class="comment">## 检测是否是基于GTID的主从复制</span></span><br><span class="line">GTID failover mode = 0</span><br><span class="line"></span><br><span class="line"><span class="comment">## VIP脚本</span></span><br><span class="line">master_ip_failover_script is not <span class="built_in">set</span>. Skipping invalidating dead master IP address</span><br><span class="line"></span><br><span class="line"><span class="comment">## MHA如何保存binlog</span></span><br><span class="line">save_binary_logs \</span><br><span class="line">--<span class="built_in">command</span>=save \</span><br><span class="line">--start_file=mysql-bin.000001 \</span><br><span class="line">--start_pos=1028 \</span><br><span class="line">--binlog_dir=/app/mysql/data \</span><br><span class="line">--</span><br><span class="line"></span><br><span class="line">output_file=/var/tmp/saved_master_binlog_from_172.16.1.51_3306_2023</span><br><span class="line">0424083240.binlog \</span><br><span class="line">--handle_raw_binlog=1 \</span><br><span class="line">--disable_log_bin=0 \</span><br><span class="line">--manager_version=0.56</span><br><span class="line"></span><br><span class="line"><span class="comment">#主库宕机了先把截取的binlog保存到本地，然后立马发送到管理节点的机器上，然后比较relay logs日志找出数据最新的从库提升为新的主库，然后再把这份binlog发给新的主库上一份</span></span><br><span class="line">[root@db01 ~]<span class="comment"># ll /var/tmp/</span></span><br><span class="line">-rw-r--r-- 1 root root 177 Apr 24 08:32</span><br><span class="line">saved_master_binlog_from_172.16.1.51_3306_20230424083240.binlog</span><br><span class="line"></span><br><span class="line">root@db03,172.16.1.53:~ <span class="comment"># ll /etc/mha/app1</span></span><br><span class="line">-rw-r--r-- 1 root root 177 Apr 24 08:32</span><br><span class="line">saved_master_binlog_from_172.16.1.51_3306_20230424083240.binlog</span><br><span class="line"></span><br><span class="line"><span class="comment">## 没有检测到优先选举主库的配置</span></span><br><span class="line">Candidate masters from the configuration file:</span><br><span class="line">Non-candidate masters:</span><br><span class="line"></span><br><span class="line">1.数据相同情况下，所有从库都有可能提升为主库</span><br><span class="line">2.如果没有设置优先选主的参数，那么server标签越小优先级越高(优先数字最小)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 其他从库加入集群，执行下面change 语句 （很重要）</span></span><br><span class="line">All other slaves should start replication from here. Statement</span><br><span class="line">should be:</span><br><span class="line"></span><br><span class="line">CHANGE MASTER TO MASTER_HOST=<span class="string">&#x27;172.16.1.52&#x27;</span>, MASTER_PORT=3306,MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000001&#x27;</span>, MASTER_LOG_POS=154,MASTER_USER=<span class="string">&#x27;slave&#x27;</span>, MASTER_PASSWORD=<span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="comment">#MHA执行完自动切换后会把自己的进程杀掉</span></span><br><span class="line">masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 is stopped(2:NOT_RUNNING).</span><br><span class="line"><span class="comment">#要先找到/etc/mha/app1/log/manager.log中change master 语句在启动MHA</span></span><br></pre></td></tr></table></figure><h3 id="恢复MHA集群"><a href="#恢复MHA集群" class="headerlink" title="恢复MHA集群"></a>恢复MHA集群</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.修复宕机的主库并启动</span></span><br><span class="line">[root@db01 ~]<span class="comment"># /etc/init.d/mysqld start</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.在MHA日志中找到change master语句</span></span><br><span class="line">[root@db03 ~]<span class="comment"># grep -i &#x27;change master to&#x27; /etc/mha/app1/log/manager.log</span></span><br><span class="line">Mon Apr 24 08:32:46 2023 - [info] All other slaves should start</span><br><span class="line">replication from here. Statement should be: CHANGE MASTER TO</span><br><span class="line">MASTER_HOST=<span class="string">&#x27;172.16.1.52&#x27;</span>, MASTER_PORT=3306,</span><br><span class="line">MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000001&#x27;</span>, MASTER_LOG_POS=154,</span><br><span class="line">MASTER_USER=<span class="string">&#x27;slave&#x27;</span>, MASTER_PASSWORD=<span class="string">&#x27;xxx&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.修改密码在宕机主库执行</span></span><br><span class="line">CHANGE MASTER TO MASTER_HOST=<span class="string">&#x27;172.16.1.52&#x27;</span>, MASTER_PORT=3306,</span><br><span class="line">MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000001&#x27;</span>, MASTER_LOG_POS=154,</span><br><span class="line">MASTER_USER=<span class="string">&#x27;slave&#x27;</span>, MASTER_PASSWORD=<span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.开启主从复制</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.补全MHA配置文件</span></span><br><span class="line">[server default]</span><br><span class="line">manager_log=/etc/mha/app1/log/manager.log</span><br><span class="line">manager_workdir=/etc/mha/app1</span><br><span class="line">master_binlog_dir=/app/mysql/data</span><br><span class="line">password=mha</span><br><span class="line">ping_interval=2</span><br><span class="line">repl_password=123</span><br><span class="line">repl_user=slave</span><br><span class="line">ssh_port=22</span><br><span class="line">ssh_user=root</span><br><span class="line">user=mha</span><br><span class="line"></span><br><span class="line">[server1]</span><br><span class="line">hostname=172.16.1.51</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">[server2]</span><br><span class="line">hostname=172.16.1.52</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">[server3]</span><br><span class="line">hostname=172.16.1.53</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">[server4]</span><br><span class="line">hostname=172.16.1.54</span><br><span class="line"></span><br><span class="line"><span class="comment">#MHA执行完自动切换后会把自己的进程杀掉</span></span><br><span class="line"><span class="comment"># 6.启动MHA</span></span><br><span class="line"> [root@db03 ~]<span class="comment"># nohup masterha_manager --conf=/etc/mha/app1.cnf --remove_dead_master_conf --ignore_last_failover &lt; /dev/null &gt; /etc/mha/app1/log/manager.log 2&gt;&amp;1 &amp;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#7.检查mha状态</span></span><br><span class="line">[root@db03 ~]<span class="comment"># masterha_check_status --conf=/etc/mha/app1.cnf</span></span><br><span class="line">app1 (pid:17102) is running(0:PING_OK), master:172.16.1.52</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#模拟用户写入数据脚本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">mysql -umha -pmha -h172.16.1.51 -e <span class="string">&#x27;drop database zls;&#x27;</span></span><br><span class="line">mysql -umha -pmha -h172.16.1.51 -e <span class="string">&#x27;create database if not exists zls;&#x27;</span></span><br><span class="line">mysql -umha -pmha -h172.16.1.51 -e <span class="string">&#x27;use zls;create table if not exists zls1(id int);&#x27;</span></span><br><span class="line">num=0</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">  ((num ++))</span><br><span class="line">  mysql -umha -pmha -h172.16.1.51 -e <span class="string">&quot;insert into zls.zls1 values(<span class="variable">$num</span>);&quot;</span></span><br><span class="line">  <span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#模拟先停掉主库，在使用脚本自动恢复MHA集群</span></span><br><span class="line">/etc/init.d/mysqld stop</span><br><span class="line"></span><br><span class="line"><span class="comment">#自动恢复MHA集群脚本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">db_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line">mha_log_path=<span class="string">&#x27;/etc/mha/app1/log/manager.log&#x27;</span></span><br><span class="line">down_master_ip=`sed -nr <span class="string">&#x27;s#^Master (.*)\(.*!#\1#gp&#x27;</span> <span class="variable">$mha_log_path</span>`</span><br><span class="line">change_statment=`grep -i <span class="string">&#x27;change master to&#x27;</span> <span class="variable">$&#123;mha_log_path&#125;</span> | awk -F: <span class="string">&#x27;&#123;print $4&#125;&#x27;</span>|sed <span class="string">&quot;s#xxx#<span class="variable">$&#123;db_pass&#125;</span>#g&quot;</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment">#修复宕机的主库并启动</span></span><br><span class="line">ssh <span class="variable">$down_master_ip</span> <span class="string">&#x27;/etc/init.d/mysqld start&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改密码在宕机主库上执行</span></span><br><span class="line">mysql -umha -pmha -h<span class="variable">$&#123;down_master_ip&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;change_statment&#125;</span>;start slave&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/mha/app1.cnf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[server default]</span></span><br><span class="line"><span class="string">manager_log=/etc/mha/app1/log/manager.log</span></span><br><span class="line"><span class="string">manager_workdir=/etc/mha/app1</span></span><br><span class="line"><span class="string">master_binlog_dir=/app/mysql/data</span></span><br><span class="line"><span class="string">master_ip_failover_script=/etc/mha/app1/script/master_ip_failover</span></span><br><span class="line"><span class="string">password=mha</span></span><br><span class="line"><span class="string">ping_interval=2</span></span><br><span class="line"><span class="string">repl_password=123</span></span><br><span class="line"><span class="string">repl_user=slave</span></span><br><span class="line"><span class="string">ssh_port=22</span></span><br><span class="line"><span class="string">ssh_user=root</span></span><br><span class="line"><span class="string">user=mha</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[server1]</span></span><br><span class="line"><span class="string">hostname=172.16.1.51</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[server2]</span></span><br><span class="line"><span class="string">hostname=172.16.1.52</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[server3]</span></span><br><span class="line"><span class="string">hostname=172.16.1.53</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[server4]</span></span><br><span class="line"><span class="string">hostname=172.16.1.54</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#MHA执行完自动切换后会把自己的进程杀掉</span></span><br><span class="line"><span class="comment"># 6.启动MHA</span></span><br><span class="line"> [root@db03 ~]<span class="comment"># nohup masterha_manager --conf=/etc/mha/app1.cnf --remove_dead_master_conf --ignore_last_failover &lt; /dev/null &gt; /etc/mha/app1/log/manager.log 2&gt;&amp;1 &amp;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#7.检查mha状态</span></span><br><span class="line">[root@db03 ~]<span class="comment"># masterha_check_status --conf=/etc/mha/app1.cnf</span></span><br><span class="line">app1 (pid:17102) is running(0:PING_OK), master:172.16.1.52</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试让52这台机器为主库</span></span><br><span class="line">vim /etc/mha/app1.cnf</span><br><span class="line"></span><br><span class="line">[server2]</span><br><span class="line">candidate_master=1    <span class="comment">#优先为主库，缺点如果落后超过100M就不生效</span></span><br><span class="line">check_repl_delay=0    <span class="comment">#关掉检测主从的延迟超过，这样落后一个T也能优先为主库</span></span><br><span class="line">hostname=172.16.1.52</span><br><span class="line">port=3306</span><br><span class="line"><span class="comment">#先停掉MHA</span></span><br><span class="line">masterha_stop --conf=/etc/mha/app1.cnf</span><br><span class="line">在启动MHA使配置文件生效</span><br><span class="line"><span class="comment"># 先停掉52机器IO线程，在停51，最后停53，这是从库数据最新是53</span></span><br><span class="line">stop slave io_thread;</span><br><span class="line"><span class="comment">#停主库54</span></span><br><span class="line">/etc/init.d/mysqld stop</span><br><span class="line"><span class="comment">#去53机器管理节点从库查看切换日志</span></span><br><span class="line"><span class="built_in">tail</span> -f /etc/mha/app1/log/manager.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行脚本恢复54机器MHA集群</span></span><br><span class="line"><span class="comment">#注意mysql数据设置主键，不然会再来一遍数据</span></span><br></pre></td></tr></table></figure><h2 id="MHA的VIP-Perl语言写的"><a href="#MHA的VIP-Perl语言写的" class="headerlink" title="MHA的VIP  (Perl语言写的)"></a>MHA的VIP  (Perl语言写的)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.手动给主库绑定VIP</span></span><br><span class="line">[root@db02 ~]<span class="comment"># ifconfig eth1:1 172.16.1.55/24</span></span><br><span class="line"><span class="comment">#查看ifconfig</span></span><br><span class="line">ping 172.16.1.55</span><br><span class="line"><span class="comment">#当主库52宕机了VIP会飘到下一个主库51上面，其实是管理节点这台机器执行了下面操作</span></span><br><span class="line">ssh 172.16.1.52 <span class="string">&#x27;ifconfig eth1:1 down&#x27;</span>    <span class="comment">#停止VIP</span></span><br><span class="line">ssh 172.16.1.51 <span class="string">&#x27;ifconfig eth1:1 172.16.1.55/24&#x27;</span>   <span class="comment">#启动VIP</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.创建脚本存放目录</span></span><br><span class="line">[root@db03 ~]<span class="comment"># mkdir /etc/mha/app1/script</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.下载脚本</span></span><br><span class="line">[root@db03 ~]<span class="comment"># cd /etc/mha/app1/script </span></span><br><span class="line">[root@db03 script]<span class="comment"># wget http://test.driverzeng.com/MySQL_File/master_ip_failover</span></span><br><span class="line">my <span class="variable">$vip</span> = <span class="string">&#x27;172.16.1.55/24&#x27;</span>;</span><br><span class="line">my <span class="variable">$key</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">my <span class="variable">$ssh_start_vip</span> = <span class="string">&quot;/sbin/ifconfig eth1:<span class="variable">$key</span> <span class="variable">$vip</span>&quot;</span>;</span><br><span class="line">my <span class="variable">$ssh_stop_vip</span> = <span class="string">&quot;/sbin/ifconfig eth1:<span class="variable">$key</span> down&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.让MHA认识这个脚本（修改MHA配置文件）</span></span><br><span class="line">vim /etc/mha/app1.cnf</span><br><span class="line">master_ip_failover_script=/etc/mha/app1/script/master_ip_failover</span><br><span class="line"><span class="comment">#重启MHA，检查状态</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.添加执行权限</span></span><br><span class="line">[root@db03 script]<span class="comment"># chmod +x /etc/mha/app1/script/master_ip_failover</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.转换格式</span></span><br><span class="line">[root@db03 script]<span class="comment"># dos2unix /etc/mha/app1/script/master_ip_failover</span></span><br><span class="line"></span><br><span class="line">dos2unix: converting file /etc/mha/app1/script/master_ip_failover</span><br><span class="line">to Unix format ...</span><br><span class="line"><span class="comment">#重启MHA，检查状态</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 脚本导致mha起不来的原因：</span></span><br><span class="line">1）语法问题 // Perl语言</span><br><span class="line">2）权限问题 // 执行权限</span><br><span class="line">3）格式问题 // unix格式</span><br></pre></td></tr></table></figure><h2 id="MHA的binlog-server"><a href="#MHA的binlog-server" class="headerlink" title="MHA的binlog-server"></a><strong>MHA</strong>的<strong>binlog-server</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.修改mha配置文件</span></span><br><span class="line">[root@db03 ~]<span class="comment"># vim /etc/mha/app1.cnf</span></span><br><span class="line">[binlog1]</span><br><span class="line">no_master=1       <span class="comment">#永远不会被提升为主库</span></span><br><span class="line">hostname=172.16.1.53</span><br><span class="line">master_binlog_dir=/data/mysql/binlog/</span><br><span class="line"></span><br><span class="line"><span class="comment">#分布式保存binlog</span></span><br><span class="line">[binlog2]</span><br><span class="line">hostname=172.16.1.51</span><br><span class="line">master_binlog_dir=/data/mysql/binlog/</span><br><span class="line">[binlog3]</span><br><span class="line">hostname=172.16.1.52</span><br><span class="line">master_binlog_dir=/data/mysql/binlog/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.创建存放binlog同步的目录</span></span><br><span class="line">[root@db03 ~]<span class="comment"># mkdir /data/mysql/binlog -p</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.MySQL自带同步binlog的工具 mysqlbinlog</span></span><br><span class="line">[root@db03 ~]<span class="comment"># cd /data/mysql/binlog/</span></span><br><span class="line">[root@db03 binlog]<span class="comment"># mysqlbinlog -R --host=172.16.1.55 --user=mha --password=mha --raw --stop-never mysql-bin.000001 &amp;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Mysql数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL读写分离方案(15)</title>
      <link href="/2022/10/17/MySQL/Day15MySQL%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%96%B9%E6%A1%88/"/>
      <url>/2022/10/17/MySQL/Day15MySQL%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="MySQL读写分离方案"><a href="#MySQL读写分离方案" class="headerlink" title="MySQL读写分离方案"></a>MySQL读写分离方案</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#给数据库加缓存服务器可以解决mysql主从复制查询数据库时数据量不一样的问题</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112738493.png" alt="image-20230518112738493"></p><h2 id="Atlas简介"><a href="#Atlas简介" class="headerlink" title="Atlas简介"></a>Atlas简介</h2><p>Atlas是由 Qihoo 360公司Web平台部基础架构团队开发维护的一个基于MySQL协议的数据<br>中间层项目。它在MySQL官方推出的MySQL-Proxy 0.8.2版本的基础上，修改了大量bug，<br>添加了很多功能特性。</p><p>官网<a href="https://github.com/">https://github.com/</a></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230518112752479.png" alt="image-20230518112752479"></p><h2 id="Atlas主要功能"><a href="#Atlas主要功能" class="headerlink" title="Atlas主要功能"></a>Atlas主要功能</h2><p>1.读写分离</p><p>2.从库负载均衡</p><p>3.IP过滤</p><p>4.自动分表：水平拆分，垂直拆分(按字段拆分）</p><p>5.DBA可平滑上下线DB</p><p>6.自动摘除宕机的DB</p><p>Atlas相对于官方MySQL-Proxy的优势</p><p>1.将主流程中所有Lua代码用C重写，Lua仅用于管理接口</p><p>2.重写网络模型、线程模型</p><p>3.实现了真正意义上的连接池</p><p>4.优化了锁机制，性能提高数十倍</p><h2 id="Atlas安装配置"><a href="#Atlas安装配置" class="headerlink" title="Atlas安装配置"></a>Atlas安装配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#atlas那台机器都可以安装，程序就连atlas的IP，不用连接MHA的VIP了</span></span><br><span class="line">1）Atlas (普通) : Atlas-2.2.1.el6.x86_64.rpm</span><br><span class="line">2）Atlas (分表) : Atlas-sharding_1.0.1-el6.x86_64.rpm</span><br><span class="line"><span class="comment">#查看大小</span></span><br><span class="line"><span class="built_in">du</span> -sh Atlas-2.2.1.el6.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.下载</span></span><br><span class="line">[root@db01 ~]<span class="comment"># wget http://test.driverzeng.com/MySQL_plugins/Atlas-2.2.1.el6.x86_64.rpm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.安装</span></span><br><span class="line">[root@db01 ~]<span class="comment"># rpm -ivh Atlas-2.2.1.el6.x86_64.rpm</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置文件位置</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/mysql-proxy/conf/</span><br><span class="line">vim test.cnf</span><br><span class="line"><span class="comment"># 管理接口的用户名</span></span><br><span class="line">admin-username = user</span><br><span class="line"><span class="comment"># 管理接口的密码</span></span><br><span class="line">admin-password = <span class="built_in">pwd</span></span><br><span class="line"><span class="comment">#Atlas监听的管理接口IP和端口</span></span><br><span class="line">admin-address = 0.0.0.0:2345</span><br><span class="line"><span class="comment">#实例名称，用于同一台机器上多个Atlas实例间的区分</span></span><br><span class="line"><span class="comment">#instance = test</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置程序连接数据库用户密码加密让atlas认识，给密码加密</span></span><br><span class="line">/usr/local/mysql-proxy/bin/encrypt 123</span><br><span class="line">3yb5jEku5h4=</span><br><span class="line">/usr/local/mysql-proxy/bin/encrypt mha</span><br><span class="line">O2jBXONX098=</span><br><span class="line"><span class="comment">#工作线程数，对Atlas的性能有很大影响，可根据情况适当设置，根据CPU核心数来设置</span></span><br><span class="line">event-threads = 8</span><br><span class="line"><span class="comment">#查看CUP核心数</span></span><br><span class="line">top 1</span><br><span class="line">lscpu</span><br><span class="line"></span><br><span class="line">[root@db01 ~]<span class="comment"># cat /usr/local/mysql-proxy/conf/test.cnf</span></span><br><span class="line">[mysql-proxy]</span><br><span class="line"><span class="comment">#带#号的为非必需的配置项目</span></span><br><span class="line"><span class="comment">#管理接口的用户名</span></span><br><span class="line">admin-username = user</span><br><span class="line"><span class="comment">#管理接口的密码</span></span><br><span class="line">admin-password = <span class="built_in">pwd</span></span><br><span class="line"><span class="comment">#Atlas后端连接的MySQL主库的IP和端口，可设置多项，用逗号分隔</span></span><br><span class="line">proxy-backend-addresses = 172.16.1.55:3306</span><br><span class="line"><span class="comment">#Atlas后端连接的MySQL从库的IP和端口，@后面的数字代表权重，用来作负载均衡，若省</span></span><br><span class="line">略则默认为1，可设置多项，用逗号分隔</span><br><span class="line">proxy-read-only-backend-addresses =</span><br><span class="line">172.16.1.52:3306,172.16.1.53:3306,172.16.1.54:3306</span><br><span class="line"><span class="comment">#用户名与其对应的加密过的MySQL密码，密码使用PREFIX/bin目录下的加密程序</span></span><br><span class="line">encrypt加密，下行的user1和user2为示例，将其替换为你的MySQL的用户名和加密密</span><br><span class="line">码！</span><br><span class="line">pwds = root:3yb5jEku5h4=,mha:O2jBXONX098=</span><br><span class="line"><span class="comment">#设置Atlas的运行方式，设为true时为守护进程方式，设为false时为前台方式，一般开</span></span><br><span class="line">发调试时设为<span class="literal">false</span>，线上运行时设为<span class="literal">true</span>,<span class="literal">true</span>后面不能有空格。</span><br><span class="line">daemon = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置Atlas的运行方式，设为true时Atlas会启动两个进程，一个为monitor，一个为</span></span><br><span class="line">worker，monitor在worker意外退出后会自动将其重启，设为<span class="literal">false</span>时只有worker，没</span><br><span class="line">有monitor，一般开发调试时设为<span class="literal">false</span>，线上运行时设为<span class="literal">true</span>,<span class="literal">true</span>后面不能有空格。</span><br><span class="line">keepalive = <span class="literal">true</span></span><br><span class="line"><span class="comment">#工作线程数，对Atlas的性能有很大影响，可根据情况适当设置，根据CPU核心数来设置</span></span><br><span class="line">event-threads = 8</span><br><span class="line"></span><br><span class="line"><span class="comment">#日志级别，分为message、warning、critical、error、debug五个级别</span></span><br><span class="line">log-level = error</span><br><span class="line"></span><br><span class="line"><span class="comment">#日志存放的路径</span></span><br><span class="line">log-path = /usr/local/mysql-proxy/log</span><br><span class="line"></span><br><span class="line"><span class="comment">#SQL日志的开关，可设置为OFF、ON、REALTIME，OFF代表不记录SQL日志，ON代表记录</span></span><br><span class="line">SQL日志，REALTIME代表记录SQL日志且实时写入磁盘，默认为OFF</span><br><span class="line">sql-log = ON</span><br><span class="line"><span class="comment">#慢日志输出设置。当设置了该参数时，则日志只输出执行时间超过sql-log-slow（单</span></span><br><span class="line">位：ms)的日志记录。不设置该参数则输出全部日志。</span><br><span class="line">sql-log-slow = 10</span><br><span class="line"><span class="comment">#实例名称，用于同一台机器上多个Atlas实例间的区分</span></span><br><span class="line"><span class="comment">#instance = test</span></span><br><span class="line"><span class="comment">#Atlas监听的工作接口IP和端口</span></span><br><span class="line">proxy-address = 0.0.0.0:3307</span><br><span class="line"><span class="comment">#Atlas监听的管理接口IP和端口</span></span><br><span class="line">admin-address = 0.0.0.0:2345</span><br><span class="line"><span class="comment">#分表设置，此例中person为库名，mt为表名，id为分表字段，3为子表数量，可设置多</span></span><br><span class="line">项，以逗号分隔，若不分表则不需要设置该项</span><br><span class="line"><span class="comment">#tables = person.mt.id.3</span></span><br><span class="line"><span class="comment">#默认字符集，设置该项后客户端不再需要执行SET NAMES语句</span></span><br><span class="line">charset = utf8</span><br><span class="line"><span class="comment">#允许连接Atlas的客户端的IP，可以是精确IP，也可以是IP段，以逗号分隔，若不设置该</span></span><br><span class="line">项则允许所有IP连接，否则只允许列表中的IP连接</span><br><span class="line"><span class="comment">#client-ips = 127.0.0.1, 192.168.1</span></span><br><span class="line"><span class="comment">#Atlas前面挂接的LVS的物理网卡的IP(注意不是虚IP)，若有LVS且设置了client-ips</span></span><br><span class="line">则此项必须设置，否则可以不设置</span><br><span class="line"><span class="comment">#lvs-ips = 192.168.1.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.启动atlas</span></span><br><span class="line">[root@db01 conf]<span class="comment"># /usr/local/mysql-proxy/bin/mysql-proxyd test start</span></span><br></pre></td></tr></table></figure><h3 id="Atlas多实例"><a href="#Atlas多实例" class="headerlink" title="Atlas多实例"></a>Atlas多实例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.配置文件修改实例名称</span></span><br><span class="line"><span class="comment">#实例名称，用于同一台机器上多个Atlas实例间的区分,配置文件名与实例名称一致,端口不能冲突</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/mysql-proxy/</span><br><span class="line"><span class="built_in">cp</span> test.cnf base.cnf</span><br><span class="line">vim base.cnf</span><br><span class="line">instance = base</span><br><span class="line"><span class="comment">#启动</span></span><br><span class="line">[root@db01 conf]<span class="comment"># /usr/local/mysql-proxy/bin/mysql-proxyd base start</span></span><br></pre></td></tr></table></figure><h2 id="Atlas管理接口"><a href="#Atlas管理接口" class="headerlink" title="Atlas管理接口"></a>Atlas管理接口</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#连接</span></span><br><span class="line">[root@db01 conf]<span class="comment"># mysql -uuser -ppwd -h127.0.0.1 -P2345</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from <span class="built_in">help</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看后端代理的所有的数据库以及状态</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from backends;</span><br><span class="line">+-------------+------------------+-------+------+</span><br><span class="line">| backend_ndx | address          | state | <span class="built_in">type</span> |</span><br><span class="line">+-------------+------------------+-------+------+</span><br><span class="line">|           1 | 172.16.1.51:3306 | up    | rw   |</span><br><span class="line">|           2 | 172.16.1.52:3306 | up    | ro   |</span><br><span class="line">|           3 | 172.16.1.53:3306 | up    | ro   |</span><br><span class="line">|           4 | 172.16.1.54:3306 | up    | ro   |</span><br><span class="line">+-------------+------------------+-------+------+</span><br><span class="line"></span><br><span class="line"><span class="comment">## 下线指定DB</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> offline 2;</span><br><span class="line">+-------------+------------------+---------+------+</span><br><span class="line">| backend_ndx | address | state | <span class="built_in">type</span> |</span><br><span class="line">+-------------+------------------+---------+------+</span><br><span class="line">| 2 | 172.16.1.52:3306 | offline | ro |</span><br><span class="line">+-------------+------------------+---------+------+</span><br><span class="line"></span><br><span class="line"><span class="comment">## 上线指定DB</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> online 2;</span><br><span class="line">+-------------+------------------+---------+------+</span><br><span class="line">| backend_ndx | address | state | <span class="built_in">type</span> |</span><br><span class="line">+-------------+------------------+---------+------+</span><br><span class="line">| 2 | 172.16.1.52:3306 | unknown | ro |</span><br><span class="line">+-------------+------------------+---------+------+</span><br><span class="line"></span><br><span class="line"><span class="comment">## 添加一台主库</span></span><br><span class="line">mysql&gt; add master 172.16.1.88:3306;</span><br><span class="line">mysql&gt; SELECT * FROM backends;</span><br><span class="line">+-------------+------------------+-------+------+</span><br><span class="line">| backend_ndx | address | state | <span class="built_in">type</span> |</span><br><span class="line">+-------------+------------------+-------+------+</span><br><span class="line">| 1 | 172.16.1.55:3306 | up | rw |</span><br><span class="line">| 2 | 172.16.1.88:3306 | down | rw |</span><br><span class="line">| 3 | 172.16.1.53:3306 | up | ro |</span><br><span class="line">| 4 | 172.16.1.54:3306 | up | ro |</span><br><span class="line">| 5 | 172.16.1.52:3306 | up | ro |</span><br><span class="line">+-------------+------------------+-------+------+</span><br><span class="line"></span><br><span class="line"><span class="comment">## 添加一台从库</span></span><br><span class="line">mysql&gt; add slave 172.16.1.54:3306;</span><br><span class="line">mysql&gt; SELECT * FROM backends;</span><br><span class="line">+-------------+------------------+-------+------+</span><br><span class="line">| backend_ndx | address | state | <span class="built_in">type</span> |</span><br><span class="line">+-------------+------------------+-------+------+</span><br><span class="line">| 1 | 172.16.1.55:3306 | up | rw |</span><br><span class="line">| 2 | 172.16.1.52:3306 | up | ro |</span><br><span class="line">| 3 | 172.16.1.53:3306 | up | ro |</span><br><span class="line">| 4 | 172.16.1.54:3306 | up | ro |</span><br><span class="line">+-------------+------------------+-------+------+</span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除一个后端节点</span></span><br><span class="line">mysql&gt; remove backend 2;</span><br><span class="line"></span><br><span class="line"><span class="comment">## Atlas结合MHA一起使用（MHA切换时）</span></span><br><span class="line">mysql&gt; remove backend 2;  // 摘除被提升为主库的从库</span><br><span class="line">mysql&gt; add slave 172.16.1.51:3306;   // 将旧主库加入到从库中</span><br><span class="line">mysql&gt; save config;  // 保存atlas配置</span><br><span class="line"></span><br><span class="line"><span class="comment">## 添加一个客户端（允许连接atlas的客户端）</span></span><br><span class="line">mysql&gt; ADD CLIENT 10.0.0.0;</span><br><span class="line">Empty <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; save config;</span><br><span class="line">Empty <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除一个客户端</span></span><br><span class="line">mysql&gt; remove client 10.0.0.0;</span><br><span class="line">Empty <span class="built_in">set</span> (0.00 sec)</span><br><span class="line">mysql&gt; SELECT * FROM clients;</span><br><span class="line">Empty <span class="built_in">set</span> (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看atlas支持的MySQL用户和密码</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from pwds;</span><br><span class="line">+----------+--------------+</span><br><span class="line">| username | password |</span><br><span class="line">+----------+--------------+</span><br><span class="line">| root | 3yb5jEku5h4= |</span><br><span class="line">| mha | O2jBXONX098= |</span><br><span class="line">+----------+--------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">## 使用接口添加用户</span></span><br><span class="line">mysql&gt; add <span class="built_in">pwd</span> zls:123;</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from pwds;</span><br><span class="line">+----------+--------------+</span><br><span class="line">| username | password |</span><br><span class="line">+----------+--------------+</span><br><span class="line">| root | 3yb5jEku5h4= |</span><br><span class="line">| mha | O2jBXONX098= |</span><br><span class="line">| zls | 3yb5jEku5h4= |</span><br><span class="line">+----------+--------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">## 使用接口添加一个加过密的密码用户</span></span><br><span class="line">mysql&gt; add enpwd zls2:O2jBXONX098=;</span><br><span class="line">Empty <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from pwds;</span><br><span class="line">+----------+--------------+</span><br><span class="line">| username | password |</span><br><span class="line">+----------+--------------+</span><br><span class="line">| root | 3yb5jEku5h4= |</span><br><span class="line">| mha | O2jBXONX098= |</span><br><span class="line">| zls | 3yb5jEku5h4= |</span><br><span class="line">| zls2 | O2jBXONX098= |</span><br><span class="line">+----------+--------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除用户和密码</span></span><br><span class="line">mysql&gt; remove <span class="built_in">pwd</span> zls2;</span><br><span class="line">Empty <span class="built_in">set</span> (0.00 sec)</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from pwds;</span><br><span class="line">+----------+--------------+</span><br><span class="line">| username | password |</span><br><span class="line">+----------+--------------+</span><br><span class="line">| root | 3yb5jEku5h4= |</span><br><span class="line">| mha | O2jBXONX098= |</span><br><span class="line">+----------+--------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">## 将所有操作保存到配置文件</span></span><br><span class="line">mysql&gt; save config;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看Atlas版本</span></span><br><span class="line">mysql&gt; SELECT VERSION;</span><br><span class="line">+---------+</span><br><span class="line">| version |</span><br><span class="line">+---------+</span><br><span class="line">| 2.2.1 |</span><br><span class="line">+---------+</span><br></pre></td></tr></table></figure><h2 id="MHA结合Atlas使用"><a href="#MHA结合Atlas使用" class="headerlink" title="MHA结合Atlas使用"></a>MHA结合Atlas使用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@db03 ~]<span class="comment"># masterha_check_status --conf=/etc/mha/app1.cnf</span></span><br><span class="line">app1 (pid:109720) is running(0:PING_OK), master:172.16.1.52</span><br><span class="line"></span><br><span class="line">52 主库</span><br><span class="line">53 54 51 从库</span><br><span class="line"></span><br><span class="line">[root@db03 ~]<span class="comment"># mysql -uuser -ppwd -h172.16.1.51 -P2345 -e &#x27;select *</span></span><br><span class="line">from backends<span class="string">&#x27;</span></span><br><span class="line"><span class="string">+-------------+------------------+-------+------+</span></span><br><span class="line"><span class="string">| backend_ndx | address | state | type |</span></span><br><span class="line"><span class="string">+-------------+------------------+-------+------+</span></span><br><span class="line"><span class="string">| 1 | 172.16.1.55:3306 | up | rw |</span></span><br><span class="line"><span class="string">| 2 | 172.16.1.53:3306 | up | ro |</span></span><br><span class="line"><span class="string">| 3 | 172.16.1.54:3306 | up | ro |</span></span><br><span class="line"><span class="string">| 4 | 172.16.1.51:3306 | up | ro |</span></span><br><span class="line"><span class="string">+-------------+------------------+-------+------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">vim /etc/mha/app1/script/master_ip_failover</span></span><br><span class="line"><span class="string">sub start_vip() &#123;</span></span><br><span class="line"><span class="string">`ssh $ssh_user\@$new_master_host \&quot; $ssh_start_vip \&quot;`;</span></span><br><span class="line"><span class="string">`/bin/sh -x /etc/mha/app1/script/mha_atlas.sh`</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@db03 ~]# mysql -uuser -ppwd -h172.16.1.51 -P2345 -e &#x27;</span><span class="keyword">select</span> *</span><br><span class="line">from backends<span class="string">&#x27;</span></span><br><span class="line"><span class="string">+-------------+------------------+-------+------+</span></span><br><span class="line"><span class="string">| backend_ndx | address | state | type |</span></span><br><span class="line"><span class="string">+-------------+------------------+-------+------+</span></span><br><span class="line"><span class="string">| 1 | 172.16.1.55:3306 | up | rw |</span></span><br><span class="line"><span class="string">| 2 | 172.16.1.53:3306 | up | ro |</span></span><br><span class="line"><span class="string">| 3 | 172.16.1.54:3306 | up | ro |</span></span><br><span class="line"><span class="string">| 4 | 172.16.1.52:3306 | up | ro |</span></span><br><span class="line"><span class="string">+-------------+------------------+-------+------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">+-------------+------------------+-------+------+</span></span><br><span class="line"><span class="string">| backend_ndx | address | state | type |</span></span><br><span class="line"><span class="string">+-------------+------------------+-------+------+</span></span><br><span class="line"><span class="string">| 1 | 172.16.1.55:3306 | up | rw |</span></span><br><span class="line"><span class="string">| 2 | 172.16.1.53:3306 | up | ro |</span></span><br><span class="line"><span class="string">| 3 | 172.16.1.51:3306 | up | ro |</span></span><br><span class="line"><span class="string">| 4 | 172.16.1.52:3306 | up | ro |</span></span><br><span class="line"><span class="string">+-------------+------------------+-------+------+</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Mysql数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>人生小感悟</title>
      <link href="/2022/10/17/%E6%96%87%E6%A1%A3/%E4%BA%BA%E7%94%9F%E6%84%9F%E6%82%9F%E8%AF%AD%E5%BD%95/"/>
      <url>/2022/10/17/%E6%96%87%E6%A1%A3/%E4%BA%BA%E7%94%9F%E6%84%9F%E6%82%9F%E8%AF%AD%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>一、不惊扰别人的宁静，就是慈悲；不伤害别人的自尊，就是善良。人活着，发自己的光就好，不要吹灭别人的灯。<br>二、不要总因为一点小事心情就一团糟，有些情绪真的没必要，纯属庸人自扰。反正我们谁也别想活着从这个世界离开，所以笑一笑，只要死不了，其他又有什么大不了。<br>三、永远不要怪别人不帮你，也永远别怪他人不关心你。活在世上，我们都是独立的个体，痛苦难受都得自己承受。没人能真正理解你，石头没砸在他脚上，他永远体会不到有多疼。<br>四、在智商过剩的年代，走心是唯一的技巧。在情绪泛滥的年纪，实力是最大的底牌。<br>五、其实让人焦虑的，不是忙也不是累，而是没有什么特别感兴趣的东西，也没有什么特别想爱的人，明知道自己该努力了，却又不知道该往哪里用力。<br><img src="https://img2.baidu.com/it/u=2580867484,985994348&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=281" alt="开开心心"><br>六、没人在乎你怎样在深夜痛哭，也没人在乎你辗转反侧的要熬几个秋。外人只看结果，自己独撑过程。等我们都明白了这个道理，便不会再在人前矫情，四处诉说以求宽慰。<br>七、不可乘喜而轻诺，不可乘快而多事，不可因倦而鲜终。不要一时高兴就向别人许诺什么，万一做不到，到时候就会落下埋怨，还会被人指责轻诺寡信。<br>八、你想过普通的生活，就会遇到普通的挫折。你想过最好的生活，就一定会遇上最强的伤害。这个世界很公平，想要最好，就一定会给你最痛。<br>九、人活着脸皮就要厚点，这也不好意思，那也不好意思，那你怎么好意思活着？出错了出丑了一笑而过，有什么好怕的？当你对这个世界好意思的时候，成长才会与日俱增。<br>十、别指望所有人都能懂你，因为萝卜青菜，各有所爱。你做了萝卜，自然就做不成青菜。<br><img src="https://img1.baidu.com/it/u=3340678434,1339355069&fm=253&fmt=auto&app=120&f=JPEG?w=1422&h=800" alt="开开心心"><br>十一、遇事不要急躁。不要急于下结论，尤其生气时不要做决断，要学会换位思考，大事化小、小事化了，把复杂的事情尽量简单处理，千万不要把简单的事情复杂化。<br>十二、与其担忧将来，不如努力现在。成功的路上，只有拼搏才可以给自己安全感。不必随便把理想寄托在某一个人身上，也不必太在意身边的耳语，因为将来是你自己的，只有你自己能给自己最大的安全感。<br>十三、人生的意义是什么，我一时回答不上来。但是我想，人生是由细碎的快乐和各种各样的苦辣酸甜堆起来的吧，什么味道都有，甜的收藏，苦的舍弃。<br>十四、生活有时会逼迫你，不得不交出权力，不得不放走机会，甚至不得不抛下爱情。你不可能什么都获得，生活中应当学会放弃，如同清理电脑中的文件一样。<br>十五、不要轻言你是在为谁付出和牺牲，其实所有的付出和牺牲最终的受益人都是自己。人生是一场与任何人无关的独自的修行，这是一条悲欣交集的道路，路的尽头一定有礼物，就看你配不配得到。<br><img src="https://img2.baidu.com/it/u=2592547089,1129050512&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" alt="开开心心"><br>十六、这个世界没有那么多将心比心。你善良，他便得寸进尺，你软弱，他便狠心欺骗，你正直，他便道德压榨。把深情交付与错误的人，就别责怪这个社会不温暖。<br>十七、不要因为害怕失去，而不敢拥有，否则，你就失去人生。同样，不要因为拥有什么，而担心它的失去，否则，你就失去自我。<br>十八、如果选择了安逸懒惰，那就做好准备接受未来的平庸艰难；若是心有不甘，就从现在开始直面挑战。生命中没有一种状态，能比不懈努力更能让我们活得理直气壮。只有受得了旅途风雨，才能看得到彩虹满天……<br>十九、能说出的委屈，便不算委屈；能够抢走的爱人，便不算爱人。<br>二十、发怒，是用别人错误惩罚自己；烦恼，是用自己的过失折磨自己；后悔，是用无奈的往事摧残自己；忧虑，是用虚拟的风险惊吓自己。<br>二一、当你落魄的连五毛钱辣条都买不起的时候，没人会认识你知道你在意你，甚至在他们眼中你这辈子也就这样了；但是当你有钱的时候，或许你自己都不经意的一个动作都会获得很多人的赞美，这就是社会。</p>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 休闲娱乐 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>越早知道越好的20条人生建议</title>
      <link href="/2022/10/17/%E6%96%87%E6%A1%A3/%E5%BB%BA%E8%AE%AE/"/>
      <url>/2022/10/17/%E6%96%87%E6%A1%A3/%E5%BB%BA%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://img2.baidu.com/it/u=1851484057,3475284405&fm=253&fmt=auto&app=120&f=JPEG?w=1132&h=800" alt="开开心心"><br>越早知道越好的20条人生建议：<br>1、不管多忙，也要每天坚持运动。肥宅的魅力值只有10，运动的人魅力值是150。<br>2、把「想做」变成「去做」。想提升自己，就先看两本书，而不是把时间浪费在考虑上。<br>3、不要过分相信自己的眼睛，你看到的真相也许是个「加工品」。在准备做出判断时，先给自己留出30秒的思考时间，剥开事物的表象，用理性去分辨和判断事实的真伪。<br>4、年轻时走的「弯路」，都是去看世界的「上坡路」。一切的艰难都是为了成功「登顶」做准备，而只有坚持下去的人，才能成为最优秀的1%。<br>5、「爱人先爱己，谋爱先谋生」。当你没有「面包」时，爱情一定会在日常琐碎中消耗殆尽。<br><img src="https://img2.baidu.com/it/u=2847232549,2214607616&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="幸福健康"><br>6、你以为你没有热爱，其实是总在浅尝辄止，没有为你的喜欢花费时间，忘了热爱需要付出持续不断的精力和心血。<br>7、早睡早起是性价比最高的自律，熬夜追剧打游戏的人，日常的工作效率至少比旁人低3倍，而能做好时间管理的人，成长速度却会快于80%的同龄人。<br>8、失败+自省&#x3D;进步，自省是我们用来发现自身不足，完善自我，并逐步走向成功的一个工具。能利用好自省的人，无论在工作还是学业上都会成为佼佼者，得到自己想要的一切。<br>9、你的财力、地位和能力决定了你的社交价值，你有多少实力就能获得多少人脉。盲目巴结，而不注重提升自身，那你永远都入不了他人的眼。<br>10、别和假装看不到你私信消息的人深交。<br><img src="https://img0.baidu.com/it/u=1551933435,847125014&fm=253&fmt=auto&app=120&f=JPEG?w=1422&h=800" alt="快快乐乐"><br>11、年轻时穷一点很正常，普通人的起步都不会太早，那些年轻有为的只是凤毛麟角。三十而立，所以踏实稳干，不要操之过急，允许成功来得晚一点。<br>12、没人会在意你的梦想是什么，大家只会在意你到底有多大的成就。<br>13、气场不合的人，第一眼就喜欢不起来，哪怕天天待一块，也只会越看越讨厌。<br>14、对一个目标的期望值要低于实际行动的付出，12分的努力只抱6分的期望，这不是自卑，而是变相的情绪管理。高期望等同于高负担，适当降低期望值，我们的幸福指数会直线上涨。<br>15、不要在意是否能得到所有人的喜欢，连父母都会有偏心的时候，我们又怎么可能让不相干的外人都喜欢我们。<br><img src="https://img1.baidu.com/it/u=8754750,3529206946&fm=253&fmt=auto&app=120&f=JPEG?w=1132&h=800" alt="春风十里"><br>16、别没事在背后嚼人舌根，隔墙有耳。尤其在厕所那种场合，你不知道哪个坑就蹲着你正在议论的人。<br>17、在青年创业中，合伙人的选择是能否成功的重要因素，理念、能力、任务分工、利益分配都是问题，切不可「一头热」，不然最后不仅损失钱财，和合伙人决裂都是正常的事。<br>18、省钱并不会提高我们的生活品质，只会让我们过上「打折」的人生。把省钱的时间用去学习理财，实现1+1&gt;2，即固有资产的升值，这样才能真正的提高生活质量水平。<br>19、善良不是无条件的纵容，不然就是受人欺负的「烂好人」。大多心理阴暗的人都欺软怕硬，所以有点脾气才能真的保护自己。<br>20、遇到自己不想做的事，要直接拒绝，因为真朋友不会让你为难，而拒绝并不意味着伤害。</p>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 休闲娱乐 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zabbix-自定义监控(3)</title>
      <link href="/2022/10/11/zabbix/Day03zabbix%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E6%8E%A7%E9%A1%B9/"/>
      <url>/2022/10/11/zabbix/Day03zabbix%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E6%8E%A7%E9%A1%B9/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="zabbix自定义监控项"><a href="#zabbix自定义监控项" class="headerlink" title="zabbix自定义监控项"></a>zabbix自定义监控项</h1><p>zabbix修改连接数据库的代码</p><p>vim &#x2F;etc&#x2F;zabbix&#x2F;web&#x2F;zabbix.conf.php</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#uptime 用于显示系统总共运行了多长时间和系统的平均负载。</span></span><br><span class="line">20:07:54 up  4:49,  1 user,  load average: 0.00, 0.01, 0.05</span><br><span class="line">无选项 <span class="built_in">uptime</span> 命令会显示一行信息，依次为：当前时间、系统已经运行了多长时间、目前有多少用户登录、系统在过去的 1 分钟、5 分钟和 15 分钟内的平均负载。输出结果等同于 top 命令汇总区的第一行。</span><br><span class="line"><span class="comment">#把目前登入个数截出来</span></span><br><span class="line"><span class="built_in">uptime</span> | awk <span class="string">&#x27;&#123;print $5&#125;&#x27;</span></span><br><span class="line">1</span><br><span class="line"><span class="comment">#零宽断言</span></span><br><span class="line">　　　　　　(?=exp) 　　　　 匹配exp前面的位置</span><br><span class="line">　　　　　　(?&lt;=exp) 　　　  匹配exp后面的位置</span><br><span class="line">　　　　　　(?!exp) 　　　　  匹配后面跟的不是exp的位置</span><br><span class="line">　　　　　　(?&lt;!exp) 　　　　匹配前面不是exp的位置</span><br><span class="line"><span class="built_in">uptime</span> | grep -Po <span class="string">&quot;\d(?= users)&quot;</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure><h2 id="自定义监控格式"><a href="#自定义监控格式" class="headerlink" title="自定义监控格式"></a>自定义监控格式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UserParameter=监控项的key名称，获取监控项值的命令或者脚本</span><br><span class="line">UserParameter=&lt;key&gt;,&lt;shell,<span class="built_in">command</span>&gt;</span><br><span class="line">UserParameter=user.count,<span class="built_in">uptime</span> | grep -Po <span class="string">&quot;\d(?= users)&quot;</span></span><br></pre></td></tr></table></figure><h2 id="添加配置文件"><a href="#添加配置文件" class="headerlink" title="添加配置文件"></a>添加配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##在web01上配置</span></span><br><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line">vim /etc/zabbix/zabbix_agentd.conf</span><br><span class="line">UserParameter=user.count,<span class="built_in">uptime</span> | grep -Po <span class="string">&quot;\d(?= users)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启zabbix客户端</span></span><br><span class="line">systemctl restart zabbix-agent.service</span><br><span class="line"><span class="comment">#检查端口</span></span><br><span class="line">netstat -lntup | grep 10050</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在zabbix测试是够能监控到数据</span></span><br><span class="line">yum install -y zabbix-get</span><br><span class="line">zabbix_get -s 172.16.1.7 -k user.count</span><br></pre></td></tr></table></figure><h2 id="页面添加监控项"><a href="#页面添加监控项" class="headerlink" title="页面添加监控项"></a>页面添加监控项</h2><h3 id="自己创建一个监控模板"><a href="#自己创建一个监控模板" class="headerlink" title="自己创建一个监控模板"></a>自己创建一个监控模板</h3><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321202619059.png" alt="image-20230321202619059"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321202637438.png" alt="image-20230321202637438"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321202646843.png" alt="image-20230321202646843"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321203025992.png" alt="image-20230321203025992"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321203125317.png" alt="image-20230321203125317"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321203234836.png" alt="image-20230321203234836"></p><h2 id="将主机关联"><a href="#将主机关联" class="headerlink" title="将主机关联"></a>将主机关联</h2><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321203545603.png" alt="image-20230321203545603"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321203614147.png" alt="image-20230321203614147"></p><h2 id="给监控画图"><a href="#给监控画图" class="headerlink" title="给监控画图"></a>给监控画图</h2><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321203714103.png" alt="image-20230321203714103"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321203736321.png" alt="image-20230321203736321"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321203803430.png" alt="image-20230321203803430"></p><h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230322102014902.png" alt="image-20230322102014902"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230322102038732.png" alt="image-20230322102038732"></p><h2 id="常用触发器条件"><a href="#常用触发器条件" class="headerlink" title="常用触发器条件"></a>常用触发器条件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">and <span class="comment"># 并且</span></span><br><span class="line">or <span class="comment"># 或</span></span><br><span class="line">last（） <span class="comment"># 对比最后的值</span></span><br><span class="line">avg（） <span class="comment"># 平均值</span></span><br><span class="line">diff（） <span class="comment"># 对比上一次文件的内容</span></span><br><span class="line">nodata（） <span class="comment"># 收不到数据进行报警</span></span><br><span class="line">（5m） <span class="comment"># 表示最近五分种得到值</span></span><br><span class="line">（<span class="comment">#5） # 表示最近五次得到的值</span></span><br></pre></td></tr></table></figure><h2 id="zabbix内置变量"><a href="#zabbix内置变量" class="headerlink" title="zabbix内置变量"></a>zabbix内置变量</h2><p>使用zabbix内置变量，来优化触发器的名称，此处使用的是</p><p>主机名变量：{HOST.NAME} IP地址变量：{HOST.IP}</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Monitor Login User Count Problem 主机名:&#123;HOST.NAME&#125; IP地址:&#123;HOST.IP&#125;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230322102214927.png" alt="image-20230322102214927"></p>]]></content>
      
      
      <categories>
          
          <category> zabbix监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>监控系统-zabbix入门(1)</title>
      <link href="/2022/10/11/zabbix/Day01%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F-zabbix%E5%85%A5%E9%97%A8/"/>
      <url>/2022/10/11/zabbix/Day01%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F-zabbix%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="监控系统-zabbix入门"><a href="#监控系统-zabbix入门" class="headerlink" title="监控系统-zabbix入门"></a>监控系统-zabbix入门</h1><h2 id="监控系统概述"><a href="#监控系统概述" class="headerlink" title="监控系统概述"></a>监控系统概述</h2><p>什么是监控？</p><p>监控系统是整个运维环节，乃至整个产品生命周期中最重要的一环，事前及时预警发现故障，事后提供翔实的数据用于追查定位问题。</p><p>为什么要做监控？</p><p>生活中:</p><p>1.超市监控: 防内外偷</p><p>2.交通监控: 测速，违章</p><p>企业中：</p><p>1.系统的监控:实际上是对系统不间断的实时监控<br>2.实时反馈系统当前状态:我们监控某个硬件、或者某个系统，都是需要能实时看到当前系统的状态，是正常、异常、或者故障。<br>3.保证服务可靠性安全性:我们监控的目的就是要保证系统、服务、业务正常运行<br>4.保证业务持续稳定运行:如果我们的监控做得很完善，即使出现故障，能第一时间接收到故障报警，在第一时间处理解决，从而保证业务持续性的稳定运行。（往往，第一时间知道业务宕机的都是用户）</p><p>监控怎么来实现？</p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230319150759460.png" alt="image-20230319150759460"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230319150811887.png" alt="image-20230319150811887"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230319150833094.png" alt="image-20230319150833094"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230319150854810.png" alt="image-20230319150854810"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230319150906596.png" alt="image-20230319150906596"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230319150921529.png" alt="image-20230319150921529"></p><p>监控软件我们使用的是zabbix，我们监控在不同的维度</p><h3 id="硬件层面"><a href="#硬件层面" class="headerlink" title="硬件层面"></a>硬件层面</h3><p>如果说到硬件，肯定要先说物理服务器用的什么型号？ 物理服务器，选型，Dell R710 720 730 … IDRAC自带一个远程管理卡，安装上一个软件包之后，就可以监控</p><p>如果不使用dell的idrac那就使用zabbix的IPMI接口监控硬件 1）CPU温度， 2）风扇转速， 3）磁盘是否损坏， 4）CMOS电池电量 5）内存是否损坏 6) …</p><h3 id="系统层面"><a href="#系统层面" class="headerlink" title="系统层面"></a>系统层面</h3><p>1）CPU：使用率、负载 2）内存：使用率 3）磁盘：使用率，IO 4）进程 5）TCP状态 6）系统负载 7) …</p><h3 id="网络层面"><a href="#网络层面" class="headerlink" title="网络层面"></a>网络层面</h3><p>1）网络设备：路由器，交换机 2）网卡入口流量 3）网卡出口流量 4）带宽的峰值 5）… 使用zabbix的snmp方式监控</p><h3 id="应用层面"><a href="#应用层面" class="headerlink" title="应用层面"></a>应用层面</h3><p>当然了最基本的就是各个服务的进程，端口号 一些特殊程序我们还需要额外监控： 1）MySQL：主从复制是否有延迟（zabbix监控模板） 2）redis：主从复制是否有延迟 监控思路:zabbix没有固定模板，可以在主库中set一个key为时间戳，然后从库会同步这个时间戳（动态），写脚本时时获取这两个时间戳，做对比。 3）NFS：磁盘挂载状况 4）tomcat：JVM监控，老年代、新生代、永久带、full-gc、垃圾回收 5）rsync的同步情况，MD5校验文件是否被篡改 6）…</p><h3 id="业务层面"><a href="#业务层面" class="headerlink" title="业务层面"></a>业务层面</h3><p>1）URL的监控 2）API的监控 3）nginx的状态码 4）tomcat的exception 5）请求时间 6）响应时间 7）加载时间 8）渲染时间 9）…</p><h2 id="单机监控命令了解"><a href="#单机监控命令了解" class="headerlink" title="单机监控命令了解"></a>单机监控命令了解</h2><h3 id="CUP监控命令"><a href="#CUP监控命令" class="headerlink" title="CUP监控命令"></a>CUP监控命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># w</span></span><br><span class="line"> 15:24:20 up 0 min,  1 user,  load average: 0.29, 0.06, 0.02</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     pts/0    10.0.0.1         15:24    3.00s  0.01s  0.00s w</span><br><span class="line"><span class="comment">#top</span></span><br><span class="line"><span class="comment">#htop</span></span><br><span class="line"><span class="comment">#glances</span></span><br><span class="line"><span class="comment">#uptime</span></span><br><span class="line"><span class="comment">#不管用什么命令监控，查看CPU，我们都必须了解，系统的用户和内和态</span></span><br><span class="line">%Cpu(s):  0.0 us,  0.0 sy,  0.0 ni,100.0 <span class="built_in">id</span>,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line"> </span><br><span class="line">us: 用户态     跟用户的操作有关35%</span><br><span class="line">sy: 内和态     跟内核的处理有关65%</span><br><span class="line"><span class="built_in">id</span>: CPU空闲</span><br><span class="line"><span class="comment">#当我们执行一个命令的时候，很快能出来结果，但是有很多人知道，这个很快，他都占用了哪些时间呢？</span></span><br><span class="line">[root@web02 ~]<span class="comment"># time ls</span></span><br><span class="line">backup.sh  group_vars_web_group</span><br><span class="line"> </span><br><span class="line">real    0m0.002s       真实执行时间</span><br><span class="line">user    0m0.001s       用户执行时间</span><br><span class="line">sys 0m0.001s       系统执行时间</span><br></pre></td></tr></table></figure><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230319152642707.png" alt="image-20230319152642707"></p><h3 id="内存监控命令"><a href="#内存监控命令" class="headerlink" title="内存监控命令"></a>内存监控命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1）free</span><br><span class="line">-m   -h</span><br><span class="line">2）top</span><br><span class="line">3）glances</span><br><span class="line">4）htop</span><br><span class="line"></span><br><span class="line"><span class="comment">#如何查看单个进程占用内存？</span></span><br><span class="line"><span class="comment">#进程占用内存公式</span></span><br><span class="line">pmem = VmRSS / MemTotal * 100</span><br><span class="line">process mem = 虚拟内存 / 总内存 * 100</span><br></pre></td></tr></table></figure><h3 id="磁盘监控命令"><a href="#磁盘监控命令" class="headerlink" title="磁盘监控命令"></a>磁盘监控命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1）<span class="built_in">df</span></span><br><span class="line"><span class="built_in">df</span> -h</span><br><span class="line"><span class="built_in">df</span> -i</span><br><span class="line">2）iotop</span><br><span class="line">3）iostat</span><br><span class="line">4）dstat</span><br><span class="line">5）glance</span><br></pre></td></tr></table></figure><h3 id="网络监控命令"><a href="#网络监控命令" class="headerlink" title="网络监控命令"></a>网络监控命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1）glances</span><br><span class="line">2）iftop</span><br><span class="line">3）nethogs</span><br><span class="line">该命令可以查看某个进程所使用的流量</span><br><span class="line">4）ifconfig</span><br><span class="line">5）route</span><br></pre></td></tr></table></figure><h3 id="TCP11种状态监控命令"><a href="#TCP11种状态监控命令" class="headerlink" title="TCP11种状态监控命令"></a>TCP11种状态监控命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1）netstat</span><br><span class="line">netstat -an</span><br><span class="line">2）ss</span><br></pre></td></tr></table></figure><h2 id="zabbix监控快速安装"><a href="#zabbix监控快速安装" class="headerlink" title="zabbix监控快速安装"></a>zabbix监控快速安装</h2><p><a href="https://www.zabbix.com/">https://www.zabbix.com/</a></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230319164014171.png" alt="image-20230319164014171"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230319164034877.png" alt="image-20230319164034877"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230319164043063.png" alt="image-20230319164043063"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230319164051102.png" alt="image-20230319164051102"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230319164100203.png" alt="image-20230319164100203"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230319164106637.png" alt="image-20230319164106637"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载zabbix的yum源</span></span><br><span class="line">rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装zabbix的服务端和客户端</span></span><br><span class="line">yum install zabbix-server-mysql zabbix-agent -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装zabbix前端web页面的yum端</span></span><br><span class="line">yum install centos-release-scl -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开zabbix的yum源的前端仓库</span></span><br><span class="line">vim /etc/yum.repos.d/zabbix.repo</span><br><span class="line">[zabbix-frontend]</span><br><span class="line">name=Zabbix Official Repository frontend - <span class="variable">$basearch</span></span><br><span class="line">baseurl=http://repo.zabbix.com/zabbix/5.0/rhel/7/<span class="variable">$basearch</span>/frontend</span><br><span class="line">enabled=0 ------&gt;1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX-A14FE591</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装zabbix前端web页面</span></span><br><span class="line">yum install zabbix-web-mysql-scl zabbix-nginx-conf-scl -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库操作</span></span><br><span class="line"><span class="comment"># 1）创建zabbix数据库</span></span><br><span class="line">MariaDB [(none)]&gt; create database zabbix character <span class="built_in">set</span> utf8 collate utf8_bin;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2）创建用户</span></span><br><span class="line">MariaDB [(none)]&gt; grant all on zabbix.* to zabbix@<span class="string">&#x27;172.16.1.%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">##在zabbix机器上操作</span></span><br><span class="line"><span class="comment"># 3）将zabbix的建表语句发送到数据库上</span></span><br><span class="line"><span class="built_in">cd</span> /usr/share/doc/zabbix-server-mysql-5.0.32/</span><br><span class="line"></span><br><span class="line">scp create.sql.gz 172.16.1.51:/opt/</span><br><span class="line"></span><br><span class="line"><span class="comment">##在数据库操作</span></span><br><span class="line"><span class="comment"># 4）跳过反向解析</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">skip_name_resolve</span><br><span class="line"><span class="comment">#重启</span></span><br><span class="line">systemctl restart mariadb</span><br><span class="line"><span class="comment"># 5）主库导入数据库</span></span><br><span class="line">zcat /opt/create.sql.gz | mysql -uzabbix -p123 -h172.16.1.51 zabbix</span><br><span class="line"></span><br><span class="line"><span class="comment">## 在zabbix上操作</span></span><br><span class="line"><span class="comment">## 修改zabbixnginx服务端配置文件</span></span><br><span class="line">vim /etc/zabbix/zabbix_server.conf</span><br><span class="line">DBHost=172.16.1.51</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBPassword=123</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改zabbix的nginx配置文件</span></span><br><span class="line">vim /etc/opt/rh/rh-nginx116/nginx/conf.d/zabbix.conf</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen          80;</span><br><span class="line">        server_name     zabbix.xxx.com;</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 修改zabbix的php配置文件</span></span><br><span class="line">vim /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf</span><br><span class="line">[zabbix]</span><br><span class="line">user = nginx</span><br><span class="line">group = nginx</span><br><span class="line">listen.acl_users = nginx</span><br><span class="line">php_value[date.timezone] = Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="comment"># 授权</span></span><br><span class="line"><span class="built_in">chown</span> -R root.nginx /var/opt/rh/rh-php72/lib/php/session/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 授权</span></span><br><span class="line"><span class="built_in">chown</span> -R nginx.nginx /etc/zabbix/web/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">systemctl restart zabbix-server zabbix-agent rh-nginx116-nginx rh-php72-php-fpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看端口</span></span><br><span class="line">netstat -lntup | grep 10051</span><br><span class="line"></span><br><span class="line"><span class="comment"># 做本地域名解析</span></span><br><span class="line">10.0.0.61 zabbix.xxx.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问</span></span><br><span class="line">zabbix.xxx.com</span><br></pre></td></tr></table></figure><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230320095420921.png" alt="image-20230320095420921"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230320095544762.png" alt="image-20230320095544762"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230320095638242.png" alt="image-20230320095638242"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230320095650870.png" alt="image-20230320095650870"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230320095714591.png" alt="image-20230320095714591"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230320095738226.png" alt="image-20230320095738226"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230320095755710.png" alt="image-20230320095755710"></p>]]></content>
      
      
      <categories>
          
          <category> zabbix监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zabbix-深入应用监控(5)</title>
      <link href="/2022/10/11/zabbix/Day06zabbix%E6%B7%B1%E5%85%A5%E5%BA%94%E7%94%A8%E7%9B%91%E6%8E%A7/"/>
      <url>/2022/10/11/zabbix/Day06zabbix%E6%B7%B1%E5%85%A5%E5%BA%94%E7%94%A8%E7%9B%91%E6%8E%A7/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h1 id="zabbix深入应用监控"><a href="#zabbix深入应用监控" class="headerlink" title="zabbix深入应用监控"></a>zabbix深入应用监控</h1><h2 id="zabbix监控Nginx"><a href="#zabbix监控Nginx" class="headerlink" title="zabbix监控Nginx"></a>zabbix监控Nginx</h2><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230324201439895.png" alt="image-20230324201439895"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##前提要装上nginx</span></span><br><span class="line"><span class="comment">#在web01上操作</span></span><br><span class="line"><span class="built_in">cd</span> /etc/nginx/conf.d/</span><br><span class="line">vim nginx_jk.conf</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name _;</span><br><span class="line"></span><br><span class="line">        location /nginx_status &#123;</span><br><span class="line">                stub_status on;</span><br><span class="line">                access_log  off;</span><br><span class="line">                allow 127.0.0.1;</span><br><span class="line">                deny all;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#本地访问nginx status</span></span><br><span class="line"> curl http://127.0.0.1/nginx_status</span><br><span class="line">Active connections: 1</span><br><span class="line">server accepts handled requests</span><br><span class="line"> 1 1 1</span><br><span class="line">Reading: 0 Writing: 1 Waiting: 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建脚本目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/zabbix/scripts</span><br><span class="line"><span class="built_in">cd</span> /etc/zabbix/scripts/</span><br><span class="line">vim nginx.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"><span class="comment"># $Name:         nginx_status.sh</span></span><br><span class="line"><span class="comment"># $Version:      v1.0</span></span><br><span class="line"><span class="comment"># $Function:     Nginx Status</span></span><br><span class="line"><span class="comment"># $Author:       DriverZeng</span></span><br><span class="line"><span class="comment"># $organization: www.driverzeng.com</span></span><br><span class="line"><span class="comment"># $Create Date:  2016-06-23</span></span><br><span class="line"><span class="comment"># $Description:  Monitor Nginx Service Status</span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"></span><br><span class="line">NGINX_PORT=80  <span class="comment">#如果端口不同仅需要修改脚本即可，否则修改xml很麻烦</span></span><br><span class="line">NGINX_COMMAND=<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">nginx_active</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$NGINX_PORT</span><span class="string">&quot;/nginx_status/&quot;</span> |awk <span class="string">&#x27;/Active/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">nginx_reading</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$NGINX_PORT</span><span class="string">&quot;/nginx_status/&quot;</span> |awk <span class="string">&#x27;/Reading/ &#123;print $2&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">nginx_writing</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$NGINX_PORT</span><span class="string">&quot;/nginx_status/&quot;</span> |awk <span class="string">&#x27;/Writing/ &#123;print $4&#125;&#x27;</span></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">nginx_waiting</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$NGINX_PORT</span><span class="string">&quot;/nginx_status/&quot;</span> |awk <span class="string">&#x27;/Waiting/ &#123;print $6&#125;&#x27;</span></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">nginx_accepts</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$NGINX_PORT</span><span class="string">&quot;/nginx_status/&quot;</span> |awk <span class="string">&#x27;NR==3 &#123;print $1&#125;&#x27;</span></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">nginx_handled</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$NGINX_PORT</span><span class="string">&quot;/nginx_status/&quot;</span> |awk <span class="string">&#x27;NR==3 &#123;print $2&#125;&#x27;</span></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">nginx_requests</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$NGINX_PORT</span><span class="string">&quot;/nginx_status/&quot;</span> |awk <span class="string">&#x27;NR==3 &#123;print $3&#125;&#x27;</span></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="variable">$NGINX_COMMAND</span> <span class="keyword">in</span></span><br><span class="line">    active)</span><br><span class="line">        nginx_active;</span><br><span class="line">        ;;</span><br><span class="line">    reading)</span><br><span class="line">        nginx_reading;</span><br><span class="line">        ;;</span><br><span class="line">    writing)</span><br><span class="line">        nginx_writing;</span><br><span class="line">        ;;</span><br><span class="line">    waiting)</span><br><span class="line">        nginx_waiting;</span><br><span class="line">        ;;</span><br><span class="line">    accepts)</span><br><span class="line">        nginx_accepts;</span><br><span class="line">        ;;</span><br><span class="line">    handled)</span><br><span class="line">        nginx_handled;</span><br><span class="line">        ;;</span><br><span class="line">    requests)</span><br><span class="line">        nginx_requests;</span><br><span class="line">        ;;</span><br><span class="line">          *)</span><br><span class="line">        <span class="built_in">echo</span> $<span class="string">&quot;USAGE:<span class="variable">$0</span> &#123;active|reading|writing|waiting|accepts|handled|requests&#125;&quot;</span></span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="comment"># 添加执行权限</span></span><br><span class="line"><span class="built_in">chmod</span> +x /etc/zabbix/scripts/nginx.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置监控项</span></span><br><span class="line"><span class="built_in">cd</span> /etc/zabbix/zabbix_agentd.d/</span><br><span class="line"></span><br><span class="line">vim jk_nginx.conf</span><br><span class="line">UserParameter=nginx_status[*],/bin/bash /etc/zabbix/scripts/nginx.sh <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="comment">#重启</span></span><br><span class="line">systemctl restart zabbix-agent.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#去zabbix上测试</span></span><br><span class="line">zabbix_get -s 172.16.1.7 -k nginx_status[reading]</span><br></pre></td></tr></table></figure><h2 id="添加nginx网页配置"><a href="#添加nginx网页配置" class="headerlink" title="添加nginx网页配置"></a>添加nginx网页配置</h2><p>添加监控项</p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230324203953798.png" alt="image-20230324203953798"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230324204143325.png" alt="image-20230324204143325"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230324204219300.png" alt="image-20230324204219300"></p><p>添加图片</p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230324204256872.png" alt="image-20230324204256872"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230324204304109.png" alt="image-20230324204304109"></p><h2 id="zabbix监控PHP"><a href="#zabbix监控PHP" class="headerlink" title="zabbix监控PHP"></a>zabbix监控PHP</h2><h3 id="修改php配置文件"><a href="#修改php配置文件" class="headerlink" title="修改php配置文件"></a>修改php配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#前提要装上php</span></span><br><span class="line">vim /etc/php-fpm.d/www.conf</span><br><span class="line"><span class="comment"># 打开php状态模板</span></span><br><span class="line">pm.status_path = /phpfpm_status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启php</span></span><br><span class="line">systemctl restart php-fpm</span><br></pre></td></tr></table></figure><h3 id="修改nginx配置文件"><a href="#修改nginx配置文件" class="headerlink" title="修改nginx配置文件"></a>修改nginx配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/nginx/conf.d/</span><br><span class="line">server&#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name _;</span><br><span class="line"></span><br><span class="line">        location /nginx_status &#123;</span><br><span class="line">                stub_status on;</span><br><span class="line">                access_log  off;</span><br><span class="line">                allow 127.0.0.1;</span><br><span class="line">                deny all;</span><br><span class="line">        &#125;</span><br><span class="line">        location ~ ^/(phpfpm_status)$ &#123;</span><br><span class="line">                include fastcgi_params;</span><br><span class="line">                fastcgi_pass    127.0.0.1:9000;</span><br><span class="line">                fastcgi_param SCRIPT_FILENAME $document_root<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#检测语法</span></span><br><span class="line">ngixn -t</span><br><span class="line"><span class="comment">#重启</span></span><br><span class="line">systemctl restart nginx</span><br><span class="line"><span class="comment">#本地测试</span></span><br><span class="line">curl http://127.0.0.1/phpfpm_status</span><br><span class="line">pool: www</span><br><span class="line">process manager: dynamic</span><br><span class="line">start time: 24/Mar/2023:17:22:53 +0800</span><br><span class="line">start since: 13</span><br><span class="line">accepted conn: 1</span><br><span class="line">listen queue: 0</span><br><span class="line">max listen queue: 0</span><br><span class="line">listen queue len: 128</span><br><span class="line">idle processes: 4</span><br><span class="line">active processes: 1</span><br><span class="line">total processes: 5</span><br><span class="line">max active processes: 1</span><br><span class="line">max children reached: 0</span><br><span class="line">slow requests: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#PHP-FPM状态解释：</span></span><br><span class="line">pool <span class="comment">#fpm池名称,大多数为www</span></span><br><span class="line">process manager <span class="comment">#进程管理方式dynamic或者static</span></span><br><span class="line">start time <span class="comment">#启动日志,如果reload了fpm，时间会更新</span></span><br><span class="line">start since <span class="comment">#运行时间</span></span><br><span class="line">accepted conn <span class="comment">#当前池接受的请求数</span></span><br><span class="line">listen queue <span class="comment">#请求等待队列,如果这个值不为0,那么需要增加FPM的进程数量</span></span><br><span class="line">max listen queue <span class="comment">#请求等待队列最高的数量</span></span><br><span class="line">listen queue len <span class="comment">#socket等待队列长度</span></span><br><span class="line">idle processes <span class="comment">#空闲进程数量</span></span><br><span class="line">active processes <span class="comment">#活跃进程数量</span></span><br><span class="line">total processes <span class="comment">#总进程数量</span></span><br><span class="line">max active processes <span class="comment">#最大的活跃进程数量（FPM启动开始计算）</span></span><br><span class="line">max children reached <span class="comment">#程最大数量限制的次数，如果这个数量不为0，那说明你的最大进程数量过小,可以适当调整。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#添加脚本</span></span><br><span class="line"><span class="built_in">cd</span> /etc/zabbix/scripts/</span><br><span class="line">vim php.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"><span class="comment"># $Name:         phpfpm_status.sh</span></span><br><span class="line"><span class="comment"># $Version:      v1.0</span></span><br><span class="line"><span class="comment"># $Function:     Nginx Status</span></span><br><span class="line"><span class="comment"># $Author:       DriverZeng</span></span><br><span class="line"><span class="comment"># $organization: www.driverzeng.com</span></span><br><span class="line"><span class="comment"># $Create Date:  2016-06-23</span></span><br><span class="line"><span class="comment"># $Description:  Monitor Nginx Service Status</span></span><br><span class="line"><span class="comment">############################################################</span></span><br><span class="line"></span><br><span class="line">PHPFPM_COMMAND=<span class="variable">$1</span></span><br><span class="line">PHPFPM_PORT=80  <span class="comment">#根据监听不同端口进行调整</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start_since</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$PHPFPM_PORT</span><span class="string">&quot;/phpfpm_status&quot;</span> |awk <span class="string">&#x27;/^start since:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">accepted_conn</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$PHPFPM_PORT</span><span class="string">&quot;/phpfpm_status&quot;</span> |awk <span class="string">&#x27;/^accepted conn:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">listen_queue</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$PHPFPM_PORT</span><span class="string">&quot;/phpfpm_status&quot;</span> |awk <span class="string">&#x27;/^listen queue:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">max_listen_queue</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$PHPFPM_PORT</span><span class="string">&quot;/phpfpm_status&quot;</span> |awk <span class="string">&#x27;/^max listen queue:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">listen_queue_len</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$PHPFPM_PORT</span><span class="string">&quot;/phpfpm_status&quot;</span> |awk <span class="string">&#x27;/^listen queue len:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">idle_processes</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$PHPFPM_PORT</span><span class="string">&quot;/phpfpm_status&quot;</span> |awk <span class="string">&#x27;/^idle processes:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">active_processes</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$PHPFPM_PORT</span><span class="string">&quot;/phpfpm_status&quot;</span> |awk <span class="string">&#x27;/^active processes:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">total_processes</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$PHPFPM_PORT</span><span class="string">&quot;/phpfpm_status&quot;</span> |awk <span class="string">&#x27;/^total processes:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">max_active_processes</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$PHPFPM_PORT</span><span class="string">&quot;/phpfpm_status&quot;</span> |awk <span class="string">&#x27;/^max active processes:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">max_children_reached</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$PHPFPM_PORT</span><span class="string">&quot;/phpfpm_status&quot;</span> |awk <span class="string">&#x27;/^max children reached:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">slow_requests</span></span>()&#123;</span><br><span class="line">    /usr/bin/curl -s <span class="string">&quot;http://127.0.0.1:&quot;</span><span class="variable">$PHPFPM_PORT</span><span class="string">&quot;/phpfpm_status&quot;</span> |awk <span class="string">&#x27;/^slow requests:/ &#123;print $NF&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$PHPFPM_COMMAND</span> <span class="keyword">in</span></span><br><span class="line">    start_since)</span><br><span class="line">        start_since;</span><br><span class="line">        ;;</span><br><span class="line">    accepted_conn)</span><br><span class="line">        accepted_conn;</span><br><span class="line">        ;;</span><br><span class="line">    listen_queue)</span><br><span class="line">        listen_queue;</span><br><span class="line">        ;;</span><br><span class="line">    max_listen_queue)</span><br><span class="line">        max_listen_queue;</span><br><span class="line">        ;;</span><br><span class="line">    listen_queue_len)</span><br><span class="line">        listen_queue_len;</span><br><span class="line">        ;;</span><br><span class="line">    idle_processes)</span><br><span class="line">        idle_processes;</span><br><span class="line">        ;;</span><br><span class="line">    active_processes)</span><br><span class="line">        active_processes;</span><br><span class="line">        ;;</span><br><span class="line">        total_processes)</span><br><span class="line">                total_processes;</span><br><span class="line">                ;;</span><br><span class="line">        max_active_processes)</span><br><span class="line">                max_active_processes;</span><br><span class="line">                ;;</span><br><span class="line">        max_children_reached)</span><br><span class="line">                max_children_reached;</span><br><span class="line">                ;;</span><br><span class="line">        slow_requests)</span><br><span class="line">                slow_requests;</span><br><span class="line">                ;;</span><br><span class="line">          *)</span><br><span class="line">        <span class="built_in">echo</span> $<span class="string">&quot;USAGE:<span class="variable">$0</span> &#123;start_since|accepted_conn|listen_queue|max_listen_queue|listen_queue_len|idle_processes|active_processes|total_processes|max_active_processes|max_children_reached&#125;&quot;</span></span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="comment"># 增加执行权限</span></span><br><span class="line"><span class="built_in">chmod</span> +x /etc/zabbix/scripts/php.sh    </span><br><span class="line"><span class="comment"># 配置监控项配置文件</span></span><br><span class="line"><span class="built_in">cd</span> /etc/zabbix/zabbix_agentd.d/</span><br><span class="line">vim php.conf</span><br><span class="line">UserParameter=phpfpm_status[*],/bin/bash /etc/zabbix/scripts/php.sh <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启zabbixagent</span></span><br><span class="line">systemctl restart zabbix-agent.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 去zabbix上检测是否能监控到</span></span><br><span class="line"> zabbix_get -s 172.16.1.7 -k</span><br><span class="line">phpfpm_status[start_since]</span><br><span class="line">482</span><br></pre></td></tr></table></figure><h2 id="添加php网页配置"><a href="#添加php网页配置" class="headerlink" title="添加php网页配置"></a>添加php网页配置</h2><p>添加监控项</p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230324211757360.png" alt="image-20230324211757360"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230324211808982.png" alt="image-20230324211808982"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230324211814741.png" alt="image-20230324211814741"></p><h2 id="zabbix监控Mysql"><a href="#zabbix监控Mysql" class="headerlink" title="zabbix监控Mysql"></a>zabbix监控Mysql</h2><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230327200351222.png" alt="image-20230327200351222"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230327200356084.png" alt="image-20230327200356084"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230327200401680.png" alt="image-20230327200401680"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230327200407347.png" alt="image-20230327200407347"></p><h2 id="zabbix监控redis"><a href="#zabbix监控redis" class="headerlink" title="zabbix监控redis"></a>zabbix监控redis</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#去db01上操作</span></span><br><span class="line"><span class="comment"># 安装redis</span></span><br><span class="line">yum install -y redis</span><br><span class="line"><span class="comment"># 启动redis</span></span><br><span class="line">systemctl start redis</span><br><span class="line">redis-cli info</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230327201110066.png" alt="image-20230327201110066"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230327201116253.png" alt="image-20230327201116253"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230327201123600.png" alt="image-20230327201123600"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230327201128899.png" alt="image-20230327201128899"></p><p>Redis 使用自带的INFO 命令，进行状态监控。以一种易于解释且易于阅读的格式，返回关于Redis 服务器的各种信<br>息和统计数值。</p><h2 id="zabbix监控JVM（JAVA）"><a href="#zabbix监控JVM（JAVA）" class="headerlink" title="zabbix监控JVM（JAVA）"></a>zabbix监控JVM（JAVA）</h2><p>在Zabbix中，JMX监控数据的获取由专门的代理程序来实现,即Zabbix-Java-Gateway来负责数据的采集，Zabbix-<br>Java-Gateway和JMX的Java程序之间通信获取数据</p><p>JMX在Zabbix中的运行流程:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.Zabbix-Server找Zabbix-Java-Gateway获取Java数据</span><br><span class="line">2.Zabbix-Java-Gateway找Java程序(zabbix-agent)获取数据</span><br><span class="line">3.Java程序返回数据给Zabbix-Java-Gateway</span><br><span class="line">4.Zabbix-Java-Gateway返回数据给Zabbix-Server</span><br><span class="line">5.Zabbix-Server进行数据展示</span><br></pre></td></tr></table></figure><p>配置JMX监控的步骤:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.安装Zabbix-Java-Gateway。</span><br><span class="line">2.配置zabbix_java_gateway.conf参数。</span><br><span class="line">3.配置zabbix-server.conf参数。</span><br><span class="line">4.Tomcat应用开启JMX协议。</span><br><span class="line">5.ZabbixWeb配置JMX监控的Java应用。</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在web01客户端上操作</span></span><br><span class="line"><span class="comment"># 安装zabbix-java-geteway</span></span><br><span class="line">yum install -y https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-javagateway-</span><br><span class="line">5.0.32-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装tomcat</span></span><br><span class="line">yum install -y tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">systemctl start zabbix-java-gateway.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#检查端口</span></span><br><span class="line">netstat -lntup |grep 10052</span><br><span class="line">tcp6 0 0 :::10052 :::* LISTEN</span><br><span class="line">16530/java</span><br><span class="line"></span><br><span class="line"><span class="comment">## 去zabbix服务端71上操作</span></span><br><span class="line"><span class="comment"># 修改配置文件</span></span><br><span class="line">vim /etc/zabbix/zabbix_server.conf</span><br><span class="line"><span class="comment"># javagateway的地址</span></span><br><span class="line">JavaGateway=172.16.1.7</span><br><span class="line"><span class="comment"># javagateway的端口</span></span><br><span class="line">JavaGatewayPort=10052</span><br><span class="line"><span class="comment"># javagateway的轮询</span></span><br><span class="line">StartJavaPollers=5</span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">systemctl restart zabbix-server.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 去web01上修改tomcat启动脚本</span></span><br><span class="line">vim /usr/libexec/tomcat/server</span><br><span class="line">CATALINA_OPTS=<span class="string">&quot;<span class="variable">$CATALINA_OPTS</span></span></span><br><span class="line"><span class="string">-Dcom.sun.management.jmxremote</span></span><br><span class="line"><span class="string">-Dcom.sun.management.jmxremote.port=12345</span></span><br><span class="line"><span class="string">-Dcom.sun.management.jmxremote.authenticate=false</span></span><br><span class="line"><span class="string">-Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=172.16.1.7&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动tomcat</span></span><br><span class="line">systemctl start tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查端口</span></span><br><span class="line">netstat -lntup</span><br></pre></td></tr></table></figure><p> <img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230327204415799.png" alt="image-20230327204415799"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230327204420715.png" alt="image-20230327204420715"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230327204427199.png" alt="image-20230327204427199"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230327204559437.png" alt="image-20230327204559437"></p><p>agent 客户端监控<br>SNMP 监控网络设备 （交换机）<br>IPMI 监控主机硬件设备<br>JMX 监控java的JVM<br>zabbix监控web</p>]]></content>
      
      
      <categories>
          
          <category> zabbix监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zabbix-监控主机(2)</title>
      <link href="/2022/10/11/zabbix/Day02zabbix%E7%9B%91%E6%8E%A7%E4%B8%BB%E6%9C%BA/"/>
      <url>/2022/10/11/zabbix/Day02zabbix%E7%9B%91%E6%8E%A7%E4%B8%BB%E6%9C%BA/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>[TOC]</p><h2 id="解决汉字无法显示"><a href="#解决汉字无法显示" class="headerlink" title="解决汉字无法显示"></a>解决汉字无法显示</h2><p>windows的字体</p><p>C:\Windows\Fonts</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入zabbix字体路径</span></span><br><span class="line"><span class="built_in">cd</span> /usr/share/zabbix/assets/fonts/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认字体</span></span><br><span class="line">/etc/alternatives/zabbix-web-font</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传电脑字体</span></span><br><span class="line">rz</span><br><span class="line"><span class="comment"># 改名原本字体名字</span></span><br><span class="line"><span class="built_in">mv</span> graphfont.ttf graphfont.ttf.bak</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改名电脑字体</span></span><br><span class="line"><span class="built_in">mv</span> SIMKAI.TTF graphfont.ttf</span><br></pre></td></tr></table></figure><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321091643429.png" alt="image-20230321091643429"></p><h2 id="快速监控一台主机"><a href="#快速监控一台主机" class="headerlink" title="快速监控一台主机"></a>快速监控一台主机</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##监控db01</span></span><br><span class="line"><span class="comment"># 查看服务端的版本</span></span><br><span class="line">zabbix_server -V</span><br><span class="line">zabbix_server (Zabbix) 5.0.32</span><br><span class="line">Revision 44d6302efbd 6 March 2023, compilation time: Mar  6 2023 16:55:39</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装对应版本的agent客户端</span></span><br><span class="line">yum install -y https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-agent-5.0.32-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">wget https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-agent-5.0.32-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">vim /etc/zabbix/zabbix_agentd.conf </span><br><span class="line">Server=172.16.1.71</span><br><span class="line">ServerActive=172.16.1.71</span><br><span class="line">Hostname=db01</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">systemctl start zabbix-agent</span><br><span class="line"></span><br><span class="line"><span class="comment">#检查端口</span></span><br><span class="line">netstat -lntup|grep 10050</span><br><span class="line">tcp        0      0 0.0.0.0:10050           0.0.0.0:*               LISTEN      7366/zabbix_agentd  </span><br><span class="line">tcp6       0      0 :::10050                :::*                    LISTEN      7366/zabbix_agentd  </span><br></pre></td></tr></table></figure><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321093001818.png" alt="image-20230321093001818"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321093429884.png" alt="image-20230321093429884"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321093457399.png" alt="image-20230321093457399"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321093509230.png" alt="image-20230321093509230"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321093521881.png" alt="image-20230321093521881"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230321093532221.png" alt="image-20230321093532221"></p><h2 id="zabbix排错排查"><a href="#zabbix排错排查" class="headerlink" title="zabbix排错排查"></a>zabbix排错排查</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#检查端口</span></span><br><span class="line">telnet 10.0.0.51 10050</span><br><span class="line"></span><br><span class="line">Connecting to 10.0.0.51:10050...</span><br><span class="line">Connection established.</span><br><span class="line"></span><br><span class="line"><span class="comment">#检查服务是否能获取到客户端的监控数据zabbix_get</span></span><br><span class="line">-s指定主机IP地址</span><br><span class="line">-k指定监控项名称</span><br><span class="line"></span><br><span class="line"><span class="comment">#服务端是否能够获取到客户端的监控数据</span></span><br><span class="line">rpm -ivh https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-get-5.0.32-1.el7.x86_64.rpm?spm=a2c6h.25603864.0.0.42cc2e2fy7m3oU</span><br><span class="line"></span><br><span class="line">zabbix_get -s 172.16.1.51 -k system.swap.size[,pfree]</span><br><span class="line"></span><br><span class="line">zabbix_get -s 172.16.1.51 -k system.swap.size[,free]</span><br><span class="line"><span class="comment">#查看nginx日志</span></span><br><span class="line"><span class="built_in">tail</span> -f /var/opt/rh/rh-nginx116/log/nginx/access.log</span><br><span class="line"></span><br><span class="line"><span class="built_in">tail</span> -f /var/opt/rh/rh-nginx116/log/nginx/error.log</span><br><span class="line"><span class="comment">#查看zabbix-server的日志</span></span><br><span class="line">tail-f/var/log/zabbix/zabbix_server.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看zabbix-agent的日志</span></span><br><span class="line">tail-f/var/log/zabbix/zabbix_agentd.log</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> zabbix监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zabbix-深入监控(4)</title>
      <link href="/2022/10/11/zabbix/Day05zabbix%E6%B7%B1%E5%85%A5%E7%9B%91%E6%8E%A7/"/>
      <url>/2022/10/11/zabbix/Day05zabbix%E6%B7%B1%E5%85%A5%E7%9B%91%E6%8E%A7/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="zabbix深入监控"><a href="#zabbix深入监控" class="headerlink" title="zabbix深入监控"></a>zabbix深入监控</h1><h2 id="zabbix自愈模式"><a href="#zabbix自愈模式" class="headerlink" title="zabbix自愈模式"></a>zabbix自愈模式</h2><p>有些时候，我们的服务宕机了，或者有些服务停掉了，那么我们可以先尝试让他启动，看是否能起的来，为了不影响<br>用户的体验，先把服务起起来，然后再去排查，是什么原因故障的。<br>那么此时我们就需要用到zabbix的自愈模式，这个…叫起来很好听，说白了，就是在让zabbix-server通过远程执行命<br>令的方式，在agent上执行命令，启动服务。</p>]]></content>
      
      
      <categories>
          
          <category> zabbix监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zabbix-网站监控(6)</title>
      <link href="/2022/10/11/zabbix/Day07zabbix%E7%BD%91%E7%AB%99%E7%9B%91%E6%8E%A7WEB/"/>
      <url>/2022/10/11/zabbix/Day07zabbix%E7%BD%91%E7%AB%99%E7%9B%91%E6%8E%A7WEB/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="zabbix网站监控web"><a href="#zabbix网站监控web" class="headerlink" title="zabbix网站监控web"></a>zabbix网站监控web</h1><h2 id="Web场景检测概述"><a href="#Web场景检测概述" class="headerlink" title="Web场景检测概述"></a>Web场景检测概述</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Web网站中什么是动态网站，什么是静态网站</span></span><br><span class="line">静态网站：纯静态网站就是服务器的源代码和客户端的源代码一致。</span><br><span class="line">动态网站：比如: &lt;?php phpinfo()?&gt; 每次用户访问的时候，内容都是在内存中动态生成的。动态网站支持登陆，支持用户交互，所以用户在请求动态网站时，会给客户端下发一个叫sessionID的内容，那么客户端则会将SessionID保存至浏览器的cookie中。</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#当用户访问Web网站时，session和cookie是如何进行工作的</span></span><br><span class="line">1) 当用户首次访问动态网站时，是不会携带cookie信息，那么在服务端返回网页的时候，会给该客户端的浏览器分配一个唯一的sessionID，客户端会该sessionID存储至浏览器的Cookie中。</span><br><span class="line">2) 当用户再次访问网站时，浏览器会在Header头信息添加Set-Cookie，Set-Cookie携带的则是该网站对应的sessionID信息，服务端接收后会进行校验</span><br></pre></td></tr></table></figure><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230327205532571.png" alt="image-20230327205532571"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#我们可以使用curl命令模拟登陆网站</span></span><br><span class="line">1.使用curl命令模拟登陆zabbix服务器，获取cookie, 将cookie保存至本地cook文件中</span><br><span class="line"></span><br><span class="line">[root@m01 ~]<span class="comment"># curl -L -c cook -b cook &#x27;http://10.0.0.61/zabbix/index.php&#x27;</span></span><br><span class="line"><span class="comment">#-b:    cookie字符串或文件读取位置，使用option来把上次的cookie信息追加到http request里面去。</span></span><br><span class="line"><span class="comment">#-c:    操作结束后把cookie写入到这个文件中</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.再次访问时，携带cook信息，同时使用-d参数携带用户以及密码，模拟登陆</span><br><span class="line"></span><br><span class="line">[root@m01 ~]<span class="comment"># curl -L -c cook -b cook -d &#x27;name=Admin&amp;password=zabbix&amp;autologin=1&amp;enter=Sign+in&#x27; &#x27;http://10.0.0.61/zabbix/index.php&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#-d:    以POST的请方式携带头部信息请求</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">登陆zabbix服务器后，可以使用curl命令获取zabbix队列信息</span><br><span class="line"></span><br><span class="line">[root@m01 ~]<span class="comment"># curl -L -c cook -b cook &#x27;http://10.0.0.61/zabbix/queue.php?config=0&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 域名解析</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line">172.16.1.71 zabbix.xxx.com</span><br><span class="line"></span><br><span class="line">curl -L -c cook <span class="string">&#x27;http://zabbix.xxx.com/index.php&#x27;</span></span><br><span class="line"><span class="comment">#-b: cookie字符串或文件读取位置，使用option来把上次的cookie信息追加到http request里面去。</span></span><br><span class="line"><span class="comment">#-c: 操作结束后把cookie写入到这个文件中</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看本地cook</span></span><br><span class="line"><span class="built_in">cat</span> cook</span><br></pre></td></tr></table></figure><h2 id="web场景检测实战"><a href="#web场景检测实战" class="headerlink" title="web场景检测实战"></a>web场景检测实战</h2><p>我们使用Zabbix Web 监控来监控Zabbix的Web界面。我们想知道它是否可用、是否正常工作以及响应速度。所以我<br>们必须使用用户名和密码登录。</p><p> 场景第1步，创建新的Web场景 添加一个场景来监控Zabbix的Web界面。该场景将执行多个步骤。点击配置-&gt;主机-&gt;选择主机-&gt;单击Web监测-&gt;创建Web监测</p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230327211222413.png" alt="image-20230327211222413"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230327211231034.png" alt="image-20230327211231034"></p><p><img src="C:\Users\李琪\AppData\Roaming\Typora\typora-user-images\image-20230327211323562.png" alt="image-20230327211323562"></p>]]></content>
      
      
      <categories>
          
          <category> zabbix监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux用户和组和密码的管理</title>
      <link href="/2022/08/13/%E4%BA%91%E8%AE%A1%E7%AE%97/5.Linux%E7%94%A8%E6%88%B7%E5%92%8C%E7%94%A8%E6%88%B7%E7%BB%84%E5%92%8C%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86%E7%9A%84%E7%AE%A1%E7%90%86/"/>
      <url>/2022/08/13/%E4%BA%91%E8%AE%A1%E7%AE%97/5.Linux%E7%94%A8%E6%88%B7%E5%92%8C%E7%94%A8%E6%88%B7%E7%BB%84%E5%92%8C%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86%E7%9A%84%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="linux用户管理"><a href="#linux用户管理" class="headerlink" title="linux用户管理"></a>linux用户管理</h1><h2 id="一、用户和组的相关概念"><a href="#一、用户和组的相关概念" class="headerlink" title="一、用户和组的相关概念"></a>一、用户和组的相关概念</h2><h3 id="账号的概念和分类"><a href="#账号的概念和分类" class="headerlink" title="账号的概念和分类"></a>账号的概念和分类</h3><ul><li><strong>账号</strong>：是一种用来记录单个用户或是多个用户的数据。Linux中每一个合法的用户都必须要拥有账号，才能使用 。它不仅可以用来验证用户身份，还决定了一个用户在系统中可以从事什么工作</li></ul><p>在Linux 上的账号可以分成两类：</p><ul><li><strong>用户账号</strong> 用来储存单一用户的数据，你可以使用一个用户账号，来储存某一个用户的数据。</li><li><strong>群组账号</strong> 用来储存多个用户的信息，每一个群组账号可以用来记录一组用户的数据。</li></ul><p>我们可以把 Linux 的所有账号依照下面两种方法进行分类：</p><ul><li>依照账号的位置。</li><li>依照账号的功能。</li></ul><p><strong>依照账号存储的位置</strong></p><p>账号数据存放在不同的地方，其可使用的范围就会不太一样，账号的使用范围我们称为视野。依照账号储存的位置与视野不同，我们可以区分本机账号与网域账号两种：</p><p><strong>本机账号:</strong> 账号密码储存于本机硬盘中，我们称为本机账号。<br>本机账号使用范围只能在账号建立的 Linux 系统上，如果超出范围时，本机账号将无法使用。比如：你在自己电脑上登录用的账号和密码，正常是无法在其它的电脑上使用的。</p><ul><li>本机账号的优点：是简单易用，你无须作额外的设置，就可以直接建立本机账号；</li><li>本机账号的缺点：则是无法具备延展性（<em>Scalability</em>）。比如：你在一个拥有很多主机的环境中，想拥有一个在每台主机都可以登录的账号时，你就需要在所有的主机上都建立相关的用户</li></ul><p><strong>网域账号：</strong> 你也可以把大量的计算机组织成为一个网域，然后在网域中的某一台 Linux 上建立账号数据，并且通过某些通信协议，将账号数据分享出来。当其他计算机需要取得账号数据时，再通过网络调用这些分享的账号即可。这种账号我们称为网域账号 （<em>Domain Account</em>）。</p><ul><li>网域账号的优点：在于具备延展性。在大规模的环境中，使用网域账号往往能节省管理账号的时间；</li><li>但网域账号也有缺点，其最大的缺点就是要配置网域账号前，你必须先建立“域”的环境才行。</li></ul><p><strong>依照账号的功能</strong></p><p>不管是本机账号或是网域账号，我们还可以把所有账号依照功能分成下面几类</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927092418446.png" alt="image-20230927092418446"></p><p><strong>用户账号部分：</strong> 包含了超级用户、普通用户；而普通用户中还可细分为系统用户、真实用户两种。</p><ul><li><p>超级用户：在Linux 系统上拥有完整的控制能力，常被称为系统管理员，在 系统上拥有完整的控制能力，你可以利用超级用户读取或写入 上任何文件、安装或删除软硬件、启动或停止服务，甚至关机与停止系统的执行。 通常只有在管理系统时才会使用超级用户账号登录，所以超级用户常被称为系统管理员 （<em>System Administrator</em>）。由于超级用户的权限不受任何限制，你可以使用该账号来管理 系统；但是，也可能因为操作错误，或者打错命令而造成无法挽救的伤害。<br>在此，强烈建议你“除非有必要，否则请不要轻易以超级用户身份使用 Linux”！</p><p><strong>在 Linux 系统中，默认超级用户的用户为 root，其 UID（用户ID号）一定为 0。</strong></p></li><li><p>普通用户账号：行为能力会受到限制，只能调用具备权限的文件，如果没有足够的权限，普通用户是完全无法调用的；所以，普通用户账号不太容易危害 Linux 系统。普通用户账号中，我们又可分为两大类：</p></li><li><p>系统账号<br>这种类型的账号仅提供给Linux 系统本身使用。在某些软件执行的时候，需要你提供一个普通用户类型的账号。为了满足这些软件而建立的账号，我们称为系统账号 （<em>System Account</em>）。</p></li><li><p>真实用户<br>系统用户账号是给软件或程序使用的，那么，什么账号是让我们登录Linux 时使用的呢？答案就是真实用户（<em>Real User</em>）。真实用户账号是为了让其他人登录系统使用的</p></li></ul><p><strong>群组账号部分：</strong> 包含了超级用户群组、系统群组以及用户自定义组三大类。</p><ul><li>超级用户群组：Linux 有一个叫做 root 的群组，因为这个群组的名称与 root 这个超级用户的名称相同，所以，我们习惯把 root 群组叫做超级用户群组。超级用户群组的 GID 为 0。</li><li>系统群组： 与系统账号一样，系统群组是给 Linux 系统本身，或是某个软件所使用</li><li>用户自定义组：除了上述的群组外其余的所有群组，皆是由管理者自行定义，因此我们把这些群组称之为用户自定义组</li></ul><p>另外，Linux 系统的“用户自定义组“类型中，还有一种名为<strong>用户私有群组</strong> （<em>UPG, User Private Group</em>）的群组。什么是 <strong>用户私有群组</strong>呢？用户私有群组（<em>UPG, User Private Group</em>）是指 “与用户账号名称相同，且为用户的主要群组”的群组。当你建立新的用户账号时，Linux 会自动建立该用户的私有群组。如，当你建立 test 这个用户账号时，Linux 会自动建立了一个名为 test 的群组，并且让 test群组成为 test 用户账号的主要群组，test 群组即是 test 的私有群组。</p><p>了解完账号的基本概念后，我们一起来看下账号到底记录了哪些信息</p><h2 id="二、用户账号管理"><a href="#二、用户账号管理" class="headerlink" title="二、用户账号管理"></a>二、用户账号管理</h2><ul><li><strong>useradd命令</strong><br>用户创建命令，创建一个linux用户。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">命令介绍</span><br><span class="line">       useradd - 创建一个新用户或更新默认新用户信息</span><br><span class="line"></span><br><span class="line">命令语法</span><br><span class="line">       useradd [选项] 登录</span><br><span class="line"></span><br><span class="line">       useradd -D</span><br><span class="line"></span><br><span class="line">       useradd -D [选项]</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">  -D        默认</span><br><span class="line">  ­</span><br><span class="line">  -u UID    用来指定账号的 UID，如果省略这个参数，useradd会自动以最后一个可用的 UID 作为新账号的 UID。</span><br><span class="line"></span><br><span class="line">  -o        告诉 useradd 允许重复的 UID。  </span><br><span class="line"></span><br><span class="line">  -g gid    定义用户的主要群组。使用 -g 参数前，GROUP 必须已经存在。 </span><br><span class="line">     </span><br><span class="line">  -d HOME   指定用户的主目录。默认的主目录是建立在  /home/ 目录下，而且目录名称与用户名称相同。</span><br><span class="line">  </span><br><span class="line">  -s SHELL  指定用户登录执行的程序。</span><br><span class="line">                                      </span><br><span class="line">  -c COMMENT   指定用户的批注说明。如果批注文字包含空白，请记得使用双引号 （&quot;） 包起来。 </span><br><span class="line"> </span><br><span class="line">  -r           这个参数用来指出建立一个系统用户的账号。    </span><br><span class="line">  </span><br><span class="line">  -M           不创建家目录</span><br><span class="line"></span><br><span class="line">  -N           不创建同名组                   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#相关文件</span><br><span class="line">/etc/passwd</span><br><span class="line">           用户账户信息。</span><br><span class="line"></span><br><span class="line">       /etc/shadow</span><br><span class="line">           安全用户账户信息。</span><br><span class="line"></span><br><span class="line">       /etc/group</span><br><span class="line">           组账户信息。</span><br><span class="line"></span><br><span class="line">       /etc/gshadow</span><br><span class="line">           安全组账户信息。</span><br><span class="line"></span><br><span class="line">       /etc/default/useradd</span><br><span class="line">           账户创建的默认值。</span><br><span class="line"></span><br><span class="line">       /etc/skel/</span><br><span class="line">           包含默认文件的目录。</span><br><span class="line"></span><br><span class="line">       /etc/subgid</span><br><span class="line">           Per user subordinate group IDs.</span><br><span class="line"></span><br><span class="line">       /etc/subuid</span><br><span class="line">           Per user subordinate user IDs.</span><br><span class="line"></span><br><span class="line">       /etc/login.defs</span><br><span class="line">           Shadow 密码套件配置。</span><br></pre></td></tr></table></figure><p>这些参数大多数可以同时使用，可以根据自己的需求指定，例如<br><strong>创建一个linux用户hello</strong><br>– uid为 1500<br>– 附加组为 hello<br>– 家目录为 &#x2F;home&#x2F;hello<br>– 登陆shell为 &#x2F;bin&#x2F;bash<br>– 描述为 “this is a test user”</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -u 1500 -G hello -d /home/hello -s /bin/bash -c &quot;this is a test user&quot; hello</span><br></pre></td></tr></table></figure><p><strong>关于linux本机用户</strong><br>本机的用户账号数据储存于&#x2F;etc&#x2F;passwd文件中。与其他的配置文件一样，passwd 也是一个文本文件，因此，你可以直接使用文字处理程序，例如 cat 或 less 浏览其中的内容。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br></pre></td></tr></table></figure><p>&#x2F;etc&#x2F;passwd 权限必须是0644，每一行代表一个用户的账号数据，每一行又使用冒号（:）分隔为几个部分</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">USERNAME:PASSWORD:UID:GID:COMMENT:HOMEDIR:SHELL  </span><br><span class="line"></span><br><span class="line">- USERNAME:用户识别名称，也是登录的名称</span><br><span class="line">- PASSWORD：密码位，用于存储用户的密码，为了安全起见，密码放在另一个文件中，这里统一用x</span><br><span class="line">- UID：用户识别号，0表示为管理员，非0为普通用户</span><br><span class="line">- GID：组识别号，用来识别用户组的身份，同样0为管理员组，非0为系统群组或者自定义组</span><br><span class="line">- COMMENT：描述信息</span><br><span class="line">- HOMEDIR：家目录位置</span><br><span class="line">- SHELL：shell类型</span><br></pre></td></tr></table></figure><ul><li><strong>usermod命令</strong><br>是用来修改用户相关信息的，和useradd使用的参数很多是相同的，用法也是一样的，除此之外usermod命令还有一些额外的参数</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">命令介绍</span><br><span class="line">       usermod - 修改一个用户账户</span><br><span class="line"></span><br><span class="line">命令语法</span><br><span class="line">       usermod [选项] 登录</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-l NEWNAME   修改账号的用户名称，NEWNAME 即是新的账号名称。</span><br><span class="line"></span><br><span class="line">-L           锁定账号，一经锁定的账号将无法用来登录系统。</span><br><span class="line"></span><br><span class="line">-U           解除锁定。</span><br></pre></td></tr></table></figure><ul><li><strong>userdel命令</strong><br>删除linux用户</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">命令介绍</span><br><span class="line">       userdel - 删除用户账户和相关文件</span><br><span class="line"></span><br><span class="line">命令语法</span><br><span class="line">       userdel [选项] 登录</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-r          用户主目录中的文件将随用户主目录和用户邮箱一起删除。在其它文件系统中的文件必须手动搜索并删除。</span><br><span class="line"></span><br><span class="line">-f          强制</span><br></pre></td></tr></table></figure><p><strong>删除tom用户以及其家目录文件</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# userdel -r tom</span><br></pre></td></tr></table></figure><h2 id="三、用户查询命令"><a href="#三、用户查询命令" class="headerlink" title="三、用户查询命令"></a>三、用户查询命令</h2><ul><li><strong>id命令：查询用户uid、gid信息</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# id hello</span><br><span class="line">uid=1500(hello) gid=1500(hello) 组=1500(hello)</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# id -u hello</span><br><span class="line">1500</span><br></pre></td></tr></table></figure><ul><li><strong>whoami命令：查询当前登录用户</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure><ul><li><strong>w命令:查询linux系统中登陆的所有用户</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# w</span><br><span class="line"> 18:21:43 up  2:01,  1 user,  load average: 0.00, 0.00, 0.00</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     pts/0    192.168.1.17    16:16    3.00s  0.08s  0.00s w</span><br></pre></td></tr></table></figure><h1 id="linux-组管理"><a href="#linux-组管理" class="headerlink" title="linux 组管理"></a>linux 组管理</h1><h2 id="组账号管理"><a href="#组账号管理" class="headerlink" title="组账号管理"></a>组账号管理</h2><p>本机的群组账号数据被储存在 &#x2F;etc&#x2F;group 文件中，权限也必须为0644，与 &#x2F;etc&#x2F;passwd 一样，这也是一个文本文件。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:</span><br><span class="line">bin:x:1:</span><br><span class="line">daemon:x:2:</span><br></pre></td></tr></table></figure><p>这与&#x2F;etc&#x2F;passwd文件的格式类似</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GROUPNAME:PASSWORD:GID:MEMBERS </span><br><span class="line"></span><br><span class="line">- GROUPNAME:组名</span><br><span class="line"></span><br><span class="line">- PASSWORD:组密码，这里也和passwd文件一样是个x</span><br><span class="line"></span><br><span class="line">- GID：群组识别号</span><br><span class="line"></span><br><span class="line">- MEMBERS：组成员</span><br></pre></td></tr></table></figure><p>一起来看下组管理的相关命令</p><ul><li><strong>groupadd</strong> 建立组</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">命令介绍</span><br><span class="line">       groupadd - 创建一个新组</span><br><span class="line"></span><br><span class="line">命令语法</span><br><span class="line">       groupadd [选项] group</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-g GID     指定群组账号的标识符 </span><br><span class="line"></span><br><span class="line">-r         指定添加的群组成为系统群组</span><br><span class="line"></span><br><span class="line">-f         强制执行。  在一般的情况下，groupadd 不允许建立一个与使用过的 GID 相同的群组账号，而使用这个参数时，groupadd 将会建立相同 GID 的 群组账号。</span><br><span class="line"></span><br><span class="line">-o         此选项允许添加一个使用非唯一 GID 的组。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#组相关文件</span><br><span class="line">       /etc/group</span><br><span class="line">           组账户信息。</span><br><span class="line"></span><br><span class="line">       /etc/gshadow</span><br><span class="line">           安全组账户信息。</span><br><span class="line"></span><br><span class="line">       /etc/login.defs</span><br><span class="line">           Shadow 密码套件配置。</span><br></pre></td></tr></table></figure><ul><li><strong>groupmod</strong> 修改群组信息</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">命令介绍</span><br><span class="line">       groupmod - 修改组信息</span><br><span class="line"></span><br><span class="line">命令语法</span><br><span class="line">       groupmod [选项] GROUP</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-g GID       修改群组账号的标识符。GID 就是新的标识符。</span><br><span class="line">-n NEWNAME   用来修改群组的名称。NEWNAME 就是新的组名。</span><br></pre></td></tr></table></figure><ul><li><strong>groupdel</strong> 删除群组账号</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">命令介绍</span><br><span class="line">groupdel - 删除一个组</span><br><span class="line"></span><br><span class="line">命令语法</span><br><span class="line">groupdel [选项] GROUP</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-f   强制</span><br></pre></td></tr></table></figure><p><strong>您不能移除现有用户的主组。在移除此组之前，必须先移除此用户。</strong></p><p>用户和组的相关命令我们介绍完了，现在来看下密码管理</p><h1 id="linux-密码管理"><a href="#linux-密码管理" class="headerlink" title="linux 密码管理"></a>linux 密码管理</h1><p>账号犹如一张通行证，有了账号你才能顺利的使用Linux。不过 Linux 怎么确认使用某账号的人，是这个账号的真正拥有者呢？此时Linux 会根据用户的密码，来确认用户的身份。Linux 的用户账号与群组账号都可设置密码。用户账号的密码用来验证用户的身份；而群组账号的密码则是用来确认用户是否为该群组的成员，以及确认是否为该群组的管理者。</p><p>在 Linux 中，使用 useradd 新建一个用户账号时，useradd 会锁定用户的密码，如此一来，用户暂时不能使用 。你必须要修改其密码后，新建的用户才能用他的账号登录。要修改用户账号的密码需要使用passwd命令</p><ul><li>passwd命令</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">命令介绍</span><br><span class="line">修改用户密码</span><br><span class="line"></span><br><span class="line">命令语法</span><br><span class="line">passwd [选项] 用户</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-d     删除用户密码，亦即把文件中的密码字段清空。</span><br><span class="line"></span><br><span class="line">-l     这个参数用来锁定账号，账号一经锁定，用户再怎样输入密码，都会被判断为错误。这个参数只能由 root 使用，普通用户无法用来锁定自己的账号。</span><br><span class="line"></span><br><span class="line">-u     解锁用户</span><br></pre></td></tr></table></figure><p>除了可以修改用户账号的密码外，你也可以为每一个群组设置一个密码，这个密码称为群组密码（Group Password）。Linux 的用户，可以通过 newgrp 暂时修改其主要群组的身份。执行 newgrp 时，会以指定的群组身份，开启一个登录 Shell，这样就可以获得暂时修改主要群组之功效。此时，如果该群组没有指定密码，那么 Linux 只允许群组的成员可以使用 newgrp修改主要群组的身份；如果群组设置了密码，群组成员仍可以不用密码就可切换主要群组身份，但非群组的成员，则必须要提供正确的密码才行。</p><ul><li>gpasswd命令</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">命令介绍</span><br><span class="line">修改组密码,对群组管理</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-r     用来删除群组的密码。</span><br><span class="line"></span><br><span class="line">-R     锁定 GROUP 的群组密码。</span><br><span class="line"></span><br><span class="line">-A     设置组管理员</span><br><span class="line"></span><br><span class="line">-a     添加组成员到组</span><br><span class="line"></span><br><span class="line">-d     从组中 删除组成员</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">命令用法</span><br><span class="line">指派群组管理员，如果有多个管理员用“，”分隔，如果想删除群组管理员，保持位置为空</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">组管理员用法案例</span><br><span class="line">创建组admin</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]<span class="comment"># groupadd admin</span></span><br><span class="line"></span><br><span class="line">创建用户 ztxa ztxb ztxc</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]<span class="comment"># useradd ztxa</span></span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]<span class="comment"># useradd ztxb</span></span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]<span class="comment"># useradd ztxc</span></span><br><span class="line"></span><br><span class="line">设置ztxa为admin组的组管理员</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]<span class="comment"># gpasswd -A ztxa admin</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">切换到ztxa   将ztxb ztxc加入 admin组</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]<span class="comment"># su - ztxa -c &quot;gpasswd -a ztxb admin&quot;</span></span><br><span class="line"></span><br><span class="line">正在将用户“ztxb”加入到“admin”组中</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]<span class="comment"># su - ztxa -c &quot;gpasswd -a ztxc admin&quot;</span></span><br><span class="line"></span><br><span class="line">正在将用户“ztxc”加入到“admin”组中</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">切换到ztxa  从admin组中删除ztxc</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]<span class="comment"># su - ztxa -c &quot;gpasswd -d ztxc admin&quot;</span></span><br><span class="line"></span><br><span class="line">正在将用户“ztxc”从“admin”组中删除</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 用户、用户组、Linux密码管理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VIM文本编辑器</title>
      <link href="/2022/08/12/%E4%BA%91%E8%AE%A1%E7%AE%97/4.VIM%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8/"/>
      <url>/2022/08/12/%E4%BA%91%E8%AE%A1%E7%AE%97/4.VIM%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="VIM文本编辑器"><a href="#VIM文本编辑器" class="headerlink" title="VIM文本编辑器"></a>VIM文本编辑器</h1><h2 id="一、vim使用介绍"><a href="#一、vim使用介绍" class="headerlink" title="一、vim使用介绍"></a>一、vim使用介绍</h2><p><strong>vim介绍</strong></p><p>在linux系统中，大部分配置文件都是ASCII的纯文本形式存放的，所以我们在修改系统设置的时候使用简单的文本编辑软件就可以实现了，如果你使用过windows当中的word的话，那么你可能会感觉linux字符界面的文本编辑工具并不是太好用，毕竟没有图形窗口，看着不会太舒服。但是既然要学习linux，掌握并熟练使用文本编辑工具是必不可少的技能，在linux当中的文本编辑工具有很多，如emacs pico nano joe vi&#x2F;vim 等等</p><p>既然有这么多文本编辑工具，为什么要学习vi&#x2F;vim呢？</p><p><strong>为什么要使用vim？</strong></p><p>虽然在linux下的文本编辑器众多，这些工具都有各自的优点，但是有几点是其它编辑工具所不能比拟的</p><ul><li>所有的类Unix系统都内建vi，其它的编辑工具则不一定，而vim相当于是vi的升级版</li><li>很多软件的编辑界面都会调用vi，如后面提到的crontab、edquota等</li><li>vim具有程序编辑能力，可以主动以字体颜色标识语法的正确性，方便代码编写</li><li>程序简单，编辑速度非常快</li></ul><p>综上所述这是一个老式的文字处理工具，但是功能很齐全，不仅是文本处理工具，还是一个程序编辑工具，就连官方网站也说vim是一个程序开发工具而不是文字处理软件，因为它包含了很多额外的功能，如：多文件编辑，区块复制等，这些功能让我们在进行配置文件修改的时候会更方便。</p><p>介绍就到这里，我们来看一下基本使用</p><h2 id="二、基本使用"><a href="#二、基本使用" class="headerlink" title="二、基本使用"></a>二、基本使用</h2><p>由于vi&#x2F;vim是一个全屏幕的文本编辑器，它工作在三种模式下：分别是命令模式、输入模式和末行模式。可以分别从命令模式切换到输入模式和末行模式，也可以从末行模式或输入模式切换到命令模式，但是输入模式与末行模式之间不能互相切换。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927092243561.png" alt="image-20230927092243561"></p><p>第一种：命令模式，当我使用“vim myfile”命令打开myfile这个文件时就处于命令模式,屏幕左下角为文件名（myfile），1L 表示本文件有1 行，26C 表示此文件有26 个字符。1,25表示光标当前位置，在此模式下用户可以输入命令来进行文件存盘、移动光标、删除字符、撤消命令和重复命令等操作，还可以设置编辑环境。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">this is the command mode.</span><br><span class="line">~                                                                                  </span><br><span class="line">~   表示没有内容                                                                                          </span><br><span class="line">&quot;myfile&quot; 1L, 26C                                         1,25         全部</span><br></pre></td></tr></table></figure><p>第二种：编辑模式，又叫输入模式。在输入模式下，屏幕的左下方会出现INSERT (插入)字样。在输入状态下，用户可以输入文本的内容。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">this is the command mode.</span><br><span class="line">~                                                                                  </span><br><span class="line">~                                                                                  </span><br><span class="line">~                                                                                  </span><br><span class="line">~                                                                                  </span><br><span class="line">-- 插入 --                                                       1,25         全部</span><br></pre></td></tr></table></figure><p>第三种：末行模式。只要在命令模式下输入命令“：”即可进入末行模式。在末行模式下，可以进行保存文件、退出vi、进行查找和替换等操作。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">this is the command mode.</span><br><span class="line">~                                                                                  </span><br><span class="line">~                                                                                  </span><br><span class="line">~                                                                                  </span><br><span class="line">~                                                                                  </span><br><span class="line">:q!                                                    </span><br></pre></td></tr></table></figure><p>三种模式介绍完了，我们看下vim的使用，这里面我们还是按照三种模式来对vim的使用进行说明</p><p><strong>命令模式可以使用的按键说明</strong></p><p> <strong>光标控制按键</strong></p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>h 或 向左箭头键(←)</td><td>光标向左移动一个字符</td></tr><tr><td>j 或 向下箭头键(↓)</td><td>光标向下移动一个字符</td></tr><tr><td>k 或 向上箭头键(↑)</td><td>光标向上移动一个字符</td></tr><tr><td>l 或 向右箭头键(→)</td><td>光标向右移动一个字符</td></tr><tr><td>15j&#x2F;15↓</td><td>向下移动15行</td></tr><tr><td>[Ctrl] + [f]</td><td>屏幕『向下』移动一页，相当于 [Page Down]按键 (常用)</td></tr><tr><td>[Ctrl] + [b]</td><td>屏幕『向上』移动一页，相当于 [Page Up] 按键 (常用)</td></tr><tr><td>[Ctrl] + [d]</td><td>屏幕『向下』移动半页</td></tr><tr><td>[Ctrl] + [u]</td><td>屏幕『向上』移动半页</td></tr><tr><td>n</td><td>那个 n 表示『数字』，例如 3 。按下数字后再按空格键，光标会向右移动3 个字符。</td></tr><tr><td>0 或功能键[Home]</td><td>这是数字『 0 』：移动到这一行的最前面字符处 (常用)</td></tr><tr><td>$ 或功能键[End]</td><td>移动到这一行的最后面字符处(常用)</td></tr><tr><td>H</td><td>光标移动到这个屏幕的最上方那一行的第一个字符</td></tr><tr><td>M</td><td>光标移动到这个屏幕的中央那一行的第一个字符</td></tr><tr><td>L</td><td>光标移动到这个屏幕的最下方那一行的第一个字符</td></tr><tr><td>G</td><td>移动到这个文件的最后一行(常用)</td></tr><tr><td>nG</td><td>n 为数字。移动到这个文件的第 n 行。可配合 :set nu</td></tr><tr><td>gg</td><td>移动到这个档案的第一行，相当于 1G (常用)</td></tr><tr><td>n</td><td>n 为数字。光标向下移动 n 行(常用)</td></tr></tbody></table><p> <strong>搜索与替换</strong></p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>&#x2F;abc</td><td>向光标之下查找一个名称为 abc 的字符串。 (常用)</td></tr><tr><td>?abc</td><td>向光标之上查找一个字符串名称为 abc 的字符串。</td></tr><tr><td>n</td><td>这个 n 是英文按键。代表『重复前一个查找的动作』。</td></tr><tr><td>N</td><td>这个 N 是英文按键。与 n 刚好相反</td></tr><tr><td>:n1,n2s&#x2F;abc1&#x2F;abc2&#x2F;g</td><td>n1 与 n2 为数字。在第 n1 与 n2 行之间查找 abc1 替换为 abc2</td></tr><tr><td>:1,$s&#x2F;abc1&#x2F;abc2&#x2F;g</td><td>从第一行到最后一行查找 abc1 字符串，并将该字符串替换为 abc2 (常用)</td></tr><tr><td>:1,$s&#x2F;abc1&#x2F;abc2&#x2F;gc</td><td>从第一行到最后一行查找 abc1 字符串，并将该字符串替换为 abc2 ,且在替换前显示提示字符给用户确认</td></tr></tbody></table><p> <strong>删除与复制粘贴</strong></p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>x, X</td><td>x 相当于 [del] ， X 相当于 [backspace] (常用)</td></tr><tr><td>nx</td><td>n 为数字，连续向后删除 n 个字符。</td></tr><tr><td>dd</td><td>删除光标所在的那一整行(常用)</td></tr><tr><td>ndd</td><td>n 为数字。删除光标所在的向下 n 行(常用)</td></tr><tr><td>d1G</td><td>删除光标所在行到第一行的所有数据</td></tr><tr><td>dG</td><td>删除光标所在行到最后一行的所有数据</td></tr><tr><td>d$</td><td>删除光标所在处，到该行的最后一个字符</td></tr><tr><td>d0</td><td>那个是数字的 0 ，删除光标所在处，到该行的最前面一个字符</td></tr><tr><td>yy</td><td>复制光标所在的那一行(常用)</td></tr><tr><td>nyy</td><td>n 为数字。(常用)</td></tr><tr><td>y1G</td><td>复制光标所在行到第一行的所有数据</td></tr><tr><td>yG</td><td>复制光标所在行到最后一行的所有数据</td></tr><tr><td>y0</td><td>复制光标所在的那个字符到该行行首的所有数据</td></tr><tr><td>y$</td><td>复制光标所在的那个字符到该行行尾的所有数据</td></tr><tr><td>p, P</td><td>p 为将已复制的数据在光标下一行贴上，P 则为贴在光标上一行 (常用)</td></tr><tr><td>J</td><td>将光标所在行与下一行的数据结合成同一行</td></tr><tr><td>c</td><td>重复删除多个数据，例如向下删除 4 行，[ 4cj ]，配合上下左右的按键使用</td></tr><tr><td>u</td><td>撤销操作。(常用)</td></tr><tr><td>[Ctrl]+r</td><td>重做上一个动作。(常用)</td></tr></tbody></table><p><strong>从命令模式进入输入模式</strong></p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>i, I</td><td>i&#x3D;从当前光标所在处插入， I &#x3D;在当前所在行的第一个非空处开始插入。 (常用)</td></tr><tr><td>a, A</td><td>a &#x3D;从当前光标所在的下一个字符处开始插入， A &#x3D;从光标所在行的最后一个字符处开始插入。(常用)</td></tr><tr><td>o, O</td><td>o &#x3D;在当前光标所在的下一行处插入新的一行； O &#x3D;在当前光标所在处的上一行插入新的一行。(常用)</td></tr><tr><td>r, R</td><td>r 只会取代光标所在的那一个字符一次；R会一直取代光标所在的文字，直到按下 ESC 为止；(常用)</td></tr><tr><td>[Esc]</td><td>退出输入模式，回到命令模式中(常用)</td></tr></tbody></table><p><strong>从命令模式进入到末行模式</strong></p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>:w</td><td>保存(常用)</td></tr><tr><td>:w!</td><td>若文件属性为『只读』时，强制保存，是否能保存与权限有关</td></tr><tr><td>:q</td><td>不保存退出(常用)</td></tr><tr><td>:q!</td><td>强制退出不保存。</td></tr><tr><td>:wq</td><td>保存退出， :wq! 则为强制保存退出 (常用)</td></tr><tr><td>ZZ</td><td>这是大写的 Z ！若档案没有更动，则不储存离开，若档案已经被更动过，则储存后离开！</td></tr><tr><td>:w [filename]</td><td>将编辑的数据储存成另一个档案（类似另存新档）</td></tr><tr><td>:r [filename]</td><td>在编辑的数据中，从指定的文件读取数据并加到光标所在行后面</td></tr><tr><td>:n1,n2 w [filename]</td><td>将 n1 到 n2 的内容保存为 filename 这个档案。</td></tr><tr><td>:! command</td><td>在系统中执行指定的命令 如 :! ls &#x2F;home</td></tr><tr><td>vim 环境的变更</td><td></td></tr><tr><td>:set nu</td><td>显示行号</td></tr><tr><td>:set nonu</td><td>取消行号</td></tr></tbody></table><h2 id="三、额外功能"><a href="#三、额外功能" class="headerlink" title="三、额外功能"></a>三、额外功能</h2><p><strong>区块选择</strong></p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>v</td><td>字符选择，选中光标经过的地方</td></tr><tr><td>V</td><td>选中光标经过的行</td></tr><tr><td>[Ctrl]+v</td><td>区块选择</td></tr><tr><td>y</td><td>复制选中的部分</td></tr><tr><td>d</td><td>删除选中的部分</td></tr></tbody></table><p><strong>多文件编辑</strong></p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>:n</td><td>编辑下一个文件</td></tr><tr><td>:N</td><td>编辑上一个文件</td></tr><tr><td>:files</td><td>列出目前这个 vim 的开启的所有文件</td></tr></tbody></table><p><strong>多窗口编辑</strong></p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>:sp&#x2F;:vsp [filename]</td><td>开启一个新窗口，如果加 filename， 表示在新窗口编辑指定的文件，否则表示两个窗口为同一个文件(同步显示)。</td></tr><tr><td>[ctrl]+w+ j [ctrl]+w+↓</td><td>按键的按法是：先按下 [ctrl] 不放， 再按下 w 后放开所有的按键，然后再按下 j (或向下箭头键)，则光标可移动到下方的窗口。</td></tr><tr><td>[ctrl]+w+ k [ctrl]+w+↑</td><td>同上，不过光标移动到上面的窗口。</td></tr><tr><td>[ctrl]+w+ q</td><td>退出光标所在窗口，也可以 [ctrl]+w+j&#x2F;k 切换窗口后，按下 :q 即可离开， 也可以按下 [ctrl]+w+q 。</td></tr></tbody></table><p><strong>环境变量与记录</strong></p><p>.viminfo:记录用户的行为，之前编辑过的文件光标在什么位置，在这个文件中进行过什么操作等，自动建立</p><p>.vimrc：定义vim的默认设置，如是否显示行号等，需要手动生成</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>:set nu &#x2F;:set nonu</td><td>就是设定与取消行号！</td></tr><tr><td>:set hlsearch &#x2F;:set nohlsearch</td><td>搜索时是否高亮显示。默认值是 hlsearch</td></tr><tr><td>:set autoindent :set noautoindent</td><td>是否自动缩排？autoindent 就是自动缩排。</td></tr><tr><td>:set backup&#x2F;:set nobackup</td><td>是否自动备份，一般是 nobackup 的， 如果设定 backup 的话，那么当你更动任何一个档案时，则源文件会被另存成一个档名为 filename~ 的档案。</td></tr><tr><td>:set ruler&#x2F;:set noruler</td><td>是否显示右下角的一些状态栏说明</td></tr><tr><td>:set showmode&#x2F;:set noshowmode</td><td>是否显示左下角的状态栏。</td></tr><tr><td>:set backspace&#x3D;(012)</td><td>一般来说， 如果我们按下 i 进入编辑模式后，可以利用backspace来删除任意字符的。 但是，某些版本则不许如此。这时就可以使用这个设置2 可以删除任意；0 或 1 仅可删除刚刚输入内容</td></tr><tr><td>:set all</td><td>显示目前所有的环境变量设定值。</td></tr><tr><td>:set</td><td>显示与系统默认值不同的设置， 用户修改过的</td></tr><tr><td>:syntax on :syntax off</td><td>是否显示颜色</td></tr><tr><td>:set bg&#x3D;dark :set bg&#x3D;light</td><td>可用以显示不同的颜色色调，预设是『 light 』。如果你常常发现批注的字体深蓝色实在很不容易看， 那么这里可以设定为 dark 喔！试看看，会有不同的样式呢！</td></tr></tbody></table><p><strong>密码设置与取消</strong></p><p>加密</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim filename---&gt;:X---&gt;输入密码---&gt;保存（否则不加密）</span><br></pre></td></tr></table></figure><p>取消密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim filename---&gt;输入正确密码---&gt;:X---&gt;空密码---&gt;保存</span><br><span class="line">vim filename---&gt;:set key= ---&gt;保存</span><br><span class="line"></span><br><span class="line">注意：不要对系统文件进行加密的操作</span><br></pre></td></tr></table></figure><p><strong>vim插件</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1、虚拟机网卡设置为NAT</span><br><span class="line">2、释放IP并重新获取IP</span><br><span class="line">dhclient -r ensxx</span><br><span class="line">dhclient ensxx</span><br><span class="line">3、安装EPELyum源</span><br><span class="line">dnf install epel-release -y</span><br><span class="line">4、安装vim插件</span><br><span class="line">dnf install vim-airline -y</span><br></pre></td></tr></table></figure><p><strong>vimdiff&amp;vimtutor</strong></p><p>vimdiff：编辑两个或者更多个文件并显示不同</p><p>vimtutor:一条神奇的命令</p><h2 id="四、使用中的注意事项"><a href="#四、使用中的注意事项" class="headerlink" title="四、使用中的注意事项"></a>四、使用中的注意事项</h2><p>由于个别版本的linux默认只安装vi，所以你需要额外安装vim的软件包，如何安装软件包我们会在后续的课程中讲解，另外vim在字符界面下不能输入中文，而在图形界面下能否输入中文则取决于系统中是否安装了中文输入法</p><p>字符差异</p><p>由于linux和windows的系统差异，它们针对于文件的中的一些特殊符号表示方式也是不同的，比如说用来表示换行的符号等，如</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat -A hello-linux.txt </span><br><span class="line">hello$</span><br><span class="line">$</span><br><span class="line">[root@zutuanxue ~]# cat -A hello-windows.txt </span><br><span class="line">hello^M$</span><br><span class="line">^M$</span><br></pre></td></tr></table></figure><p>如果这种文件是从windows拷贝到linux的一本小说的话，基本没什么问题，但是如果是一个我们需要执行指定工作的shell脚本就会出现问题，因为linux不认识这种符号的含义，就会导致shell脚本无法执行。所以此时我们就要对这种文件进行处理</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]<span class="comment"># unix2dos [-kn] file [newfile]</span></span><br><span class="line">选项与参数：</span><br><span class="line">-k  ：保留文件原本的 mtime 时间格式</span><br><span class="line">-n  ：保留旧文件，将转换后的内容输出到新文件，如： dos2unix -n old new</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VIM文本编辑器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux目录结构和文件属性管理</title>
      <link href="/2022/08/11/%E4%BA%91%E8%AE%A1%E7%AE%97/3.Linux%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%92%8C%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7%E7%AE%A1%E7%90%86/"/>
      <url>/2022/08/11/%E4%BA%91%E8%AE%A1%E7%AE%97/3.Linux%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%92%8C%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Linux目录结构和文件属性管理"><a href="#Linux目录结构和文件属性管理" class="headerlink" title="Linux目录结构和文件属性管理"></a>Linux目录结构和文件属性管理</h1><h2 id="一、FHS介绍"><a href="#一、FHS介绍" class="headerlink" title="一、FHS介绍"></a>一、FHS介绍</h2><p>Filesystem Hierarchy Standard（文件系统层次化标准）的缩写，多数Linux版本采用这种文件组织形式，类似于Windows操作系统中c盘的文件目录，FHS采用树形结构组织文件。FHS定义了系统中每个区域的用途、所需要的最小构成的文件和目录，同时还给出了例外处理与矛盾处理。</p><p>FHS定义了两层规范，第一层是， &#x2F; 下面的各个目录应该要放什么文件数据，例如&#x2F;etc应该要放置设置文件，&#x2F;bin与&#x2F;sbin则应该要放置可执行文件等等。第二层则是针对&#x2F;usr及&#x2F;var这两个目录的子目录来定义。例如&#x2F;var&#x2F;log放置系统登录文件、&#x2F;usr&#x2F;share放置共享数据等等。</p><h2 id="二、linux目录结构介绍"><a href="#二、linux目录结构介绍" class="headerlink" title="二、linux目录结构介绍"></a>二、linux目录结构介绍</h2><p>整个Linux系统最重要的地方就是在于目录树架构，所谓的目录树架构就是以根目录为主， 然后向下呈现分支状的目录结构的一种档案架构。下图给出了linux的目录结构，那这些目录都有什么作用呢？</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091934807.png" alt="image-20230927091934807"></p><h2 id="三、linux目录的作用"><a href="#三、linux目录的作用" class="headerlink" title="三、linux目录的作用"></a>三、linux目录的作用</h2><ul><li><strong>根目录（&#x2F;）</strong></li></ul><p>最高一级目录，所有目录都是根目录衍生出来，只有root用户具有写权限，一般根目录下只存放目录，不要存放件</p><ul><li><strong>&#x2F;bin目录 – 用户二进制文件</strong></li></ul><p>包含二进制的可执行文件，你需要的常见的Linux命令都位于此目录下。</p><ul><li><strong>&#x2F;sbin目录 – 系统二进制文件</strong></li></ul><p>这个目录下的命令通常由系统管理员使用， 对系统进行维护。</p><ul><li><strong>&#x2F;etc– 配置文件</strong></li></ul><p>包含所有程序所需要的配置文件，也包含用于启动&#x2F;停止单个程序的起动和关闭shell脚本。</p><ul><li><strong>&#x2F;dev-设备文件</strong></li></ul><p>包含设备文件，包括终端设备、USB或连接到系统的任何设备，如网卡等。</p><ul><li><strong>&#x2F;proc-进程信息文件</strong></li></ul><p>这是一个虚拟的文件系统，包含有关正在运行的进程信息。</p><ul><li><strong>&#x2F;usr-用户程序</strong></li></ul><p>包含二进制文件、库文件、文档和二级程序的源代码。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin中包含用户程序的二进制文件。如果你在/bin中找不到用户二进制文件，到/usr/bin目录看看。</span><br><span class="line">/usr/sbin中包含系统管理员的二进制文件。如果你在/sbin中找不到系统二进制文件，到/usr/sbin目录看看。</span><br><span class="line">/usr/lib中包含了/usr/bin和/usr/sbin用到的库。</span><br><span class="line">/usr/local中包含了从源安装的用户程序。</span><br></pre></td></tr></table></figure><ul><li><strong>&#x2F;home -HOME目录</strong></li></ul><p>包含所有用户的个人档案，Linux是多用户的系统，所以用该目录保存各用户的信息。</p><ul><li><strong>&#x2F;boot -引导加载程序</strong></li></ul><p>包含引导加载程序相关的文件。</p><ul><li><strong>&#x2F;lib -系统库</strong></li></ul><p>包含支持位于&#x2F;lib和&#x2F;sbin下的二进制文件的库文件。</p><ul><li><strong>&#x2F;opt -可选的附加应用程序</strong></li></ul><p>给主机额外安装软件所摆放的目录，以前的 Linux 系统中，习惯放置在 &#x2F;usr&#x2F;local 目录下</p><ul><li><strong>&#x2F;mnt &#x2F;media -挂载目录</strong></li></ul><p>光盘默认挂载点，通常光盘挂载于 &#x2F;mnt&#x2F;cdrom 下，也不一定，可以选择任意位置进行挂载。</p><ul><li><strong>&#x2F;root</strong> 管理员家目录</li></ul><p>在这里我们所介绍的目录是在linux系统中常见的目录，不同厂商的linux有所差异，有的版本中会出现有额外作用的目录，这个就需要具体问题具体对待了。</p><h2 id="四、目录和设备节点"><a href="#四、目录和设备节点" class="headerlink" title="四、目录和设备节点"></a>四、目录和设备节点</h2><p>我们已经知道目录是用来存放文件的，不同的目录存放的文件作用不同，那么我们来看下设备节点是什么？ 一个设备节点其实就是一个文件，Linux中称为设备文件。有一点必要说明的是，在Linux中，<strong>所有的设备访问都是通过文件的方式，一般的数据文件程序普通文件，设备节点称为设备文件</strong>，而这些设备节点，或者说是设备文件都统一存放在&#x2F;dev目录下，简单来说，设备节点是一种特殊的文件，只不过这个文件存放的不是一般的数据，而是和你计算机中的设备相关联的。</p><h2 id="五、-和…"><a href="#五、-和…" class="headerlink" title="五、.和…"></a>五、.和…</h2><p>在linux系统中，使用ls -a命令时，你会发现每一个目录下都包含两个目录，这两个目录就是.和…，其中”.“表示是的是当前目录，也就是你使用pwd所查看到的路径，而”…”表示的上一级目录，也就是父目录。</p><h2 id="六、绝对路径和相对路径"><a href="#六、绝对路径和相对路径" class="headerlink" title="六、绝对路径和相对路径"></a>六、绝对路径和相对路径</h2><p>linux的路径书写方式有两种：</p><ul><li>绝对路径：路径的写法一定是由根目录 &#x2F; 写起的，以根目录为起点；</li><li>相对路径：路径的写法不是由根目录 &#x2F; 写起的，不以根目录为起点。</li></ul><p>例如，你知道你的朋友在四楼，而你在五楼，如果你的朋友询问你的位置，你就有两种回答方式：</p><ul><li>绝对路径的方式就是你告诉对方你在XX小区的xx号楼的五楼，</li><li>相对路径的方式就是你告诉对方你在对方五楼。</li></ul><p>至于优缺点方面没有绝对的答案，不同情况使用不同的路径罢了，两种路径的出现只是因为参照物不同而已。</p><h1 id="深入理解linux文件"><a href="#深入理解linux文件" class="headerlink" title="深入理解linux文件"></a>深入理解linux文件</h1><h2 id="一、linux的文件存储"><a href="#一、linux的文件存储" class="headerlink" title="一、linux的文件存储"></a>一、linux的文件存储</h2><p>假如有一个用户在linux系统中编辑了一个文件，编辑完内容后，关闭编辑器时会问用户改如何命名这个文件，设置完名称之后会选择一个目录将该文件保存到指定目录下，在这个例子中包含了linux系统中与文件相关的三个组成部分</p><ul><li>数据：就是文件的内容，保存在一个叫data（数据块）的结构中</li><li>元数据：保存一个文件的特征的系统数据，用来保存除了文件内容和文件名以外的与文件相关的信息， 诸如文件的创建者，日期，大小等等，保存在一个叫inode（i节点）的结构中。</li><li>文件名：用来保存文件名称，文件名保存在一个叫dentry（目录项）的结构中。</li></ul><h2 id="二、i节点介绍"><a href="#二、i节点介绍" class="headerlink" title="二、i节点介绍"></a>二、i节点介绍</h2><p>通过前面的课程我们知道，inode是用来保存文件的元数据的，除此之外还保存文件相关属性信息，如链接数等。我们通过类似stat hello.txt这条命令查看指定文件的inode信息。</p><h2 id="三、链接文件介绍"><a href="#三、链接文件介绍" class="headerlink" title="三、链接文件介绍"></a>三、链接文件介绍</h2><p> Linux中如果用户想把同一个文件保存在两个地方，或用两个不同的文件名保存，除了复制之外还有另外一种选择，就是链接，在linux系统中链接分为硬链接，软链接，空链接，递归链接等</p><p><strong>链接命令: ln</strong></p><p>语法：<br>ln 源文件路径 链接位置路径</p><p>常用命令选项:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-s 创建软连接</span><br><span class="line"></span><br><span class="line">-f 强制执行</span><br><span class="line"></span><br><span class="line">-i 交互模式，文件存在则提示用户是否覆盖</span><br><span class="line"></span><br><span class="line">-n 把符号链接视为一般目录,显示为一般文件</span><br><span class="line"></span><br><span class="line">-v 显示详细的处理过程</span><br></pre></td></tr></table></figure><ul><li>硬链接：允许一个文件拥有多个有效路径名，这样用户就可以建立硬链接到重要的文件，以防止“误删”源数据，不过硬链接只能在同一文件系统中的文件之间进行连接</li><li>软链接 ： 也叫符号链接，类似于windows系统中的快捷方式，与硬链接不同，软链接就是一个普通文件，软链接可对文件或目录创建。</li></ul><p>这是概念上的描述，我们用一句话来将这两种链接进行总结：</p><p>a、硬链接不能链目录，不能跨文件系统，软链接可以；</p><p>b、源文件删除后软链接失效，硬链接依然可用；</p><p>我们通过下面的例子可以看到硬链接和软链接的创建方式以及基本对比</p><p><strong>软连接</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 在root家目录下创建一个文件ztx</span><br><span class="line">[root@zutuanxue ~]# touch ztx</span><br><span class="line"></span><br><span class="line"># 为/root/ztx文件创建一个软连接文件在/tmp目录下</span><br><span class="line">[root@zutuanxue ~]# ln -s /root/ztx /tmp/</span><br><span class="line"></span><br><span class="line"># 验证快捷方式是否创建成功</span><br><span class="line">[root@zutuanxue ~]# ls -l /tmp/ztx </span><br><span class="line">lrwxrwxrwx 1 root root 9 11月 26 15:06 /tmp/ztx -&gt; /root/ztx</span><br><span class="line"></span><br><span class="line"># 查看源文件和链接文件的i节点信息</span><br><span class="line">[root@zutuanxue ~]# ls -i /root/ztx /tmp/ztx </span><br><span class="line">674632 /root/ztx  929916 /tmp/ztx    # 发现软连接的文件i节点不同</span><br><span class="line"></span><br><span class="line"># 删除源文件</span><br><span class="line">[root@zutuanxue ~]# rm -f /root/ztx</span><br><span class="line"> </span><br><span class="line"># 验证链接文件是否可用</span><br><span class="line">[root@zutuanxue ~]# cat /tmp/ztx </span><br><span class="line">cat: /tmp/ztx: 没有那个文件或目录    #删除源文件发现链接文件失效</span><br></pre></td></tr></table></figure><p><strong>硬链接</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个源文件  名字为组团学</span><br><span class="line">[root@zutuanxue ~]# touch zutuanxue   </span><br><span class="line"></span><br><span class="line"># 为/root/zutuanxue文件创建一个硬链接文件 到/tmp/zutuanxue</span><br><span class="line">[root@zutuanxue ~]# ln /root/zutuanxue /tmp/zutuanxue   </span><br><span class="line"></span><br><span class="line"># 查看源文件和链接文件的i节点</span><br><span class="line">[root@zutuanxue ~]# ls -i /root/zutuanxue /tmp/zutuanxue </span><br><span class="line">674632 /root/zutuanxue  674632 /tmp/zutuanxue  # 硬链接的i节点和源文件的i节点一致</span><br><span class="line"></span><br><span class="line"># 删除源文件，看看硬链接文件是否可用</span><br><span class="line">[root@zutuanxue ~]# echo test &gt; /root/zutuanxue </span><br><span class="line">[root@zutuanxue ~]# rm /root/zutuanxue </span><br><span class="line">rm：是否删除普通文件 &quot;/root/zutuanxue&quot;？y</span><br><span class="line">[root@zutuanxue ~]# cat /tmp/zutuanxue </span><br><span class="line">test#删除硬链接源文件后，发现链接文件依然可以使用</span><br></pre></td></tr></table></figure><p>除了上面我们说到的硬链接和软链接之外还有</p><ul><li>空链接，所谓的空链接就是软链接指向的源文件不存在了，包括源文件被删除，改名。</li><li>递归链接：递归链接不如空链接常见，如果想看的话几乎需要专门寻找，如果用户创建两个软链接，linka与linkb关联，而linkb又与linka关联，这时候就会出现递归链接，比如</li></ul><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927092012766.png" alt="image-20230927092012766"></p><ul><li>绝对软链接和相对软链接：主要指的是用户在创建软链接的时候使用的是绝对路径还是相对路径来指定链接目标，如果链接创建完成之后不会移动，那么这两种方法可以随意使用，但是如果链接文件需要被移动，那么建议还是使用绝对路径，比如</li></ul><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927092024456.png" alt="image-20230927092024456"></p><p>好了链接我们就说到这里，下面我们看一下时间戳</p><h2 id="四、时间戳"><a href="#四、时间戳" class="headerlink" title="四、时间戳"></a>四、时间戳</h2><p>时间戳是指格林威治时间1970年01月01日00时00分00秒(北京时间1970年01月01日08时00分00秒)起至现在的总毫秒数。通俗的讲， 时间戳是一份能够表示一份数据在一个特定时间点已经存在的完整的可验证的数据。 它的提出主要是为用户提供一份电子证据， 以证明用户的某些数据的产生时间。 当我们使用stat命令查看文件的时候除了创建时间你会发现有三个跟时间戳相关的信息</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927092040599.png" alt="image-20230927092040599"></p><table><thead><tr><th>缩写</th><th>命令</th><th>目的</th></tr></thead><tbody><tr><td>Atime</td><td>访问时间</td><td>文件数据每次被阅读后的更新</td></tr><tr><td>Ctime</td><td>改变时间</td><td>文件的i-节点信息每次被改变后都更新</td></tr><tr><td>Mtime</td><td>修改时间</td><td>文件数据每次被改变后的更新</td></tr></tbody></table><h2 id="五、常用目录管理命令总结"><a href="#五、常用目录管理命令总结" class="headerlink" title="五、常用目录管理命令总结"></a>五、常用目录管理命令总结</h2><ul><li><strong>目录：</strong></li></ul><table><thead><tr><th>命令</th><th>用法</th><th>功能</th></tr></thead><tbody><tr><td>mkdir</td><td>mkdir 目录名称</td><td>创建一个目录</td></tr><tr><td>rmdir</td><td>rmdir 目录名称</td><td>删除一个空目录</td></tr><tr><td>cd</td><td>cd 目录名称</td><td>进入一个目录</td></tr><tr><td>ls</td><td>ls 目录名称</td><td>列出一个目录内容</td></tr></tbody></table><ul><li><strong>文件：</strong></li></ul><table><thead><tr><th>命令</th><th>用法</th><th>功能</th></tr></thead><tbody><tr><td>touch</td><td>touch 文件名</td><td>新建一个文件</td></tr><tr><td>rm</td><td>rm 文件名</td><td>删除一个文件</td></tr><tr><td>cat</td><td>cat 文件名</td><td>打印一个文件内容</td></tr></tbody></table><ul><li><strong>其他：</strong></li></ul><table><thead><tr><th>命令</th><th>用法</th><th>功能</th></tr></thead><tbody><tr><td>cp</td><td>mkdir file folder</td><td>将文件file拷贝到目录folder</td></tr><tr><td>mv</td><td>mv A B</td><td>移动A到B目录或者从命名 A为B</td></tr><tr><td>ln</td><td>ln -s A B</td><td>给A做一个快捷方式,放到B位置</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux目录结构和文件属性管理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux的基本优化</title>
      <link href="/2022/08/10/%E4%BA%91%E8%AE%A1%E7%AE%97/2.Linux%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BC%98%E5%8C%96/"/>
      <url>/2022/08/10/%E4%BA%91%E8%AE%A1%E7%AE%97/2.Linux%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Linux的基本优化"><a href="#Linux的基本优化" class="headerlink" title="Linux的基本优化"></a>Linux的基本优化</h1><h2 id="一、selinux和防火墙优化"><a href="#一、selinux和防火墙优化" class="headerlink" title="一、selinux和防火墙优化"></a>一、selinux和防火墙优化</h2><h3 id="1、SElinux"><a href="#1、SElinux" class="headerlink" title="1、SElinux"></a>1、SElinux</h3><p>selinux 安全增强型 Linux（Security-Enhanced Linux）简称 SELinux，它是一个 Linux 内核模块，也是 Linux 的一个安全子系统。SELinux 主要由美国国家安全局开发。它的主要 作用就是最大限度地减小系统中服务进程可访问的资源（最小权限原则）。也由于它的这个原则，导致我们很多操作无法正确的执行，所以对于初学者而言在会用selinux之前我们要把这个子系统关闭</p><p><strong>SELinux 的工作模式</strong></p><p>SELinux 有三种工作模式，分别是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- enforcing：强制模式。违反 SELinux 规则的行为将被阻止并记录到日志中。</span><br><span class="line"></span><br><span class="line">- permissive：宽容模式。违反 SELinux 规则的行为只会记录到日志中。一般为调试用。</span><br><span class="line"></span><br><span class="line">- disabled：关闭 SELinux。</span><br></pre></td></tr></table></figure><p><strong>SElinux工作模式设置方法</strong></p><ul><li>临时设置<br>enforcing 和 permissive 模式可以通过 setenforce 1|0 命令快速切换,重启系统后失效。</li><li>永久生效<br>SELinux 工作模式可以在 &#x2F;etc&#x2F;selinux&#x2F;config 中设定。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果想从 disabled 切换到 enforcing 或者 permissive 的话，需要重启系统。反过来也一样。</span><br></pre></td></tr></table></figure><p>需要注意的是，如果系统已经在关闭 SELinux 的状态下运行了一段时间，在打开 SELinux 之后的第一次重启速度可能会比较慢。因为系统必须为磁盘中的文件创建安全上下文，我们现在来看一下如何关闭selinux，首先用root的身份登录系统，打开一个终端输入gedit &#x2F;etc&#x2F;selinux&#x2F;config命令，回车之后会打开一个文件，将所标记出来部分的enforcing改为disabled，保存之后重启linux系统</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# gedit /etc/selinux/config</span><br><span class="line"></span><br><span class="line">##/etc/selinux/config  内容</span><br><span class="line"># This file controls the state of SELinux on the system.</span><br><span class="line"># SELINUX= can take one of these three values:</span><br><span class="line">#     enforcing - SELinux security policy is enforced.</span><br><span class="line">#     permissive - SELinux prints warnings instead of enforcing.</span><br><span class="line">#     disabled - No SELinux policy is loaded.</span><br><span class="line">SELINUX=enforcing     #这里定义selinux是否为开启状态</span><br><span class="line"></span><br><span class="line"># SELINUXTYPE= can take one of these three values:</span><br><span class="line">#     targeted - Targeted processes are protected,</span><br><span class="line">#     minimum - Modification of targeted policy. Only selected processes are protected. </span><br><span class="line">#     mls - Multi Level Security protection.</span><br><span class="line">SELINUXTYPE=targeted   #这里定义的是selinux保护级别</span><br></pre></td></tr></table></figure><p>重启登录之后可以使用sestatus -v命令去查看是否成功，如果看到的状态不是disabled则需要重新操作</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# sestatus -v</span><br><span class="line">SELinux status:                 disabled</span><br></pre></td></tr></table></figure><h3 id="2、防火墙"><a href="#2、防火墙" class="headerlink" title="2、防火墙"></a>2、防火墙</h3><p>防火墙技术是通过有机结合各类用于安全管理与筛选的软件和硬件设备，帮助计算机网络于其内、外网之间构建一道相对隔绝的保护屏障，以保护用户资料与信息安全性的一种技术。 在CentOS8中使用firewalld作为防火墙，基于iptables的防火墙被默认不启动，但仍然可以继续使用。CentOS8中有几种防火墙共存：firewalld、iptables、ebtables等，默认使用firewalld作为防火墙，通过firewall-cmd工具来管理netfilter,不过底层调用的命令仍然是iptables，虽然防火墙是安全软件，但是它的一些默认设置会对初学者造成困扰，所以我们要先关闭firewalld。通过systemctl stop firewalld.service停止防火墙，systemctl disable firewalld.service禁止防火墙服务开机启动，接下来我们看一下如何设置中文</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091556018.png" alt="image-20230927091556018"></p><h2 id="二、中文设置优化"><a href="#二、中文设置优化" class="headerlink" title="二、中文设置优化"></a>二、中文设置优化</h2><p>我们在安装系统选择的是中文，但是我们系统当中并没有中文输入法，所以如果要想输入中文的话需要添加中文输入法，以root用户身份登录系统之后我们使用gedit &#x2F;etc&#x2F;yum.repos.d&#x2F;server.repo,输入如下内容保存退出，确保虚拟机的光驱中加载的是CentOS8的光盘镜像，并且已连接</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091617181.png" alt="image-20230927091617181"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091624201.png" alt="image-20230927091624201"></p><p>设置完成之后执行mkdir命令建立目录，然后挂载光盘</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091641846.png" alt="image-20230927091641846"></p><p>光盘挂载完成之后执行输入法安装命令，如果只要拼音则安装的是： ibus-libpinyin.x86_64</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 安装所有支持的输入法</span><br><span class="line">[root@zutuanxue ~]# dnf install ibus* -y</span><br><span class="line"></span><br><span class="line"># 或者 精准安装拼音输入法</span><br><span class="line">[root@zutuanxue ~]#  dnf install ibus-libpinyin.x86_64 -y</span><br></pre></td></tr></table></figure><p>等待软件包安装完成之后重启系统然后重新登录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">如果不想重启系统可以使用</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# ibus restart </span><br><span class="line"></span><br><span class="line">命令重启ibus-daemon进程来实现</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091653560.png" alt="安装完成之后点击右上角的按钮然后点击设置"></p><p>安装完成之后点击右上角的按钮然后点击设置</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091708931.png" alt="image-20230927091708931"></p><p>在新打开的窗口中找到语言，选择添加，选择汉语，然后选择一个适合自己的中文输入法点击添加之后就可以使用中文输入法了</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091721210.png" alt="image-20230927091721210"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091730207.png" alt="image-20230927091730207"></p><p>输入法设置完成之后，我们来看下时间相关的设置</p><h2 id="三、网络时间服务器优化"><a href="#三、网络时间服务器优化" class="headerlink" title="三、网络时间服务器优化"></a>三、网络时间服务器优化</h2><p>如果系统的时间不准，自己手动设置起来比较麻烦，我们可以看下怎么来优化一下</p><p>同样还是找到设置，在里面找到详细信息，展开之后可以看到日期和时间的设置，两个自动设置的选项打开，如果你的虚拟机可以联网的话，过一会就会看到时间正常了</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091748698.png" alt="image-20230927091748698"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091755051.png" alt="image-20230927091755051"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091800898.png" alt="image-20230927091800898"></p><h2 id="四、自启动服务优化"><a href="#四、自启动服务优化" class="headerlink" title="四、自启动服务优化"></a>四、自启动服务优化</h2><p>自启动服务优化的方式类似我们之前提到的停止firewalld，但是首先我们要确认一下有哪些服务是开机启动的，然后利用之前用过的systemctl stop servername和systemctl disabled servername这两条命令停止相应的服务，比如说蓝牙服务和防火墙服务，但是各位需要注意的是，这里面所涉及的服务在你不了解的前提下不要乱停止，否则可能会导致系统功能失灵，甚至是崩溃</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091815544.png" alt="image-20230927091815544"></p>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux的基本优化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux命令行介绍</title>
      <link href="/2022/08/09/%E4%BA%91%E8%AE%A1%E7%AE%97/1.Linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/"/>
      <url>/2022/08/09/%E4%BA%91%E8%AE%A1%E7%AE%97/1.Linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Linux命令行介绍"><a href="#Linux命令行介绍" class="headerlink" title="Linux命令行介绍"></a>Linux命令行介绍</h1><h2 id="一、命令行的介绍"><a href="#一、命令行的介绍" class="headerlink" title="一、命令行的介绍"></a>一、命令行的介绍</h2><p>命令行界面（英语：command-line interface，缩写：CLI）是在图形用户界面得到普及之前使用最为广泛的用户界面，它通常不支持鼠标，用户通过键盘输入指令，计算机接收到指令后，予以执行。也有人称之为字符用户界面CUI。通常认为，命令行界面（CLI）没有图形用户界面GUI那么方便用户操作。因为，命令行界面的软件通常需要用户记忆操作的命令，但是，由于其本身的特点，命令行界面要较图形用户界面节约计算机系统的资源。在熟记命令的前提下，使用命令行界面往往要较使用图形用户界面的操作速度要快。所以，图形用户界面的操作系统中，都保留着可选的命令行界面。另外Linux 系统的优势基因还是快速、批量、自动化、智能化管理系统及处理业务。和Windows系统使用鼠标点击的可视化管理大不相同 ，Linux通过键盘输入指令就可以完成管理系统的相关操作。说完命令行，我们来看下命令提示符</p><h2 id="二、命令提示符的介绍"><a href="#二、命令提示符的介绍" class="headerlink" title="二、命令提示符的介绍"></a>二、命令提示符的介绍</h2><p>当我们打开终端时，不论是在图形界面还是在字符界面，我们看到的格式都是类似于[root@localhost ~]#这种格式的一串字符，这串字符就是命令提示符</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091128775.png" alt="image-20230927091128775"></p><p>提示符组成详解：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root：当前用户的名称</span><br><span class="line"></span><br><span class="line">@：分隔符</span><br><span class="line"></span><br><span class="line">localhost：当前主机的主机名</span><br><span class="line"></span><br><span class="line">~：用户当前所在的目录名称 “~”表示为用户家目录（发音tilde[ˈtɪldə]）</span><br><span class="line"></span><br><span class="line"><span class="comment">#： 用户身份提示符，#表示超级用户，也就是管理员；$表示普通用户 (发音pound[paʊnd])</span></span><br></pre></td></tr></table></figure><h2 id="三、命令的语法格式"><a href="#三、命令的语法格式" class="headerlink" title="三、命令的语法格式"></a>三、命令的语法格式</h2><p>命令+选项+操作对象这三部分是组成了一个标准的linux命令，其中命令部分需要输入命令的名称；选项部分定义命令的执行特性，可以有长短两种选项，长选项用“ –” （发音dash[dæʃ]）引导，后面跟完整的单词，如 –help；短选项用 ‘- ’引导，后面跟单个的字符， 如 -a 。多个短选项可以组合使用，例如：-h -l -a &#x3D;&#x3D; -hla，但是长选项不能组合使用，如 –help后面就不能再跟另外一个单词了。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091156783.png" alt="image-20230927091156783"></p><p>但是大家需要注意，命令与选项，选项与选项，选项与操作对象，操作对象与操作对象他们之间是必须用空格分隔！至于操作对象就是图片中的&#x2F;boot，操作对象是可以有多个的</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091210881.png" alt="image-20230927091210881"></p><p>语法格式我们就介绍完了，咱们接着往下看</p><h2 id="四、如何高效的输入命令"><a href="#四、如何高效的输入命令" class="headerlink" title="四、如何高效的输入命令"></a>四、如何高效的输入命令</h2><p>想提高命令的输入效率除了要提升命令的熟练度之外，还要掌握我们上节课所学的快捷键，这样能让你在输入命令是更得心应手。<br>那如何提升命令熟练度呢？</p><ul><li>就要会查看命令的说明，只有看懂了才能记住，记住了才能熟练</li><li>使用tab键查询或补全</li></ul><h3 id="4-1、如何快速获取命令的帮助说明"><a href="#4-1、如何快速获取命令的帮助说明" class="headerlink" title="4.1、如何快速获取命令的帮助说明"></a>4.1、如何快速获取命令的帮助说明</h3><p>在linux中获取命令的帮助说明的途径很多，这里面给大家简单介绍几个</p><p>a、help命令可以帮助我们获取到内建命令的使用帮助</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091224981.png" alt="image-20230927091224981"></p><p>b、–help参数</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091236437.png" alt="image-20230927091236437"></p><p>c、man手册</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091252526.png" alt="image-20230927091252526"></p><p>以上这是三种获取帮助的方式，另外还有info、whatis等也可以获取帮助，各位还可以通过一些在线查询工具获取到相关命令的帮助！</p><h3 id="4-2、Tab键模糊查询命令"><a href="#4-2、Tab键模糊查询命令" class="headerlink" title="4.2、Tab键模糊查询命令"></a>4.2、Tab键模糊查询命令</h3><p>a、命令模糊查找：如果你命令记不住了，大概能记得个开头，你可以使用： 命令开头字符+两次tab键找到所有以该命令开头字符的命令，然后就能找到了！</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927091308544.png" alt="image-20230927091308544"></p><p>b、命令补全： 当你打命令的时候，一般情况下你打出命令的前3-5个字符按一下tab就可以完成命令补全，补全的前提是你打的这些字符可以直接匹配到这个命令。</p><h1 id="Linux基本命令与常用符号"><a href="#Linux基本命令与常用符号" class="headerlink" title="Linux基本命令与常用符号"></a>Linux基本命令与常用符号</h1><h2 id="一、常用命令介绍"><a href="#一、常用命令介绍" class="headerlink" title="一、常用命令介绍"></a>一、常用命令介绍</h2><p>在linux系统中存在很多命令，这些命令可以帮助我们完成不同的工作，在这里面我们先介绍一些常用的基础命令，这些命令可以帮助我们完成对应的基本操作，随着以后的学习，我们还会接触到更多可以帮助我们完成不同工作的linux命令，我们来一起看一下这些基础命令都有哪些</p><p><strong>1、关机、重启命令</strong></p><p><strong>关机命令</strong></p><ul><li>init 0 #管理员可以使用</li><li>halt</li><li>shutdown -h</li><li>poweroff</li></ul><p><strong>重启命令</strong></p><ul><li>shutdown -r</li><li>reboot</li><li>shutdown -r</li></ul><p>强烈推荐：关机或重启命令及步骤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1） sync：将缓冲区的数据同步到磁盘中(关机，重启前都需要执行，避免数据丢失)，在Linux系统中，当数据需要存入磁盘时，通常会先放到缓冲区内，等到适当的时刻再写入磁盘，如此可提高系统的执行效率</span><br><span class="line"></span><br><span class="line">2） shutdown： 以一种安全的方式关闭或重启系统。所有登陆用户都可以看到关机信息提示，并且禁止登陆</span><br><span class="line"></span><br><span class="line">-k并非真正关机，只向所有人显示警告信息。</span><br><span class="line">如：shutdown -k +5</span><br><span class="line">-r重启。默认延迟一分钟</span><br><span class="line">如：shutdown -r +3 &quot;shutdown in 3 minutes&quot;</span><br><span class="line">-h关机。默认延迟一分钟</span><br><span class="line">如：shutdown -h 12：00/shutdown -h now</span><br><span class="line">-f重启时跳过磁盘检测。</span><br><span class="line">-F重启时强制磁盘检测。</span><br><span class="line">-c取消shutdown</span><br><span class="line"></span><br><span class="line">推荐理由：</span><br><span class="line">1、将内存中的数据刷入硬盘，避免因为重启或关机数据没有及时保存而丢失</span><br><span class="line">2、避免多用户使用突然某个用户强行关机，影响其他用户，使用shutdown关机和重启可以通知其他用户，给予缓冲时间</span><br></pre></td></tr></table></figure><p><strong>2、系统信息</strong></p><ul><li>uname</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-s  输出内核名称</span><br><span class="line">-n  输出网络节点上的主机名</span><br><span class="line">-r  输出内核发行号</span><br><span class="line">-v  输出内核版本</span><br><span class="line">-m  输出主机的硬件架构名称</span><br><span class="line">-p  输出处理器类型或&quot;unknown&quot;</span><br><span class="line">-i输出硬件平台或&quot;unknown&quot;</span><br><span class="line">-o输出操作系统名称</span><br><span class="line">-a  以如下次序输出所有信息。其中若-p和-i的结果不可知则省略</span><br></pre></td></tr></table></figure><ul><li>hostname 查看主机名</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># hostnamectl set-hostname hello</span><br></pre></td></tr></table></figure><ul><li>date 查看和设置时间</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">时间方面：</span><br><span class="line">%n : 下一行</span><br><span class="line">%t : 跳格 tab</span><br><span class="line">%H : 小时(00..23)</span><br><span class="line">%I : 小时(01..12)</span><br><span class="line">%k : 小时(0..23)</span><br><span class="line">%l : 小时(1..12)</span><br><span class="line">%M : 分钟(00..59)</span><br><span class="line">%p : 显示本地 AM 或 PM</span><br><span class="line">%r : 直接显示时间 (12 小时制，格式为 hh:mm:ss [AP]M)</span><br><span class="line">%s : 从 1970 年 1 月 1 日 00:00:00 UTC 到目前为止的秒数</span><br><span class="line">%S : 秒(00..60)</span><br><span class="line">%T : 直接显示时间 (24 小时制)</span><br><span class="line">%X : 相当于 %H:%M:%S</span><br><span class="line">%Z : 显示时区</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">日期方面：</span><br><span class="line">%a : 星期几 (Sun..Sat)</span><br><span class="line">%A : 星期几 (Sunday..Saturday)</span><br><span class="line">%b : 月份 (Jan..Dec)</span><br><span class="line">%B : 月份 (January..December)</span><br><span class="line">%c : 直接显示日期与时间</span><br><span class="line">%d : 日 (01..31)</span><br><span class="line">%D : 直接显示日期 (mm/dd/yy)</span><br><span class="line">%h : 同 %b</span><br><span class="line">%j : 一年中的第几天 (001..366)</span><br><span class="line">%m : 月份 (01..12)</span><br><span class="line">%U : 一年中的第几周 (00..53) (以 Sunday 为一周的第一天的情形)</span><br><span class="line">%w : 一周中的第几天 (0..6)</span><br><span class="line">%W : 一年中的第几周 (00..53) (以 Monday 为一周的第一天的情形)</span><br><span class="line">%x : 直接显示日期 (yyyy-mm-dd)</span><br><span class="line">%y : 年份的最后两位数字 (00.99)</span><br><span class="line">%Y : 完整年份 (0000..9999)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%I%M%S&#x27;</span><br><span class="line">025929</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%r&#x27;</span><br><span class="line">上午 02时59分49秒</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%s&#x27;</span><br><span class="line">1584428402</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%Z&#x27;</span><br><span class="line">EDT</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%a&#x27;</span><br><span class="line">二</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%A&#x27;</span><br><span class="line">星期二</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%b&#x27;</span><br><span class="line">3月</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%B&#x27;</span><br><span class="line">三月</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%c&#x27;</span><br><span class="line">2020年03月17日 星期二 03时01分36秒</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%T%n%D&#x27;</span><br><span class="line">03:03:35</span><br><span class="line">03/17/20</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%T%t%D&#x27;</span><br><span class="line">03:03:5803/17/20</span><br><span class="line">[root@zutuanxue ~]# date -s 2021-10-25</span><br><span class="line">2021年 10月 25日 星期一 00:00:00 EDT</span><br><span class="line">[root@zutuanxue ~]# date -s 18:00</span><br><span class="line">2021年 10月 25日 星期一 18:00:00 EDT</span><br><span class="line">[root@zutuanxue ~]# date -s 18:30:21</span><br><span class="line">2021年 10月 25日 星期一 18:30:21 EDT</span><br><span class="line">[root@zutuanxue ~]# date -s &quot;2021-04-28 15:30:20&quot;</span><br><span class="line">2021年 04月 28日 星期三 15:30:20 EDT</span><br></pre></td></tr></table></figure><p><strong>3、文件和目录</strong></p><ul><li>cd 目录 进入目录</li><li>pwd： 查看当前的工作路径</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-P显示实际位置</span><br><span class="line">-L显示所在位置</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# cd /etc     #进入到/etc这个目录</span><br><span class="line">[root@zutuanxue ~]# cd /</span><br><span class="line">[root@zutuanxue /]# ls</span><br><span class="line">bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@zutuanxue /]# cd bin/</span><br><span class="line">[root@zutuanxue bin]# pwd</span><br><span class="line">/bin</span><br><span class="line">[root@zutuanxue bin]# pwd -P</span><br><span class="line">/usr/bin</span><br><span class="line">[root@zutuanxue bin]# pwd -L</span><br><span class="line">/bin</span><br></pre></td></tr></table></figure><ul><li>ls： 查看当前目录下有哪些文件</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">-a 列出目录下的所有文件，包括以 . 开头的隐含文件。</span><br><span class="line">-A 显示除 “.”和“..”外的所有文件。</span><br><span class="line">-B 不输出以 “~”结尾的备份文件。</span><br><span class="line">-c 与lt一起使用，显示并按照修改时间（ctime）排序，与l一起使用，显示修改时间，按名称排序。</span><br><span class="line">-d 将目录象文件一样显示，而不是显示其下的文件。</span><br><span class="line">-f 对输出的文件不排序，使用此选项后aU选项生效，lst选项失效</span><br><span class="line">-F 在每个文件名后附上一个字符以说明该文件的类型，“*”表示可执行的普通文件；“/”表示目录；“@”表示符号链接；“|”表示FIFOs；“=”表示套接字(sockets)。</span><br><span class="line">-g 类似l但是不显示所有者</span><br><span class="line">-h 与l一起，以易于阅读的格式输出文件大小(例如 1K 234M 2G)</span><br><span class="line">-i 输出文件的i节点的索引信息。</span><br><span class="line">-k 以k字节的形式表示文件的大小。--si类似k但是以1000为进制而非1024</span><br><span class="line">-l 列出文件的详细信息。</span><br><span class="line">-L 遇到链接文件是，显示原文件的信息，而非链接信息</span><br><span class="line">-m 横向输出文件名，并以“，”作分格符。</span><br><span class="line">-n 类似l,但是用数字的 UID,GID 代替名称。</span><br><span class="line">-o 显示文件的除组信息外的详细信息。</span><br><span class="line">-p 目录后面加上/标识</span><br><span class="line">-q 用?代替不可输出的字符。</span><br><span class="line">-r 对目录反向排序。</span><br><span class="line">-s 在每个文件名后输出该文件的大小。</span><br><span class="line">-t 以修改时间排序。</span><br><span class="line">-u 与lt一起使用，以访问时间(atime)排序；与l一起使用显示访问时间，按照名称排序</span><br><span class="line">-x 按列输出，横向排序。</span><br><span class="line">-Q 把输出的文件名用双引号括起来。</span><br><span class="line">-R 列出所有子目录下的文件。</span><br><span class="line">-S 以文件大小排序。</span><br><span class="line">-X 以文件的扩展名(最后一个 . 后的字符)排序。</span><br><span class="line">-1 一行只输出一个文件。</span><br><span class="line">--color=no 不显示彩色文件名</span><br><span class="line">--help 在标准输出上显示帮助信息。</span><br><span class="line">--version 在标准输出上输出版本信息并退出。</span><br></pre></td></tr></table></figure><ul><li>mkdir 建立目录</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-m设置权限模式(类似chmod)</span><br><span class="line">-p需要时创建目标目录的上层目录，但即使这些目录已存在也不当作错误处理</span><br><span class="line">-v每次创建新目录都显示信息</span><br><span class="line">-Z将每个创建的目录的SELinux 安全环境设置为CTX</span><br></pre></td></tr></table></figure><ul><li>rmdir 删除空文件夹</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-p  递归删除空目录，从最后一个目录倒删</span><br></pre></td></tr></table></figure><ul><li>touch 建立文件</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">-a只更改访问时间</span><br><span class="line">-c不创建任何文件</span><br><span class="line">-m只更改修改时间</span><br><span class="line">-r使用指定文件的时间属性替代当前时间</span><br><span class="line">-t使用[[CC]YY]MMDDhhmm[.ss] 格式的时间替代当前时间</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# stat hello</span><br><span class="line">  文件：hello</span><br><span class="line">  大小：0         块：0          IO 块：4096   普通空文件</span><br><span class="line">设备：fd00h/64768dInode：34502264    硬链接：1</span><br><span class="line">权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)</span><br><span class="line">最近访问：2020-03-17 16:51:35.502961371 -0400</span><br><span class="line">最近更改：2020-03-17 16:51:35.502961371 -0400</span><br><span class="line">最近改动：2020-03-17 16:51:35.502961371 -0400</span><br><span class="line">创建时间：-</span><br><span class="line">[root@zutuanxue ~]# touch -a -t 202002010101.30 hello</span><br><span class="line">[root@zutuanxue ~]# stat hello</span><br><span class="line">  文件：hello</span><br><span class="line">  大小：0         块：0          IO 块：4096   普通空文件</span><br><span class="line">设备：fd00h/64768dInode：34502264    硬链接：1</span><br><span class="line">权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)</span><br><span class="line">最近访问：2020-02-01 01:01:30.000000000 -0500</span><br><span class="line">最近更改：2020-03-17 16:51:35.502961371 -0400</span><br><span class="line">最近改动：2020-03-17 16:51:53.143475189 -0400</span><br><span class="line">创建时间：-</span><br><span class="line">[root@zutuanxue ~]# touch -m -t 202002050101.30 hello</span><br><span class="line">[root@zutuanxue ~]# stat hello</span><br><span class="line">  文件：hello</span><br><span class="line">  大小：0         块：0          IO 块：4096   普通空文件</span><br><span class="line">设备：fd00h/64768dInode：34502264    硬链接：1</span><br><span class="line">权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)</span><br><span class="line">最近访问：2020-02-01 01:01:30.000000000 -0500</span><br><span class="line">最近更改：2020-02-05 01:01:30.000000000 -0500</span><br><span class="line">最近改动：2020-03-17 16:52:07.837453512 -0400</span><br><span class="line">创建时间：-</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#将hello-linux.txt的属性改成与anaconda-ks.cfg一样</span><br><span class="line">[root@zutuanxue ~]# stat hello-linux.txt </span><br><span class="line">  文件：hello-linux.txt</span><br><span class="line">  大小：12        块：8          IO 块：4096   普通文件</span><br><span class="line">设备：fd00h/64768dInode：34513350    硬链接：1</span><br><span class="line">权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)</span><br><span class="line">最近访问：2020-03-17 22:50:51.319377144 -0400</span><br><span class="line">最近更改：2020-03-17 22:50:45.909483733 -0400</span><br><span class="line">最近改动：2020-03-17 22:50:45.912483674 -0400</span><br><span class="line">创建时间：-</span><br><span class="line">[root@zutuanxue ~]# stat anaconda-ks.cfg </span><br><span class="line">  文件：anaconda-ks.cfg</span><br><span class="line">  大小：1378      块：8          IO 块：4096   普通文件</span><br><span class="line">设备：fd00h/64768dInode：34973658    硬链接：1</span><br><span class="line">权限：(0600/-rw-------)  Uid：(    0/    root)   Gid：(    0/    root)</span><br><span class="line">最近访问：2020-03-16 23:08:34.121427663 -0400</span><br><span class="line">最近更改：2020-02-04 15:01:33.273959663 -0500</span><br><span class="line">最近改动：2020-03-18 16:33:48.873881970 -0400</span><br><span class="line">创建时间：-</span><br><span class="line">[root@zutuanxue ~]# touch -r anaconda-ks.cfg hello-linux.txt </span><br><span class="line">[root@zutuanxue ~]# stat hello-linux.txt </span><br><span class="line">  文件：hello-linux.txt</span><br><span class="line">  大小：12        块：8          IO 块：4096   普通文件</span><br><span class="line">设备：fd00h/64768dInode：34513350    硬链接：1</span><br><span class="line">权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)</span><br><span class="line">最近访问：2020-03-16 23:08:34.121427663 -0400</span><br><span class="line">最近更改：2020-02-04 15:01:33.273959663 -0500</span><br><span class="line">最近改动：2020-03-18 18:22:48.694597233 -0400</span><br><span class="line">创建时间：-</span><br></pre></td></tr></table></figure><ul><li>cat 查看文件内容</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-A等价于-vET</span><br><span class="line">-b对非空输出行编号</span><br><span class="line">-e      等价于-vE</span><br><span class="line">-E在每行结束处显示$</span><br><span class="line">-n对输出的所有行编号</span><br><span class="line">-s不输出多行空行</span><br><span class="line">-t与-vT等价</span><br><span class="line">-T将跳格字符（tab）显示为 ^I</span><br><span class="line">-v使用^和M</span><br></pre></td></tr></table></figure><ul><li>rm 删除文件或目录</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-f强制删除。忽略不存在的文件，不提示确认</span><br><span class="line">-i在删除前需要确认</span><br><span class="line">-I超过三个文件或者递归删除前要求确认。比-i提示内容更少</span><br><span class="line">-d删除空目录</span><br><span class="line">-r递归删除目录及其内容</span><br></pre></td></tr></table></figure><p>这些命令都是初学者可能会经常用到的，大家可以在自己的虚拟机上练习一下</p><ul><li>cp 拷贝</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-i覆盖前询问(使前面的 -n 选项失效)</span><br><span class="line">-n不要覆盖已存在的文件(使前面的 -i 选项失效)</span><br><span class="line">-R, -r, --recursive递归复制目录及其子目录内的所有内容</span><br><span class="line">-s只创建符号链接而不复制文件</span><br><span class="line">-f强制，将目标文件无法打开则将其移除并重试</span><br></pre></td></tr></table></figure><ul><li>mv 移动&#x2F;改名</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-f覆盖前不询问</span><br><span class="line">-i覆盖前询问</span><br><span class="line">-n不覆盖已存在文件</span><br><span class="line">#如果您指定了-i、-f、-n 中的多个，仅最后一个生效。</span><br></pre></td></tr></table></figure><h2 id="二、常用符号"><a href="#二、常用符号" class="headerlink" title="二、常用符号"></a>二、常用符号</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*任意字符串</span><br><span class="line"></span><br><span class="line">?任意字符</span><br><span class="line"></span><br><span class="line">/路径间隔符</span><br><span class="line"></span><br><span class="line">~当前用户的家目录管理员家目录为/root，其它用户的家目录在/home/用户名</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux命令行介绍 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux终端的使用</title>
      <link href="/2022/08/08/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/8.Linux%E7%BB%88%E7%AB%AF%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2022/08/08/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/8.Linux%E7%BB%88%E7%AB%AF%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Linux终端的使用"><a href="#Linux终端的使用" class="headerlink" title="Linux终端的使用"></a>Linux终端的使用</h1><h2 id="一、终端的作用"><a href="#一、终端的作用" class="headerlink" title="一、终端的作用"></a>一、终端的作用</h2><p>要了解终端，就要了解一下计算机方面的历史，早期的计算机都属于大中型计算机，是个庞然大物，占用很大的空间，属于公用产品。不像现在的电脑，可以人手一部，直接操作。那如何对这些计算机进行控制与操作呢。那就搞个终端设备来操作。因此一台计算机上有很多种不同的终端设备也和正常。也就是说终端就是为主机提供了人机接口，每个人都通过终端使用主机的资源。</p><p>终端有字符终端和图形终端两种模式。在linux的图形环境下，我们可以通过鼠标点击来完成所有的管理任务，这是图形界面终端，另外一种就是文本界面的终端，在这个界面的终端下我们可以使用linux命令来控制系统完成响应的工作，而这个文本终端也是服务器常用的模式。</p><p>用一句话来说终端就是存在于用户和计算机之间沟通的桥梁，通过终端，用户可以控制计算机完成响应的工作，也可以获得到计算机的反馈</p><h2 id="二、打开终端的几种方法"><a href="#二、打开终端的几种方法" class="headerlink" title="二、打开终端的几种方法"></a>二、打开终端的几种方法</h2><p>第一种，我们登录系统之后就已经打开了图形终端，在图形终端中也给我们提供了一个可以用linux命令控制系统的工具，我们点击屏幕左上角的“活动”就可以找到这个它</p><h2 id="一、终端的作用-1"><a href="#一、终端的作用-1" class="headerlink" title="一、终端的作用"></a>一、终端的作用</h2><p>要了解终端，就要了解一下计算机方面的历史，早期的计算机都属于大中型计算机，是个庞然大物，占用很大的空间，属于公用产品。不像现在的电脑，可以人手一部，直接操作。那如何对这些计算机进行控制与操作呢。那就搞个终端设备来操作。因此一台计算机上有很多种不同的终端设备也和正常。也就是说终端就是为主机提供了人机接口，每个人都通过终端使用主机的资源。</p><p>终端有字符终端和图形终端两种模式。在linux的图形环境下，我们可以通过鼠标点击来完成所有的管理任务，这是图形界面终端，另外一种就是文本界面的终端，在这个界面的终端下我们可以使用linux命令来控制系统完成响应的工作，而这个文本终端也是服务器常用的模式。</p><p>用一句话来说终端就是存在于用户和计算机之间沟通的桥梁，通过终端，用户可以控制计算机完成响应的工作，也可以获得到计算机的反馈</p><h2 id="二、打开终端的几种方法-1"><a href="#二、打开终端的几种方法-1" class="headerlink" title="二、打开终端的几种方法"></a>二、打开终端的几种方法</h2><p>第一种，我们登录系统之后就已经打开了图形终端，在图形终端中也给我们提供了一个可以用linux命令控制系统的工具，我们点击屏幕左上角的“活动”就可以找到这个它</p><h2 id="一、终端的作用-2"><a href="#一、终端的作用-2" class="headerlink" title="一、终端的作用"></a>一、终端的作用</h2><p>要了解终端，就要了解一下计算机方面的历史，早期的计算机都属于大中型计算机，是个庞然大物，占用很大的空间，属于公用产品。不像现在的电脑，可以人手一部，直接操作。那如何对这些计算机进行控制与操作呢。那就搞个终端设备来操作。因此一台计算机上有很多种不同的终端设备也和正常。也就是说终端就是为主机提供了人机接口，每个人都通过终端使用主机的资源。</p><p>终端有字符终端和图形终端两种模式。在linux的图形环境下，我们可以通过鼠标点击来完成所有的管理任务，这是图形界面终端，另外一种就是文本界面的终端，在这个界面的终端下我们可以使用linux命令来控制系统完成响应的工作，而这个文本终端也是服务器常用的模式。</p><p>用一句话来说终端就是存在于用户和计算机之间沟通的桥梁，通过终端，用户可以控制计算机完成响应的工作，也可以获得到计算机的反馈</p><h2 id="二、打开终端的几种方法-2"><a href="#二、打开终端的几种方法-2" class="headerlink" title="二、打开终端的几种方法"></a>二、打开终端的几种方法</h2><p>第一种，我们登录系统之后就已经打开了图形终端，在图形终端中也给我们提供了一个可以用linux命令控制系统的工具，我们点击屏幕左上角的“活动”就可以找到这个它</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927085700427.png" alt="image-20230927085700427"></p><p>打开之后我们会看到linux的命令行，在这里面我们可以输入linux命令来进行操作</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927085712765.png" alt="image-20230927085712765"></p><p>第二种 打开文本终端，这个需要键盘上的组合键[Ctrl] + [Alt] + [F1] - [F6] ，其中F1和F2是两个可供登录的图形终端，F3-F6为文本终端，现在我们使用[Ctrl] + [Alt] + [F3]打开文本终端，然后使用root用户登录</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927085725177.png" alt="image-20230927085725177"></p><p>这就是在linux中终端的打开方式，那我们接下来看一下有哪些快捷键</p><h2 id="三、常用快捷键"><a href="#三、常用快捷键" class="headerlink" title="三、常用快捷键"></a>三、常用快捷键</h2><p>1、图形界面下通过点击屏幕右上角的“活动”按钮打开的终端</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Shift]+[Ctrl]+t以标签的形式打开一个新的终端</span><br><span class="line"></span><br><span class="line">[Shift]+[Ctrl]+n以窗口的形式打开一个新的终端</span><br><span class="line"></span><br><span class="line">[Shift]+[Ctrl]+w关闭标签页</span><br><span class="line"></span><br><span class="line">[Shift]+[Ctrl]+q关闭窗口</span><br></pre></td></tr></table></figure><p>如果你想知道额外的快捷键，点击终端上方的文字按钮，会有对应快捷键的提示</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927085741856.png" alt="image-20230927085741856"></p><p>2、通用快捷键</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+r:实现快速检索使用过的历史命令.</span><br><span class="line">Ctrl+a:光标回到命令行首。 </span><br><span class="line">Ctrl+e:光标回到命令行尾。 </span><br><span class="line">ctrl+w:移除光标前的一个单词</span><br><span class="line">Ctrl+k:删除光标处到行尾的字符。</span><br><span class="line">Ctrl+u:删除整个命令行文本字符。</span><br><span class="line">Ctrl+y:粘贴Ctrl+u，Ctrl+k，Ctrl+w删除的文本。</span><br><span class="line">Ctrl+d:删除提示符所在出的一个字符，在空命令行的情况下可以退出终端。</span><br><span class="line">esc+. :上一个命令的后面的参数</span><br><span class="line">Ctrl+b:光标向行首移动一个字符。</span><br><span class="line">Ctrl+f:光标向行尾移动一个字符。</span><br><span class="line">Ctrl+h:向行首删除一个字符。</span><br><span class="line">Ctrl+i:相当于Tab键。</span><br><span class="line">Ctrl+L:清屏</span><br><span class="line">Ctrl+s:使终端发呆，静止，可以使快速输出的终端屏幕停下来。</span><br><span class="line">Ctrl+q:退出Ctrl+s引起的发呆。</span><br><span class="line">Ctrl+z:使正在运行在终端的任务，运行于后台。 （可用fg恢复）</span><br><span class="line">Ctrl+c:中断终端中正在执行的任务。</span><br><span class="line">Tab键:命令、文件名等自动补全功能。</span><br></pre></td></tr></table></figure><p>以上的快捷键都是在工作中可能会经常用到的，不论是在图形界面打开的终端还是字符界面的终端都可以使用，在这里面就不挨个演示了，各位可以在终端中使用任意字幕和空格模拟命令输入然后多多熟悉，尽快掌握。</p>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux终端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>各发行版Linux介绍</title>
      <link href="/2022/08/07/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/7.%E5%90%84%E5%8F%91%E8%A1%8C%E7%89%88Linux%E4%BB%8B%E7%BB%8D/"/>
      <url>/2022/08/07/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/7.%E5%90%84%E5%8F%91%E8%A1%8C%E7%89%88Linux%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="各发行版Linux介绍"><a href="#各发行版Linux介绍" class="headerlink" title="各发行版Linux介绍"></a>各发行版Linux介绍</h1><h2 id="一、RedHat-Enterprise-Linux介绍"><a href="#一、RedHat-Enterprise-Linux介绍" class="headerlink" title="一、RedHat Enterprise Linux介绍"></a>一、RedHat Enterprise Linux介绍</h2><p>可能这是最著名的Linux版本了，Red Hat Linux已经创造了自己的品牌，越来越多的人听说过它。Red Hat在1994年创业，当时聘用了全世界500多名员工，他们都致力于开放的源代码体系。</p><p>Red Hat Linux是公共环境中表现上佳的服务器。它拥有自己的公司，能向用户提供一套完整的服务，这使得它特别适合在公共网络中使用。这个版本的Linux也使用最新的内核，还拥有大多数人都需要使用的主体软件包。</p><p>Red Hat Linux的安装过程也十分简单明了。它的图形安装过程提供简易设置服务器的全部信息。磁盘分区过程可以自动完成，还可以选择GUI工具完成，即使对于 Linux新手来说这些都非常简单。选择软件包的过程也与其他版本类似；用户可以选择软件包种类或特殊的软件包。系统运行起来后，用户可以从Web站点和 Red Hat那里得到充分的技术支持。是一个符合大众需求的最优版本。在服务器和桌面系统中它都工作得很好。Red Hat通过论坛和邮件列表提供广泛的技术支持，它还有自己公司的电话技术支持，后者对要求更高技术支持水平的集团客户更有吸引力。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927084608312.png" alt="image-20230927084608312"></p><h2 id="二、Ubuntu介绍"><a href="#二、Ubuntu介绍" class="headerlink" title="二、Ubuntu介绍"></a>二、Ubuntu介绍</h2><p>Ubuntu是一个以桌面应用为主的Linux操作系统，基于Debian，与Debian的不同在于它每6个月会发布一个新版本。Ubuntu的目标在于为一般用户提供一个最新的、同时又相当稳定的主要由自由软件构建而成的操作系统。Ubuntu具有庞大的社区力量，用户可以方便地从社区获得帮助。随着云计算的流行，ubuntu推出了一个云计算环境搭建的解决方案，可以在其官方网站找到相关信息。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927084619112.png" alt="image-20230927084619112"></p><h2 id="三、Debian介绍"><a href="#三、Debian介绍" class="headerlink" title="三、Debian介绍"></a>三、Debian介绍</h2><p>广义的Debian是指一个致力于创建自由操作系统的合作组织及其作品，由于Debian项目众多内核分支中以Linux内核为主，而且 Debian开发者所创建的操作系统中绝大部分基础工具来自于GNU工程 ，因此 “Debian” 常指Debian GNU&#x2F;Linux。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927084630251.png" alt="image-20230927084630251"></p><h2 id="四、open-SUSE介绍"><a href="#四、open-SUSE介绍" class="headerlink" title="四、open SUSE介绍"></a>四、open SUSE介绍</h2><p>openSUSE 项目是由 Novell 发起的开源社区计划。 旨在推进 Linux 的广泛使用，提供了自由简单的方法来获得世界上最好用的 Linux 发行版之一。openSUSE 项目为 Linux开发者和爱好者提供了开始使用 Linux 所需要的一切。该项目由SUSE等公司赞助，2011年Attachmate集团收购了Novell，并把Novell和SUSE做为两个独立的子公司运营。openSUSE 操作系统和相关的开源程序会被SUSE Linux Enterprise使用。openSUSE对个人来说是完全免费的，包括使用和在线更新。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927084642001.png" alt="image-20230927084642001"></p><h2 id="五、CentOS介绍"><a href="#五、CentOS介绍" class="headerlink" title="五、CentOS介绍"></a>五、CentOS介绍</h2><p>CentOS（Community Enterprise Operating System，中文意思是社区企业操作系统）是Linux发行版之一，它是来自于Red Hat Enterprise Linux依照开放源代码规定释出的源代码所编译而成。由于出自同样的源代码，因此有些要求高度稳定性的服务器以CentOS替代商业版的Red Hat Enterprise Linux使用。两者的不同在于CentOS完全开源。</p><p>CentOS 每个版本的 CentOS都会获得十年的支持（通过安全更新方式）。新版本的 CentOS 大约每两年发行一次，而每个版本的 CentOS 会定期（大概每六个月）更新一次，以便支持新的硬件。这样，建立一个安全、低维护、稳定、高预测性、高重复性的 Linux 环境。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927084652729.png" alt="image-20230927084652729"></p><h2 id="六、Linux-Mint介绍"><a href="#六、Linux-Mint介绍" class="headerlink" title="六、Linux Mint介绍"></a>六、Linux Mint介绍</h2><p>Linux Mint 由Linux Mint Team团队于2006年开始发行，是一份基于Debian和Ubuntu的Linux发行版。其目标是提供一种更完整的即刻可用体验，这包括提供浏览器插件、多媒体编解码器、对DVD播放的支持、Java和其他组件，它也增加了一套定制桌面及各种菜单，一些独特的配置工具，以及一份基于web的软件包安装界面。Linux Mint是对用户友好而功能强大的操作系统。它诞生的目的是为家庭用户和企业提供一个免费的，易用</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927084704199.png" alt="image-20230927084704199"></p><h2 id="七、Mageia介绍"><a href="#七、Mageia介绍" class="headerlink" title="七、Mageia介绍"></a>七、Mageia介绍</h2><p>2010年9月，为 Mandriva 发行版工作的多数雇员在 Mandriva 子公司 Edge-IT 实施清算时遭到解聘，他们随即与社群支持者于2010年9月18日在法国巴黎创建 Mandriva Linux 的分支项目—— Mageia。这是一个完全由社群运作的 Linux 发行版，将继续发挥 Mandriva Linux 对用户友好的优秀品质，而避免 Mandriva 公司缺乏竞争力的运作模式。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927084719720.png" alt="image-20230927084719720"></p><h2 id="八、Fedora介绍"><a href="#八、Fedora介绍" class="headerlink" title="八、Fedora介绍"></a>八、Fedora介绍</h2><p>Fedora 是一个 Linux发行版，是一款由全球社区爱好者构建的面向日常应用的快速、稳定、强大的操作系统。 它允许任何人自由地使用、修改和重发布，无论现在还是将来。它由一个强大的社群开发，这个社群的成员以自己的不懈努力，提供并维护自由、开放源码的软件和开放的标准。Fedora 项目由 Fedora 基金会管理和控制，得到了 Red Hat 的支持。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927084731413.png" alt="image-20230927084731413"></p><h2 id="九、Arch-Linux介绍"><a href="#九、Arch-Linux介绍" class="headerlink" title="九、Arch Linux介绍"></a>九、Arch Linux介绍</h2><p><strong>Arch Linux</strong>是一款基于 x86-64 架构的 Linux 发行版。系统主要由自由]和开源软件组成，支持社区参与。系统设计以KISS原则（保持简单和愚蠢）为总体指导原则，注重代码正确、优雅和极简主义，期待用户能够愿意去理解系统的操作。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927084741728.png" alt="image-20230927084741728"></p><h2 id="十、Slackware介绍"><a href="#十、Slackware介绍" class="headerlink" title="十、Slackware介绍"></a>十、Slackware介绍</h2><p><em>Slackware</em> 作为较古老的Linux发行版之一相比其他的主流发行版更希望成为具有 “UNIX风格” 的那一个，一直以来以简洁、安全和稳定所著称。其以灵活性和稳定性作为主要目标，但是缺少其他linux发行版本中那些为发行版定制的配置工具。在当今其他发行版都在使用 Systemd作为启动管理器时，<em>Slackware</em> 依旧使用 BSD 启动风格，各有优劣不做评价。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927084753456.png" alt="image-20230927084753456"></p>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 发行版Linux介绍 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux起源和发展</title>
      <link href="/2022/08/06/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/6.linux%E8%B5%B7%E6%BA%90%E5%92%8C%E5%8F%91%E5%B1%95/"/>
      <url>/2022/08/06/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/6.linux%E8%B5%B7%E6%BA%90%E5%92%8C%E5%8F%91%E5%B1%95/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Linux起源和发展"><a href="#Linux起源和发展" class="headerlink" title="Linux起源和发展"></a>Linux起源和发展</h1><h2 id="一、什么是linux？"><a href="#一、什么是linux？" class="headerlink" title="一、什么是linux？"></a>一、什么是linux？</h2><p><strong>Linux是一套免费使用和自由传播的类Unix操作系统</strong>，是一个基于POSIX和Unix的多用户、多任务、支持多线程和多CPU的操作系统。伴随着互联网的发展，Linux得到了来自全世界软件爱好者、组织、公司的支持。它除了在服务器操作系统方面保持着强劲的发展势头以外，在个人电脑、嵌入式系统上都有着长足的进步。使用者不仅可以直观地获取该操作系统的实现机制，而且可以根据自身的需要来修改完善这个操作系统，使其最大化地适应用户的需要。</p><p><strong>Linux系统应用</strong><br>Linux不仅系统性能稳定，而且是开源软件。其核心防火墙组件性能高效、配置简单，保证了系统的安全。在很多企业网络中，为了追求速度和安全，Linux操作系统不仅仅是被网络运维人员当作服务器使用，Linux既可以当作服务器，又可以当作网络防火墙是Linux的 一大亮点。</p><p><strong>linux优点</strong><br>Linux与其他操作系统相比 ，具有开放源码、没有版权、技术社区用户多等特点 ，开放源码使得用户可以自由裁剪，灵活性高，功能强大，成本低。尤其系统中内嵌网络协议栈 ，经过适当的配置就可实现路由器的功能。这些特点使得Linux成为开发路由交换设备的理想开发平台。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927083239033.png" alt="image-20230927083239033"></p><h2 id="二、Linux的起源"><a href="#二、Linux的起源" class="headerlink" title="二、Linux的起源"></a>二、Linux的起源</h2><p>Linux操作系统的诞生、发展和成长过程始终依赖着五个重要支柱：</p><ul><li>Unix操作系统</li><li>MINIX操作系统</li><li>GNU计划</li><li>POSIX标准</li><li>Internet网络。</li></ul><p>20世纪80年代，计算机硬件的性能不断提高，PC的市场不断扩大，当时可供计算机选用的操作系统主要有Unix、DOS和MacOS这几种。Unix价格昂贵，不能运行于PC；DOS显得简陋，且源代码被软件厂商严格保密；<br>MacOS是一种专门用于苹果计算机的操作系统。此时，计算机科学领域迫切需要一个更加完善、强大、廉价和完全开放的操作系统。由于供教学使用的典型操作系统很少，因此当时在荷兰当教授的美国人AndrewS.Tanenbaum编写了一个操作系统，名为MINIX，为了向学生讲述操作系统内部工作原理。MINIX虽然很好，但只是一个用于教学目的的简单操作系统，而不是一个强有力的实用操作系统，然而最大的好处就是公开源代码。全世界学计算机的学生都通过钻研MINIX源代码来了解电脑里运行的MINIX操作系统，芬兰赫尔辛基大学大学二年级的学生Linus Torvalds就是其中一个，在吸收了MINIX精华的基础上，Linus于1991年写出了属于自己的Linux操作系统，版本为Linux0.01，是Linux时代开始的标志。他利用Unix的核心，去除繁杂的核心程序，改写成适用于一般计算机的x86系统，并放在网络上供大家下载，1994年推出完整的核心Version1.0，至此，Linux逐渐成为功能完善、稳定的操作系统，并被广泛使用。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927083251190.png" alt="image-20230927083251190"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927083300484.png" alt="image-20230927083300484"></p><h2 id="三、Linux的发展史"><a href="#三、Linux的发展史" class="headerlink" title="三、Linux的发展史"></a>三、Linux的发展史</h2><p>1984年，Andrew S.Tanenbaum开发了用于教学的UNIX系统，命名为Mininx。</p><p>1989年，Andrew S.Tanenbaum将Minix系统运行于x86的PC平台。</p><p>1990年，芬兰赫尔辛基大学学生Linux Torvalds首次接触Minix系统。</p><p>1991年，Linux Torvalds开始在Minix上编写各种驱动程序等操作系统内核组件。</p><p>1991年年底，Linux Torvalds公开了Linux内核源码0.02版</p><p>1994年，Linux 1.0版本发布</p><p>1996年，Linux 2.0版本发布</p><p>2011年，Linux3.0版本发布</p><p>这里面我们所介绍的发布时间，指的都是内核大版本的发布时间，次要版本号更新时间请参看FAQ，其中偶数版的内核为稳定版，奇数版的内核为开发版或测试版</p><h2 id="四、Linux和Unix的对比"><a href="#四、Linux和Unix的对比" class="headerlink" title="四、Linux和Unix的对比"></a>四、Linux和Unix的对比</h2><p>我们所讨论的差异只从硬件支持，版权和价格这些来讨论他们之间的区别，UNIX是一个功能强大、性能全面的多用户、多任务操作系统，可以应用从巨型计算机到普通PC机等多种不同的平台上，是应用面最广、影响力最大的操作系统。</p><ul><li>Linux是一种外观和性能与UNIX相同或更好的操作系统，但Linux不源于任何版本的UNIX的源代码，并不是UNIX，而是一个类似于UNIX的产品。</li><li>Linux是开发源代码的自由软件,UNIX是对源代码实行知识产权保护的传统商业软件.</li><li>UNIX系统大多是与硬件配套的,而Linux则可运行在多种硬件平台上.</li><li>UNIX是商业软件，需要收费,而Linux是自由软件,免费、公开源代码的</li><li>在对硬件的要求上,linux比unix要低,没有unix那么苛刻.在安装上linux比unix容易掌握.</li></ul><h2 id="五、类Unix操作系统介绍"><a href="#五、类Unix操作系统介绍" class="headerlink" title="五、类Unix操作系统介绍"></a>五、类Unix操作系统介绍</h2><ul><li>什么是类Unix操作系统？</li></ul><p>类Unix系统（英文：Unix-like）是指继承UNIX的设计风格演变出来的系统，这些操作系统虽然有的是自由软件，有的是商业软件，但都相当程度地继承了原始UNIX的特性，有许多相似处，并且都在一定程度上遵守POSIX规范，但是它们却并不含有UNIX的源代码。由于UNIX标准认定价格昂贵，所以目前唯一获得UNIX标准认定的为苹果的MACOS系统。</p><ul><li>类Unix操作系统有哪些？</li></ul><p>FreeBSD及其衍生产品、OpenBSD及其衍生产品、GNU&#x2F;Linux、GNU&#x2F;OpenSolaris等等，这里面我们所介绍的几种主流的类Unix操作系统，他们大多都属于开源产品，在互联网上是可以获取到的，有兴趣的同学可以自行搜索并下载安装</p><p>并且接触到了一个概念叫做“类Unix操作系统”，也知道了这个类Unix操作系统的家族非常庞大。</p><h2 id="六、linux厂商"><a href="#六、linux厂商" class="headerlink" title="六、linux厂商"></a>六、linux厂商</h2><p>真实因为GPL,很多公司基于linux的源码进行修改、优化后推出了自己的产品，其中最著名的就是redhat，其实每个国家都有自己的linux系统，比如中国最早的红旗linux，现在的中科麒麟、深度，都是linux系统.企业通过收取技术服务费来进行盈利。</p><h2 id="七、linux的应用"><a href="#七、linux的应用" class="headerlink" title="七、linux的应用"></a>七、linux的应用</h2><p>100% 的世界超级计算机跑在 Linux 上。包括 NASA 的集群。</p><p>SpaceX 在其灰背隼火箭引擎上使用具有特殊容错设计的 Linux。借此，Linux 帮助完成了 32 次航天任务。 埃隆·马斯克 特斯拉</p><p>电影泰坦尼克是首个基于 Linux 服务器拍摄的电影。</p><p>即使 Linux 的最大的竞争操作系统微软 Windows 也拥抱 Linux。Windows 最近集成了 Ubuntu Bash 到 Windows 10 里了。</p><h2 id="八、视频学习"><a href="#八、视频学习" class="headerlink" title="八、视频学习"></a>八、视频学习</h2><p><a href="https://www.ixigua.com/6906825528561369608?is_new_connect=0&is_new_user=0">视频：linux介绍</a><br><a href="https://www.ixigua.com/6906835360559727111?id=6906825493740257804&logTag=40b7533f87d8f1a8cc8d">视频：linux起源</a></p><h1 id="GNU和GPL"><a href="#GNU和GPL" class="headerlink" title="GNU和GPL"></a>GNU和GPL</h1><h2 id="一、GNU介绍"><a href="#一、GNU介绍" class="headerlink" title="一、GNU介绍"></a>一、GNU介绍</h2><p><strong>GNU</strong>是一个自由的操作系统，其内容软件完全以GPL方式发布。这个操作系统是GNU计划的主要目标，名称来自GNU’s Not Unix!的缩写，因为GNU的设计类似Unix，但它不包含具著作权的Unix代码。GNU的创始人，理查德·马修·斯托曼。</p><p>作为操作系统，GNU的发展仍未完成，其中最大的问题是具有完备功能的内核尚未被开发成功。GNU的内核是自由软件基金会发展的重点，但是其发展尚未成熟。在实际使用上，多半使用Linux内核、FreeBSD等替代方案，作为系统核心，其中主要的操作系统是Linux的发行版。Linux操作系统包涵了Linux内核与其他自由软件项目中的GNU组件和软件，可以被称为GNU&#x2F;Linux。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927084309978.png" alt="image-20230927084309978"></p><p>1985年Richard Stallman又创立了自由软件基金会来为GNU计划提供技术、法律以及财政支持。尽管GNU计划大部分时候是由个人自愿无偿贡献，但FSF有时还是会聘请程序员帮助编写。当GNU计划开始逐渐获得成功时，一些商业公司开始介入开发和技术支持。</p><p>到了1990年，GNU计划已经开发出的软件包括了一个功能强大的文字编辑器Emacs。GCC（GNU Compiler Collection，GNU编译器集合），是一套由 GNU 开发的编程语言编译器。以及大部分UNIX系统的程序库和工具。唯一依然没有完成的重要组件就是操作系统的内核。</p><p>1991年Linus Torvalds编写出了与UNIX兼容的Linux操作系统内核并在GPL条款下发布。Linux之后在网上广泛流传，许多程序员参与了开发与修改。1992年Linux与其他GNU软件结合，完全自由的操作系统正式诞生。该操作系统往往被称为“GNU&#x2F;Linux”或简称Linux。许多UNIX系统上也安装了GNU软件，因为GNU软件的质量比之前UNIX的软件还要好。GNU工具还被广泛地移植到Windows和Mac OS上。</p><h2 id="理查德·马修·斯托曼"><a href="#理查德·马修·斯托曼" class="headerlink" title="理查德·马修·斯托曼"></a>理查德·马修·斯托曼</h2><p>理查德·马修·斯托曼（英语：Richard Matthew Stallman，简称rms，有时也用大写的RMS，1953年3月16日－），美国程序员，自由软件活动家。他发起自由软件运动，倡导软件用户能够对软件自由进行使用、学习、共享和修改，确保了这些软件被称作自由软件。斯托曼发起了GNU项目，并成立了自由软件基金会。他开发了GCC、GDB、GNU Emacs，同时编写了GNU通用公共许可协议。</p><p>为了创建一个完全由免费软件组成的类Unix计算机操作系统，斯托曼在1983年9月推出了GNU项目。借此又发起了自由软件运动。他迄今为止一直是GNU项目的组织者，作为主要开发者的他开发了一些被广泛使用的GNU软件。在1985年10月他创立了自由软件基金会。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927084328635.png" alt="image-20230927084328635"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927084335686.png" alt="image-20230927084335686"></p><h2 id="二、自由软件基金会介绍"><a href="#二、自由软件基金会介绍" class="headerlink" title="二、自由软件基金会介绍"></a>二、自由软件基金会介绍</h2><p><strong>自由软件基金会</strong>（英语：<strong>Free Software Foundation</strong>，<strong>FSF</strong>）是一个致力于推广自由软件的美国民间非营利性组织。它于1985年10月由理查德·斯托曼创建。其主要工作是运行GNU计划，开发更多的自由软件。</p><p>从其创建到1990年代中自由软件基金会的基金主要被用来雇佣编程师来发展自由软件。从1990年代中开始写自由软件的公司和个人繁多，因此自由软件基金会的雇员和志愿者主要在自由软件运动的法律和结构问题上工作。</p><p><strong>主要工作</strong>：</p><ul><li>GNU</li></ul><p>自由软件基金会最早的目的在于促进自由软件的开发，但自由软件基金会也有自己的GUN项目</p><ul><li>发布并管理许可证</li></ul><p>自由软件基金会具有发布GNU通用公共许可证和其它GNU许可证的能力和资源，但自由软件基金会只对它拥有版权的软件负责。其它软件必须由它们自己的拥有人来负责</p><ul><li>GNU许可证</li></ul><p>GNU通用公共许可证是自由软件工程中最普及的许可证。目前的版本是2007年发表的。自由软件基金会还发布了GNU宽通用公共许可证和GNU自由文档许可证</p><ul><li>监督版权</li></ul><p>自由软件基金会拥有大多数GNU软件和一些非GNU自由软件的版权。每个GNU软件包的贡献者必须签署版权文件，这样自由软件基金会可以在诉讼案中在法庭上维护这些软件。此外这样假如许可证有所变化的话不必征求软件所有的贡献者的同意。</p><ul><li>自由软件目录</li></ul><p>自由软件目录是所有自由软件包的一个列表。其中列出的每个软件包含47条信息，比如工程的主页、程序师、编程语言等。目的是提供一个自由软件的搜索引擎和为用户提供一个检查一个软件包是否自由的工具。自由软件基金会为此从联合国教科文组织获得少数基金。计划是将来这个目录可以翻译成不同的语言。</p><ul><li>颁发奖励</li></ul><p>自由软件基金会每年颁发两部奖励：自由软件进步大奖和社会福利自由软件奖励。</p><h2 id="三、GPL介绍"><a href="#三、GPL介绍" class="headerlink" title="三、GPL介绍"></a>三、GPL介绍</h2><p><strong>GNU</strong>通用公共许可协议（英语：GNU General Public License，缩写GNU GPL 或 GPL），是被广泛使用的自由软件许可证，给予了终端用户运行、学习、共享和修改软件的自由。许可证最初由自由软件基金会的理查德·斯托曼为GNU项目所撰写，并授予计算机程序的用户自由软件定义的权利。GPL是一个Copyleft许可证，这意味着派生作品只能以相同的许可条款分发。 GPL是第一个普遍使用的Copyleft许可证。历史上，GPL许可证系列一直是自由和开源软件领域最受欢迎的软件许可之一。</p><h2 id="GPL历史"><a href="#GPL历史" class="headerlink" title="GPL历史"></a>GPL历史</h2><p>GPLv1：GPL版本1，即最初的版本，发布于1989年一月</p><p>GPLv2：发布于1991年6月，这个版本一直延续到1999年，并分支出一个派生的LGPL版本号为2.1，并将其重命名为轻量级通用公共许可证（又称宽通用公共许可证）</p><p>GPLv3：2007年6月29日正式发布</p>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux起源、GNU和GPL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机操作系统</title>
      <link href="/2022/08/05/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/5.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BB%8B%E7%BB%8D/"/>
      <url>/2022/08/05/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/5.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="操作系统介绍"><a href="#操作系统介绍" class="headerlink" title="操作系统介绍"></a>操作系统介绍</h1><h2 id="一、操作系统的介绍"><a href="#一、操作系统的介绍" class="headerlink" title="一、操作系统的介绍"></a>一、操作系统的介绍</h2><p>操作系统是<strong>管理计算机硬件与软件资源</strong>的计算机程序，会对计算机管理硬件、驱动硬件；管理软件；资源分配与回收，操作系统也提供一个让用户与系统交互的操作界面。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927083019854.png" alt="image-20230927083019854"></p><p>在计算机中，操作系统是其最基本也是最为重要的基础性系统软件。</p><ul><li>从计算机用户的角度来说：计算机操作系统体现在其提供的各项服务；</li><li>从程序员的角度来说：其主要是指用户登录的界面或者接口；</li><li>从设计人员的角度来说：就是指各式各样模块和单元之间的联系。</li></ul><p>经过几十年以来的发展，计算机操作系统已经由一开始的简单控制循环体发展成为较为复杂的分布式操作系统，再加上计算机用户需求的愈发多样化，计算机操作系统已经成为既复杂而又庞大的计算机软件系统之一。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927083039602.png" alt="image-20230927083039602"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230927083046568.png" alt="image-20230927083046568"></p><h2 id="二、操作系统的功能"><a href="#二、操作系统的功能" class="headerlink" title="二、操作系统的功能"></a>二、操作系统的功能</h2><p>操作系统主要包括以下几个方面的功能 ：</p><p>①进程管理：其工作主要是进程调度，解决处理器的调度、 分配和回收等问题 。如：根据进程的优先级不同，来决定优先处理哪个进程的数据</p><p>②存储管理分为几种功能：<br>– 存储分配，如：内存资源的分配；<br>– 存储共享，如：不同进程可以共享内存中的数据等；<br>– 存储保护，如：保证内存中的程序只能在指定的存储区域内活动，互不干扰 ；<br>– 存储扩张，如：利用虚拟内存技术或者自动覆盖技术，从逻辑上扩充内存。</p><p>③设备管理分有以下功能：<br>– 设备分配，也就是为对应的进程分配合适的设备及相关硬件；<br>– 设备传输控制，主要是控制各种I&#x2F;O设备和内存或CPU之间的数据传送 ；<br>– 设备独立性，又称设备无关性，是指应用程序独立于具体使用的物理设备。</p><p>④文件管理：<br>– 文件存储空间的管理，可以简单理解为，硬盘上哪些地方空着我可以写入数据，哪些地方的数据删除了，我可以将空间回收，以便有新的数据写入时使用，只不过这个是针对于块的操作；<br>– 目录管理 ，让我们可以按照名字进行存取，提高查询的速度等；<br>– 文件操作管理，如：文件的创建，删除，读，写等；<br>– 文件保护，如：为了防止文件被破坏或修改，针对不同的用户设置不同的权限。</p><p>⑤作业管理是负责处理用户提交的任何要求。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">操作系统是一个计算机程序，是人类和计算机硬件沟通的一个桥梁，它解决了人不懂二进制的问题，同时也解决了硬件听不懂人下发指令语言。</span><br><span class="line"></span><br><span class="line">相对于人来说他是人的大管家，负责管理硬件、支配硬件干活、把硬件工作的结果反馈给人。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">这就是操作系统的作用，人类的帮手。</span><br></pre></td></tr></table></figure><h2 id="三、操作系统的分类"><a href="#三、操作系统的分类" class="headerlink" title="三、操作系统的分类"></a>三、操作系统的分类</h2><p>计算机的操作系统根据不同的用途分为不同的种类</p><ul><li><p><strong>从功能角度分类</strong>: 实时系统、批处理系统、分时系统、网络操作系统等。</p><p><strong>实时系统</strong>主要是指当外界事件或数据产生时，能够接受并以足够快的速度予以处理，其处理的结果又能在规定的时间之内来控制生产过程或对处理系统做出快速响应，调度一切可利用的资源完成实时任务，并控制所有实时任务协调一致运行的操作系统。提供及时响应和高可靠性是其主要特点。常用于工业控制，航空，航天等领域，目前主流的实时操作系统有uc&#x2F;OS、FreeRTOS、TI DSP&#x2F;BIOS、RT-Thread</p><p><strong>批处理系统</strong>在1960年左右出现，是指用户将一批作业提交给操作系统后就不再干预，由操作系统控制它们自动运行，批处理操作系统不具有交互性，它是为了提高CPU的利用率而提出的一种操作系统。</p><p><strong>分时系统</strong>可以实现用户的人机交互需要，多个用户共同使用一个主机，很大程度上节约了资源成本，如linux</p><p><strong>网络操作系统</strong>是向网络计算机提供服务的特殊的操作系统。借由网络达到互相传递数据与各种消息，分为服务器及客户端，我们日常接触的windows、linux等也都属于网络操作系统范畴</p><p><strong>分布式操作系统</strong> 简单来说就是有一堆计算机，各自物理硬件上是独立的，通过网络相连，互相通信，通过统一的“中间件”进行协调，共享资源，协同分工完成一件任务的计算机集群</p></li><li><p><strong>从使用角度分类:</strong><br><strong>个人版系统:</strong> xp win7 win10 fedora<br><strong>网络版系统:</strong> win2008 win2012 RHEL CentOS</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 云计算 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机网络</title>
      <link href="/2022/08/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/4.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
      <url>/2022/08/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/4.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="计算机网络介绍"><a href="#计算机网络介绍" class="headerlink" title="计算机网络介绍"></a>计算机网络介绍</h1><h2 id="计算机网络"><a href="#计算机网络" class="headerlink" title="计算机网络"></a>计算机网络</h2><p>计算机网络是由通信介质将地理位置不同的且相互独立的计算机连接起来，实现数据通信与资源共享</p><h2 id="网络分类"><a href="#网络分类" class="headerlink" title="网络分类"></a>网络分类</h2><h3 id="按照网络拓扑分类"><a href="#按照网络拓扑分类" class="headerlink" title="按照网络拓扑分类"></a>按照网络拓扑分类</h3><p>总线型：一般传输介质为同轴电缆，需要T型头和信号终结器</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926172002455.png" alt="image-20230926172002455"></p><p>环形：需要申请令牌才可以通信。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926172034796.png" alt="image-20230926172034796"></p><p>星型：中央节点压力大，单点故障</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926172050104.png" alt="image-20230926172050104"></p><p>网型：效率高，网络复杂</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926172104207.png" alt="image-20230926172104207"></p><h3 id="按地域分类：参照物不同，类型不同"><a href="#按地域分类：参照物不同，类型不同" class="headerlink" title="按地域分类：参照物不同，类型不同"></a>按地域分类：参照物不同，类型不同</h3><p>局域网(LAN)：一个公司、一个家庭</p><p>城域网(MAN)：一个区、一个城市、一个国家</p><p>广域网(WAN)：一个国家、全世界</p><h2 id="网络设备"><a href="#网络设备" class="headerlink" title="网络设备"></a>网络设备</h2><p>交换机：负责组建局域网，研究的是MAC地址</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926172148966.png" alt="image-20230926172148966"></p><p>路由器：负责组建广域网，研究的是IP地址</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926172205103.png" alt="image-20230926172205103"></p><h2 id="传输介质"><a href="#传输介质" class="headerlink" title="传输介质"></a>传输介质</h2><p>同轴电缆、双绞线、光纤</p><p>目前常用的就是双绞线和光纤</p><h2 id="1）双绞线"><a href="#1）双绞线" class="headerlink" title="1）双绞线"></a>1）双绞线</h2><p>双绞线（twisted pair，TP）是一种综合布线工程中最常用的传输介质，是由两根具有绝缘保护层的铜导线组成的。把两根绝缘的铜导线按一定密度互相绞在一起，每一根导线在传输中辐射出来的电波会被另一根线上发出的电波抵消，有效降低信号干扰的程度。双绞线理论最大传输距离是100米，<strong>树明建议不要超过90米</strong>。如果两台设备超过这个距离，建议中间放一个中继器或者交换机。</p><h3 id="双绞线分为屏蔽双绞线和非屏蔽双绞线两种"><a href="#双绞线分为屏蔽双绞线和非屏蔽双绞线两种" class="headerlink" title="双绞线分为屏蔽双绞线和非屏蔽双绞线两种"></a>双绞线分为屏蔽双绞线和非屏蔽双绞线两种</h3><p>屏蔽双绞线：抗静电干扰性强，价格稍高一些，一般室外用的多一些。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926172319684.png" alt="image-20230926172319684"></p><p>非屏蔽双绞线：重量轻，易弯曲，易安装，一般用在室内。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926172333716.png" alt="image-20230926172333716"></p><h3 id="按照传输速度分类"><a href="#按照传输速度分类" class="headerlink" title="按照传输速度分类"></a>按照传输速度分类</h3><ul><li>1类 100KHz 主要用于传输语音</li><li>2类 1MHz 用于语音传输和最高传输速率4Mbps的数据传输</li><li>3类 16MHz 指目前在ANSI和EIA&#x2F;TIA568标准中指定的电缆，该电缆的传输频率16MHz，用于语音传输及最高传输速率为10Mbps的数据传输主要用于10BASE–T。</li><li>4类 20MHz 该类电缆的传输频率为20MHz，用于语音传输和最高传输速率16Mbps的数据传输主要用于基于令牌的局域网和 10BASE-T&#x2F;100BASE-T。</li><li>5类 100MHz 该类电缆增加了绕线密度，外套一种高质量的绝缘材料，传输率为100MHz，用于语音传输和最高传输速率为10Mbps的数据传输，主要用于100BASE-T和10BASE-T网络。这是最常用的以太网电缆。</li><li>5e类 100MHz 超5类具有衰减小，串扰少，并且具有更高的衰减与串扰的比值(ACR)和信噪比(Structural Return Loss)、更小的时延误差，性能得到很大提高。超5类线主要用于千兆位以太网（1000Mbps）。</li><li>6类 250MHz 六类线：该类电缆的传输频率为1MHz～250MHz，六类布线系统在200MHz时综合衰减串扰比（PS-ACR）应该有较大的余量，它提供2倍于超五类的带宽。六类布线的传输性能远远高于超五类标准，最适用于传输速率高于1Gbps的应用。六类与超五类的一个重要的不同点在于：改善了在串扰以及回波损耗方面的性能，对于新一代全双工的高速网络应用而言，优良的回波损耗性能是极重要的。六类标准中取消了基本链路模型，布线标准采用星形的拓扑结构，要求的布线距离为：永久链路的长度不能超过90m，信道长度不能超过100m。</li><li>6A类 500MHz</li><li>7类 600MHz</li></ul><h3 id="按照品牌分类"><a href="#按照品牌分类" class="headerlink" title="按照品牌分类"></a><strong>按照品牌分类</strong></h3><ul><li>安普</li><li>西蒙</li><li>朗讯</li><li>丽特</li><li>IBM</li></ul><h2 id="2）光纤"><a href="#2）光纤" class="headerlink" title="2）光纤"></a>2）光纤</h2><p>光纤是光导纤维的简写，是一种由玻璃或塑料制成的纤维，可作为光传导工具。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926172520999.png" alt="image-20230926172520999"></p><h3 id="光纤分类"><a href="#光纤分类" class="headerlink" title="光纤分类"></a>光纤分类</h3><p>单模光纤：只能传输一种模式的光，传输距离远，是多模光纤的几十倍以上，单模光纤外面护套线颜色一般为黄色</p><p>多模光纤：可以传输多种模式的光，多模光纤传输的距离比较近，一般只有几千米，多模光纤外面颜色一般为橘红色</p><h3 id="光纤速度"><a href="#光纤速度" class="headerlink" title="光纤速度"></a>光纤速度</h3><p>光纤的极限传输家用的普通光纤就可达到10Gbps以上。</p><p>实验室中单条光纤最大速度已达到了26Tbps，有消息说通过石墨烯制造的新光调制器，还可继续提高10000倍，即260Pbps。</p><h1 id="OSI七层网络模型"><a href="#OSI七层网络模型" class="headerlink" title="OSI七层网络模型"></a>OSI七层网络模型</h1><h2 id="ISO介绍"><a href="#ISO介绍" class="headerlink" title="ISO介绍"></a>ISO介绍</h2><p>国际标准化组织（International Organization for Standardization，ISO）简称ISO，是一个全球性的非政府组织，是国际标准化领域中一个十分重要的组织。ISO国际标准组织成立于1946年，</p><p>ISO负责目前绝大部分领域（包括军工、石油、船舶等垄断行业）的标准化活动。ISO现有117个成员，包括117个国家和地区。中国是ISO的正式成员，代表中国参加ISO的国家机构是中国国家技术监督局（CSBTS）。</p><h2 id="网络模型介绍"><a href="#网络模型介绍" class="headerlink" title="网络模型介绍"></a>网络模型介绍</h2><p>在上世纪70年代，不同的厂商的计算机之间采用的都是本厂的通信协议，不同厂商间的计算机是无法通信的，为了解决这个问题，ISO组织专门成立了一个小组，目的是写出一套公共通信协议，实现不同厂商计算机之间通信互联。</p><p>实际上只是Honeywell Information System公司的一个小组完成的，小组的技术负责人是Charlie Bachman，这个小组主要是为了开发一些原型系统而成立的，主要关注数据库系统的设计。70年代中，为了支持数据库系统的访问，需要一个结构化的分布式通信系统体系结构。</p><p>在1977年提出了一个七层的体系结构模型，他们内部称之为分布式系统体系结构（DSA）</p><p>与此同时，1977年英国标准化协会向国际标准化组织（ISO）提议，为了定义分布处理之间的通信基础设施，需要一个标准的体系结构。结果，ISO就开放系统互联（OSI）问题成立了一个专委会（TC 97, Subcomittee 16），指定由美国国家标准协会（ANSI）开发一个标准草案，在专委会第一次正式会议之前提交。</p><p>Bachman [1] 参加了ANSI早期的会议，并提交了他的七层模型，这个模型就成了提交ISO专委会的唯一的一份草案。1978年发布了这个临时版本，1979年稍作细化之后，成了最终的版本。</p><h2 id="OSI七层模型"><a href="#OSI七层模型" class="headerlink" title="OSI七层模型"></a>OSI七层模型</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926172817611.png" alt="image-20230926172817611"></p><h2 id="OSI七层模型介绍"><a href="#OSI七层模型介绍" class="headerlink" title="OSI七层模型介绍"></a>OSI七层模型介绍</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926173025825.png" alt="image-20230926173025825"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926172915596.png" alt="image-20230926172915596"></p><p>应用层</p><p>网络服务与最终用户的一个接口。</p><p>协议有：HTTP FTP TFTP SMTP SNMP DNS TELNET HTTPS POP3 DHCP</p><p>表示层</p><p>数据的表示、安全、压缩。（在五层模型里面已经合并到了应用层）</p><p>格式有，JPEG、ASCll、DECOIC、加密格式等</p><p>会话层</p><p>建立、管理、终止会话。（在五层模型里面已经合并到了应用层）</p><p>对应主机进程，指本地主机与远程主机正在进行的会话</p><p>传输层</p><p>定义传输数据的协议端口号，以及流控和差错校验。</p><p>协议有：TCP UDP，数据包一旦离开网卡即进入网络传输层</p><p>网络层</p><p>进行逻辑地址寻址，实现不同网络之间的路径选择。</p><p>协议有：ICMP IGMP IP（IPV4 IPV6） ARP RARP</p><p>数据链路层</p><p>建立逻辑连接、进行硬件地址寻址、差错校验 [2] 等功能。（由底层网络定义协议）</p><p>将比特组合成字节进而组合成帧，用MAC地址访问介质，错误发现但不能纠正。</p><p>物理层</p><p>建立、维护、断开物理连接。（由底层网络定义协议）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">关于设备工作在哪一层！</span><br><span class="line"></span><br><span class="line">一个设备工作在哪一层，关键看它工作时利用哪一层的数据头部信息。网桥工作时，是以MAC头部来决定转发端口的，</span><br><span class="line">因此显然它是数据链路层的设备。</span><br><span class="line">具体说:</span><br><span class="line">物理层：网卡，网线，集线器，中继器，调制解调器</span><br><span class="line"></span><br><span class="line">数据链路层：网桥，交换机</span><br><span class="line"></span><br><span class="line">网络层：路由器</span><br></pre></td></tr></table></figure><h2 id="OSI七层特点"><a href="#OSI七层特点" class="headerlink" title="OSI七层特点"></a>OSI七层特点</h2><p>OSI七层由于太过严格，所以并没有应用在计算机中，而是基于其衍生了一个TCP&#x2F;IP四层模型，被广大操作系统所应用。</p><h1 id="TCP-IP四层网络模型"><a href="#TCP-IP四层网络模型" class="headerlink" title="TCP&#x2F;IP四层网络模型"></a>TCP&#x2F;IP四层网络模型</h1><h2 id="一、TCP-IP四层模型介绍"><a href="#一、TCP-IP四层模型介绍" class="headerlink" title="一、TCP&#x2F;IP四层模型介绍"></a>一、TCP&#x2F;IP四层模型介绍</h2><p>OSI的七层协议体系结构的概念清楚，理论也比较完整，但它既复杂又不实用，ISO制定的OSI参考模型的过于庞大、复杂招致了许多批评。由技术人员自己开发的TCP&#x2F;IP协议栈获得了更为广泛的应用。TCP&#x2F;IP体系结构则不同，它现在已经得到了非常广泛的应用，TCP&#x2F;IP是一个四层的体系结构。</p><p>它包含应用层、运输层、网际层和网络接口层（用网际层这个名字是强调这一层是为了解决不同网络的互连问题 ），不过从实质来讲，TCP&#x2F;IP只有最上面的三层，因为最下面的网络接口层基本上和一般的通信链路的功能上没有多大差别.</p><h2 id="二、TCP-IP四层模型"><a href="#二、TCP-IP四层模型" class="headerlink" title="二、TCP&#x2F;IP四层模型"></a>二、TCP&#x2F;IP四层模型</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926173143773.png" alt="image-20230926173143773"></p><p>每一层负责不同的功能:</p><p>链路层：有时也称作数据链路层或网络接口层，</p><p>通常包括操作系统中的设备驱动程序和计算机</p><p>中对应的网络接口卡。它们一起处理与电缆(或其他任何传输媒介)的物理接口细节。</p><p>网络层：有时也称作互联网层，处理分组在网络中的活动，例如分组的选路。在TCP&#x2F;IP协议族中，网络层协议包括IP协议(网际协议)，ICMP协议(Internet互联网控制报文协议 ，以及IGMP协议(Internet组管理协议 )。</p><p>运输层：主要为两台主机上的应用程序提供端到端的通信。在TCP&#x2F;IP 协议族中 ， 有两个互不相同的传输协议 : TCP (传输控制协议) 和UDP (用户数据报协议)。</p><p>TCP 为两台主机提供高可靠性的数据通信。它所做的工作包括把应用程序交给它的数据分 成合适的小块交给下面的网络层，确认接收到的分组，设置发送最后确认分组的超时时钟等。由于运输层提供了高可靠性的端到端的通信，因此应用层可以忽略所有这些细节。</p><p>而另一方面， UDP则为应用层提供一种非常简单的服务 。 它只是把称作数据报的分组从一台主机发送到另一台主机，但并不保证该数据报能到达另一端。任何必需的可靠 性必须由应用层来提供。 这两种运输层协议分别在不同的应用程序中有不同的用途，这一点将在后面看到。</p><p>应用层：负责处理特定的应用程序细节。几乎各种不同的 TCP&#x2F;IP实现都会提供下面这些通用的应用程序:</p><p>Telnet 远程登录。</p><p>FTP 文件传输协议。</p><p>SMTP 简单邮件传送协议。</p><p>SNMP 简单网络管理协议。</p><h3 id="TCP-IP协议簇"><a href="#TCP-IP协议簇" class="headerlink" title="TCP&#x2F;IP协议簇"></a>TCP&#x2F;IP协议簇</h3><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926173219050.png" alt="image-20230926173219050"></p><h3 id="一次C-S通信"><a href="#一次C-S通信" class="headerlink" title="一次C&#x2F;S通信"></a>一次C&#x2F;S通信</h3><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926173254867.png" alt="image-20230926173254867"></p><h1 id="传输层协议"><a href="#传输层协议" class="headerlink" title="传输层协议"></a>传输层协议</h1><p>TCP 和 UDP 是两种最为著名的传输层协议，二者都使用 I P 作 为 网 络 层 协 议</p><p>尽管 TCP 和 UDP 都使用相同的网络层( IP )， TCP 却向应用层提供与 UDP 完全不同的服务。 TCP 提供一种面向连接的、可靠的字节流服务。</p><p>TCP: 传输控制协议,面向连接的协议</p><p>面向连接意味着两个使用 TCP 的 应 用 ( 通 常 是 一 个 客 户 和 一 个 服 务 器 ) 在 彼 此 交 换 数 据 之前必须先建立一个 TCP 连 接 。</p><p>一对一传输</p><h2 id="tcp三次握手"><a href="#tcp三次握手" class="headerlink" title="tcp三次握手"></a>tcp三次握手</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926173337607.png" alt="image-20230926173337607"></p><h2 id="TCP四次断开"><a href="#TCP四次断开" class="headerlink" title="TCP四次断开"></a>TCP四次断开</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926173356094.png" alt="image-20230926173356094"></p><h2 id=""><a href="#" class="headerlink" title=""></a><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926173356094.png"></h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926173412419.png" alt="image-20230926173412419"></p><h2 id="UDP协议"><a href="#UDP协议" class="headerlink" title="UDP协议"></a>UDP协议</h2><p>UDP（User Datagram Protocol），用户数据报协议，是OSI(Open System Interconnection，开放式系统互联) 参考模型中一种无连接的传输层协议，提供面向事务的简单不可靠信息传送服务,UDP提供了无连接通信，适合于一次传输少量数据,UDP报文没有可靠性保证、顺序保证和流量控制字段等，可靠性较差。但是正因为UDP协议的控制选项较少，在数据传输过程中延迟小、数据传输效率高，适合对可靠性要求不高的应用程序，或者可以保障可靠性的应用程序，如DNS、TFTP、SNMP等。</p><p>可以一对一、一对多传输、多对一和多对多的交互通信</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926173432065.png" alt="image-20230926173432065"></p><h2 id="TCP与UDP区别："><a href="#TCP与UDP区别：" class="headerlink" title="TCP与UDP区别："></a>TCP与UDP区别：</h2><p>1、TCP面向连接（如打电话要先拨号建立连接）;UDP是无连接的，即发送数据之前不需要建立连接</p><p>2、TCP提供可靠的服务。也就是说，通过TCP连接传送的数据，无差错，不丢失，不重复，且按序到达;UDP尽最大努力交付，即不保证可靠交付，Tcp通过校验和，重传控制，序号标识，滑动窗口、确认应答实现可靠传输。如丢包时的重发控制，还可以对次序乱掉的分包进行顺序控制。</p><p>3、UDP具有较好的实时性，工作效率比TCP高，适用于对高速传输和实时性有较高的通信或广播通信。</p><p>4.每一条TCP连接只能是点到点的;UDP支持一对一，一对多，多对一和多对多的交互通信</p><p>5、TCP对系统资源要求较多，UDP对系统资源要求较少。</p><h1 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h1><h2 id="一、IP介绍"><a href="#一、IP介绍" class="headerlink" title="一、IP介绍"></a>一、IP介绍</h2><p>IP是英文Internet Protocol的缩写，意思是“网络之间互连的协议”，也就是为计算机网络相互连接进行通信而设计的协议。在因特网中，它是能使连接到网上的所有计算机网络实现相互通信的一套规则，规定了计算机在因特网上进行通信时应当遵守的规则。任何厂家生产的计算机系统，只要遵守IP协议就可以与因特网互连互通。正是因为有了IP协议，因特网才得以迅速发展成为世界上最大的、开放的计算机通信网络。因此，IP协议也可以叫做“因特网协议”。</p><p>IP地址是指互联网协议地址，IP地址是IP协议提供的一种统一的地址格式，它为互联网上的每一个网络和每一台主机分配一个逻辑地址。大家日常见到的情况是每台联网的PC上都需要有IP地址，才能正常通信。我们可以把“个人电脑”比作“一台电话”，那么“IP地址”就相当于“电话号码”，而Internet中的路由器，就相当于电信局的“程控式交换机”。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IP是一个协议，是计算机在网络中互联互通的规则</span><br><span class="line">IP地址是IP实现互联互通的一个策略</span><br></pre></td></tr></table></figure><h3 id="IP地址和Mac地址"><a href="#IP地址和Mac地址" class="headerlink" title="IP地址和Mac地址"></a>IP地址和Mac地址</h3><p>IP地址是软件地址，而不是硬件地址。硬件地址被硬编码到网络接口卡(NIC)中，用于在本地 网络中寻找主机。 IP地址让一个网络中的主机能够与另一个网络中的主机通信，而不管这些主机所属的LAN是什么类型的。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MAC用于局域网中通信，交换机通过mac地址将数据包转发到正确的计算机</span><br><span class="line">IP用于网络间通信</span><br></pre></td></tr></table></figure><h3 id="IP地址分类"><a href="#IP地址分类" class="headerlink" title="IP地址分类"></a>IP地址分类</h3><p>IPV4:32位二进制 以点分割，分为4段十进制数 a.b.c.d</p><p>IPV6:128位二进制 以冒号分割,分为8段十六进制数 a🅱️c:d:e:f:g:h</p><h2 id="二、IPV4地址"><a href="#二、IPV4地址" class="headerlink" title="二、IPV4地址"></a>二、IPV4地址</h2><p>IPV4地址长 32位，这些位被划分成 4组(称为字节或八位组)，每组8位,每组最大不超过255，我们可使用下面3种方法描述IP地址:</p><p>点分十进制表示，如 192.168.0.1。</p><p>二进制，如 11000000.10101000.00000000.00000001</p><p>十六进制，如 c0.a8.0.1。</p><p>上述示例表示的是同一个IP地址。对于IP编址时，十六进制表示没有点分十进制和二进制那样常用，但某些程序确实以十六进制形式存储IP地址， Windows注册表就将机器的IP地址存储为十六进制。</p><h3 id="IPV4地址分类"><a href="#IPV4地址分类" class="headerlink" title="IPV4地址分类"></a>IPV4地址分类</h3><p>按照第一段的范围分类</p><p>A 1-126</p><p>B 128-191</p><p>C 192-223</p><p>D 224-239</p><p>E 240-255</p><p>设计因特网的人决定根据网络规模创建网络类型。对于少量包含大量节点的网络，他们创建了A类网络;对于另一种极端情况的网络，他们创建了C类网络，用来指示大量只包含少量节点的网络; 介于超大型和超小型网络之间的是B类网络。所以IPV4五类地址中只有前三类可以分给用户试用，D类是多播地址，E类为保留地址，用于研究。</p><p>网络的类型决定了 IP地址将如何划分成网络部分和节点部分</p><h3 id="子网掩码"><a href="#子网掩码" class="headerlink" title="子网掩码"></a>子网掩码</h3><p>子网掩码：区分IP地址的网络位和主机位</p><p>255.0.0.0</p><p>255.255.0.0</p><p>255.255.255.0</p><p>255.255.255.255</p><p>网络位:掩码对应的IP位的二进制部分，全为1的部分是网络位</p><p>主机位:掩码对应的IP位的二进制部分，不全为1的部分是主机位</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926173643630.png" alt="image-20230926173643630"></p><h3 id="进制转换方法"><a href="#进制转换方法" class="headerlink" title="进制转换方法"></a>进制转换方法</h3><p>十进制转二进制: 除2取余倒着念</p><p>十进制转八进制: 除8取余倒着念</p><p>十进制转十六进制: 除16取余倒着念</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926173706096.png" alt="image-20230926173706096"></p><h3 id="8421法则转换法"><a href="#8421法则转换法" class="headerlink" title="8421法则转换法"></a>8421法则转换法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">把要转换的十进制数按照下列数累加，用的的写1没用的的写0</span><br><span class="line">128      64      32      16    8     4   2   1</span><br><span class="line"></span><br><span class="line">比如：十进制数132转换为二进制</span><br><span class="line">128      64      32      16    8     4   2   1</span><br><span class="line">1         0      0       0     0     1   0   0</span><br><span class="line"></span><br><span class="line">因为132=128+4</span><br><span class="line">所以十进制数132转换为二进制是<span class="string">&quot;10000100</span></span><br></pre></td></tr></table></figure><h3 id="私网地址"><a href="#私网地址" class="headerlink" title="私网地址"></a>私网地址</h3><p>由于互联网的蓬勃发展，IP位址的需求量愈来愈大，使得IP位址的发放愈趋严格，各项资料显示全球IPv4位址可能在2005至2010年间全部发完(实际情况是在2011年2月3日IPv4位地址分配完毕）。</p><p>为了解决IP地址不足，又设计了私有地址，这样就可以重复在局域网中使用了，LAN中的用户想上网只需通过PNAT的方式通过地址转换技术就可以上网，保证了公网地址的最大化、最高效应用。</p><p>A类地址中私网10.0.0.0–10.255.255.255</p><p>B类地址中私网172.16.0.0.0–172.31.255.255</p><p>C类地址中私网192.168.0.0–192.168.255.255</p><h3 id="PNAT技术"><a href="#PNAT技术" class="headerlink" title="PNAT技术"></a>PNAT技术</h3><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926173728881.png" alt="image-20230926173728881"></p><h3 id="IP分配原则"><a href="#IP分配原则" class="headerlink" title="IP分配原则"></a>IP分配原则</h3><p>只有A、B、C三类地址可以分配给计算机和网络设备</p><p>网络地址相同主机地址必须唯一</p><p>网络地址的第一个数字不能为127，保留用来测试连接</p><p>网络地址不能全为0，也不能全为1.</p><p>主机地址中不能全为0，也不能全为1：主机地址全为0用来表示网络地址，全为1用作广播</p><p><strong>ipv4特殊IP，不能使用的IP：</strong></p><p>0.0.0.0</p><p>255.255.255.255</p><p>127.x.x.x</p><p>A.0.0.0、A.255.255.255</p><p>169.254.0.0–168.254.255.255</p><h2 id="三、IPv6地址"><a href="#三、IPv6地址" class="headerlink" title="三、IPv6地址"></a>三、IPv6地址</h2><p>由于IPv4最大的问题在于网络地址资源有限，严重制约了互联网的应用和发展。IPv6的使用，不仅能解决网络地址资源数量的问题，而且也解决了多种接入设备连入互联网的障碍</p><p>互联网数字分配机构（IANA）在2016年已向国际互联网工程任务组（IETF）提出建议，要求新制定的国际互联网标准只支持IPv6，不再兼容IPv4。</p><h3 id="IPV6组成"><a href="#IPV6组成" class="headerlink" title="IPV6组成"></a>IPV6组成</h3><p>IPv6的地址长度为128位，是IPv4地址长度的4倍。于是IPv4点分十进制格式不再适用，采用十六进制表示。</p><h3 id="IPV6分类"><a href="#IPV6分类" class="headerlink" title="IPV6分类"></a>IPV6分类</h3><p>单播地址（Unicast Address）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用来唯一标识一个接口，类似于IPv4中的单播地址。发送到单播地址的数据报文将被传送给此地址所标识的一个接口。</span><br></pre></td></tr></table></figure><p>组播地址（Multicast Address）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">用来标识一组接口（通常这组接口属于不同的节点），类似于IPv4中的组播地址。发送到组播地址的数据报文被传送给此</span><br><span class="line">地址所标识的所有接口。</span><br></pre></td></tr></table></figure><p>任播地址（Anycast Address）</p><p>用来标识一组接口（通常这组接口属于不同的节点）。发送到任播地址的数据报文被传送给此地址所标识的一组接口中距离源节点最近（根据使用的路由协议进行度量）的一个接口，一对最近。</p><p>单播地址</p><p>可聚合的全球单播地址（Aggregatable Global Unicast Addresses）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">可在全球范围内路由和到达的，相当于IPv4里面的global addresses。前三个bit是001</span><br><span class="line"></span><br><span class="line">例如：2000::1:2345:6789:01ab</span><br></pre></td></tr></table></figure><p>链路本地地址（Link-Local Addresses）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">用于同一个链路上的相邻节点之间通信，相当于IPv4里面的169.254.0.0/16地址。Ipv6的路由器不会转发链路本地地址</span><br><span class="line">的数据包。前10个bit是1111 1110 10，由于最后是64bit的interface ID，所以它的前缀总是FE80::/64</span><br><span class="line"></span><br><span class="line">例如：FE80::1/10</span><br></pre></td></tr></table></figure><p>站点本地地址（Site-Local Addresses）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">对于无法访问internet的本地网络，可以使用站点本地地址，这个相当于IPv4里面的private address（10.0.0.0/8,</span><br><span class="line"> 172.16.0.0/12, and 192.168.0.0/16）。它的前10个bit是1111 1110 11，它最后是16bit的Subnet ID和</span><br><span class="line">64bit的interface ID，所以它的前缀是FEC0::/48。</span><br></pre></td></tr></table></figure><p>未指定地址（Unspecified address）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0:0:0:0:0:0:0:0 或者::</span><br><span class="line"></span><br><span class="line">当一个有效地址还不能确定，一般用未指定地址作为源地址。未指定地址不能作为一个目标地址来使用。</span><br></pre></td></tr></table></figure><p>回环地址（Loopback address）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">回环地址::1用于标识一个回环接口，可以使一个节点可以给自己发送数据包。相当于IPv4的回环地址127.0.0.1</span><br></pre></td></tr></table></figure><p>唯一的本地单播地址（ULA，Unique Local IPv6 Unicast Address）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在RFC4193中标准化了一种用来在本地通信中取代单播站点本地地址的地址。ULA拥有固定前缀FC00::/7，后面跟一个</span><br><span class="line">被称为全局ID的40bit随机标识符</span><br></pre></td></tr></table></figure><h3 id="IPV6特殊地址"><a href="#IPV6特殊地址" class="headerlink" title="IPV6特殊地址"></a>IPV6特殊地址</h3><p>下面列出一些绝对应该牢记的地址范围，因为我们总是会用到它们。它们都是特殊地址或保留用 于特定目的的地址，但不同于 IPv4， IPv6提供的地址非常多，因此保留一些不会有任何害处。</p><p>0:0:0:0:0:0:0:0 (::)相当于 IPv4地址 0.0.0札通常在使用有状态 DHCP配置时，用作主机 的源地址。</p><p>0:0:0:0:0:0:0:1 (::1) 相当于 IPv4地址 127.0.0.10</p><p>0:0:0:0:0:0:192.168.100.1 在同时支持 IP4和IPv6的网络中，从 IPv4地址转换而来的IPv6地址通常这样书写。</p><p>2000::&#x2F;3 全局单播地址范围。</p><p>FCOO::厅唯一的本地单播地址范围。</p><p>FE80::&#x2F;10 链路本地单播地址范围。</p><p>FFOO::&#x2F;8 组播地址范围。</p><p>3FFF:FFFF::&#x2F;32 保留举例和编写文档时使用。</p><p>2001:0088::&#x2F;32 保留举例和编写文档时使用。</p><p>2002::&#x2F;16 保留供 6t04隧道技术使用。 6t04隧道技术是一种从IPv4迁移到IPv6的方法，让IPv6分组能够通过IPv4 网络进行传输，而无需配置显式的隧道。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IPV6为啥这么多年没广泛应用</span><br><span class="line"></span><br><span class="line">网络黑白名单需要时间去建立，否则网络威胁无法解决。</span><br><span class="line"></span><br><span class="line">目前骨干线路已经全部使用了IPV6地址，随着物联网的出现，IPV6会更快完成替换。</span><br></pre></td></tr></table></figure><h2 id="四、VLSM可变长子网掩码"><a href="#四、VLSM可变长子网掩码" class="headerlink" title="四、VLSM可变长子网掩码"></a>四、VLSM可变长子网掩码</h2><p>VLSM(可变长子网掩码) 提供了在一个主类(A类、B类、C类)网络内包含多个子网的能力，可以对一个子网再进行子网划分,使IP地址得到最充分的利用.</p><h3 id="划分子网"><a href="#划分子网" class="headerlink" title="划分子网"></a>划分子网</h3><p>就是借用主机号的位充当网络号来扩大网络的个数</p><h3 id="VLSM优点"><a href="#VLSM优点" class="headerlink" title="VLSM优点"></a>VLSM优点</h3><p>VLSM技术可以避免固定长度子网掩码浪费地址空间的问题。</p><p>提高带宽利用率</p><p>实现LAN中的网络隔离，更加安全。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926173822537.png" alt="image-20230926173822537"></p>]]></content>
      
      
      <categories>
          
          <category> 李上网来 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机硬件组成</title>
      <link href="/2022/08/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/3.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BB%84%E6%88%90/"/>
      <url>/2022/08/03/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/3.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E7%BB%84%E6%88%90/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="计算机硬件-内存"><a href="#计算机硬件-内存" class="headerlink" title="计算机硬件-内存"></a>计算机硬件-内存</h1><h2 id="一、内存介绍"><a href="#一、内存介绍" class="headerlink" title="一、内存介绍"></a>一、内存介绍</h2><p>内存是计算机中最重要的部件，它是计算机中的一个中间件。解决了CPU和硬盘之间速度严重不对等的问题，是CPU和硬盘数据交互的桥梁。默认情况下，CPU从内存读写数据，内存从硬盘读写数据。为了提升效率，一般在开机或者软件在运行的时候，会将常用数据直接从硬盘直接读入内存，以待后续CPU使用，提高计算机运行效率。</p><h2 id="二、内存工作原理"><a href="#二、内存工作原理" class="headerlink" title="二、内存工作原理"></a>二、内存工作原理</h2><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926174501968.png" alt="image-20230926174501968"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">计算机在开机加载系统的时候，会把系统常用的数据从硬盘调入内存，方便CPU直接从内存获取数据，避免了从低速的硬盘</span><br><span class="line">拿数据造成用户等待，给用户不好的体验；当然用户在使用APP的时候也是同样的道理，所需数据都是优先存入到内存中。</span><br><span class="line">这是内存的读操作。当然，写操作也是一样的道理，也需要经过内存在到硬盘，用户在计算机操作过程中临时产生的数据</span><br><span class="line">也是暂存内存，通过用户保存或者内存数据刷新机制写入到硬盘。</span><br><span class="line"></span><br><span class="line">比如: 你创建了一个word文件，你往word文档写数据其实是先写到内存然后在由内存写到硬盘的。</span><br></pre></td></tr></table></figure><h2 id="三、内存分类"><a href="#三、内存分类" class="headerlink" title="三、内存分类"></a>三、内存分类</h2><p>内存条分为：笔记本、台式机两种</p><p>当然如果按厂商的话会有很多，这里推荐金士顿的，老牌子靠得住。</p><ul><li>台式机内存</li></ul><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926174528005.png" alt="image-20230926174528005"></p><ul><li>笔记本内存</li></ul><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926174606293.png" alt="image-20230926174606293"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">误区解读：内存越大越好吗？</span><br><span class="line">其实理论上是这样的，同时也需要你的金钱支撑，因为买很多大容量内存还是需要花很多钱的，同时还得主板支持。</span><br><span class="line">但是，还是需要根据自己的电脑运行业务的情况去定，很多家用电脑购买了只是简单的游戏或者办公，购买满配的内存其实</span><br><span class="line">真正的内存使用率确不到30%</span><br><span class="line">浪费了钱也浪费了资源，你懂了吗？</span><br></pre></td></tr></table></figure><h2 id="四、内存选购"><a href="#四、内存选购" class="headerlink" title="四、内存选购"></a>四、内存选购</h2><p>选购参数：容量、频率</p><p>选购多条内存或者升级计算机内存的时候，最好选购同品牌，同频率的产品，否则会有兼容问题，会造成蓝屏或重启。</p><h2 id="五、内存常见故障"><a href="#五、内存常见故障" class="headerlink" title="五、内存常见故障"></a>五、内存常见故障</h2><p>台式机开机点不亮显示器</p><p>台式机运行了一段后突然一天开机显示器不亮(点不亮)的情况，一般是由于内存条上的金手指（内存和主板插槽接触的铜片）氧化，拔下来用橡皮或者粗糙的纸擦擦就好了，如果条件允许就换个槽插上就行了。</p><h1 id="计算机硬件-硬盘"><a href="#计算机硬件-硬盘" class="headerlink" title="计算机硬件-硬盘"></a>计算机硬件-硬盘</h1><h2 id="一、硬盘介绍"><a href="#一、硬盘介绍" class="headerlink" title="一、硬盘介绍"></a>一、硬盘介绍</h2><p>硬盘是计算机中最重要的存储设备，负责永久性数据存储。目前常用的硬盘分为<strong>机械硬盘</strong>和<strong>固态硬盘</strong>两种，相比来说，固态硬盘速度快但是容量较小，价格高；机械硬盘速度慢但是容量大，价格便宜。</p><h3 id="机械硬盘"><a href="#机械硬盘" class="headerlink" title="机械硬盘"></a>机械硬盘</h3><p>机械硬盘是由磁盘片、磁头、马达、电路板等部件组成，分为2.5和3.5英寸两种，转速为5400转&#x2F;分、7200转&#x2F;分、10000转&#x2F;分、15000转&#x2F;分.笔记本采用的是2.5英寸的，台式机常用3.5英寸的。数据写在磁盘片的正反面的磁道上，磁盘片和光盘类似！</p><p>由于机械硬盘价格相对较低、容量大、技术稳定，所以深受广大计算机用户的喜爱。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926174652446.png" alt="image-20230926174652446"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">脑补：</span><br><span class="line">机械硬盘读写速度最快有多快</span><br><span class="line">机械硬盘最快的当属15000转/分的scsi接口磁盘，理论读写220MB/S</span><br></pre></td></tr></table></figure><h3 id="固态硬盘"><a href="#固态硬盘" class="headerlink" title="固态硬盘"></a>固态硬盘</h3><p>固态硬盘是一种新型硬盘，采用电信号存储，速度更快，深受广大计算机用户的喜爱，但是目前固态硬盘容量相对较小，价格较贵，还没有深度普及，又因为其存储的颗粒受擦写次数的限制，所以只是用在擦写不是很频繁的环境中。</p><ul><li>固态硬盘有sata固态、m.2固态、pci-e固态三种</li><li>m.2固态又有nvme的m.2和sata的m.2两种</li></ul><p>STAT接口的固态硬盘，目前很多笔记本电脑厂商使用这种固态硬盘，价格相对较低。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926174706399.png" alt="image-20230926174706399"></p><p>M.2 NVME接口硬盘，俗称口香糖硬盘，苹果笔记本大部分采用这种硬盘，价格相对较高。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926174718286.png" alt="image-20230926174718286"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">脑补：</span><br><span class="line">固态硬盘速度有多快</span><br><span class="line">目前不同厂家的固态硬盘读写速度不同，最快的nvme.m2 告诉SSD磁盘理论读写速度为3400MB/S</span><br></pre></td></tr></table></figure><h3 id="磁盘类型"><a href="#磁盘类型" class="headerlink" title="磁盘类型"></a>磁盘类型</h3><p>按接口分类:IDE、SCSI、SATA、SAS</p><h2 id="二、硬盘的选购"><a href="#二、硬盘的选购" class="headerlink" title="二、硬盘的选购"></a>二、硬盘的选购</h2><p>参考指标:容量、缓存、【转速】、读写速度</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926174741318.png" alt="image-20230926174741318"></p><h2 id="三、硬盘常见故障"><a href="#三、硬盘常见故障" class="headerlink" title="三、硬盘常见故障"></a>三、硬盘常见故障</h2><ul><li>磁盘坏道<br>硬盘属于计算机中的耗材设备，如果磁盘出现坏道会造成蓝屏或者数据读写慢，甚至数据无法读出。应该尽快更换硬盘。</li><li>电脑越用越慢<br>很多小伙伴的windows电脑越用越慢，常常抱怨，重装系统后感觉就好多了，这是为啥？<br>一般情况下windows电脑越用越慢的原因是因为windows系统在运行的时候会把运行日志都存储在安装系统的那个分区，随着时间推移，越存越多，自然该分区就越来越小了，每次在使用这个分区上的空间时都需要长时间寻找空闲空间造成等待，还因为数据量太大，从该分区找系统所使用的文件时间也会越来越长，所以用户体验特别不好。定期清理系统盘的垃圾是很有必要的。</li><li>家里电脑年代长了，升级内存后依然很慢<br>电脑年头久了，想升级一下电脑，所以加装了大内存，但是感觉提升很小。原因是可能同学对电脑的运行原理还不是很了解，可以看看上一节的内存工作原理。<br>其实电脑工作涉及的核心部件就三个：CPU、内存、硬盘<br>CPU一般是不会用完的，因为个人电脑CPU再老也能满足个人的日常使用，除非你玩很大的游戏或者高负荷运算。<br>内存是CPU连接硬盘的桥梁，只要日常查看内存监控的时候使用率到不了80%以上完全没必要投资升级<br>硬盘其实是电脑慢的罪魁祸首，因为CPU的数据得从硬盘读出或存入。读是硬盘交给内存，内存交给CPU；写是CPU交给内存，内存存入硬盘。当你发现CPU使用率不高，内存的也不高，但是电脑特慢，不用在找原因了，肯定是硬盘出问题了，一般是因为长时间的使用硬盘中的盘片有划伤了，所以在读数据时，读到划伤区域会读的特变慢！<br>兄台，换块固态吧！努一努，单车变摩托。</li></ul><h1 id="计算机硬件-主板"><a href="#计算机硬件-主板" class="headerlink" title="计算机硬件-主板"></a>计算机硬件-主板</h1><h2 id="主板介绍"><a href="#主板介绍" class="headerlink" title="主板介绍"></a>主板介绍</h2><p>主板是计算机中最重要的平台部件，也是电脑中最大的集成电路板，它直接或间接的将所有的设备连接在一起。主板的好坏直接决定了计算机速度的快慢和运行稳定。同时主板也提供了大量的设备接口，为计算机扩展功能提供了可能。</p><p>主板一般为矩形电路板，上面安装了组成计算机的主要电路系统，一般有BIOS芯片、I&#x2F;O控制芯片、键和面板控制开关接口、指示灯插接件、扩充插槽、主板及插卡的直流电源供电接插件等元件。</p><p>现在主板一般情况下都集成了三卡(显卡、网卡、声卡)，也有的只集成了声卡和网卡。</p><p>主板分为大板和小板两种，如果不是空间的限制，建议大家一律选择大板。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926174850694.png" alt="image-20230926174850694"></p><h2 id="主板选购"><a href="#主板选购" class="headerlink" title="主板选购"></a>主板选购</h2><p>参考指标：CPU平台、接口数量、支持的技术</p><h2 id="主板故障"><a href="#主板故障" class="headerlink" title="主板故障"></a>主板故障</h2><p>主板是高精密的集成电路板，出厂经过严格的检测，使用过程中如果不是外力，基本上不会被损坏。</p><h1 id="计算机硬件-显卡"><a href="#计算机硬件-显卡" class="headerlink" title="计算机硬件-显卡"></a>计算机硬件-显卡</h1><h2 id="显卡介绍"><a href="#显卡介绍" class="headerlink" title="显卡介绍"></a>显卡介绍</h2><p>显卡是计算机中最重要的图像输出设备，是将计算机系统所需要的显示信息进行转换驱动显示器，并向显示器提供逐行或隔行扫描信号，控制显示器的正确显示，是连接显示器和个人计算机主板的重要组件，是“人机对话”的重要设备之一。</p><p>显卡按照接口分类</p><ol><li>ISA</li><li>PCI</li><li>AGP</li><li>PCI-E</li></ol><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926174933556.png" alt="image-20230926174933556"></p><h2 id="显卡选购"><a href="#显卡选购" class="headerlink" title="显卡选购"></a>显卡选购</h2><p>显卡参考指标: 显存、位宽、频率</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926174948777.png" alt="image-20230926174948777"></p><h1 id="计算机硬件-机箱电源"><a href="#计算机硬件-机箱电源" class="headerlink" title="计算机硬件-机箱电源"></a>计算机硬件-机箱电源</h1><h2 id="机箱介绍与选购"><a href="#机箱介绍与选购" class="headerlink" title="机箱介绍与选购"></a>机箱介绍与选购</h2><p>机箱是用来装载计算机硬件的容器，可以起到对计算机硬件的保护作用。此外，电脑机箱具有屏蔽电磁辐射的重要作用。在购买机箱的时候，建议大家参考以下的指标：</p><p>1）抗静电</p><p>2）机箱质量</p><p>3）机箱散热</p><p>4）机箱质量不易变形</p><p>5）机箱空间能满足扩展需求</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926175008426.png" alt="image-20230926175008426"></p><p>机箱分类</p><ol><li>E-ATX加大型</li><li>ATX标准型</li><li>M-ATX紧凑型</li><li>MINI mini型</li></ol><h4 id="机箱选购"><a href="#机箱选购" class="headerlink" title="机箱选购"></a>机箱选购</h4><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926175023368.png" alt="image-20230926175023368"></p><h2 id="电源介绍与选购"><a href="#电源介绍与选购" class="headerlink" title="电源介绍与选购"></a>电源介绍与选购</h2><p>计算机属于弱电产品，也就是说部件的工作电压比较低，一般在正负12伏以内，并且是直流电。而普通的市电为220伏（有些国家为110伏）交流电，不能直接在计算机部件上使用。因此计算机和很多家电一样需要一个电源部分，负责将普通市电转换为计算机可以使用的电压，一般安装在计算机内部。计算机的核心部件工作电压非常低，并且由于计算机工作频率非常高，因此对电源的要求比较高。目前计算机的电源为开关电路，将普通交流电转为直流电，再通过斩波控制电压，将不同的电压分别输出给主板、硬盘、光驱等计算机部件。</p><p>电源是所有计算机获得电力的设备，是计算机的心脏部件。电源工作的稳定直接决定了电脑的稳定，所以在选购电源时，建议大家不要选购杂牌，一定选择正规的大厂品牌，同时要考虑电源的功率，要为后续升级硬件预留空间。</p><p>电源选购时应该注意以下指标:</p><p>1）品牌</p><p>2）提供的电源接口</p><p>3）电源功率</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926175037562.png" alt="image-20230926175037562"></p><h4 id="电源选购"><a href="#电源选购" class="headerlink" title="电源选购"></a>电源选购</h4><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926175054401.png" alt="image-20230926175054401"></p><h1 id="计算机硬件-网卡声卡"><a href="#计算机硬件-网卡声卡" class="headerlink" title="计算机硬件-网卡声卡"></a>计算机硬件-网卡声卡</h1><h2 id="一、网卡介绍"><a href="#一、网卡介绍" class="headerlink" title="一、网卡介绍"></a>一、网卡介绍</h2><p>网卡又叫网络接口卡，是计算机联网的设备。之前一直是独立存在的，后来被主板商集成在主板上。目前集成的网卡基本上都是10&#x2F;100&#x2F;1000M自适应网卡。</p><p>网卡分为有线网卡和无线网卡两种。</p><p>无线网卡遵循了IEEE802.11ac、a、b、g、n标准，标准不同速度不同，标准之间是向下兼容的。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">不同标准的无线网卡速度</span><br><span class="line">11Mbps（802.11b）</span><br><span class="line">22Mbps（802.11 Super b）</span><br><span class="line">54Mbps（802.11g/802.11a）</span><br><span class="line">108Mbps（802.11 Super G）</span><br><span class="line">125Mbps（802.11 High Speed-G）</span><br><span class="line">300Mbps（802.11n）</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926175118306.png" alt="image-20230926175118306"></p><h2 id="二、声卡介绍"><a href="#二、声卡介绍" class="headerlink" title="二、声卡介绍"></a>二、声卡介绍</h2><p>声卡 (Sound Card)也叫音频卡：声卡是多媒体技术中最基本的组成部分，是实现声波&#x2F;数字信号相互转换的一种硬件。</p><p>声卡的基本功能是把来自话筒、磁带、光盘的原始声音信号加以转换，输出到耳机、扬声器、扩音机、录音机等声响设备，或通过音乐设备数字接口(MIDI)使乐器发出美妙的声音。</p><p>现在电脑声卡基本上是集成在主板上的，除非特殊需要采购专业声卡，比如唱歌、影视频处理等。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926175131394.png" alt="image-20230926175131394"></p><h1 id="服务器品牌、型号介绍"><a href="#服务器品牌、型号介绍" class="headerlink" title="服务器品牌、型号介绍"></a>服务器品牌、型号介绍</h1><h2 id="一、服务器品牌介绍"><a href="#一、服务器品牌介绍" class="headerlink" title="一、服务器品牌介绍"></a>一、服务器品牌介绍</h2><p>1、戴尔（Dell），是一家总部位于美国德克萨斯州朗德罗克的世界五百强企业，由迈克尔·戴尔于1984年创立。戴尔以生产、设计、销售家用以及办公室电脑而闻名，不过它同时也涉足高端电脑市场，生产与销售服务器、数据储存设备、网络设备等</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926175150898.png" alt="image-20230926175150898"></p><p>2、惠普已经拆分成了两家独立的世界五百强。一个叫HPI 沿用惠普的名字主营pc和打印机，一个叫HPE也就是慧与，主营服务器。拆分主要是让两家公司对这两块业务更加专注，独立运营，惠普（HP）是世界最大的信息科技（IT）公司之一，成立于1939年，总部位于美国加利福尼亚州帕洛阿尔托市。惠普下设三大业务集团：信息产品集团、打印及成像系统集团和企业计算机专业服务集团。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926175202439.png" alt="image-20230926175202439"></p><p>3、浪潮集团有限公司，即浪潮集团，是中国本土综合实力强大的大型IT企业之一，中国领先的云计算、大数据服务商。浪潮集团旗下拥有浪潮信息、浪潮软件、浪潮国际、华光光电四家上市公司，业务涵盖云数据中心、云服务大数据、智慧城市、智慧企业四大产业群组，为全球100多个国家和地区提供IT产品和服务</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926175214737.png" alt="image-20230926175214737"></p><p>4、ThinkServer是2012年6月5日联想从全球向中国引进的全新服务器品牌，与Think一脉相承，恪守对品质的坚持，传承Think“品质”、“创新”、“易用”三大基因，共享联想全球研发和制造资源，并汲取全球用户对品质的要求，以精密的设计、业界最全面的质量标准、严苛的测试流程打造全球品质的产品</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926175225747.png" alt="image-20230926175225747"></p><p>5、华为技术有限公司是一家生产销售通信设备的民营通信科技公司，于1987年正式注册成立，是全球领先的信息与通信技术（ICT）解决方案供应商，专注于ICT领域，坚持稳健经营、持续创新、开放合作，在电信运营商、企业、终端和云计算等领域构筑了端到端的解决方案优势</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926175237231.png" alt="image-20230926175237231"></p><p>6、IBM（International Business Machines Corporation）。总公司在纽约州阿蒙克市。1911年托马斯·沃森创立于美国，是全球最大的信息技术和业务解决方案公司，拥有全球雇员31多万人，业务遍及160多个国家和地区。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926175246848.png" alt="image-20230926175246848"></p><p>以上的公司都是一个综合类型公司，生产和销售服务器只是他们的一项业务，除了上面介绍的几家公司之外还有思科，新华三，宝德等有服务器生产销售业务的公司。</p><h2 id="二、服务器规格介绍"><a href="#二、服务器规格介绍" class="headerlink" title="二、服务器规格介绍"></a>二、服务器规格介绍</h2><p>我们以机架式服务器为例来给各位介绍一下服务器规格，通常机架式服务器都有1U、2U、4U、6U、8U这几种规格，这里面提到了一个U的概念，U指的是高度也就是1U&#x3D;4.445cm高，所以机架式服务器对应的高度你就可以用1、2、4、6、8去乘以4.445去进行计算，而服务器的高度越大对应的可扩展性就越好，支持的硬件就越多，当然价格也就越高一些。通常企业中选购的服务器以2U的居多</p><h2 id="三、服务器型号介绍"><a href="#三、服务器型号介绍" class="headerlink" title="三、服务器型号介绍"></a>三、服务器型号介绍</h2><p>我们以典型的戴尔服务器和IBM的服务器为例来给大家介绍一下这两个厂商的服务器型号以及他们的命名规则</p><p>首先，我们来看下戴尔的服务器，从第十代服务器开始，戴尔重新规范的了服务器的名字，以PowerEdge R640为例</p><p>第一位是字母，R代表的是机架式服务器，除了R之外还有</p><ul><li>R：Rack，机架式服务器</li><li>T：Tower 塔式服务器</li><li>M：Modular 模块化服务器（刀片服务器）</li></ul><p>另外还有一个比较特别的系列，这个系列是为数据中心等提出的高密度服务器，也称为为服务器就是C</p><p>第二位是数字，这个数字代表此服务器在整个产品线中的位置</p><ul><li>1,2系列为基础入门级的单路CPU服务器，这个系列是中小型企业的首选</li><li>3,4,5系列为中高端的单路CPU和入门级的双路CPU服务器，包含有可选的高级系统管理功能，适合远程站点和较大的公司使用</li><li>6,7,8系列是主流的双路CPU和入门级四路CPU服务器，拥有强大的性能，能够满足大部分企业级应用需求</li><li>9系列是最高端的四路CPU服务器，用用强大的计算能力，支持超大内存，适合需要最高性能，可靠性以及I&#x2F;O可扩展的关键任务应用程序</li></ul><p>第三位是数字，代表的是第几代产品</p><ul><li>目前戴尔最新的服务器是第十四代产品所以这个数字是4</li></ul><p>最后一位是数字</p><ul><li>0代表的是intel的CPU，5代表的是AMD的CPU</li></ul><p>接下来我们看下IBM的服务器</p><p>IBM服务器，主要包括i系列、p系列、x系列、z系列。</p><ul><li>i系列的服务器产品一直被大家命名为“小型机“，i系列服务器一般是终端产品，该系列产品用户主要是将众多的小型服务器合并到更少量的i系列产品中，i系列采用IBM POWER微处理器技术。</li><li>p系列也是基于POWER处理器的服务器，运行AIX（IBM版Unix）和Linux，p系列是IBM Unix服务器产品线的根基，有机架式和机柜式。</li><li>x系列全部基于X86架构处理器，也和DELL、HP一样包括塔式服务器、机架式服务器和刀片服务器。如IBM X3850 X5服务器来说明命名规则，x3表明是x3架构下的服务器，第二位的8表明性能，数字越大表示性能越强，第三位的5表示机架式，如果是2或者3也表示机架式，如果第三位是0则表示塔式，如X3500服务器即为塔式服务器，第四位的0表示采用的是intel的CPU，5表示用的是AMD的CPU，最后的两位x5则是表示内存技术、内存扩展能力。</li><li>z系列为大型机，都为机柜式结构，该系列产品相当高端，是IBM的支柱产品。</li></ul><h2 id="四、如何购买"><a href="#四、如何购买" class="headerlink" title="四、如何购买"></a>四、如何购买</h2><p>对于服务器产品的购买，现在的渠道相对来说比较多，可以去京东，淘宝，或者各家服务器的官网，货比三家之后购买会有惊喜</p><h2 id="五、服务器内部结构"><a href="#五、服务器内部结构" class="headerlink" title="五、服务器内部结构"></a>五、服务器内部结构</h2><p>对于刀片式服务器，从大体上为存储模块，散热模块，计算模块（包含CPU，内存等）供电模块和其他扩展模块这几部分组成，不同类型的布局上会稍微有些差异，下面的两张图片分别是戴尔和IBM的产品</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926175308385.png" alt="image-20230926175308385"></p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926175316577.png" alt="image-20230926175316577"></p><h2 id="六、机柜介绍"><a href="#六、机柜介绍" class="headerlink" title="六、机柜介绍"></a>六、机柜介绍</h2><p>机柜一般是冷轧钢板或合金制作的用来存放计算机和相关控制设备的物件，可以提供对存放设备的保护，屏蔽电磁干扰，有序、整齐地排列设备，方便以后维护设备。机柜一般分为服务器机柜、网络机柜、控制台机柜等。我们以服务器机柜为例，服务器机柜在机柜的深度、高度、承重等方面均有要求。高度有2.2米、2.0米、1.8米、1.6米、1.4米、1.2米等高度；宽度为800mm、700mm或600mm三种；深度为800mm、900mm和1000mm三种，对应的是47U、42U、37U、32U、27U、22U，可以配置：专用固定托盘、专用滑动托盘、电源支架、地脚轮、地脚钉、理线环、理线架、L支架、扩展横梁等。主体框架、前后门、左右侧门可以快速拆装。</p><p><img src="https://cdn.jsdelivr.net/gh/liqigg/picgo/img/image-20230926175330810.png" alt="image-20230926175330810"></p>]]></content>
      
      
      <categories>
          
          <category> 李上网来 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机硬件组成 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机原理</title>
      <link href="/2022/08/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/2.%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/"/>
      <url>/2022/08/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/2.%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="计算机的组成原理"><a href="#计算机的组成原理" class="headerlink" title="计算机的组成原理"></a>计算机的组成原理</h1><h2 id="1-1、什么是计算机"><a href="#1-1、什么是计算机" class="headerlink" title="1.1、什么是计算机"></a>1.1、什么是计算机</h2><p>俗称电脑，即通电的大脑，电脑二字蕴含了人类对计算机的终极期望，希望它能真的像人脑一样去工作，从而解放人力。</p><h2 id="1-2、为什么要用计算机"><a href="#1-2、为什么要用计算机" class="headerlink" title="1.2、为什么要用计算机"></a>1.2、为什么要用计算机</h2><p>世界是由聪明的懒人统治的，任何时期，总有一群聪明的懒人想要奴隶别人。在奴隶制社会，聪明的懒人奴役的是真正的人，而人是无法不吃、不喝、不睡觉一直工作的，但是计算机作为一台机器是可以做到的，所以把计算机当奴隶是上上之选。</p><h2 id="1-3、计算机的五大组成部分"><a href="#1-3、计算机的五大组成部分" class="headerlink" title="1.3、计算机的五大组成部分"></a>1.3、计算机的五大组成部分</h2><p>计算机有五大组成部分，既然计算机是人的奴隶，那么计算机设计核心肯定也是在模仿真正的人，所以我们完全可以把计算机的五大组件比喻成人类的各种器官</p><h4 id="1-3-1、控制器"><a href="#1-3-1、控制器" class="headerlink" title="1.3.1、控制器"></a>1.3.1、控制器</h4><p>控制器是计算机的指挥系统，用来控制计算机其他组件的运行，相当于人类的大脑</p><h4 id="1-3-2、运算器"><a href="#1-3-2、运算器" class="headerlink" title="1.3.2、运算器"></a>1.3.2、运算器</h4><p>运算器是计算机的运算功能，用来做算术运算和逻辑运算，相当于人脑。</p><p>ps：控制器+运算器&#x3D;CPU，cpu相当于人的大脑</p><h4 id="1-3-3、存储器"><a href="#1-3-3、存储器" class="headerlink" title="1.3.3、存储器"></a>1.3.3、存储器</h4><p>存储器是计算机的记忆功能，用来存取数据。</p><p>存储器主要分为内存与外存：</p><p> 内存相当于人的短期记忆。断电数据丢失</p><p> 外存(如磁盘),相当于记事的本子，断电数据不会丢失，是用来永久保存数据的</p><p> ps：内存的存取速度要远远高于外存</p><h4 id="1-3-4、输入设备input"><a href="#1-3-4、输入设备input" class="headerlink" title="1.3.4、输入设备input"></a>1.3.4、输入设备input</h4><p>输入设备是计算接收外界输入数据的工具，如键盘、鼠标，相当于人的眼睛或耳朵。</p><h4 id="1-3-5、输出设备output"><a href="#1-3-5、输出设备output" class="headerlink" title="1.3.5、输出设备output"></a>1.3.5、输出设备output</h4><p>输出设备是计算机向外输出数据的工具，如显示器、打印机，相当于人说的话，写出的文章。</p><p>ps：存储器如内存、磁盘等既是输入设备又是输出设备，统称为IO设备</p><h5 id="一个非常重要的基础知识-与运行程序相关的三大核心硬件"><a href="#一个非常重要的基础知识-与运行程序相关的三大核心硬件" class="headerlink" title="一个非常重要的基础知识:与运行程序相关的三大核心硬件"></a>一个非常重要的基础知识:与运行程序相关的三大核心硬件</h5><p>我们编写的程序一定是要运行于计算机硬件之上，而站在硬件的角度，与运行程序有关的三大核心硬件为CPU、内存、硬盘。</p><p>程序最先是存放于硬盘中的，程序的运行是先从硬盘把代码加载到内存中，然后cpu是从内存中读取指令运行。</p><h2 id="计算机的硬件组成"><a href="#计算机的硬件组成" class="headerlink" title="计算机的硬件组成"></a>计算机的硬件组成</h2><p>专业名词: I&#x2F;O </p><p>I: input (输入)</p><p>O: output (输出)</p><p>磁盘I&#x2F;O: 吞吐量</p><ul><li><p>鼠标</p></li><li><p>键盘</p></li><li><p>显示器</p><ul><li>输出图形话界面</li></ul></li><li><p>主机箱</p><ul><li>主板: 集成所有的硬件，给硬件提供电源</li><li>CPU: 计算数据，处理功能(多线程处理应用)</li><li>内存: 临时存储数据</li><li>磁盘: 永久存储数据(持久化)</li><li>显卡</li><li>声卡</li><li>网卡：无线网卡(WLAN),有线网卡(以太网)</li><li>电源</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 李上网来 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机发展历史</title>
      <link href="/2022/08/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/1.%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8F%91%E5%B1%95%E5%8E%86%E5%8F%B2/"/>
      <url>/2022/08/01/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9F%A5%E8%AF%86/1.%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8F%91%E5%B1%95%E5%8E%86%E5%8F%B2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="了解计算机发展历史"><a href="#了解计算机发展历史" class="headerlink" title="了解计算机发展历史"></a>了解计算机发展历史</h1><h2 id="一、计算机定义"><a href="#一、计算机定义" class="headerlink" title="一、计算机定义"></a>一、计算机定义</h2><p>计算机（computer）俗称电脑，是现代一种用于高速计算的电子计算机器，可以进行数值计算，又可以进行逻辑计算，还具有存储记忆功能。是能够按照程序运行，自动、高速处理海量数据的现代化智能电子设备。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">计算机光有硬件是没法工作的，因为人无法和硬件(CPU/硬盘/光驱等)交流的，你说的它也听不懂，所以需要一个媒介来</span><br><span class="line">帮助你管理这些硬件，驱动硬件干活，能听懂的的指令，管理你的所有app。这个媒介就是操作系统，比如windows</span><br><span class="line"> Linux Unix Android ios等这些都是操作系统，所以一个可以让人使用的完整的计算机必须包括干活的硬件和辅助</span><br><span class="line">人类使用的操作系统软件</span><br></pre></td></tr></table></figure><h2 id="二、计算机分类"><a href="#二、计算机分类" class="headerlink" title="二、计算机分类"></a>二、计算机分类</h2><ul><li>超级计算机</li></ul><p>超级计算机是计算机中功能最强、运算速度最快、存储容量最大的一类计算机，多用于国家高科技领域和尖端技术研究，是一个国家科研实力的体现，它对国家安全，经济和社会发展具有举足轻重的意义。是国家科技发展水平和综合国力的重要标志。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">中国超级计算机: 天河2号 神威蓝光 曙光星云等</span><br></pre></td></tr></table></figure><p>超级计算机一般用在科研、超级运算、航天等领域，因为价格超级昂贵(注意我的措辞：昂贵，大家脑补吧)，一般不会被企业和个人购买和使用，所以我们一般是看不到这样的机器的，大家了解这种神一样的机器是存在的就可以了。有的小伙伴问过我，像阿里云、京东云等这样的云计算公司会不会用到这样的机器呢？<br>答案是肯定的：不会<br>原因是：</p><ol><li>价格是第一要素</li><li>弹性伸缩很难实现</li><li>运营成本太高</li></ol><ul><li>工业控制计算机</li></ul><p>工控机（Industrial Personal Computer，IPC）即工业控制计算机，是一种采用总线结构，对生产过程及机电设备、工艺装备进行检测与控制的工具总称。工控机具有重要的计算机属性和特征，如具有计算机主板、CPU、硬盘、内存、外设及接口，并有操作系统、控制网络和协议、计算能力、友好的人机界面。工控行业的产品和技术非常特殊，属于中间产品，是为其他各行业提供稳定、可靠、嵌入式、智能化的工业计算机。</p><p>工控机的主要类别有：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IPC（PC总线工业电脑）</span><br><span class="line">PLC（可编程控制系统）</span><br><span class="line">DCS（分散型控制系统）</span><br><span class="line">FCS（现场总线系统）</span><br><span class="line">CNC（数控系统）</span><br></pre></td></tr></table></figure><ul><li>网络计算机<br>网络计算机的特点是无盘，是瘦版的计算机，数据由由服务器提供网络上的程序或存储。网络计算机具有自己的处理能力，但除核心软件之外，其他软件都需从网络服务器下载，节省了频繁的软件升级和维护，也降低了成本。</li><li>个人计算机<br>个人计算机由硬件系统和软件系统组成，是一种能独立运行，完成特定功能的设备。</li><li>嵌入式计算机<br>嵌入式技术就是”专用”计算机技术，这个专用，是指针对某个特定的应用，如针对网络、针对通信、针对音频、针对视频，针对工业控制等，从学术的角度，嵌入式系统是以应用为中心，以计算机技术为基础，并且软硬件可裁剪，适用于应用系统对功能、可靠性、成本、体积、功耗有严格要求的专用计算机系统，它一般由嵌入式微处理器、外围硬件设备、嵌入 式操作系统以及用户的应用程序等四个部分组成。</li></ul><h2 id="三、计算机的发展史"><a href="#三、计算机的发展史" class="headerlink" title="三、计算机的发展史"></a>三、计算机的发展史</h2><p><strong>第1代：电子管数字机（1946—1958年）</strong></p><p>世界上第一台电脑硬件方面，逻辑元件采用的是真空电子管，主存储器采用汞延迟线、阴极射线示波管静电存储器、磁鼓、磁芯；外存储器采用的是磁带。软件方面采用的是机器语言、汇编语言。应用领域以军事和科学计算为主。特点是体积大、功耗高、可靠性差。速度慢（一般为每秒数千次至数万次）、价格昂贵，但为以后的计算机发展奠定了基础。</p><p><strong>第2代：晶体管数字机（1958—1964年）</strong></p><p>硬件方的操作系统、高级语言及其编译程序。应用领域以科学计算和事务处理为主，并开始进入工业控制领域。特点是体积缩小、能耗降低、可靠性提高、运算速度提高（一般为每秒数10万次，可高达300万次）、性能比第1代计算机有很大的提高。</p><p><strong>第3代：集成电路数字机（1964—1970年）</strong></p><p>硬件方面，逻辑元件采用中、小规模集成电路（MSI、SSI），主存储器仍采用磁芯。软件方面出现了分时操作系统以及结构化、规模化程序设计方法。特点是速度更快（一般为每秒数百万次至数千万次），而且可靠性有了显著提高，价格进一步下降，产品走向了通用化、系列化和标准化等。应用领域开始进入文字处理和图形图像处理领域。</p><p><strong>第4代：大规模集成电路机（1970年至今）</strong></p><p>硬件方面，逻辑元件采用大规模和超大规模集成电路（LSI和VLSI）。软件方面出现了数据库管理系统、网络管理系统和面向对象语言等。特点是1971年世界上第一台微处理器在美国硅谷诞生，开创了微型计算机的新时代。应用领域从科学计算、事务管理、过程控制逐步走向家庭。</p><p>推动计算机高速发展的重要人物–冯.诺依曼<br>1944年，美籍匈牙利数学家 冯·诺依曼 提出计算机基本结构和工作方式的设想，为计算机的诞生和发展提供了理论基础。时至今日，尽管计算机软硬件技术飞速发展，但计算机本身的体系结构并没有明显的突破，当今的计算机仍属于冯·诺依曼架构。</p><p><strong>计算机快速发展的贡献者–冯.诺依曼，提出了计算机的冯.诺依曼体系。</strong></p><p><strong>冯.诺依曼计算机体系的部分内容：</strong><br>1）计算机硬件设备由存储器、运算器、控制器、输入设备和输出设备5部分组成。<br>2）采用二进制形式表示数据和指令。<br>3） 将程序（数据和指令序列）预先存放在主存储器中，使计算机在工作时能够自动高速地从存储器中取出指令，并加以执行。</p>]]></content>
      
      
      <categories>
          
          <category> 李上网来 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机发展历史 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
